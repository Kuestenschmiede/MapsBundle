/*! For license information please see src_Resources_public_js_components_c4g-geosearch_jsx.bundle.1b7a769c85c8adad0a47.js.LICENSE.txt */
"use strict";(self.webpackChunkmapsbundle=self.webpackChunkmapsbundle||[]).push([["src_Resources_public_js_components_c4g-geosearch_jsx"],{"./src/Resources/public/js/components/c4g-geosearch.jsx":(e,t,o)=>{var s=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),n=o("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(o("./node_modules/@babel/runtime/helpers/typeof.js")),l=s(o("./node_modules/@babel/runtime/helpers/classCallCheck.js")),r=s(o("./node_modules/@babel/runtime/helpers/createClass.js")),i=s(o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=s(o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),u=s(o("./node_modules/@babel/runtime/helpers/inherits.js")),p=function(e){if("function"==typeof WeakMap){var t=new WeakMap;new WeakMap}return function(e){if(e&&e.__esModule)return e;var o,s,a={__proto__:null,default:e};if(null===e||"object"!=n(e)&&"function"!=typeof e)return a;if(o=t){if(o.has(e))return o.get(e);o.set(e,a)}for(var l in e)"default"!==l&&{}.hasOwnProperty.call(e,l)&&((s=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,l))&&(s.get||s.set)?o(a,l,s):a[l]=e[l]);return a}(e)}(o("./node_modules/react/index.js")),h=o("./node_modules/ol/control.js"),d=o("./src/Resources/public/js/c4g-maps-i18n.js"),m=o("./src/Resources/public/js/c4g-maps-constant.js"),g=o("./node_modules/ol/proj.js"),f=o("./node_modules/ol/easing.js"),C=o("./node_modules/ol/source.js"),y=o("./node_modules/ol/layer.js"),v=o("./node_modules/ol/style.js"),b=o("./node_modules/ol/index.js"),k=o("./node_modules/ol/geom.js"),S=o("./node_modules/ol/render.js"),R=o("./node_modules/ol/Observable.js"),w=o("./src/Resources/public/js/c4g-maps-utils.js"),j=o("./node_modules/ol/extent.js");function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_=function(){return!!e})()}var E=p.default.lazy(function(){return o.e("src_Resources_public_js_components_c4g-geosearch-results_jsx").then(o.bind(o,"./src/Resources/public/js/components/c4g-geosearch-results.jsx"))}),x=p.default.lazy(function(){return Promise.resolve().then(o.bind(o,"./src/Resources/public/js/components/c4g-titlebar.jsx"))});t.default=function(e){function t(e){var o,s,n,a;(0,l.default)(this,t),s=this,n=t,a=[e],n=(0,c.default)(n),(o=(0,i.default)(s,_()?Reflect.construct(n,a||[],(0,c.default)(s).constructor):n.apply(s,a))).langConstants=(0,d.getLanguage)(e.mapController.data),o.clickControl=o.clickControl.bind(o),o.doneFunction=o.doneFunction.bind(o);var r=document.createElement("div"),u=document.createElement("button");if(e.mapController.data.themeData&&e.mapController.data.themeData.controlLabels){var p=document.createElement("span");p.innerText=o.langConstants.CTRL_GEOSEARCH,u.appendChild(p)}else u.setAttribute("aria-label",o.langConstants.CTRL_GEOSEARCH),u.setAttribute("title",o.langConstants.CTRL_GEOSEARCH);if(r.className="c4g-geosearch ol-control ol-unselectable",r.appendChild(u),jQuery(u).on("click",function(){o.clickControl()}),e.external&&(r.className+=" c4g-external"),e.mapController.data.geosearch.inputCssSelector){var m=document.querySelector(e.mapController.data.geosearch.inputCssSelector);m.setAttribute("id","c4g-geosearch-input"),m.addEventListener("keydown",function(e){o.inputCallback(e)}),m.addEventListener("input",function(e){o.deleteCallback(e)}),o.input=m}else{var g=document.createElement("input");g.setAttribute("id","c4g-geosearch-input"),e.collapsed?jQuery(g).addClass("c4g-close"):jQuery(g).addClass("c4g-open"),g.addEventListener("keydown",function(e){o.inputCallback(e)}),g.addEventListener("input",function(e){o.deleteCallback(e)}),r.appendChild(g),o.input=g;var f=document.createElement("span");f.addEventListener("click",function(){o.clickControl(!0)}),jQuery(f).addClass("searchSpan");var C=document.createElement("i");C.innerHTML='<i class="far fa-times-circle"></i>',f.appendChild(C),r.appendChild(f)}o.controlElement=r;var y=new h.Control({element:r,target:e.target}),v=e.mapController.arrComponents.findIndex(function(e){return"geosearch"===e.name});if(e.mapController.arrComponents[v].control=y,e.mapController.mapsControls.controls.geosearch=y,o.config={},e.mapController.data.geosearch.searchKey&&e.mapController.data.geosearch.url?(o.config.url=e.mapController.data.geosearch.url+"search.php",o.config.key=e.mapController.data.geosearch.searchKey,o.config.params=e.mapController.data.geosearch.params):o.config.url=e.mapController.data.api.geosearch+"/"+e.mapController.data.profile,o.config.zoomlevel=e.searchZoom,o.config.zoombounds=e.zoomBounds,o.config.quicksearch=e.quicksearch||!0,o.config.animate=e.animate,o.config.markResult=e.markResult,o.config.animateDuration=e.animateDuration,o.config.resultDuration=e.resultDuration,o.config.popup=e.popup,o.config.autopick=e.autopick,o.config.mapController=e.mapController,o.config.results=e.results,o.config.resultStyle=e.resultStyle,o.config.resultStyle&&parseInt(o.config.resultStyle,10)>0){var b=o;e.mapController.proxy.locationStyleController.arrLocStyles[o.config.resultStyle]?o.config.resultStyle=e.mapController.proxy.locationStyleController.arrLocStyles[o.config.resultStyle].style:e.mapController.proxy.locationStyleController.loadLocationStyles([o.config.resultStyle],{done:function(){b.config.resultStyle=e.mapController.proxy.locationStyleController.arrLocStyles[b.config.resultStyle].style}})}return o.config.collapsed=e.collapsed,o.config.resultCount=e.resultCount,o.config.caching=e.caching,o.config.placeholder=e.placeholder,o.state={open:!e.collapsed,query:"",results:[],currentCoordinate:[],openResults:!1,currentResult:null},o.inputCallback=o.inputCallback.bind(o),o.deleteCallback=o.deleteCallback.bind(o),o.startSearch=o.startSearch.bind(o),o.zoomTo=o.zoomTo.bind(o),o.closeResults=o.closeResults.bind(o),o.openResults=o.openResults.bind(o),o.close=o.close.bind(o),o.closeResultsCompletely=o.closeResultsCompletely.bind(o),o}return(0,u.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this,t=this.state.open&&this.state.openResults?"c4g-open":"c4g-close";this.props.extDiv&&(t+=" external ");var o="";this.state.openResults&&this.config.results&&(o=p.default.createElement(E,{className:t,results:this.state.results,extDiv:this.props.extResultsDiv,zoomFunc:function(t){e.setState({currentResult:e.state.results[t]}),e.zoomTo(t)},closeResults:this.closeResults,headline:this.props.resultsHeadline,currentResult:this.state.currentResult,resultsDiv:this.props.resultsDiv,open:this.state.results.length>0,openResults:this.openResults,closeCb:this.closeResultsCompletely}));var s="",n="";this.props.external||(s="c4g-titlebar-close",n=this.clickControl);var a=this.props.headline;a||(a=this.langConstants.GEOSEARCH);var l=null;return this.props.external&&(l=p.default.createElement("div",{className:"c4g-geosearch-filter"},p.default.createElement("input",{type:"text",onInput:this.deleteCallback,onKeyDown:this.inputCallback,id:"c4g-geosearch-input",placeholder:this.config.placeholder,"aria-label":this.config.placeholder}),p.default.createElement("button",{className:m.cssConstants.GEOSEARCH_START,type:"button",title:this.langConstants.CTRL_START_SEARCH,onMouseUp:this.startSearch}))),this.props.external||this.state.open&&this.state.openResults?p.default.createElement(p.default.Fragment,null,p.default.createElement("div",{className:m.cssConstants.GEOSEARCH_WRAPPER+" "+t+" c4g-horizon"},p.default.createElement(p.Suspense,{fallback:p.default.createElement("div",null,"Loading...")},p.default.createElement(x,{wrapperClass:"c4g-geosearch-header",header:a,headerClass:"c4g-geosearch-headline",detailBtnClass:"",detailBtnCb:"",closeBtnClass:s,closeBtnCb:n,closeBtnTitle:this.langConstants.CLOSE})),l,o)):null}},{key:"closeResultsCompletely",value:function(){this.setState({openResults:!1})}},{key:"componentDidUpdate",value:function(e,t,o){if(this.props.mapController&&this.props.mapController.data&&this.props.mapController.data.geosearch&&this.props.mapController.data.geosearch.results&&(this.state.open?(t.open!==this.state.open&&this.state.results&&this.state.results.length&&this.props.mapController.setOpenComponent(this),this.state.openResults&&!this.props.extResultsDiv&&jQuery(".c4g-geosearch-container-right").addClass("c4g-open").removeClass("c4g-close")):jQuery(".c4g-geosearch-container-right").addClass("c4g-close").removeClass("c4g-open"),this.props.mapController.data.caching)){var s=w.utils.getValue("panel");"GeoSearch"!==s||this.state.open?"GeoSearch"!==s&&this.state.open&&w.utils.storeValue("panel","GeoSearch"):w.utils.storeValue("panel","")}}},{key:"close",value:function(){this.setState({open:!1})}},{key:"startSearch",value:function(e){e.stopPropagation();var t=document.querySelector(m.cssConstants.GEOSEARCH_START);try{t.blur()}catch(e){}var o=jQuery("#c4g-geosearch-input");o.val()&&this.findLocation(o.val())}},{key:"inputCallback",value:function(e){if(e.stopPropagation(),13===e.which){var t=jQuery("#c4g-geosearch-input");return t.val()&&this.findLocation(t.val()),!1}}},{key:"deleteCallback",value:function(e){e.stopPropagation();var t=jQuery("#c4g-geosearch-input").val();if(this.lastVal!==t&&(this.lastVal=t,t.length<1)){var o=this.props.mapController.arrComponents.findIndex(function(e){return"layerswitcher"===e.name});o>-1&&this.props.mapController.arrComponents[o]&&this.props.mapController.arrComponents[o].component.applyOldState("searchResults")}}},{key:"clickControl",value:function(e){(void 0!==e?e:this.state.open)?(this.setState({open:!1}),this.props.external||jQuery(this.input).addClass("c4g-close").removeClass("c4g-open")):(this.setState({open:!0}),this.props.external||(jQuery(this.input).removeClass("c4g-close").addClass("c4g-open"),this.input.focus()))}},{key:"closeResults",value:function(){this.setState({detailOpenResults:!1})}},{key:"openResults",value:function(){this.setState({detailOpenResults:!0})}},{key:"findLocation",value:function(e,t){var o,s=this;if((o=this.props.mapController).map,o.spinner.show(),this.config.animate,this.config.animateDuration,this.config.markResult,"object"===(0,a.default)(t)&&(void 0!==t.animate&&t.animate,void 0!==t.markResult&&t.markResult),this.config.quicksearch){var n={format:"json",q:e};if(this.config.resultCount&&(n.limit=this.config.resultCount),this.config.key&&(n.key=this.config.key),this.config.params)for(var l in this.config.params)this.config.params.hasOwnProperty(l)&&(n[l]=this.config.params[l]);var r=w.utils.callHookFunctions(window.c4gMapsHooks.hook_search,[n,this]);if(r&&r.length>0)for(var i in this.config.mapController.spinner.hide(),r)r.hasOwnProperty(i)&&this.doneFunction(r[i]);else if(jQuery.ajax({dataType:"json",url:this.config.url,data:n}).done(this.doneFunction).fail(function(){}).always(function(){s.config.mapController.spinner.hide()}),o.data.geosearch.showOnlyResults){var c=o.arrComponents.findIndex(function(e){return"layerswitcher"===e.name});if(c>-1&&o.arrComponents[c]){var u=o.arrComponents[c].component;u.buttonEnabled&&u.toggleAllLayers("searchResults")}}}}},{key:"doneFunction",value:function(e){var t,o,s,n,a=this.props.mapController,l=a.map,r=this.config.animate,i=(this.config.animateDuration,this.config.markResult);if(e&&e.length&&e.length>0){if(t=l.getView(),e[0])if(n=e[0],this.results=e,n.hasOwnProperty("uuid")){var c=a.arrComponents.findIndex(function(e){return"layerswitcher"===e.name}),u=!1;c>-1&&a.arrComponents[c]&&(u=a.arrComponents[c].component);var p=[],h=[];for(var m in this.results)this.results.hasOwnProperty(m)&&(this.results[m].hasOwnProperty("uuid")&&p.push(this.results[m].uuid),this.results[m].hasOwnProperty("lon")&&this.results[m].hasOwnProperty("lat")&&this.results[m].lon&&this.results[m].lat&&h.push((0,g.transform)([parseFloat(this.results[m].lon),parseFloat(this.results[m].lat)],"EPSG:4326","EPSG:3857")));a.data.geosearch.showOnlyResults&&u&&u.toggleSpecificLayers(p);var f=l.getSize(),C=(0,j.boundingExtent)(h),y={duration:250,padding:[f[1]/10,f[0]/10,f[1]/10,f[0]/10]};l.getView()&&h.length>0&&C&&y&&l.getView().fit(C,y)}else o=t.getCenter(),s=(0,g.transform)([parseFloat(n.lon),parseFloat(n.lat)],"EPSG:4326","EPSG:3857"),r?this.flyTo(l,s,this.config.zoomlevel,this.config.zoombounds,n.bounding_box,i,this.config.resultDuration,r,this.config.animateDuration,l.getView()):(this.completeSearch(this.config.markResult,this.config.animate,void 0,this.config.animateDuration,s,this.config.resultDuration),t.setCenter(s),this.config.zoomlevel>=0&&l.getView().setZoom(this.config.zoomlevel)),this.config.autopick&&this.config.mapController.geopicker&&"function"==typeof this.config.mapController.geopicker.pick&&this.config.mapController.geopicker.pick(s);else{var v=(0,d.getLanguage)(this.options.mapController.data);alert(v.SEARCH_NOT_FOUND)}this.results&&(this.props.mapController.hideOtherComponents(this),this.setState({results:this.results,open:!0,currentCoordinate:o,openResults:!0,currentResult:e[0]}),this.props.mapController.setOpenComponent(this))}}},{key:"flyTo",value:function(e,t,o,s,n,a,l,r,i,c){var u,p=i,h=o,d=2,m=!1,C=this;function y(o){if(--d,!(m||0!==d&&o)){if(m=!0,s&&n&&null!==n[0]&&null!==n[1]&&null!==n[2]&&null!==n[3]){var y=[];y.push(parseFloat(n[2])),y.push(parseFloat(n[0])),y.push(parseFloat(n[3])),y.push(parseFloat(n[1])),u=(0,g.transformExtent)(y,"EPSG:4326","EPSG:3857"),window.setTimeout(function(){c.fit(u,e.getSize(),{minZoom:c.get("minZoom")||2,maxZoom:h||c.get("maxZoom")||18,duration:p/2,easing:f.easeOut})},p)}C.completeSearch(a,r,"bounce",i,t,l)}}e.getView().animate({center:t,duration:p},y),e.getView().animate({zoom:h-1,duration:p/2},{zoom:h,duration:p/2},y)}},{key:"completeSearch",value:function(e,t,o,s,n,a){var l=this;if(e){var r,i,c,u;i=new C.Vector;var p=this.config.resultStyle;p&&"0"!==p||(p=[new v.Style({image:new v.Circle({radius:7,snapToPixel:!1,stroke:new v.Stroke({color:"rgba(200, 0, 0, 0.9)",width:2,opacity:.9})})}),new v.Style({image:new v.Circle({radius:20,snapToPixel:!1,stroke:new v.Stroke({color:"rgba(200, 0, 0, 0.9)",width:2,opacity:.9})})}),new v.Style({image:new v.Circle({radius:33,snapToPixel:!1,stroke:new v.Stroke({color:"rgba(200, 0, 0, 0.9)",width:2,opacity:.9})})})]),c=new y.Vector({style:p,source:i,zIndex:99999}),this.props.mapController.map.addLayer(c),r=function(){i.addFeature(new b.Feature(new k.Point(n)))},u=function(e){var t,o,s,n;o=(new Date).getTime(),s=a,t=function(t){var a,l,r,c,u;a=(0,S.getVectorContext)(t),l=t.frameState,u=e.getGeometry().clone(),c=(r=l.time-o)/s,(0,f.linear)(1-c),(0,f.linear)(c);var p=new v.Style;if(a.setStyle(p),a.drawGeometry(u,null),r>s)return i.clear(),void(0,R.unByKey)(n);l.animate=!0},n=c.on("postrender",t)},i.on("addfeature",function(e){u(e.feature)}),t?window.setTimeout(r,s/2):r()}if(this.config.popup){var h=this.props.mapController.map.getPixelFromCoordinate(n);window.setTimeout(function(){l.props.mapController.map.dispatchEvent({type:"click",pixel:h},100)})}}},{key:"zoomTo",value:function(e){var t,o,s,n,a=(t=this.props.mapController.map).getView(),l=this.state.currentCoordinate;if(o=this.results[e],s=(0,g.transform)([parseFloat(o.lon),parseFloat(o.lat)],"EPSG:4326","EPSG:3857"),this.config.animate){a.getResolution();var r=a.calculateExtent(t.getSize());if((0,j.containsCoordinate)(r,s))n="zoom";else{if(Math.abs(l[0]-s[0])>Math.abs(l[1]-s[1]))Math.abs(l[0]-s[0]),(0,j.getWidth)(r);else Math.abs(l[1]-s[1]),(0,j.getHeight)(r);n="bounce"}this.flyTo(t,s,this.config.zoomlevel,this.config.zoombounds,o.bounding_box,this.config.markResult,this.config.resultDuration,this.config.animate,this.config.animateDuration,a)}else this.completeSearch(this.config.markResult,this.config.animate,n,this.config.animateDuration,s,this.config.resultDuration),t.getView().setCenter(s),this.config.zoomlevel>=0&&t.getView().setZoom(this.config.zoomlevel)}}])}(p.Component)}}]);