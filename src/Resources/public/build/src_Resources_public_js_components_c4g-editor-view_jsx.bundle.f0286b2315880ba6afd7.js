/*! For license information please see src_Resources_public_js_components_c4g-editor-view_jsx.bundle.f0286b2315880ba6afd7.js.LICENSE.txt */
"use strict";(self.webpackChunkmapsbundle=self.webpackChunkmapsbundle||[]).push([["src_Resources_public_js_components_c4g-editor-view_jsx"],{"./src/Resources/public/js/components/c4g-editor-view.jsx":(e,t,r)=>{var s=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=r("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=s(r("./node_modules/@babel/runtime/helpers/createClass.js")),l=s(r("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),i=s(r("./node_modules/@babel/runtime/helpers/inherits.js")),c=s(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),u=s(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),d=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=n?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(s,a,l):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}(r("./node_modules/react/index.js")),p=(r("./node_modules/ol/layer.js"),r("./node_modules/ol/source.js"),r("./node_modules/ol/format.js")),f=r("./node_modules/ol/index.js"),m=r("./node_modules/ol/geom.js"),h=r("./node_modules/ol/interaction.js"),y=r("./src/Resources/public/js/c4g-maps-utils.js"),v=r("./src/Resources/public/js/components/c4g-starboard-style.jsx");function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}r("./src/Resources/public/js/c4g-popup-controller.js"),r("./src/Resources/public/js/c4g-maps-misc-tooltippopup.js");var S=function(e){(0,i.default)(o,e);var t,r,s=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=(0,u.default)(t);if(r){var o=(0,u.default)(this).constructor;e=Reflect.construct(s,arguments,o)}else e=s.apply(this,arguments);return(0,c.default)(this,e)});function o(e){var t;return(0,n.default)(this,o),t=s.call(this,e),(0,l.default)(t),t.state={freehand:!1,selectedFeature:!1,features:"[]",activeElement:e.elements[0]?e.elements[0].id:0,activeStyle:e.elements[0]?e.elements[0].styleId:0,selectMode:"modify"},t.interaction=null,t.changeJSON=t.changeJSON.bind((0,l.default)(t)),t.resetInteraction=t.resetInteraction.bind((0,l.default)(t)),t}return(0,a.default)(o,[{key:"render",value:function(){var e=this;if("select"!==this.props.mode&&this.props.active){var t;switch(this.resetInteraction(),this.props.mode){case"Point":t=new m.Point(0,0);break;case"LineString":t=new m.LineString([[0,0],[1,1]]);break;case"Polygon":t=new m.Polygon([[0,0],[1,1]])}var r=new f.Feature(t);r.set("locstyle",this.state.activeStyle),this.interaction=new h.Draw({source:this.props.editorLayer.getSource(),type:this.props.mode,snapTolerance:1,style:this.props.styleFunction(r),freehand:this.state.freehand}),this.interaction.on("drawend",(function(t){var r;if(t.feature.set("editorId",e.props.editorId),t.feature.set("locstyle",e.state.activeStyle),t.feature.set("elementId",e.state.activeElement),"Circle"===e.props.mode){var s=t.feature.getGeometry().clone().transform("EPSG:3857","EPSG:4326").getCenter(),o=t.feature.getGeometry().getRadius(),n=y.utils.measureGeometry(t.feature.getGeometry()).rawValue;r={type:"Feature",geometry:{type:"Point",coordinates:s},properties:{editorId:e.props.editorId,elementId:e.state.activeElement,locstyle:e.state.activeStyle,radius:o,realRadius:n}}}else r=(new p.GeoJSON).writeFeatureObject(t.feature,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});var a={source:e.props.editorLayer.getSource(),geojson:r,event:t,format:new p.GeoJSON};y.utils.callHookFunctions(window.c4gMapsHooks.hook_editor_draw,a),e.props.addFeature(r),e.props.countEditorId()})),this.props.mapController.map.addInteraction(this.interaction)}else"select"===this.props.mode&&this.props.active?(this.resetInteraction(),this.interaction=[],this.interaction.push(new h.Select({layers:[this.props.editorLayer],hitTolerance:20})),this.interaction.push(new h.Modify({features:this.state.selectedFeature?new f.Collection([this.state.selectedFeature]):new f.Collection([new f.Feature]),pixelTolerance:20})),this.interaction[0].on("select",(function(t){var r=t.selected[0];e.setState({selectedFeature:r})})),this.interaction[1].on("modifyend",(function(t){var r,s=t.features.getArray()[0];if(s.getGeometry()instanceof m.Circle){var o=s.getGeometry().clone().transform("EPSG:3857","EPSG:4326").getCenter(),n=s.getGeometry().getRadius(),a=y.utils.measureGeometry(s.getGeometry()).rawValue;r={type:"Feature",geometry:{type:"Point",coordinates:o},properties:{editorId:s.get("editorId"),elementId:s.get("elementId"),locstyle:s.get("activeStyle"),radius:n,realRadius:a}}}else r=(new p.GeoJSON).writeFeatureObject(s,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});var l={source:e.props.editorLayer.getSource(),geojson:r,event:t,format:new p.GeoJSON};y.utils.callHookFunctions(window.c4gMapsHooks.hook_editor_modify,l),e.props.modifyFeature(r)})),this.props.mapController.map.addInteraction(this.interaction[0]),this.props.mapController.map.addInteraction(this.interaction[1])):this.resetInteraction();var s=null;this.props.elements&&this.props.elements.length>1&&(s=this.props.elements.map((function(t){var r,s,o=e.props.styleData.arrLocStyles[t.styleId],n=o.locStyleArr,a=n?n.styletype:"default";if(!n||"cust_icon"!==a&&"cust_icon_svg"!==a&&"photo"!==a){var l=o.style&&o.style(new f.Feature({geometry:new m.Point(0,0)}),"EPSG:4326")?o.style(new f.Feature({geometry:new m.Point(0,0)}),"EPSG:4326"):null,i=Array.isArray(l)?l[0]:l;i&&i.getFill()&&i.getStroke()?r=i.getFill().getColor():n&&n.fillcolor&&n.strokecolor&&(r=y.utils.getRgbaFromHexAndOpacity(n.fillcolor[0],n.fillcolor[1])),s=d.default.createElement("span",{title:t.name,className:"c4g-editor-locstyle",style:{backgroundColor:r}})}else s=d.default.createElement(v.C4gStarboardStyle,{tooltip:t.name,styleData:e.props.styleData,styleId:t.styleId});return d.default.createElement("button",{key:t.id,style:{height:"32px",width:"32px"},onMouseUp:function(){e.setState({activeElement:t.id,activeStyle:t.styleId})}},s)})));var o=null;if("LineStringPolygon".includes(this.props.mode)){var n="c4g-editor-view ";n+=this.state.freehand?"c4g-active":"c4g-inactive",o=d.default.createElement("a",{className:n,title:this.props.lang.EDITOR_VIEW_TRIGGER_DRAW_FREEHAND,onMouseUp:function(){e.changeFreehand()}},this.props.lang.EDITOR_VIEW_TRIGGER_DRAW_FREEHAND)}var a=[];if(this.state.selectedFeature&&"select"===this.props.mode)for(var l in o=d.default.createElement("div",{className:"c4g-editor-mode-switcher"},d.default.createElement("button",{title:this.props.lang.EDITOR_FEATURE_DELETE,className:"c4g-editor-feature-delete "+("remove"===this.state.selectMode?"c4g-active":"c4g-inactive"),onMouseUp:function(){e.removeActiveFeature()}})),this.props.editorVars)if(this.props.editorVars.hasOwnProperty(l)){var i=this.props.editorVars[l];if(i.caption&&i.key){var c=this.state.selectedFeature.get(i.key)?this.state.selectedFeature.get(i.key):"";a.push(d.default.createElement("form",{className:"c4g-editor-vars-input",key:l,onSubmit:function(e){e.preventDefault()}},d.default.createElement("label",null,i.caption,":",d.default.createElement("input",{type:"text",value:c,name:i.key,onChange:function(t){e.handleVarChange(t)}}))))}}return d.default.createElement(d.default.Fragment,null,d.default.createElement("div",null,o,d.default.createElement("div",{className:"c4g-editor-element-selection"},s)),d.default.createElement("div",{className:"c4g-editor-vars"},a))}},{key:"resetInteraction",value:function(){this.interaction&&(Array.isArray(this.interaction)?(this.props.mapController.map.removeInteraction(this.interaction[0]),this.props.mapController.map.removeInteraction(this.interaction[1])):this.props.mapController.map.removeInteraction(this.interaction))}},{key:"removeActiveFeature",value:function(){var e=(new p.GeoJSON).writeFeatureObject(this.state.selectedFeature,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});this.props.removeFeature(e),this.props.editorLayer.getSource().removeFeature(this.state.selectedFeature),this.setState({selectedFeature:!1})}},{key:"componentDidUpdate",value:function(e,t,r){var s=this;this.props.elements[0]&&e.mode!==this.props.mode&&(0===this.state.activeElement?this.setState({activeElement:this.props.elements[0].id,activeStyle:this.props.elements[0].styleId}):this.props.elements.find((function(e){return e.id===s.state.activeElement}))||this.setState({activeElement:this.props.elements[0].id,activeStyle:this.props.elements[0].styleId}))}},{key:"changeSelectMode",value:function(e){this.setState({selectMode:e})}},{key:"handleVarChange",value:function(e){var t=e.target.value,r=e.target.name;this.state.selectedFeature.set(r,t);var s=(new p.GeoJSON).writeFeatureObject(this.state.selectedFeature,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});this.props.modifyFeature(s),this.setState({selectedFeature:this.state.selectedFeature})}},{key:"changeFreehand",value:function(){this.setState({freehand:!this.state.freehand})}},{key:"changeJSON",value:function(e){this.setState({features:e.target.value})}}]),o}(d.Component);t.default=S},"./src/Resources/public/js/components/c4g-starboard-style.jsx":(e,t,r)=>{var s=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),o=r("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.C4gStarboardStyle=void 0;var n=s(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),a=s(r("./node_modules/@babel/runtime/helpers/createClass.js")),l=s(r("./node_modules/@babel/runtime/helpers/inherits.js")),i=s(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=s(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=n?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(s,a,l):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}(r("./node_modules/react/index.js")),d=s(r("./node_modules/ol/Feature.js")),p=r("./node_modules/ol/geom.js"),f=r("./src/Resources/public/js/c4g-maps-constant.js"),m=r("./src/Resources/public/js/c4g-maps-utils.js");function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}var y=function(e){(0,l.default)(o,e);var t,r,s=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=(0,c.default)(t);if(r){var o=(0,c.default)(this).constructor;e=Reflect.construct(s,arguments,o)}else e=s.apply(this,arguments);return(0,i.default)(this,e)});function o(e){return(0,n.default)(this,o),s.call(this,e)}return(0,a.default)(o,[{key:"enterEvent",value:function(e){13===e.which&&this.props.clickEvent(e)}},{key:"render",value:function(){var e=this,t=null,r=this.props.styleData.arrLocStyles[this.props.styleId],s=r.locStyleArr,o=r.style&&r.style(new d.default({geometry:new p.Point(0,0)}),"EPSG:4326")?r.style(new d.default({geometry:new p.Point(0,0)}),"EPSG:4326"):null,n=Array.isArray(o)?o[0]:o,a=s?s.styletype:"default",l=this.props.tooltip||"";if(!s||"cust_icon"!==a&&"cust_icon_svg"!==a&&"photo"!==a){var i,c,h;switch(a){case"point":i=f.cssConstants.STARBOARD_LOCSTYLE_POINT;break;case"square":i=f.cssConstants.STARBOARD_LOCSTYLE_SQUARE;break;case"star":i=f.cssConstants.STARBOARD_LOCSTYLE_STAR;break;case"x":i=f.cssConstants.STARBOARD_LOCSTYLE_X;break;case"cross":i=f.cssConstants.STARBOARD_LOCSTYLE_CROSS;break;case"triangle":i=f.cssConstants.STARBOARD_LOCSTYLE_TRIANGLE;break;default:i=f.cssConstants.STARBOARD_LOCSTYLE}n&&n.getFill()&&n.getStroke()?(c=n.getFill().getColor(),h=n.getStroke().getColor()):s&&s.fillcolor&&s.strokecolor&&(c=m.utils.getRgbaFromHexAndOpacity(s.fillcolor[0],s.fillcolor[1]),h=m.utils.getRgbaFromHexAndOpacity(s.strokecolor[0],s.strokecolor[1]));var y={"--var-color":c,"--var-bordercolor":h};t=this.props.clickEvent?u.default.createElement("span",{className:i,style:y,title:l,onMouseUp:function(t){return e.props.clickEvent(t)}}):u.default.createElement("span",{className:i,style:y,title:l})}else{var v,g=null;if(s.icon_src&&-1!==s.icon_src.indexOf(".")||s.svgSrc&&-1!==s.svgSrc.indexOf("."))v="cust_icon"===a||"photo"===a?s.icon_src:s.svgSrc,g=u.default.createElement("img",{src:v,style:{height:25,width:25}});else if(n){var S=n.getImage&&"function"==typeof n.getImage&&n.getImage()?n.getImage():null;if(!S||!S.getSrc())return null;g=u.default.createElement("img",{src:S.getSrc(),style:{height:25,width:25}})}t=this.props.clickEvent?u.default.createElement("span",{tabIndex:1,className:f.cssConstants.STARBOARD_LOCSTYLE,title:l,onKeyPress:function(t){return e.enterEvent(t)},onMouseUp:function(t){return e.props.clickEvent(t)}},g):u.default.createElement("span",{className:f.cssConstants.STARBOARD_LOCSTYLE,title:l},g)}return t}}]),o}(u.Component);t.C4gStarboardStyle=y}}]);