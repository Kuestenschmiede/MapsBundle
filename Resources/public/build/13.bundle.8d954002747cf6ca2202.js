(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"./Resources/public/js/components/c4g-permalink.jsx":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(s("./node_modules/babel-runtime/core-js/object/get-prototype-of.js")),a=g(s("./node_modules/babel-runtime/helpers/classCallCheck.js")),o=g(s("./node_modules/babel-runtime/helpers/createClass.js")),r=g(s("./node_modules/babel-runtime/helpers/possibleConstructorReturn.js")),l=g(s("./node_modules/babel-runtime/helpers/inherits.js")),i=s("./node_modules/react/index.js"),c=g(i),p=s("./Resources/public/js/c4g-maps-constant.js"),u=s("./Resources/public/js/components/c4g-titlebar.jsx"),d=s("./node_modules/ol/proj.js"),m=s("./Resources/public/js/c4g-maps-utils.js"),C=s("./Resources/public/js/c4g-maps-i18n.js"),h=s("./node_modules/ol/control.js");function g(e){return e&&e.__esModule?e:{default:e}}var k=function(e){function t(e){(0,a.default)(this,t);var s=(0,r.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e)),o=s,l=document.createElement("div"),i=document.createElement("button"),c=(0,C.getLanguage)(e.mapController.data);i.title=c.CTRL_PERMALINK,l.className="c4g-permalink-control ol-unselectable ol-control ",e.open?l.className+="c4g-open":l.className+="c4g-close",e.external&&(l.className+=" c4g-external"),l.appendChild(i),jQuery(l).on("click",(function(e){o.state.open?o.close():o.open()}));var p=e.mapController,u=new h.Control({element:l,target:e.target});return p.mapsControls.controls.horizontalPanel=u,p.map.addControl(u),s.open=s.open.bind(s),s.close=s.close.bind(s),s.langConstants=(0,C.getLanguage)(s.props.mapController.data),s.state={open:!1,link:""},s}return(0,l.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this;return c.default.createElement("div",{className:"c4g-permalink-wrapper"},c.default.createElement(u.Titlebar,{wrapperClass:"c4g-permalink-header",headerClass:"c4g-permalink-header-headline",header:"Permalink",closeBtnClass:"c4g-permalink-close",closeBtnCb:this.close,closeBtnTitle:this.langConstants.CLOSE}),c.default.createElement("div",{className:"c4g-permalink-content"},c.default.createElement("textarea",{cols:"50",rows:"2",id:"permalink-text",value:this.state.link,readOnly:!0}),c.default.createElement("button",{className:p.cssConstants.COPY+" "+p.cssConstants.ICON,title:this.langConstants.COPY_TO_CLIPBOARD,"data-clipboard-target":"#permalink-text"}),c.default.createElement("button",{className:p.cssConstants.REFRESH+" "+p.cssConstants.ICON,title:this.langConstants.REFRESH,onMouseUp:function(){return e.generateLinkFromCurrentState({target:e.textfield})}})))}},{key:"componentDidUpdate",value:function(e,t,s){(t.open===this.state.open&&t.link===this.state.link||this.generateLinkFromCurrentState({target:this.textfield}),t.open&&!this.state.open&&jQuery(".c4g-permalink-container").removeClass(p.cssConstants.OPEN).addClass(p.cssConstants.CLOSE),this.props.mapController.data.caching&&!this.state.open)&&(m.utils.getValue("panel")===this.constructor.name&&m.utils.storeValue("panel",""));this.state.open&&jQuery(".c4g-permalink-container").addClass(p.cssConstants.OPEN).removeClass(p.cssConstants.CLOSE)}},{key:"componentDidMount",value:function(){this.textField=document.querySelector("#permalink-text");var e=document.querySelector("."+p.cssConstants.COPY+"."+p.cssConstants.ICON);try{new ClipboardJS(e)}catch(e){console.warn("Permalink is currently not supported in backend mode..")}}},{key:"open",value:function(){jQuery(this.element).addClass(p.cssConstants.OPEN),jQuery(".c4g-permalink-container").removeClass(p.cssConstants.CLOSE).addClass(p.cssConstants.OPEN),this.setState({open:!0}),this.props.mapController.setOpenComponent(this)}},{key:"close",value:function(){jQuery(this.element).removeClass(p.cssConstants.OPEN),jQuery(".c4g-permalink-container").removeClass(p.cssConstants.OPEN).addClass(p.cssConstants.CLOSE),this.setState({open:!1})}},{key:"toggle",value:function(){jQuery(this.popup).hasClass(p.cssConstants.CLOSE)?this.open():this.close()}},{key:"generateLinkFromCurrentState",value:function(e){var t,s,n,a,o,r;(!(t=e||{}).paramCount||6!==t.paramCount&&2!==t.paramCount&&1!==t.paramCount)&&(t.paramCount=6),a=[],n=this.props.mapController.map.getView(),s=this.props.mapController.proxy,r=n.getCenter(),r=(0,d.transform)([r[0],r[1]],"EPSG:3857","EPSG:4326"),a.push(+r[0].toFixed(6)),a.push(+r[1].toFixed(5)),a.push(n.getZoom()),a.push(+n.getRotation().toFixed(2)),s.activeBaselayerId?a.push(s.activeBaselayerId):a.push(0);var l=[],i=this.props.mapController.state.arrLayerStates;for(var c in i)i.hasOwnProperty(c)&&(l=l.concat(this.getActiveLayerIds(i[c])));l=l.length>1?(l=m.utils.deltaEncode(l)).join(":"):l[0]||"0",a.push(l),a=a.join("/"),o=m.utils.setUrlParam(a,this.props.mapController.data.permalink.getParameter),this.setState({link:o})}},{key:"generateLink",value:function(e){return!(!e||6!==e.length&&2!==e.length&&1!==e.length)&&m.utils.setUrlParam(e.join("/"),this.props.mapController.data.permalink.getParameter)}},{key:"getActiveLayerIds",value:function(e){var t=[];for(var s in e.active&&t.push(e.id),e.childStates)e.childStates.hasOwnProperty(s)&&(t=t.concat(this.getActiveLayerIds(e.childStates[s])));return t}}]),t}(i.Component);
/*
                      * This file is part of con4gis,
                      * the gis-kit for Contao CMS.
                      *
                      * @package   	con4gis
                      * @version        6
                      * @author  	    con4gis contributors (see "authors.txt")
                      * @license 	    LGPL-3.0-or-later
                      * @copyright 	KÃ¼stenschmiede GmbH Software & Design
                      * @link              https://www.con4gis.org
                      *
                      */t.default=k}}]);