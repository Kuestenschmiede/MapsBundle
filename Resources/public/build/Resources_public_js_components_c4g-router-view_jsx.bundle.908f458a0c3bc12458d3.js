/*! For license information please see Resources_public_js_components_c4g-router-view_jsx.bundle.908f458a0c3bc12458d3.js.LICENSE.txt */
(self.webpackChunkmapsbundle=self.webpackChunkmapsbundle||[]).push([["Resources_public_js_components_c4g-router-view_jsx"],{"../CoreBundle/Resources/public/js/AlertHandler.js":(e,t,r)=>{"use strict";r.r(t),r.d(t,{AlertHandler:()=>a});var o=r("../CoreBundle/node_modules/sweetalert2/dist/sweetalert2.all.js"),s=r.n(o);class a{showErrorDialog(e,t,r){s().fire({title:e,text:t,type:"error",customClass:r||""})}showInfoDialog(e,t,r){s().fire({title:e,text:t,type:"info",customClass:r||""})}showInfoActionDialog(e,t,r,o){s().fire({title:e,text:t,type:"info",customClass:o||""}).then((function(){r()}))}showInfoActionDialog2(e,t,r,o){s().fire({title:e,text:t,type:"info",showLoaderOnConfirm:!0,customClass:o||"",preConfirm:e=>{r()}})}showConfirmDialog(e,t,r,o,a,n,i){s().fire({title:e,text:t,type:"warning",showCancelButton:!0,confirmButtonText:a||"Confirm",cancelButtonText:n||"Cancel",dangerMode:!0,customClass:i||""}).then((e=>{e.value?r():o()}))}showConfirmDialogHTML(e,t,r,o,a,n,i){s().fire({title:e,html:t,type:"warning",showCancelButton:!0,confirmButtonText:a||"Confirm",cancelButtonText:n||"Cancel",dangerMode:!0,customClass:i||""}).then((e=>{e.value?r():o()}))}showPreConfirmDialog(e,t,r,o,a,n,i){s().fire({title:e,text:t,type:"warning",showCancelButton:!0,confirmButtonText:o||"Confirm",cancelButtonText:a||"Cancel",showLoaderOnConfirm:i||!0,preConfirm:function(){return new Promise((function(e){r()}))},allowOutsideClick:()=>!s().isLoading(),dangerMode:!0,customClass:n||""})}showLoadingDialog(e,t,r,o){s().fire({title:e,text:t,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,showLoaderOnConfirm:!0,onBeforeOpen:()=>{s().clickConfirm()},customClass:o||"",preConfirm:()=>new Promise((function(e){r()}))})}async showSelectDialog(e,t,r,o,a){const{value:n}=await s().fire({title:e,input:"select",inputOptions:t,inputPlaceholder:"Select a fruit",showCancelButton:!0,confirmButtonText:r,cancelButtonText:o,customClass:a||""});return n}}},"./Resources/public/js/c4g-router-time-conversions.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toHumanDistance=function(e){var t;return t=parseInt(e,10),(t/=1e3)>=100?t.toFixed(0)+" km":t>=10?t.toFixed(1)+" km":t>=.1?t.toFixed(2)+" km":(1e3*t).toFixed(0)+" m"},t.toHumanTime=function(e){var t,r,o;return t=parseInt(e,10),r=parseInt(t/60,10),t%=60,o=parseInt(r/60,10),r%=60,0===o&&0===r?t+" s":0===o?r+" min":o+" h "+r+" min"}},"./Resources/public/js/c4g-routing-permalink.js":(e,t,r)=>{"use strict";var o=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:!0}),t.RoutingPermalink=void 0;var s=o(r("./node_modules/@babel/runtime/regenerator/index.js")),a=o(r("./node_modules/@babel/runtime/helpers/slicedToArray.js")),n=o(r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),i=o(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),l=o(r("./node_modules/@babel/runtime/helpers/createClass.js")),u=o(r("./node_modules/@babel/runtime/helpers/defineProperty.js")),c=function(){function e(t){(0,i.default)(this,e),(0,u.default)(this,"_router",void 0),this._router=t,this.linkFragments={},this.rawFragments={}}var t,r;return(0,l.default)(e,[{key:"router",get:function(){return this._router},set:function(e){this._router=e}},{key:"updateLinkFragments",value:function(e,t){this.linkFragments||(this.linkFragments={}),this.linkFragments[e]=t,this.updateUrl()}},{key:"updateUrl",value:function(){var e="?mapsParams=",t=this.linkFragments;if(t.mode&&"area"===t.mode){e+=t.mode?"m:"+t.mode+"/":"",e+=t.addressArea?"a:"+t.addressArea[0]+","+t.addressArea[1]+"/":"",e+=t.detourArea?"d:"+t.detourArea+"/":"",e+=t.searchType?"s:"+t.searchType+"/":"",e+=t.forceStart?"f:"+t.forceStart:"";var r=window.location.pathname+e;history.pushState({},null,r)}else if(t.mode&&"route"===t.mode){e+=t.mode?"m:"+t.mode+"/":"",e+=t.fromAddress?"af:"+t.fromAddress[0]+","+t.fromAddress[1]+"/":"",e+=t.toAddress?"at:"+t.toAddress[0]+","+t.toAddress[1]+"/":"",e+=t.detourRoute?"d:"+t.detourRoute+"/":"",e+=t.searchType?"s:"+t.searchType+"/":"",e+=t.forceStart?"f:"+t.forceStart:"";var o=window.location.pathname+e;history.pushState({},null,o)}}},{key:"handleInitialParams",value:(r=(0,n.default)(s.default.mark((function e(){var t,r,o,n,i,l,u,c,p;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.rawFragments=this.router.props.mapController.data.initialParams,!this.rawFragments){e.next=30;break}return e.next=5,this.checkForOldParams();case 5:t=this.rawFragments.split("/").map((function(e){return e.split(":")})),r={},t.forEach((function(e){var t=(0,a.default)(e,2),o=t[0],s=t[1];return r[o]=s})),o=this.router.props.mapController.data.routerLayers,n="",e.t0=s.default.keys(o);case 11:if((e.t1=e.t0()).done){e.next=28;break}if(i=e.t1.value,!o.hasOwnProperty(i)){e.next=26;break}l=o[i],e.t2=s.default.keys(l);case 16:if((e.t3=e.t2()).done){e.next=26;break}if(u=e.t3.value,!l.hasOwnProperty(u)){e.next=24;break}if(c=l[u],p=r.s,c.mapLabel!==p){e.next=24;break}return n=u,e.abrupt("break",28);case 24:e.next=16;break;case 26:e.next=11;break;case 28:this.desiredButtonRouting=n,"area"===r.m?this.handleInitialAreaSearch(r):"route"===r.m&&this.handleInitialRouteSearch(r);case 30:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"checkForOldParams",value:(t=(0,n.default)(s.default.mark((function e(){var t,r,o,a,n,i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",-1===(r=this.router.props.mapController.data.initialParams).indexOf("m:")){e.next=4;break}return e.abrupt("return");case 4:if(o=r.split("/"),t+="m:"+o[0]+"/","route"!==o[0]){e.next=20;break}return e.next=9,this.router.performGeoSearch(o[1]);case 9:return a=e.sent,e.next=12,this.router.performGeoSearch(o[2]);case 12:n=e.sent,t+="af:"+a.join()+"/",t+="at:"+n.join()+"/",t+="d:"+o[3]+"/",t+="s:"+o[4]+"/",t+="f:"+o[5]+"/",e.next=27;break;case 20:return e.next=22,this.router.performGeoSearch(o[1]);case 22:i=e.sent,t+="a:"+i.join()+"/",t+="d:"+o[2]+"/",t+="s:"+o[3]+"/",t+="f:"+o[4]+"/";case 27:this.rawFragments=t;case 28:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleInitialAreaSearch",value:function(e){this.router.setState({mode:"area"});var t=e.a;t&&(t=t.split(","));var r=e.d,o=e.s,s=e.f;(r||r>1)&&this.updateLinkFragments("detour",r),t&&2===t.length&&(this.updateLinkFragments("addressArea",t),this.router.setAreaPoint(t)),o&&this.updateLinkFragments("searchType",o),s&&this.updateLinkFragments("forceStart",s),jQuery(".c4g-portside-viewtriggerbar .c4g-area-search").click()}},{key:"handleInitialRouteSearch",value:function(e){this.router.setState({mode:"route"});var t=e.af?e.af.split(",").map((function(e){return parseFloat(e)})):null,r=e.at?e.at.split(",").map((function(e){return parseFloat(e)})):null,o=e.d,s=e.s,a=e.f;o&&(jQuery(this.router.toggleDetourRoute).val(o),jQuery(this.router.toggleDetourRoute).trigger("input"),this.updateLinkFragments("detour",e.d)),t&&this.updateLinkFragments("fromAddress",t),r&&this.updateLinkFragments("toAddress",r),s&&this.updateLinkFragments("searchType",e.s),a&&this.updateLinkFragments("forceStart",e.f),t&&r&&(this.router.setRouteFrom(t[0],t[1]),this.router.setRouteTo(r[0],r[1])),jQuery(".c4g-portside-viewtriggerbar .c4g-route-search").click()}}]),e}();t.RoutingPermalink=c},"./Resources/public/js/components/c4g-autocomplete-input.jsx":(e,t,r)=>{"use strict";var o=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=r("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.AutocompleteInput=void 0;var a=o(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),n=o(r("./node_modules/@babel/runtime/helpers/createClass.js")),i=o(r("./node_modules/@babel/runtime/helpers/inherits.js")),l=o(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),u=o(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=a?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}(r("./node_modules/react/index.js"));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}var d=function(e){(0,i.default)(s,e);var t,r,o=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,u.default)(t);if(r){var s=(0,u.default)(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return(0,l.default)(this,e)});function s(e){var t;return(0,a.default)(this,s),(t=o.call(this,e)).listenerRegistered=!1,t}return(0,n.default)(s,[{key:"render",value:function(){var e=this;return c.default.createElement("input",{id:this.props.cssId,type:"search",defaultValue:this.props.value,onKeyDown:function(t,r){13===t.keyCode?function(){var t,r=$("#"+e.props.cssId);r.trigger("change"),t=-1!==e.props.cssId.indexOf("area")?function(){e.props.router.performArea()}:function(){e.props.router.performViaRoute()};var o=-1!==e.props.cssId.indexOf("From")?"fromValue":"toValue";e.props.router.performSearch(r,o,t)}():0!==$(t.currentTarget).val().length||t.keyCode?(e.counter=Math.floor(Date.now()),setTimeout((function(){if(e.counter&&e.counter+400<Math.floor(Date.now()))if(delete e.counter,e.props.objSettings.proxyUrl&&e.props.objSettings.keyAutocomplete)e.autocompleteAddress($("#"+e.props.cssId).val(),"#"+e.props.cssId);else{var t=-1!==e.props.cssId.indexOf("From")?"fromValue":"toValue",r=$("#"+e.props.cssId);e.props.router.performSearch(r,t)}}),500)):"function"==typeof e.props.objFunctions.deleteFunction?e.props.objFunctions.deleteFunction(t.currentTarget,t.currentTarget.id):e.props.objFunctions[e.props.index].deleteFunction(t.currentTarget,t.currentTarget.id)},autoComplete:"off"})}},{key:"componentDidUpdate",value:function(){var e,t=this;-1!==this.props.cssId.indexOf("From")?e=this.props.containerAddresses.arrFromNames:-1!==this.props.cssId.indexOf("To")?e=this.props.containerAddresses.arrToNames:-1!==this.props.cssId.indexOf("Over")?e=this.props.containerAddresses.arrOverNames[this.props.index]:-1!==this.props.cssId.indexOf("area")&&(e=this.props.containerAddresses.arrAreaNames);var r=jQuery("#"+this.props.cssId);r&&"function"==typeof r.autocomplete&&r.autocomplete({source:e}),this.listenerRegistered||(r.on("autocompleteselect",(function(e,r){t.props.index?t.props.objFunctions[t.props.index].selectListener(e,r):t.props.objFunctions.selectListener(e,r)})),this.listenerRegistered=!0)}},{key:"setCenter",value:function(e){this.objSettings.center=e}},{key:"autocompleteAddress",value:function(e,t){var r,o,s=this,a=s.props.objSettings;if(a.center)if("function"==typeof a.center){var n=a.center();r=n[0]+","+n[1]}else r=a.center[0]+","+a.center[1];else a.bBox&&(r=(parseFloat(a.bBox[0])+parseFloat(a.bBox[2]))/2+","+(parseFloat(a.bBox[1])+parseFloat(a.bBox[3]))/2);if(o=r?a.proxyUrl+"autocomplete.php?format=json&key="+a.keyAutocomplete+"&q="+e+"&center="+r:a.proxyUrl+"autocomplete.php?format=json&key="+a.keyAutocomplete+"&q="+e,a.geosearchParams)for(var i in a.geosearchParams)a.geosearchParams.hasOwnProperty(i)&&(o+="&"+i+"="+a.geosearchParams[i]);$.ajax({url:o}).done((function(e){var r;if(a.center?r=a.center:a.bBox&&(r=[(parseFloat(a.bBox[0])+parseFloat(a.bBox[2]))/2,(parseFloat(a.bBox[1])+parseFloat(a.bBox[3]))/2]),e.length>0){if(e[0]&&e[0].display_name&&r){var o=[];for(var n in e)if(e.hasOwnProperty(n)&&a.bBox&&a.bBox[0]&&s.isInBoundingBox(e[n].lon,e[n].lat,a.bBox)){var i={dist:Math.sqrt((r[0]-e[n].lon)*(r[0]-e[n].lon)+(r[1]-e[n].lat)*(r[1]-e[n].lat)),pos:[e[n].lat,e[n].lon],name:e[n].display_name};o.push(i)}for(var l in o.sort((function(e,t){return e.dist-t.dist})),o)o.hasOwnProperty(l)&&(-1!==t.indexOf("from")?s.props.containerAddresses.arrFromNames.includes(o[l].name)||(s.props.containerAddresses.arrFromNames.push(o[l].name),s.props.containerAddresses.arrFromPositions.push(o[l].pos)):-1!==t.indexOf("to")?s.props.containerAddresses.arrToNames.includes(o[l].name)||(s.props.containerAddresses.arrToNames.push(o[l].name),s.props.containerAddresses.arrToPositions.push(o[l].pos)):-1!==t.indexOf("over")?s.props.containerAddresses.arrOverNames[s.props.index].includes(o[l].name)||(s.props.containerAddresses.arrOverNames[s.props.index].push(o[l].name),s.props.containerAddresses.arrOverPositions[s.props.index].push(o[l].pos)):-1!==t.indexOf("area")?s.props.containerAddresses.arrAreaNames.includes(o[l].name)||(s.props.containerAddresses.arrAreaNames.push(o[l].name),s.props.containerAddresses.arrAreaPositions.push(o[l].pos)):console.log("This is weird ¯\\_(ツ)_/¯"));var u=jQuery.Event("keydown",{keyCode:8});$(t).trigger(u)}for(var c in e)e.hasOwnProperty(c)&&(-1!==t.indexOf("From")?s.props.containerAddresses.arrFromNames.includes(e[c].display_name)||(s.props.containerAddresses.arrFromNames.push(e[c].display_name),s.props.containerAddresses.arrFromPositions.push([e[c].lat,e[c].lon])):-1!==t.indexOf("To")?s.props.containerAddresses.arrToNames.includes(e[c].display_name)||(s.props.containerAddresses.arrToNames.push(e[c].display_name),s.props.containerAddresses.arrToPositions.push([e[c].lat,e[c].lon])):-1!==t.indexOf("Over")?s.props.containerAddresses.arrOverNames[s.props.index].includes(e[c].display_name)||(s.props.containerAddresses.arrOverNames[s.props.index].push(e[c].display_name),s.props.containerAddresses.arrOverPositions[s.props.index].push([e[c].lat,e[c].lon])):-1!==t.indexOf("area")?s.props.containerAddresses.arrAreaNames.includes(e[c].display_name)||(s.props.containerAddresses.arrAreaNames.push(e[c].display_name),s.props.containerAddresses.arrAreaPositions.push([e[c].lat,e[c].lon])):console.log("This is weird ¯\\_(ツ)_/¯"));s.props.router.setState({containerAddresses:s.props.containerAddresses});var p=jQuery.Event("keydown",{keyCode:8});$(t).trigger(p)}}))}},{key:"isInBoundingBox",value:function(e,t,r){return"string"==typeof e&&(e=parseFloat(e)),"string"==typeof t&&(t=parseFloat(t)),r[0]<e&&e<r[2]&&r[1]<t&&t<r[3]}}]),s}(c.Component);t.AutocompleteInput=d},"./Resources/public/js/components/c4g-router-popup-buttons.jsx":(e,t,r)=>{"use strict";var o=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=r("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.RouterPopupButtons=void 0;var a=o(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),n=o(r("./node_modules/@babel/runtime/helpers/createClass.js")),i=o(r("./node_modules/@babel/runtime/helpers/inherits.js")),l=o(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),u=o(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=a?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}(r("./node_modules/react/index.js")),p=(r("./Resources/public/js/components/c4g-autocomplete-input.jsx"),r("./node_modules/ol/geom.js"),r("./Resources/public/js/routing-constant-i18n.js"),r("./node_modules/ol/proj.js"));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}var h=function(e){(0,i.default)(s,e);var t,r,o=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,u.default)(t);if(r){var s=(0,u.default)(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return(0,l.default)(this,e)});function s(e){return(0,a.default)(this,s),o.call(this,e)}return(0,n.default)(s,[{key:"render",value:function(){var e=this;return c.default.createElement("div",null,c.default.createElement("button",{className:"c4g-icon c4g-popup-route-from",title:this.props.config.router.languageConstants.POPUP_ROUTE_FROM,onMouseUp:function(){!function(){e.props.config.router.openControls(!0),e.props.config.router.setMode("route");var t=(0,p.toLonLat)(e.props.config.feature.getGeometry().getCoordinates(),"EPSG:3857");e.props.config.router.setRouteFrom(t[0],t[1])}()}}),c.default.createElement("button",{className:"c4g-icon c4g-popup-route-to",title:this.props.config.router.languageConstants.POPUP_ROUTE_TO,onMouseUp:function(){!function(){e.props.config.router.openControls(!0),e.props.config.router.setMode("route");var t=(0,p.toLonLat)(e.props.config.feature.getGeometry().getCoordinates(),"EPSG:3857");e.props.config.router.setRouteTo(t[0],t[1])}()}}))}}]),s}(c.Component);t.RouterPopupButtons=h},"./Resources/public/js/components/c4g-router-result-container.jsx":(e,t,r)=>{"use strict";var o=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=r("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.RouterResultContainer=void 0;var a=o(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),n=o(r("./node_modules/@babel/runtime/helpers/createClass.js")),i=o(r("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),l=o(r("./node_modules/@babel/runtime/helpers/inherits.js")),u=o(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=o(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),p=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=a?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}(r("./node_modules/react/index.js")),d=o(r("./node_modules/ol/format/GPX.js")),h=r("./Resources/public/js/c4g-router-time-conversions.js");function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}r("./Resources/public/js/components/c4g-titlebar.jsx");var f=p.default.lazy((function(){return r.e("Resources_public_js_components_c4g-router-instructions-container_jsx").then(r.bind(r,"./Resources/public/js/components/c4g-router-instructions-container.jsx"))})),y=p.default.lazy((function(){return r.e("Resources_public_js_components_c4g-router-feature-list_jsx").then(r.bind(r,"./Resources/public/js/components/c4g-router-feature-list.jsx"))})),g=function(e){(0,l.default)(s,e);var t,r,o=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,c.default)(t);if(r){var s=(0,c.default)(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return(0,u.default)(this,e)});function s(e){var t;return(0,a.default)(this,s),(t=o.call(this,e)).clickControl=t.clickControl.bind((0,i.default)(t)),t.profileTranslation={0:"car",1:"hgv",2:"bike",3:"bike",4:"bike",5:"bike",6:"bike",7:"bike",8:"foot",9:"foot",10:"wheelchair",11:"hgv",12:"scooter",13:"scooter"},window.c4gMapsHooks.hook_map_click=window.c4gMapsHooks.hook_map_click||[],window.c4gMapsHooks.hook_map_click.push((function(e){var r=t.props.mapController.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));if(r&&r.get("tid")){var o=r.get("tid");t.props.setResultFeat(e),t.props.setActiveId(o)}})),t}return(0,n.default)(s,[{key:"render",value:function(){var e=this,t="",r="",o="",s="",a="";this.props.routerInstructions&&this.props.routerInstructions.instructions&&"route"===this.props.mode?(r=(0,h.toHumanTime)(this.props.routerInstructions.time),o=(0,h.toHumanDistance)(this.props.routerInstructions.distance)):this.props.featureList&&"area"===this.props.mode&&(s=this.props.detour,a=this.props.featureList.features.length);var n="",i=function(){var t="instr"===e.props.resultMode?".c4g-route-instructions-wrapper":".c4g-route-feature-wrapper",r=document.querySelector(t).cloneNode(!0);if("instr"===e.props.resultMode){var o=e.props.router.state.fromAddress,s=document.createElement("div"),a=document.createElement("label");a.innerHTML=e.props.lang.ROUTER_FROM+": ";var n=document.createElement("em");n.innerHTML=o,s.appendChild(a),s.appendChild(n),s.appendChild(document.createElement("em"));var i=e.props.router.state.toAddress,l=document.createElement("div"),u=document.createElement("label");u.innerHTML=e.props.lang.ROUTER_FROM+": ";var c=document.createElement("em");c.innerHTML=i,l.appendChild(u),l.appendChild(c),l.appendChild(document.createElement("em")),r.querySelector(".c4g-router-instructions-header").appendChild(s),r.querySelector(".c4g-router-instructions-header").appendChild(l)}r.querySelector(".c4g-router-print").remove();var p=window.open("","","left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0");p.document.write(r.innerHTML),p.document.close(),p.focus(),p.print(),p.close()};return r&&o&&"route"===this.props.mode?n=p.default.createElement("div",{className:"c4g-router-instructions-header"},p.default.createElement("div",{className:"c4g-router-route-time"},p.default.createElement("label",null,this.props.lang.ROUTER_VIEW_LABEL_TIME),p.default.createElement("em",null,r)),p.default.createElement("div",{className:"c4g-router-route-distance"},p.default.createElement("label",null,this.props.lang.ROUTER_VIEW_LABEL_DISTANCE),p.default.createElement("em",null,o)),p.default.createElement("button",{className:"c4g-router-download",title:this.props.lang.ROUTER_DOWNLOAD,onMouseUp:function(){e.exportGpx()}}),p.default.createElement("button",{className:"c4g-router-print",title:this.props.lang.ROUTER_PRINT,onMouseUp:function(){i()}})):s&&a&&"area"===this.props.mode&&(n=p.default.createElement("div",{className:"c4g-router-instructions-header"},p.default.createElement("div",{className:"c4g-router-area-detour"},p.default.createElement("label",null,this.props.lang.AREA_DETOUR,":"),p.default.createElement("em",null,s," km")),p.default.createElement("div",{className:"c4g-router-area-featurecount"},p.default.createElement("label",null,this.props.lang.AREA_FEATURECOUNT,":"),p.default.createElement("em",null,a)),p.default.createElement("button",{className:"c4g-router-print",onMouseUp:function(){i()}}))),"instr"===this.props.resultMode&&this.props.routerInstructions&&"route"===this.props.mode?t=p.default.createElement(p.Suspense,{fallback:p.default.createElement("div",null,'"loading.."')},p.default.createElement(f,{className:"c4g-route-instructions-wrapper",mapController:this.props.mapController,routerInstructions:this.props.routerInstructions,routerWaySource:this.props.routerWaySource,routerHintSource:this.props.routerHintSource,open:this.props.open,header:n})):("feat"===this.props.resultMode||"area"===this.props.mode||!this.props.routerInstructions&&this.props.featureList)&&(t=p.default.createElement(p.Suspense,{fallback:p.default.createElement("div",null,'"loading.."')},p.default.createElement(y,{className:"c4g-route-feature-wrapper",activeId:this.props.activeId,setActiveId:this.props.setActiveId,routeMode:this.props.mode,layerRoute:this.props.layerRoute,layerArea:this.props.layerArea,featureList:this.props.featureList,mapController:this.props.mapController,featureSource:this.props.featureSource,layerValueRoute:this.props.layerValueRoute,layerValueArea:this.props.layerValueArea,header:n}))),this.props.open?p.default.createElement("div",{className:this.props.className+(this.props.open?" c4g-open":" c4g-close")+(this.props.open?" c4g-details-open":"")},t):null}},{key:"componentDidUpdate",value:function(){var e=this.props.className+(this.props.open?" c4g-open":" c4g-close"),t=document.getElementsByClassName(e)[0],r=document.querySelector(".c4g-router-panel.c4g-open");r&&(r=r[0]);var o=!!document.querySelector(".c4g_map")&&document.querySelector(".c4g_map")[0];o&&t&&r&&t.offsetHeight+r.offsetHeight+84>o.offsetHeight&&(t.style.height=o.offsetHeight-r.offsetHeight),"area"===this.props.mode&&"feat"!==this.props.resultMode&&this.props.router.setState({resultMode:"feat"})}},{key:"open",value:function(){this.props.setOpen(!0)}},{key:"close",value:function(){this.props.setOpen(!1)}},{key:"clickControl",value:function(){this.props.open?this.close():this.open()}},{key:"exportGpx",value:function(){var e=this.props.router.routerWaySource,t=new d.default;if(e&&e.getFeatures&&e.getFeatures()){var r=t.writeFeatures(e.getFeatures(),{featureProjection:"EPSG:3857",dataProjection:"EPSG:4326",decimals:3}),o=document.createElement("a");o.setAttribute("href","data:text/xml;charset=utf-8,"+encodeURIComponent(r)),o.setAttribute("download","route.gpx"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),console.log(r)}}},{key:"slideInCollidingElements",value:function(){}},{key:"slideOutCollidingElements",value:function(){}}]),s}(p.Component);t.RouterResultContainer=g},"./Resources/public/js/components/c4g-router-view.jsx":(e,t,r)=>{"use strict";var o=r("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=r("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.RouterView=void 0;var a=o(r("./node_modules/@babel/runtime/regenerator/index.js")),n=o(r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js")),i=o(r("./node_modules/@babel/runtime/helpers/classCallCheck.js")),l=o(r("./node_modules/@babel/runtime/helpers/createClass.js")),u=o(r("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),c=o(r("./node_modules/@babel/runtime/helpers/inherits.js")),p=o(r("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),d=o(r("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),h=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=a?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}(r("./node_modules/react/index.js")),m=r("./Resources/public/js/components/c4g-router-result-container.jsx"),f=r("./Resources/public/js/routing-constants.js"),y=r("./node_modules/ol/index.js"),g=r("./node_modules/ol/geom.js"),v=r("./node_modules/ol/format.js"),R=r("./node_modules/ol/proj.js"),_=r("./node_modules/ol/style.js"),P=r("./node_modules/ol/layer.js"),C=r("./node_modules/ol/source.js"),S=r("./node_modules/ol/interaction.js"),b=r("../CoreBundle/Resources/public/js/AlertHandler.js"),A=r("./Resources/public/js/c4g-routing-permalink.js"),E=r("./Resources/public/js/routing-constant-i18n.js"),j=r("./Resources/public/js/c4g-maps-constant.js"),O=r("./Resources/public/js/components/c4g-titlebar.jsx"),w=r("./Resources/public/js/c4g-maps-utils.js"),k=r("./Resources/public/js/components/c4g-router-popup-buttons.jsx");function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}var I=h.default.lazy((function(){return r.e("Resources_public_js_components_c4g-router-controls_jsx").then(r.bind(r,"./Resources/public/js/components/c4g-router-controls.jsx"))})),L=h.default.lazy((function(){return r.e("Resources_public_js_components_c4g-router-profile-selection_jsx").then(r.bind(r,"./Resources/public/js/components/c4g-router-profile-selection.jsx"))})),F=r("./node_modules/osmtogeojson/index.js"),x=function(e){(0,c.default)(T,e);var t,r,o,s=(r=T,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.default)(r);if(o){var s=(0,d.default)(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return(0,p.default)(this,e)});function T(e){var t;(0,i.default)(this,T),(t=s.call(this,e)).setActiveId=t.setActiveId.bind((0,u.default)(t)),t.setOpen=t.setOpen.bind((0,u.default)(t)),t.close=t.close.bind((0,u.default)(t)),t.openControls=t.openControls.bind((0,u.default)(t)),t.resetFromPoint=t.resetFromPoint.bind((0,u.default)(t)),t.resetToPoint=t.resetToPoint.bind((0,u.default)(t)),t.resetAreaPoint=t.resetAreaPoint.bind((0,u.default)(t)),t.toggleResultDetails=t.toggleResultDetails.bind((0,u.default)(t)),t.setResultInstr=t.setResultInstr.bind((0,u.default)(t)),t.setResultFeat=t.setResultFeat.bind((0,u.default)(t)),t.recalculateRoute=t.recalculateRoute.bind((0,u.default)(t));var r=t.props.mapController,o=[];for(var a in t.languageConstants=(0,E.getLanguage)(r.data),r.data.router_profiles)r.data.router_profiles.hasOwnProperty(a)&&o.push({id:a,text:r.data.router_profiles[a]});var n=null,l=null,c=null,p=null;if(r.data.showFeatures){var d=r.data.routerLayers;for(var h in d)d.hasOwnProperty(h)&&(n=n||h,c=Object.keys(d[n])[0]||c,l=l||h,p=Object.keys(d[l])[0]||p)}return t.state={router:e.router,objSettings:{proxyUrl:r&&r.data?r.data.proxyUrl:"",keyAutocomplete:r&&r.data?r.data.autocomplete:"",center:function(){var e=r.map.getView().getCenter();return e=(0,R.transform)(e,"EPSG:3857","EPSG:4326")},geosearchParams:r.data.geosearch.params},activeId:null,openResults:!1,containerAddresses:{arrFromPositions:[],arrFromNames:[],arrToPositions:[],arrToNames:[],arrAreaPositions:[],arrAreaNames:[],arrOverPositions:{},arrOverNames:{}},fromAddress:"",toAddress:"",areaAddress:"",layerRoute:n,layerArea:l,layerValueRoute:c,layerValueArea:p,detourRoute:e.detourRoute.initial,detourArea:e.detourArea.initial,featureList:{features:[],type:""},mode:r.data.initialMode,overPtCtr:0,overAddresses:[],featureSource:void 0,routerWaySource:void 0,routerHintSource:void 0,areaPoint:null,fromPoint:null,toPoint:null,overPoints:[],profiles:o||[],currentProfile:0,open:"routing"===e.mapController.data.initial_open_comp||!1,openSettings:"routing"===e.mapController.data.initial_open_comp||!1,routerInstructions:{},resultMode:e.mapController.data.initialResultMode||"instr"},t.popupRouteButtonWrapper="",t.swapPoints=t.swapPoints.bind((0,u.default)(t)),r.data.usePermalink&&(t.permalink=new A.RoutingPermalink((0,u.default)(t))),t.profileTranslation={0:"car",1:"hgv",2:"bike",3:"bike",4:"bike",5:"bike",6:"bike",7:"bike",8:"foot",9:"foot",10:"wheelchair",11:"hgv",12:"scooter",13:"scooter"},t.init(),t}return(0,l.default)(T,[{key:"render",value:function(){var e=this,t=this.props.mapController.data,r={waySource:this.state.routerWaySource,hintSource:this.state.routerHintSource,featureSource:this.state.featureSource},o={};"route"===this.state.mode?o={min:t.detourRoute.min,max:t.detourRoute.max,value:this.state.detourRoute,router:this}:"area"===this.state.mode&&(o={min:t.detourArea.min,max:t.detourArea.max,value:this.state.detourArea,router:this});var s={from:this.resetFromPoint,to:this.resetToPoint,area:this.resetAreaPoint},a=this.createOverSettings(),n="";"route"===this.state.mode?n=this.props.mapController.data.routerHeadline||this.languageConstants.ROUTER_DEFAULT_HEADLINE_ROUTE:"area"===this.state.mode&&(n=this.props.mapController.data.areaHeadline||this.languageConstants.ROUTER_DEFAULT_HEADLINE_AREA);var i=this.state.routerInstructions.instructions,l="",u=[];return this.state.featureList.features.length>0&&(this.state.fromAddress&&this.state.toAddress&&"route"===this.state.mode||this.state.areaAddress&&"area"===this.state.mode)&&u.push(h.default.createElement("button",{id:"c4g-router-button-feature",className:"feat"===this.state.resultMode&&this.state.openResults?"c4g-active":"c4g-inactive",onMouseUp:this.setResultFeat,key:1,title:"Ergebnisliste anzeigen"})),i&&i.length>0&&"route"===this.state.mode&&u.push(h.default.createElement("button",{id:"c4g-router-button-instructions",className:"instr"===this.state.resultMode&&this.state.openResults?"c4g-active":"c4g-inactive",onMouseUp:this.setResultInstr,key:2,title:"Routenhinweise anzeigen"})),u.length>0&&(l=h.default.createElement(h.default.Fragment,null,h.default.createElement("button",{className:"c4g-router-hide-form-button "+(this.state.openSettings?"c4g-active":"c4g-inactive"),onMouseUp:function(){e.setState({openSettings:!e.state.openSettings})},title:this.languageConstants.ROUTER_SETTINGS}),h.default.createElement("div",{className:"c4g-router-mode-switch"},u))),h.default.createElement("div",{className:"c4g-router-wrapper"},h.default.createElement(h.default.Fragment,null,h.default.createElement(O.Titlebar,{wrapperClass:"c4g-router-header",header:n,headerClass:"c4g-router-headline",detailBtnClass:"c4g-router-extended-options",hideContainer:".c4g-router-container-right",detailBtnCb:this.toggleDetails,closeBtnClass:"c4g-router-close",closeBtnCb:this.close,closeBtnTitle:this.languageConstants.CLOSE}),h.default.createElement("div",{className:"c4g-router-switcher"},h.default.createElement("div",null,l),h.default.createElement(h.Suspense,{fallback:h.default.createElement("div",null,'"loading..."')},h.default.createElement(L,{profiles:this.state.profiles,router:this,currentProfile:this.state.currentProfile})))),h.default.createElement(h.Suspense,{fallback:h.default.createElement("div",null,'"loading"')},h.default.createElement(I,{router:this,open:this.state.open&&this.state.openSettings,setOpen:this.openControls,profiles:this.state.profiles,className:"c4g-router-panel",objSettings:this.state.objSettings,objFunctions:this.objFunctions,overSettings:a,enableOverPoints:this.props.mapController.data.enableOverPoints,sources:r,layers:this.props.mapController.data.routerLayers,containerAddresses:this.state.containerAddresses,resetFunctions:s,mapController:this.props.mapController,currentProfile:this.state.currentProfile,fromAddress:this.state.fromAddress,switchTargets:this.props.mapController.data.enableTargetSwitch,toAddress:this.state.toAddress,areaAddress:this.state.areaAddress,mode:this.state.mode,sliderOptions:o,title:this.languageConstants.CTRL_ROUTER,target:this.props.target})),h.default.createElement(h.Suspense,{fallback:h.default.createElement("div",null,'"loading"')},h.default.createElement(m.RouterResultContainer,{visible:this.state.open,open:this.state.open&&this.state.openResults,setOpen:this.setOpen,direction:"bottom",className:"c4g-router-result-container",mapController:this.props.mapController,mode:this.state.mode,setResultFeat:this.setResultFeat,routerInstructions:this.state.routerInstructions,featureList:this.state.featureList,routerWaySource:this.state.routerWaySource,detour:this.state.detourArea,layerRoute:this.state.layerRoute,layerValueRoute:this.state.layerValueRoute,layerArea:this.state.layerArea,resultMode:this.state.resultMode,router:this,layerValueArea:this.state.layerValueArea,routerHintSource:this.state.routerHintSource,featureSource:this.state.featureSource,profile:this.state.currentProfile,activeId:this.state.activeId,setActiveId:this.setActiveId,detailOpen:this.state.resultDetailOpen,toggleDetailOpen:this.toggleResultDetails,headline:"Router Ergebnisse",lang:this.languageConstants})))}},{key:"setResultInstr",value:function(e){e.stopPropagation(),this.setState({resultMode:"instr",openResults:!0})}},{key:"setResultFeat",value:function(e){e.stopPropagation(),this.setState({resultMode:"feat",openResults:!0})}},{key:"close",value:function(){this.openControls(!1),jQuery(this.props.mapController.routerContainer).removeClass("c4g-open").addClass("c4g-close")}},{key:"getProfileById",value:function(e){for(var t=0;t<this.state.profiles.length;t++)if(parseInt(this.state.profiles[t].id,10)===parseInt(e,10))return this.state.profiles[t];return null}},{key:"toggleResultDetails",value:function(){this.state.resultDetailOpen?this.setState({resultDetailOpen:!1}):this.setState({resultDetailOpen:!0})}},{key:"openControls",value:function(e){e?(this.props.mapController.setOpenComponent(this),this.setState({open:!0,openSettings:!0}),jQuery(this.props.mapController.routerContainer).removeClass("c4g-close").addClass("c4g-open")):this.setState({open:!1})}},{key:"componentDidMount",value:function(){this.props.mapController.data.usePermalink&&this.permalink.handleInitialParams(),this.props.mapController.data.router_div&&this.setState({open:!0})}},{key:"componentDidUpdate",value:function(e,t,r){if(this.props.mapController.data.usePermalink){var o=this.permalink.linkFragments;this.state.fromPoint&&o.fromAddress!==this.state.fromPoint.getCoordinates()&&this.permalink.updateLinkFragments("fromAddress",this.state.fromPoint.getCoordinates()),this.state.toPoint&&o.toAddress!==this.state.toPoint.getCoordinates()&&this.permalink.updateLinkFragments("toAddress",this.state.toPoint.getCoordinates()),o.mode!==this.state.mode&&this.permalink.updateLinkFragments("mode",this.state.mode),o.detourArea!==this.state.detourArea&&this.permalink.updateLinkFragments("detourArea",this.state.detourArea),o.detourRoute!==this.state.detourRoute&&this.permalink.updateLinkFragments("detourRoute",this.state.detourRoute)}!0===t.open&&!1===this.state.open&&(this.routerLayerGroup.setVisible(!1),this.modWayInteraction.setActive(!1),jQuery(this.props.mapController.routerContainer).removeClass("c4g-open").addClass("c4g-close")),this.state.open&&!t.open&&(this.props.mapController.hideOtherComponents(this),this.routerLayerGroup.setVisible(!0),this.modWayInteraction.setActive(!0),jQuery(this.props.mapController.routerContainer).addClass("c4g-open").removeClass("c4g-close"),this.state.openSettings||this.state.openResults||this.setState({openSettings:!0})),this.state.openSettings&&!t.openSettings&&this.setState({openResults:!1}),this.state.openResults&&!t.openResults&&this.setState({openSettings:!1}),this.state.openResults||this.state.openSettings||!t.openSettings||this.setState({openSettings:!0}),this.state.openSettings||this.state.openResults||!t.openResults||this.setState({openResults:!0}),"route"!==this.state.mode||this.state.fromAddress&&this.state.toAddress||!this.state.openResults||"area"!==t.mode||this.setState({openResults:!1}),this.props.mapController.data.caching&&!this.state.open&&w.utils.getValue("panel")===this.constructor.name&&w.utils.storeValue("panel","")}},{key:"setProfile",value:function(e){this.setState({currentProfile:e},this.updateRouteLayersAndPoints)}},{key:"setLayer",value:function(e){var t=this.props.mapController.data.routerLayers[e],r=Object.keys(t)[0];"route"===this.state.mode?this.setState({layerRoute:e,layerValueRoute:r},this.recalculateRoute):this.setState({layerArea:e,layerValueArea:r},this.performArea)}},{key:"setLayerValue",value:function(e){var t=this;"route"===this.state.mode?this.setState({layerValueRoute:e},(function(){t.showFeatures(t.state.featureList.features,t.state.featureList.type,"router",!1)})):"area"===this.state.mode&&this.setState({layerValueArea:e},(function(){t.showFeatures(t.state.featureList.features,t.state.featureList.type,"area",!1)}))}},{key:"setActiveId",value:function(e){this.setState({activeId:e})}},{key:"setOpen",value:function(e){this.setState({openResults:e})}},{key:"setAreaPoint",value:function(e,t){var r=this;this.performReverseSearch("areaAddress",[e,t]);var o=new g.Point([e,t]);this.setState({areaPoint:o},(function(){return r.updateRouteLayersAndPoints()}))}},{key:"setRouteFrom",value:function(e,t){var r=this;this.performReverseSearch("fromAddress",[e,t]);var o=new g.Point([e,t]);this.setState({fromPoint:o},(function(){r.updateRouteLayersAndPoints()}))}},{key:"setRouteTo",value:function(e,t){var r=this;this.performReverseSearch("toAddress",[e,t]);var o=new g.Point([e,t]);this.setState({toPoint:o},(function(){return r.updateRouteLayersAndPoints()}))}},{key:"addOverPoint",value:function(e,t,r){var o=this;this.performReverseSearch("overAddress",[e,t],r);var s=new g.Point([e,t]),a=this.state.overPoints;a.splice(r,1,s),this.setState({overPoints:a},(function(){return o.updateRouteLayersAndPoints()}))}},{key:"setMode",value:function(e){var t=this;if(this.state.mode!==e){var r={waySource:this.state.routerWaySource,hintSource:this.state.routerHintSource,featureSource:this.state.featureSource,locationSource:this.locationsSource};this.setState({mode:e},(function(){for(var e in r)r.hasOwnProperty(e)&&r[e]&&r[e].clear();t.updateRouteLayersAndPoints()}))}}},{key:"swapPoints",value:function(){var e=this.state.toPoint,t=this.state.toAddress,r=this.state.fromPoint,o=this.state.fromAddress,s=this.state.containerAddresses,a=s.arrFromNames,n=s.arrFromPositions;s.arrFromNames=s.arrToNames,s.arrFromPositions=s.arrToPositions,s.arrToNames=a,s.arrToPositions=n,this.setState({fromPoint:e,fromAddress:t,toPoint:r,toAddress:o,containerAddresses:s},this.updateRouteLayersAndPoints)}},{key:"createOverSettings",value:function(){var e=this,t={};t.overAddresses=this.state.overAddresses,t.overPoints=this.state.overPoints,t.overPtCtr=this.state.overPtCtr,t.overFunction=function(){var t=e.state.containerAddresses;t.arrOverNames[e.state.overPtCtr]=[],t.arrOverPositions[e.state.overPtCtr]=[],e.setState({overPtCtr:e.state.overPtCtr+1,containerAddresses:t})},t.swapPoints=this.swapPoints,t.objFunctions={};for(var r=0;r<this.state.overPtCtr;r++)t.objFunctions[r]=this.createAutocompleteFunctionsForOverField(r),t.overAddresses[r]||(t.overAddresses[r]=""),t.overPoints[r]||(t.overPoints[r]=null);return t}},{key:"createAutocompleteFunctionsForOverField",value:function(e){var t=this;return{selectListener:function(r,o){var s,a,n,i=o.item.value,l=t.state.containerAddresses.arrOverNames[e].findIndex((function(e){return e===i})),u=t.state.containerAddresses.arrOverPositions[e][l];(s=t.state.overAddresses)[e]=t.state.containerAddresses.arrOverNames[e][l],n=new g.Point([u[1],u[0]]),(a=t.state.overPoints)[e]=n,t.setState({overPoints:a,overAddresses:s},(function(){t.updateRouteLayersAndPoints()}))},deleteFunction:function(r){var o=t.state.containerAddresses;o.arrOverPositions[e]=[],o.arrOverNames[e]=[];var s=t.state.overPoints;s.splice(e,1);var a=t.state.overAddresses;a.splice(e,1),t.setState({overPoints:s,containerAddresses:o,overAddresses:a,overPtCtr:t.state.overPtCtr-1},(function(){t.updateRouteLayersAndPoints()}))},changeListener:function(){}}}},{key:"updateRouteLayersAndPoints",value:function(){var e=this,t=this;if(this.locationsSource.clear(),this.areaSource.clear(),"route"===this.state.mode){if(this.state.fromPoint){var r=new y.Feature({geometry:this.state.fromPoint.clone().transform("EPSG:4326","EPSG:3857")});this.props.mapController.data.router_from_locstyle&&this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_from_locstyle]?r.setStyle(this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_from_locstyle].style):this.props.mapController.proxy.locationStyleController.loadLocationStyles([this.props.mapController.data.router_from_locstyle],{done:function(){r.setStyle(e.props.mapController.proxy.locationStyleController.arrLocStyles[e.props.mapController.data.router_from_locstyle].style)}}),this.locationsSource.addFeature(r)}if(this.state.toPoint){var o=new y.Feature({geometry:this.state.toPoint.clone().transform("EPSG:4326","EPSG:3857")});this.props.mapController.data.router_to_locstyle&&this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_to_locstyle]?o.setStyle(this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_to_locstyle].style):this.props.mapController.proxy.locationStyleController.loadLocationStyles([this.props.mapController.data.router_to_locstyle],{done:function(){o.setStyle(e.props.mapController.proxy.locationStyleController.arrLocStyles[e.props.mapController.data.router_to_locstyle].style)}}),this.locationsSource.addFeature(o)}if(this.state.fromPoint&&this.state.toPoint||this.routerWaySource.clear(),this.state.overPoints&&Object.keys(this.state.overPoints).length>0)for(var s in this.state.overPoints)if(this.state.overPoints.hasOwnProperty(s)&&null!==this.state.overPoints[s]){var a=new y.Feature({geometry:this.state.overPoints[s].clone().transform("EPSG:4326","EPSG:3857")});this.props.mapController.data.router_interim_locstyle&&this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_interim_locstyle]&&a.setStyle(this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_interim_locstyle].style),this.locationsSource.addFeature(a)}this.props.mapController.data.routeStartButton||this.recalculateRoute()}else if("area"===this.state.mode){if(this.state.areaPoint){var n=new y.Feature({geometry:this.state.areaPoint.clone().transform("EPSG:4326","EPSG:3857")});this.props.mapController.data.router_point_locstyle&&this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_point_locstyle]?n.setStyle(this.props.mapController.proxy.locationStyleController.arrLocStyles[this.props.mapController.data.router_point_locstyle].style):this.props.mapController.proxy.locationStyleController.loadLocationStyles([this.props.mapController.data.router_point_locstyle],{done:function(){n.setStyle(this.props.mapController.proxy.locationStyleController.arrLocStyles[t.props.mapController.data.router_point_locstyle].style)}}),this.areaSource.addFeature(n)}this.performArea()}}},{key:"resetFromPoint",value:function(){var e=this,t=e.state.containerAddresses;t.arrFromPositions=[],t.arrFromNames=[],this.setState({fromPoint:null,containerAddresses:t,fromAddress:""},(function(){e.updateRouteLayersAndPoints()}))}},{key:"resetToPoint",value:function(){var e=this,t=e.state.containerAddresses;t.arrToPositions=[],t.arrToNames=[],this.setState({toPoint:null,containerAddresses:t,toAddress:""},(function(){e.updateRouteLayersAndPoints()}))}},{key:"resetAreaPoint",value:function(){var e=this,t=e.state.containerAddresses;t.arrAreaPositions=[],t.arrAreaNames=[],this.setState({areaPoint:null,containerAddresses:t,areaAddress:""},(function(){e.updateRouteLayersAndPoints()}))}},{key:"createAutocompleteFunctions",value:function(){var e={},t=this;return e.fromFunctions={selectListener:function(e,r){var o=r.item.value,s=t.state.containerAddresses.arrFromNames.findIndex((function(e){return e===o})),a=t.state.containerAddresses.arrFromPositions[s],n=new g.Point([a[1],a[0]]);t.setState({fromPoint:n,fromAddress:t.state.containerAddresses.arrFromNames[s]},(function(){t.updateRouteLayersAndPoints(),t.recalculateRoute()}))},deleteFunction:function(e){t.resetFromPoint()},changeListener:function(){}},e.toFunctions={selectListener:function(e,r){var o=r.item.value,s=t.state.containerAddresses.arrToNames.findIndex((function(e){return e===o})),a=t.state.containerAddresses.arrToPositions[s],n=new g.Point([a[1],a[0]]);t.setState({toPoint:n,toAddress:t.state.containerAddresses.arrToNames[s]},(function(){t.updateRouteLayersAndPoints(),t.recalculateRoute()}))},deleteFunction:function(e){t.resetToPoint()},changeListener:function(){}},e.areaFunctions={selectListener:function(e,r){var o=r.item.value,s=t.state.containerAddresses.arrAreaNames.findIndex((function(e){return e===o})),a=t.state.containerAddresses.arrAreaPositions[s],n=new g.Point([a[1],a[0]]);t.setState({areaPoint:n,areaAddress:t.state.containerAddresses.arrAreaNames[s]},(function(){t.updateRouteLayersAndPoints(),t.performArea()}))},deleteFunction:function(e){var r=t.state.containerAddresses;r.arrAreaPositions=[],r.arrAreaNames=[],t.setState({areaPoint:null,containerAddresses:r,areaAddress:""},(function(){}))},changeListener:function(){}},e}},{key:"addPopupHook",value:function(){var e=this;window.c4gMapsHooks.proxy_appendPopup=window.c4gMapsHooks.proxy_appendPopup||[],window.c4gMapsHooks.proxy_appendPopup.push((function(t){var r=t.mapController,o=t.popup;if(r.components.router&&o.popup.routing_link)if(3!==parseInt(r.data.popupHandling,10)){var s=function(t){var r=t.feature,o=e,s=function(e){if(o.openControls(!0),o.setMode("route"),jQuery(e.currentTarget).hasClass(j.cssConstants.POPUP_ROUTE_FROM)){var t=(0,R.toLonLat)(r.getGeometry().getCoordinates(),"EPSG:3857");o.setRouteFrom(t[0],t[1])}else{var s=(0,R.toLonLat)(r.getGeometry().getCoordinates(),"EPSG:3857");o.setRouteTo(s[0],s[1])}},a=document.createElement("div");a.className=j.cssConstants.POPUP_ROUTE_WRAPPER;var n=document.createElement("button");n.className=j.cssConstants.ICON+" "+j.cssConstants.POPUP_ROUTE_FROM,jQuery(n).click(s),a.appendChild(n);var i=document.createElement("span");n.appendChild(i);var l=document.createElement("button");l.className=j.cssConstants.ICON+" "+j.cssConstants.POPUP_ROUTE_TO,jQuery(l).click(s),a.appendChild(l);var u=document.createElement("span");return l.appendChild(u),a}(o);window.c4gMapsPopup.$content.append(s)}else{var a={feature:o.feature,router:e};t.comp.setAddButtons(k.RouterPopupButtons,a)}}))}},{key:"init",value:function(){var e=this,t=[this.props.mapController.data.router_from_locstyle,this.props.mapController.data.router_to_locstyle,this.props.mapController.data.router_point_locstyle,this.props.mapController.data.areaCenterLocstyle,this.props.mapController.data.clickLocstyle];this.props.mapController.data.priorityFeatures&&this.props.mapController.data.priorityLocstyle&&t.push(this.props.mapController.data.priorityLocstyle),this.props.mapController.proxy.locationStyleController.loadLocationStyles(t);var r=this.props.mapController.data;for(var o in this.objLayers={},r.routerLayers)r.routerLayers.hasOwnProperty(o)&&(this.objLayers[o]=r.routerLayers[o][Object.keys(r.routerLayers[o])[0]]);this.routingAltWaySource=new C.Vector,this.routerWaySource=new C.Vector,this.routerWayLayer=new P.Vector({source:this.routerWaySource,zIndex:1,style:[new _.Style({stroke:new _.Stroke({color:"rgba(255, 255, 255, 0.6)",width:8})}),new _.Style({stroke:new _.Stroke({color:"rgba(0, 51, 119, 0.9)",width:4})})]}),this.routerAltWayLayer=new P.Vector({source:this.routingAltWaySource,zIndex:0,style:[new _.Style({stroke:new _.Stroke({color:"rgba(255, 255, 255, 0.6)",width:8})}),new _.Style({stroke:new _.Stroke({color:"rgba(0, 51, 119, 0.4)",width:4})})]});var s=new S.Select({style:[new _.Style({stroke:new _.Stroke({color:"rgba(255, 255, 255, 0.0)",width:8})}),new _.Style({stroke:new _.Stroke({color:"rgba(255, 51, 119, 0.0)",width:4})})]});s.on("select",(function(t){var r=t.selected[0];if(r){var o=r.getGeometry();o&&"LineString"===o.getType()?e.showAltRoute(e.response,r.getId()):r&&e.clickFeatureEntryForFeature(r)}})),this.mapSelectInteraction=s,this.modWayInteraction=new S.Modify({source:this.routerWaySource,style:[new _.Style({stroke:new _.Stroke({color:"rgba(255, 255, 255, 0.0)",width:8})}),new _.Style({stroke:new _.Stroke({color:"rgba(255, 51, 119, 0.0)",width:4})})]}),this.modWayInteraction.on("modifystart",(function(t){!0===e.state.open&&(e.modifyStartPoint=new g.Point(t.mapBrowserEvent.coordinate).transform("EPSG:3857","EPSG:4326"))})),this.modWayInteraction.on("modifyend",(function(t){if(!0===e.state.open){var r,o=new g.Point(t.mapBrowserEvent.coordinate).transform("EPSG:3857","EPSG:4326"),s=1/0,a=Object.keys(e.state.overPoints);if(a.length>0){for(var n in e.state.overPoints)if(e.state.overPoints.hasOwnProperty(n)){var i=e.calcDistance(e.modifyStartPoint.getCoordinates(),e.state.overPoints[n].getCoordinates());i<s&&(s=i,r=n)}var l=e.calcDistance(e.state.fromPoint.getCoordinates(),e.modifyStartPoint.getCoordinates()),u=e.calcDistance(e.state.toPoint.getCoordinates(),e.modifyStartPoint.getCoordinates()),c=e.calcDistance(e.state.fromPoint.getCoordinates(),e.state.overPoints[0].getCoordinates()),p=a[a.length-1],d=e.calcDistance(e.state.toPoint.getCoordinates(),e.state.overPoints[p].getCoordinates());l<c?r=0:u<d&&r++}else r=0;e.performReverseSearch("overAddress",o.getCoordinates(),r),e.addOverPoint(o.getCoordinates()[0],o.getCoordinates()[1],r)}})),e.props.mapController.map.addInteraction(s),this.props.mapController.data.enableOverPoints&&e.props.mapController.map.addInteraction(this.modWayInteraction),s.setActive(!1),this.routerHintSource=new C.Vector,this.routerHintLayer=new P.Vector({source:this.routerHintSource,style:function(t,r){return!e.props.mapController.proxy||e.props.mapController.proxy.locationStyleController.arrLocStyles[e.props.mapController.data.router_point_locstyle].style(t,r)}}),this.mapData=this.props.mapController.data,this.locationsSource=new C.Vector,this.locationsLayer=new P.Vector({source:this.locationsSource,zIndex:2}),this.areaSource=new C.Vector,this.areaLayer=new P.Vector({source:this.areaSource,zIndex:2}),this.routerFeaturesSource=new C.Vector,this.routerFeaturesLayer=new P.Vector({source:this.routerFeaturesSource,zIndex:20}),this.routerLayerGroup=new P.Group({layers:new y.Collection([this.routerWayLayer,this.routerAltWayLayer,this.locationsLayer,this.routerHintLayer,this.routerFeaturesLayer,this.locationsLayer,this.areaLayer]),visible:!0}),this.props.mapController.map.addLayer(this.routerLayerGroup),"route"===this.props.mapController.data.initialMode||this.viewArea,this.routeInstructions={};var a=this.props.mapController.data.profile;this.geoSearchApi=this.props.mapController.data.api.geosearch+"/"+a,this.geoReverseSearchApi=this.props.mapController.data.api.geosearch_reverse+"/"+a,this.routingApi=this.props.mapController.data.api.routing+"/"+a,this.usePermalink&&this.permalinkHandler.handleInitialParams(),this.objFunctions=this.createAutocompleteFunctions(),this.addPopupHook(),this.addMapInputInteraction()}},{key:"calcDistance",value:function(e,t){var r,o;return r=Math.pow(e[0]-t[0],2),o=Math.pow(e[1]-t[1],2),Math.sqrt(r+o)}},{key:"showRouteInstructions",value:function(e,t,r,o){t=t||0;var s,a,n,i="",l="",u="",c="";if(this.props.mapController.data.showInstructions&&((a=document.createElement("div")).className=f.routingConstants.ROUTER_INSTRUCTIONS_HEADER,e)){if(e.features&&e.features.length>0&&this.props.mapController.data.showFeatures||jQuery(".c4g-router-instructions-wrapper").css("display","block"),"1"==this.props.mapController.data.router_api_selection||"1"==e.routeType)e.routes[t].legs[0].summary&&(i=e.routes[t].legs[0].summary.split(",")[0],l=e.routes[t].legs[0].summary.split(",")[1],e.routes[t].legs[1]&&(l=e.routes[t].legs[1].summary.split(",")[1])),u=e.routes[t].distance,c=e.routes[t].duration;else if("0"==this.props.mapController.data.router_api_selection||"0"==e.routeType)e.route_name&&(i=e.route_name[0],l=e.route_name[1]),e.route_summary&&(u=e.route_summary.total_distance,c=e.route_summary.total_time);else if("2"==this.props.mapController.data.router_api_selection||"2"==e.routeType){c=e.routes[t].summary.duration,u=e.routes[t].summary.distance;for(var p=[],d=e.routes[t].segments,h=0;h<d.length;h++)for(var m=d[h],y=0;y<m.steps.length;y++){var g=m.steps[y];g.length=g.distance/1e3,p.push(g)}this.routeInstructions[t]={time:c,distance:u,instructions:p},this.setState({routerInstructions:this.routeInstructions[t],routerWaySource:r,routerHintSource:o})}else if("3"==this.props.mapController.data.router_api_selection||"3"==e.routeType){u=e.paths[t].distance,c=e.paths[t].time/1e3;for(var v=[],R=e.paths[t].instructions,_=0;_<R.length;_++){var P=R[_];P.length=P.distance/1e3,P.instruction=P.text,P.type=P.sign,v.push(P)}this.routeInstructions[t]={time:c,distance:u,instructions:v},this.setState({routerInstructions:this.routeInstructions[t],routerWaySource:r,routerHintSource:o})}else"4"!=this.props.mapController.data.router_api_selection&&"4"!=e.routeType||(u=1e3*e.trip.summary.length,c=e.trip.summary.time,this.routeInstructions[t]={time:c,distance:u,instructions:e.trip.legs[t].maneuvers},this.setState({routerInstructions:this.routeInstructions[t],routerWaySource:r,routerHintSource:o}));i&&l?a.innerHTML="<label>"+this.languageConstants.ROUTER_VIEW_LABEL_ROUTE+"</label> <em>"+i+" &#8594; "+l+"</em><br><label>"+this.languageConstants.ROUTER_VIEW_LABEL_DISTANCE+"</label> <em>"+u+"</em><br><label>"+this.languageConstants.ROUTER_VIEW_LABEL_TIME+"</label> <em>"+c+"</em><br>":this.routeProfile&&this.routeProfile.active&&Array.isArray(this.routeProfile.active)&&(a.innerHTML="<label>"+this.languageConstants.ROUTER_VIEW_LABEL_PROFILE+"</label> <em>"+this.props.mapController.data.router_profiles[this.routeProfile.active]+"</em><br><label>"+this.languageConstants.ROUTER_VIEW_LABEL_DISTANCE+"</label> <em>"+u+"</em><br><label>"+this.languageConstants.ROUTER_VIEW_LABEL_TIME+"</label> <em>"+c+"</em><br>"),s=document.createElement("div"),n='<table class="'+f.routingConstants.ROUTER_INSTRUCTIONS_TABLE+'" cellpadding="0" cellspacing="0">',"1"===this.props.mapController.data.router_api_selection||"1"==e.routeType||"0"===this.props.mapController.data.router_api_selection||"0"==e.routeType||"2"===this.props.mapController.data.router_api_selection||"2"==e.routeType||"3"===this.props.mapController.data.router_api_selection||"3"==e.routeType||"4"===this.props.mapController.data.router_api_selection||e.routeType,n+="</table>",s.innerHTML=n,this.adjustInstructionMapInteraction()}}},{key:"performGeoSearch",value:(t=(0,n.default)(a.default.mark((function e(t){var r,o;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(r=this).geoSearchApi+"?format=json&limit=1&q="+encodeURI(t),this.mapData&&this.mapData.geosearch&&this.mapData.geosearch.searchKey&&this.mapData.geosearch.url&&(o=this.mapData.geosearch.url+"search.php?key="+this.mapData.geosearch.searchKey+"&format=json&limit=1&q="+encodeURI(t)),e.next=5,fetch(o).then((function(e){if(e)return e.json().then((function(e){return[parseFloat(e[0].lon),parseFloat(e[0].lat)]}));(new b.AlertHandler).showInfoDialog(r.props.langConstants.ROUTER_VIEW_ALERT_ERROR,r.props.langConstants.ROUTER_VIEW_ALERT_ADDRESS)})).catch((function(){(new b.AlertHandler).showInfoDialog(r.props.langConstants.ROUTER_VIEW_ALERT_ERROR,r.props.langConstants.ROUTER_VIEW_ALERT_ADDRESS)}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"performSearch",value:function(e,t,r){var o,s,a,n,i;if(n=this,""===e.val())return delete n[t],"";if(s=(o=n.props.mapController.map).getView().calculateExtent(o.getSize()),a="&viewbox="+(s=(0,R.transformExtent)(s,o.getView().getProjection(),"EPSG:4326"))[0]+","+s[1]+","+s[2]+","+s[3],i=n.geoSearchApi+"?format=json&limit=1&q="+encodeURI(e.val())+a,this.mapData&&this.mapData.geosearch&&this.mapData.geosearch.searchKey&&this.mapData.geosearch.url&&(i=this.mapData.geosearch.url+"search.php?key="+this.mapData.geosearch.searchKey+"&format=json&limit=1&q="+encodeURI(e.val())+a),this.mapData.geosearch.params)for(var l in this.mapData.geosearch.params)this.mapData.geosearch.params.hasOwnProperty(l)&&(i+="&"+l+"="+this.mapData.geosearch.params[l]);return jQuery.ajax({url:i}).done((function(o){if(o.length>0)if("overValue"===t){n.overValue||(n.overValue=[]);for(var s=new g.Point([parseFloat(o[0].lon),parseFloat(o[0].lat)]),a=e.next()[0];!jQuery(a).hasClass("c4g-router-input-clear");)a=jQuery(a).next()[0];a.id=s.ol_uid,n.overValue.push(s),n.$buttonOver.prop("disabled",!1)}else{var i=[parseFloat(o[0].lon),parseFloat(o[0].lat)],l=new g.Point(i);"fromValue"===t?n.setState({fromPoint:l,fromAddress:e.val()},(function(){return n.updateRouteLayersAndPoints()})):"toValue"===t&&n.setState({toPoint:l,toAddress:e.val()},(function(){return n.updateRouteLayersAndPoints()}))}else(new b.AlertHandler).showInfoDialog(n.props.langConstants.ROUTER_VIEW_ALERT_ERROR,n.props.langConstants.ROUTER_VIEW_ALERT_ADDRESS);r&&"function"==typeof r&&r()})).fail((function(){(new b.AlertHandler).showInfoDialog(n.props.langConstants.ROUTER_VIEW_ALERT_ERROR,n.props.langConstants.ROUTER_VIEW_ALERT_ADDRESS)})),""}},{key:"performReverseSearch",value:function(e,t,r){var o,s=this;o=this.geoReverseSearchApi+"?format=json&lat="+t[1]+"&lon="+t[0],this.mapData&&this.mapData.geosearch&&this.mapData.geosearch.reverseKey&&this.mapData.geosearch.url&&(o=this.mapData.geosearch.url+"reverse.php?key="+this.mapData.geosearch.reverseKey+"&format=json&lat="+t[1]+"&lon="+t[0]),jQuery.ajax({url:o}).done((function(t){if(t){var o="";switch(t.address&&((t.address.road||t.address.path||t.address.pedestrian)&&(o+=t.address.road||t.address.path||t.address.pedestrian,t.address.house_number&&(o+=" "+t.address.house_number)),(t.address.city||t.address.town)&&(o+=o?", ":"",o+=t.address.city||t.address.town)),""===o&&(o=t.display_name),e){case"areaAddress":s.setState({areaAddress:o},(function(){""===jQuery("#areaFrom").val()&&jQuery("#areaFrom").val(o)}));break;case"fromAddress":s.setState({fromAddress:o},(function(){""===jQuery("#routingFrom").val()&&jQuery("#routingFrom").val(o)}));break;case"toAddress":s.setState({toAddress:o},(function(){""===jQuery("#routingTo").val()&&jQuery("#routingTo").val(o)}));break;case"overAddress":var a=s.state.overAddresses;a.splice(r,1,o),s.setState({overAddresses:a})}}}))}},{key:"performArea",value:function(){var e=this,t=this.state.areaPoint;if(t){var r=[t.getCoordinates()[1],t.getCoordinates()[0]],o="con4gis/areaService/"+this.props.mapController.data.profile+"/"+this.state.layerArea+"/"+this.state.detourArea+"/"+r;o+="?profile="+this.state.currentProfile,e.areaAjax&&e.areaAjax.abort(),e.areaAjax=jQuery.ajax({url:o}).done((function(t){if(e.response=t,t){var r=e.showFeatures(t[0],t[1],"area");e.setState({featureList:{features:r,type:t[1]},featureSource:e.routerFeaturesSource,openResults:!0})}}))}}},{key:"performViaRoute",value:function(e,t,r){var o,s,a,n,i;if(s=this,this.state.featureSource&&this.state.featureSource.clear(),this.mapSelectInteraction.getFeatures().clear(),e||(e=this.fromPoint)){if(!t){if(!t)return;t=this.toPoint}if(r||this.overPoints&&(r=this.overPoints),a=[e.getCoordinates()[1],e.getCoordinates()[0]],n=[t.getCoordinates()[1],t.getCoordinates()[0]],r&&Object.keys(r).length>0)for(var l in i=[],r)r.hasOwnProperty(l)&&r[l]&&i.push([r[l].getCoordinates()[1],r[l].getCoordinates()[0]]);if(this.props.mapController.data.router_api_selection>="1"){var u=this.props.mapController.data.profile;if(o="con4gis/routeService/"+this.props.mapController.data.lang+"/"+u+"/"+this.state.layerRoute+"/"+this.state.detourRoute+"/"+a,r)for(var c=0;c<i.length;c++)o+=";"+i[c];return o+=";"+n,o+="?profile="+this.state.currentProfile,s.routeAjax&&s.routeAjax.abort(),s.routeAjax=jQuery.ajax({url:o}).done((function(e){if(s.response=e,e)if(e.error)(new b.AlertHandler).showInfoDialog(s.props.langConstants[e.error]);else if(s.showRouteLayer(e),s.showRouteInstructions(e,0,s.routerWaySource,s.routerHintSource),e.features&&(e.features.elements||e.features.length>0)){var t=s.showFeatures(e.features,e.type,"router");s.setState({featureList:{features:t,type:e.type},featureSource:s.routerFeaturesSource,openResults:!0})}})).always((function(){s.routeAjax=void 0,s.props.mapController.data.closeAfterSearch})),""}try{return o="con4gis/routeService/"+profileId+"?output=json&instructions=true&alt=false&loc_from="+a+"&loc_to="+n,jQuery.ajax({url:o}).done((function(e){e&&s.showRoute(e)})),""}catch(e){console.log("Please use a more modern API-Version for the Routeservice")}}}},{key:"recalculateRoute",value:function(){this.state.fromPoint&&this.state.toPoint&&(this.state.overPoints&&Object.keys(this.state.overPoints).length>0?this.performViaRoute(this.state.fromPoint,this.state.toPoint,this.state.overPoints):this.performViaRoute(this.state.fromPoint,this.state.toPoint))}},{key:"getActiveLayer",value:function(e){return this.objLayers[e]}},{key:"showFeatures",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"table",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"router",o=arguments.length>3?arguments[3]:void 0,s=this;if(o||this.routerFeaturesSource.clear(),!e||0===e.length)return[];var a=this.mapData,n="route"===this.state.mode?this.state.layerRoute:this.state.layerArea,i="route"===this.state.mode?this.state.layerValueRoute:this.state.layerValueArea,l=this.getActiveLayer(n).layerData,u=[],c=[],p=[],d=e.length?e.slice():e.elements.slice(),h=[];if(this.bestFeatureIds=[],a.priorityFeatures&&a.priorityLocstyle&&e.length>0){d.sort((function(e,t){return parseFloat(e[a.routerLayers[n][i].mapLabel])-parseFloat(t[a.routerLayers[n][i].mapLabel])}));for(var m=parseInt(a.priorityFeatures,10),f=m>d.length?d.length:m,_=0;_<f;_++)h[_]=d[_],this.bestFeatureIds.push(d[_].id)}if("petrols"===t&&"area"!==r&&(e=e.elements),"overpass"!==t){for(var P=0;e&&P<e.length;P++)if(e[P].id){var C="",S=e[P],b=void 0,A=void 0;b=(0,R.transform)([parseFloat(S.geox),parseFloat(S.geoy)],"EPSG:4326","EPSG:3857");var E=new g.Point(b);(A=new y.Feature(E)).setId(S.id),A.set("loc_linkurl",l.loc_linkurl),A.set("locstyle",l.locstyle),A.set("hover_location",l.hover_location),A.set("hover_style",l.hover_style),A.set("zoom_onclick",l.zoom_onclick),A.set("tid",S.id),a.routerLayers[n]&&a.routerLayers[n][i]&&a.routerLayers[n][i].mapLabel&&S[a.routerLayers[n][i].mapLabel]?C=S[a.routerLayers[n][i].mapLabel]:a.routerLayers[n]&&a.routerLayers[n][i]&&a.routerLayers[n][i].mapLabel&&S.tags&&S.tags[a.routerLayers[n][i].mapLabel]&&(C=S.tags[a.routerLayers[n][i].mapLabel]);var j=S.locstyle||l.locstyle;for(var O in a.priorityFeatures&&a.priorityLocstyle&&h.includes(S)&&(j=a.priorityLocstyle),A.set("locationStyle",j),A.set("zIndex",P),A.set("label",C),j&&s.props.mapController.proxy.locationStyleController.arrLocStyles[j]&&s.props.mapController.proxy.locationStyleController.arrLocStyles[j].style?(A.setStyle(s.props.mapController.proxy.locationStyleController.arrLocStyles[j].style),s.props.mapController.data.hideFeaturesWithoutLabel?C&&""!==C&&c.push(A):c.push(A)):(A.set("styleId",j),s.props.mapController.data.hideFeaturesWithoutLabel?C&&""!==C&&(u.push(A),p[j]=j):(u.push(A),p[j]=j)),S.tags)S.tags.hasOwnProperty(O)&&A.set(O,S.tags[O])}}else{var w;e.elements?(w=F(e),this.geoJsonFeatures=w):w=this.geoJsonFeatures;var k=s.props.mapController.map.getView().getProjection();c=(new v.GeoJSON).readFeatures(w,{dataProjection:"EPSG:4326",featureProjection:k});var T=a.routerLayers[n][i].mapLabel;for(var I in c)c.hasOwnProperty(I)&&(c[I].set("loc_linkurl",l.loc_linkurl),c[I].set("locstyle",l.locstyle),c[I].set("hover_location",l.hover_location),c[I].set("hover_style",l.hover_style),c[I].set("zoom_onclick",l.zoom_onclick),c[I].set("tid",parseInt(c[I].get("id").split("/")[1])),c[I].set("label",c[I].get(T)),s.props.mapController.proxy.locationStyleController.arrLocStyles[l.locstyle]&&c[I].setStyle(s.props.mapController.proxy.locationStyleController.arrLocStyles[l.locstyle].style))}return p&&p.length>0&&s.props.mapController.proxy.locationStyleController.loadLocationStyles(p,{done:function(){for(var e=0;e<u.length;e++){var t=u[e].get("styleId");u[e].setStyle(s.props.mapController.proxy.locationStyleController.arrLocStyles[t].style),s.routerFeaturesSource.addFeature(u[e])}p=void 0}}),c&&c.length>0&&this.routerFeaturesSource.addFeatures(c),d}},{key:"showRoute",value:function(e){this.showRouteLayer(e,0),this.showRouteInstructions(e,0)}},{key:"showAltRoute",value:function(e,t){this.showRouteLayer(e,t),this.showRouteInstructions(e,t)}},{key:"showRouteLayer",value:function(e,t){var r,o,s,a;if(t=t||0,e&&(this.routerWaySource.clear(),this.routingAltWaySource.clear(),r=this.props.mapController.map.getView(),"1"==this.props.mapController.data.router_api_selection||"2"==this.props.mapController.data.router_api_selection||"1"==e.routeType||"2"==e.routeType?(o=new v.Polyline,e.routes&&(e.routes[1]&&(1===t?(a=o.readFeatures(e.routes[0].geometry,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(0):(a=o.readFeatures(e.routes[1].geometry,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(1)),(s=o.readFeatures(e.routes[t].geometry,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(t))):"0"==this.props.mapController.data.router_api_selection||"0"==e.routeType?s=(o=new v.Polyline({factor:this.props.mapController.data.router_viaroute_precision||1e6})).readFeatures(e.route_geometry,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}):"3"==this.props.mapController.data.router_api_selection?(o=new v.Polyline,e.paths&&e.paths[1]&&(1==t?(a=o.readFeatures(e.paths[0].points,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(0):(a=o.readFeatures(e.paths[1].points,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(1)),(s=o.readFeatures(e.paths[t].points,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(t)):"4"!=this.props.mapController.data.router_api_selection&&"4"!=e.routeType||(o=new v.Polyline({factor:1e6}),e.trip&&e.trip.legs&&e.trip.legs[1]&&(1==t?(a=o.readFeatures(e.trip.legs[1].shape,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(0):(a=o.readFeatures(e.trip.legs[1].shape,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(1)),(s=o.readFeatures(e.trip.legs[t].shape,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()}))[0].setId(t)),"1"==this.props.mapController.data.router_alternative&&(e.routes&&e.routes.length>1&&e.routes[1]||e.paths&&e.paths.length>1&&e.paths[1])&&this.routingAltWaySource.addFeatures(a),s)){this.routerWaySource.addFeatures(s),this.props.mapController.map.renderSync(),r.animate({start:+new Date,duration:2e3,resolution:r.getResolution(),center:[0,0]});var n=jQuery(".c4g-starboard-container").css("width");n?(n=n.split("."),n=Array.isArray(n)?n[0]:n,n=parseInt(n)+50):n=50,r.fit(s[0].getGeometry(),{size:this.props.mapController.map.getSize(),padding:[50,n,50,50]})}}},{key:"adjustInstructionMapInteraction",value:function(e){var t,r,o,s=this;t=function(e){s.routerHintSource.clear();var t=s.routerWaySource.getFeatures()[0].getGeometry().getCoordinates(),r=e.data("pos");if(r){var o=r.split(",");o[0]=parseFloat(o[0]),o[1]=parseFloat(o[1]);var a=(0,R.fromLonLat)(o),n=new y.Feature({geometry:new g.Point(a)});s.routerHintSource.addFeature(n),s.options.mapController.map.getView().setCenter(a)}if(t){var i=e.data("start"),l=e.data("end");if(l){var u=new g.LineString(t.slice(i,l));(n=new y.Feature({geometry:u})).setStyle(new _.Style({stroke:new _.Stroke({color:"rgba(255, 0, 0, 1)",width:20})}));var c=s.options.mapController.map.getView().getZoom();s.routerHintSource.addFeature(n),s.options.mapController.map.getView().fit(u);var p=s.options.mapController.map.getView().getZoom(),d=Math.round((c+p)/2);d=d>p?p:d,s.options.mapController.map.getView().setZoom(d)}}},r=function(e){var t;if(s.routerWaySource&&s.routerWaySource.getFeatures()&&"0"==s.options.mapController.data.router_api_selection&&(t=s.routerWaySource.getFeatures()[0])){s.routerHintSource.clear();var r=new y.Feature({geometry:new g.Point(t.getGeometry().getCoordinates()[e.data("pos")])});s.routerHintSource.addFeature(r)}if(s.routerWaySource&&s.routerWaySource.getFeatures()&&s.options.mapController.data.router_api_selection>="1"&&(t=s.routerWaySource.getFeatures()[0])){s.routerHintSource.clear();var o=e.data("pos");if(o){var a=o.split(",");a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]);var n=(0,R.fromLonLat)(a);r=new y.Feature({geometry:new g.Point(n)}),s.routerHintSource.addFeature(r)}var i=(t=s.routerWaySource.getFeatures()[0]).getGeometry().getCoordinates();if(i){var l=e.data("start"),u=e.data("end");u&&((r=new y.Feature({geometry:new g.LineString(i.slice(l,u))})).setStyle(new _.Style({stroke:new _.Stroke({color:"rgba(255, 0, 0, 1)",width:15})})),s.routerHintSource.addFeature(r))}}},o=function(){s.routerHintSource.clear()},jQuery("[data-start]",e).each((function(e,s){var a=jQuery(s);a.click((function(){t(a)})),a.on("mouseenter",(function(){r(a)})),a.on("mouseleave",(function(){o()}))})),jQuery("[data-pos]",e).each((function(e,s){var a=jQuery(s);a.click((function(){t(a)})),a.on("mouseenter",(function(){r(a)})),a.on("mouseleave",(function(){o()}))}))}},{key:"addMapInputInteraction",value:function(){var e,t=this;t.fnMapRouterInteraction=function(r){if(!0===t.state.open){var o=t.props.mapController.map.forEachFeatureAtPixel(r.pixel,(function(e,t){return e}));if(o&&o.getId()){var s=o.getId().search&&o.getId().search("/")?parseFloat(o.getId().substring(o.getId().search("/")+1)):o.getId();t.setState({activeId:s,openResults:!0},(function(){if(document.querySelector(".c4g-route-feature-wrapper")){var e=document.querySelector(".c4g-route-feature-wrapper"),t=document.querySelector("li.route-features-list-element.c4g-active");e&&t&&e.scrollTo(0,t.offsetTop)}}))}else if(e=(0,R.toLonLat)(r.coordinate),t.areaSource.clear(),"route"===t.state.mode){if(""===t.state.fromAddress)t.setRouteFrom(e[0],e[1]),t.recalculateRoute();else if(""===t.state.toAddress)t.setRouteTo(e[0],e[1]),t.recalculateRoute();else if(t.state.overPtCtr>0)for(var a=0;a<t.state.overPtCtr;a++)if(!t.state.overPoints[a]){t.addOverPoint(e[0],e[1],a);break}}else"area"===t.state.mode&&""===t.state.areaAddress&&t.setAreaPoint(e[0],e[1])}},this.props.mapController.map.on("click",t.fnMapRouterInteraction)}}]),T}(h.Component);t.RouterView=x},"./Resources/public/js/routing-constant-i18n.js":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLanguage=function(e){if(void 0!==e)switch(e.lang){case"de":return o.routingConstantsGerman;case"en":default:return s.routingConstantsEnglish}};var o=r("./Resources/public/js/routing-constant-i18n-de.js"),s=r("./Resources/public/js/routing-constant-i18n-en.js")},"./Resources/public/js/routing-constants.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.routingConstants=void 0,t.routingConstants={ROUTER_INPUT_WRAPPER:"c4g-router-input-wrapper",ROUTER_PROFILE_WRAPPER:"c4g-router-profile-wrapper",ROUTER_INPUT_FROM:"c4g-router-input-from",ROUTER_INPUT_TO:"c4g-router-input-to",ROUTER_INPUT_OVER:"c4g-router-input-over",ROUTER_INPUT_CLEAR:"c4g-router-input-clear",ROUTER_BUTTONBAR:"c4g-router-buttonbar",ROUTER_ATTRIBUTION_WRAPPER:"c4g-router-attribution-wrapper",ROUTER_INSTRUCTIONS_WRAPPER:"c4g-router-instructions-wrapper",ROUTER_INSTRUCTIONS_HEADER:"c4g-router-instructions-header",ROUTER_SWITCH:"c4g-router-switch",ROUTER_OVER:"c4g-router-over",ROUTER_PRINT:"c4g-router-print",ROUTER_PROFILE_CAR:"c4g-router-profile-car",ROUTER_PROFILE_TRUCK:"c4g-router-profile-hgv",ROUTER_PROFILE_BIKE:"c4g-router-profile-bike",ROUTER_PROFILE_FOOT:"c4g-router-profile-foot",ROUTER_PROFILE_WHEELCHAIR:"c4g-router-profile-wheelchair",ROUTER_PROFILE_SCOOTER:"c4g-router-profile-scooter",ROUTER_INSTRUCTIONS_TABLE:"c4g-router-instruction-table",ROUTER_INSTRUCTIONS_ITEM:"c4g-router-instruction-item",ROUTER_INSTRUCTIONS_ITEM_ODD:"c4g-router-instruction-item--odd",ROUTER_INSTRUCTIONS_ITEM_EVEN:"c4g-router-instruction-item--even",ROUTER_INSTRUCTIONS_ITEM_DIRECTION:"c4g-router-instruction-item_direction",ROUTER_INSTRUCTIONS_ITEM_DIRECTION_ICON:"c4g-router-instruction-item_direction-icon",ROUTER_INSTRUCTIONS_ITEM_DIRECTION_TEXT:"c4g-router-instruction-item_text",ROUTER_INSTRUCTIONS_ITEM_DIRECTION_DISTANCE:"c4g-router-instruction-item_distance",ROUTE_LAYER_VALUES:"c4g-routing-layer-values",ROUTE_LAYERS_SELECT:"c4g-routing-layers-select",ROUTE_TOGGLE:"c4g-routing-toggle",OUTPUT_DETOUR:"c4g-routing-output",ROUTE_START_BUTTON:"c4g-route-search-start",ROUTER_SEARCH:"c4g-router-search",ROUTE_POSITION:"c4g-router-position",ROUTE_ERROR:"c4g-routing-error",NONE:""}}}]);