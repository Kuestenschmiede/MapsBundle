(self.webpackChunkmapsbundle=self.webpackChunkmapsbundle||[]).push([["Resources_public_js_components_c4g-geosearch_jsx"],{"./Resources/public/js/components/c4g-geosearch-results.jsx":(e,t,o)=>{"use strict";var n=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=o("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.GeoSearchResults=void 0;var a=n(o("./node_modules/@babel/runtime/helpers/classCallCheck.js")),r=n(o("./node_modules/@babel/runtime/helpers/createClass.js")),l=n(o("./node_modules/@babel/runtime/helpers/inherits.js")),i=n(o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),c=n(o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var o=f(t);if(o&&o.has(e))return o.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}return n.default=e,o&&o.set(e,n),n}(o("./node_modules/react/index.js")),p=n(o("./node_modules/react-dom/index.js"));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(f=function(e){return e?o:t})(e)}var d=function(e){(0,l.default)(s,e);var t,o,n=(t=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,c.default)(t);if(o){var s=(0,c.default)(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return(0,i.default)(this,e)});function s(e){return(0,a.default)(this,s),n.call(this,e)}return(0,r.default)(s,[{key:"render",value:function(){var e,t=this;return this.props.closeCb,e=u.default.createElement("ul",{id:"resultcontainer"},this.props.results.map((function(e,o){var n="searchResultButton";return e===t.props.currentResult&&(n+=" c4g-active"),u.default.createElement("li",{key:o},u.default.createElement("button",{key:o,id:o,className:n,name:e,onMouseUp:function(){return t.props.zoomFunc(o)}},e))}))),this.props.resultsDiv?p.default.createPortal(u.default.createElement("div",{className:"c4g-geosearch-results-content c4g-external "+this.props.className+" c4g-beach"},u.default.createElement("div",{className:"c4g-beach-content"},e)),this.props.resultsDiv):u.default.createElement("div",{className:"c4g-geosearch-results-content "+this.props.className+" c4g-beach"},u.default.createElement("div",{className:"c4g-beach-content"},e))}}]),s}(u.Component);t.GeoSearchResults=d},"./Resources/public/js/components/c4g-geosearch.jsx":(e,t,o)=>{"use strict";var n=o("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),s=o("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(o("./node_modules/@babel/runtime/helpers/typeof.js")),r=n(o("./node_modules/@babel/runtime/helpers/classCallCheck.js")),l=n(o("./node_modules/@babel/runtime/helpers/createClass.js")),i=n(o("./node_modules/@babel/runtime/helpers/assertThisInitialized.js")),c=n(o("./node_modules/@babel/runtime/helpers/inherits.js")),u=n(o("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js")),p=n(o("./node_modules/@babel/runtime/helpers/getPrototypeOf.js")),f=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var o=x(t);if(o&&o.has(e))return o.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}return n.default=e,o&&o.set(e,n),n}(o("./node_modules/react/index.js")),d=o("./node_modules/ol/control.js"),h=o("./Resources/public/js/c4g-maps-i18n.js"),m=o("./Resources/public/js/c4g-maps-constant.js"),g=o("./Resources/public/js/components/c4g-geosearch-results.jsx"),y=o("./node_modules/ol/proj.js"),C=o("./node_modules/ol/easing.js"),v=o("./node_modules/ol/source.js"),b=o("./node_modules/ol/layer.js"),w=o("./node_modules/ol/style.js"),k=o("./node_modules/ol/index.js"),j=o("./node_modules/ol/geom.js"),R=o("./node_modules/ol/render.js"),S=o("./node_modules/ol/Observable.js"),_=o("./Resources/public/js/c4g-maps-utils.js"),P=o("./node_modules/ol/extent.js"),E=o("./Resources/public/js/components/c4g-titlebar.jsx");function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(x=function(e){return e?o:t})(e)}var O=function(e){(0,c.default)(s,e);var t,o,n=(t=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,p.default)(t);if(o){var s=(0,p.default)(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return(0,u.default)(this,e)});function s(e){var t;(0,r.default)(this,s),(t=n.call(this,e)).langConstants=(0,h.getLanguage)(e.mapController.data),t.clickControl=t.clickControl.bind((0,i.default)(t)),t.doneFunction=t.doneFunction.bind((0,i.default)(t));var o=document.createElement("div"),a=document.createElement("button");a.setAttribute("aria-label",t.langConstants.CTRL_GEOSEARCH),a.setAttribute("title",t.langConstants.CTRL_GEOSEARCH),o.className="c4g-geosearch ol-control ol-unselectable",e.external&&(o.className+=" c4g-external"),o.appendChild(a),jQuery(a).on("click",t.clickControl);var l=new d.Control({element:o,target:e.target});if(e.mapController.map.addControl(l),t.config={},e.mapController.data.geosearch.searchKey&&e.mapController.data.geosearch.url?(t.config.url=e.mapController.data.geosearch.url+"search.php",t.config.key=e.mapController.data.geosearch.searchKey,t.config.params=e.mapController.data.geosearch.params):t.config.url=e.mapController.data.api.geosearch+"/"+e.mapController.data.profile,t.config.zoomlevel=e.searchZoom,t.config.zoombounds=e.zoomBounds,t.config.quicksearch=e.quicksearch||!0,t.config.animate=e.animate,t.config.markResult=e.markResult,t.config.animateDuration=e.animateDuration,t.config.resultDuration=e.resultDuration,t.config.popup=e.popup,t.config.autopick=e.autopick,t.config.mapController=e.mapController,t.config.results=e.results,t.config.resultStyle=e.resultStyle,t.config.resultStyle&&parseInt(t.config.resultStyle,10)>0){var c=(0,i.default)(t);e.mapController.proxy.locationStyleController.arrLocStyles[t.config.resultStyle]?t.config.resultStyle=e.mapController.proxy.locationStyleController.arrLocStyles[t.config.resultStyle].style:e.mapController.proxy.locationStyleController.loadLocationStyles([t.config.resultStyle],{done:function(){c.config.resultStyle=e.mapController.proxy.locationStyleController.arrLocStyles[c.config.resultStyle].style}})}return t.config.collapsed=e.collapsed,t.config.resultCount=e.resultCount,t.config.caching=e.caching,t.config.placeholder=e.placeholder,t.state={open:!e.collapsed,query:"",results:[],currentCoordinate:[],openResults:!1,currentResult:null},t.inputCallback=t.inputCallback.bind((0,i.default)(t)),t.startSearch=t.startSearch.bind((0,i.default)(t)),t.zoomTo=t.zoomTo.bind((0,i.default)(t)),t.closeResults=t.closeResults.bind((0,i.default)(t)),t.openResults=t.openResults.bind((0,i.default)(t)),t.close=t.close.bind((0,i.default)(t)),t.closeResultsCompletely=t.closeResultsCompletely.bind((0,i.default)(t)),t}return(0,l.default)(s,[{key:"render",value:function(){var e=this,t=this.state.open?"c4g-open":"c4g-close";this.props.extDiv&&(t+=" external ");var o="";this.state.openResults&&this.config.results&&(o=f.default.createElement(g.GeoSearchResults,{className:t,results:this.state.results,zoomFunc:function(t){e.setState({currentResult:e.state.results[t]}),e.zoomTo(t)},closeResults:this.closeResults,headline:this.props.resultsHeadline,currentResult:this.state.currentResult,resultsDiv:this.props.resultsDiv,open:this.state.results.length>0,openResults:this.openResults,closeCb:this.closeResultsCompletely}));var n="",s="";this.config.collapsed&&(n="c4g-titlebar-close",s=this.close);var a=this.props.headline;return a||(a=this.langConstants.GEOSEARCH),f.default.createElement(f.default.Fragment,null,f.default.createElement("div",{className:m.cssConstants.GEOSEARCH_WRAPPER+" "+t+" c4g-horizon"},f.default.createElement(E.Titlebar,{wrapperClass:"c4g-geosearch-header",header:a,headerClass:"c4g-geosearch-headline",detailBtnClass:"",detailBtnCb:"",closeBtnClass:n,closeBtnCb:s,closeBtnTitle:this.langConstants.CLOSE}),f.default.createElement("div",{className:"c4g-geosearch-filter"},f.default.createElement("input",{type:"text",onKeyDown:this.inputCallback,id:"c4g-geosearch-input",placeholder:this.config.placeholder,"aria-label":this.config.placeholder}),f.default.createElement("button",{className:m.cssConstants.GEOSEARCH_START,type:"button",title:this.langConstants.CTRL_START_SEARCH,onMouseUp:this.startSearch})),o))}},{key:"closeResultsCompletely",value:function(){this.setState({openResults:!1})}},{key:"componentDidUpdate",value:function(e,t,o){this.state.open?(t.open!==this.state.open&&this.props.mapController.setOpenComponent(this),jQuery(".c4g-geosearch-container-right").addClass("c4g-open").removeClass("c4g-close")):jQuery(".c4g-geosearch-container-right").addClass("c4g-close").removeClass("c4g-open"),this.props.mapController.data.caching&&!this.state.open&&_.utils.getValue("panel")===this.constructor.name&&_.utils.storeValue("panel","")}},{key:"close",value:function(){this.setState({open:!1})}},{key:"startSearch",value:function(e){e.stopPropagation();var t=document.querySelector(m.cssConstants.GEOSEARCH_START);try{t.blur()}catch(e){}var o=jQuery("#c4g-geosearch-input");o.val()&&this.findLocation(o.val())}},{key:"inputCallback",value:function(e){if(e.stopPropagation(),13===e.which){var t=jQuery("#c4g-geosearch-input");return t.val()&&this.findLocation(t.val()),!1}}},{key:"clickControl",value:function(){this.state.open?(this.setState({open:!1}),jQuery(this.props.mapController.searchContainer).removeClass("c4g-open").addClass("c4g-close")):(this.setState({open:!0}),jQuery(this.props.mapController.searchContainer).removeClass("c4g-close").addClass("c4g-open"),this.props.mapController.setOpenComponent(this))}},{key:"closeResults",value:function(){this.setState({detailOpenResults:!1})}},{key:"openResults",value:function(){this.setState({detailOpenResults:!0})}},{key:"findLocation",value:function(e,t){var o,n=this;if((o=this.props.mapController).map,o.spinner.show(),this.config.animate,this.config.animateDuration,this.config.markResult,"object"===(0,a.default)(t)&&(void 0!==t.animate&&t.animate,void 0!==t.markResult&&t.markResult),this.config.quicksearch){var s={format:"json",q:e};if(this.config.resultCount&&(s.limit=this.config.resultCount),this.config.key&&(s.key=this.config.key),this.config.params)for(var r in this.config.params)this.config.params.hasOwnProperty(r)&&(s[r]=this.config.params[r]);var l=_.utils.callHookFunctions(window.c4gMapsHooks.hook_search,[s,this]);if(l&&l.length>0)for(var i in this.config.mapController.spinner.hide(),l)l.hasOwnProperty(i)&&this.doneFunction(l[i]);else jQuery.ajax({dataType:"json",url:this.config.url,data:s}).done(this.doneFunction).fail((function(){})).always((function(){n.config.mapController.spinner.hide()}))}}},{key:"doneFunction",value:function(e){var t,o,n,s,r=this.props.mapController.map,l=this.config.animate,i=(this.config.animateDuration,this.config.markResult);if(e&&e.length&&e.length>0){if(t=r.getView(),e[0]){s=e[0],this.results=e,o=t.getCenter(),n=(0,y.transform)([parseFloat(s.lon),parseFloat(s.lat)],"EPSG:4326","EPSG:3857"),l?this.flyTo(r,n,this.config.zoomlevel,this.config.zoombounds,s.bounding_box,i,this.config.resultDuration,l,this.config.animateDuration,r.getView()):(this.completeSearch(this.config.markResult,this.config.animate,void 0,this.config.animateDuration,n,this.config.resultDuration),t.setCenter(n),this.config.zoomlevel>=0&&r.getView().setZoom(this.config.zoomlevel));var c=r.getPixelFromCoordinate(n),u=r.forEachFeatureAtPixel(c,(function(e,t){return e})),p=r.forEachFeatureAtPixel(c,(function(e,t){return t}));if(this.config.popup){var f={};if(u&&u.get("popup")?f=u.get("popup"):p&&p.popup?f=p.popup:u=!1,u){var d=u.getGeometry();if(d instanceof j.Point)var g=d.getCoordinates();else g=n;if(window.c4gMapsPopup.popup.setPosition(g),f.content)if(window.c4gMapsPopup.$content.html(""),window.c4gMapsPopup.popup.addClass(m.cssConstants.ACTIVE).addClass(m.cssConstants.LOADING),window.c4gMapsPopup.spinner.show(),!1===f.async||"0"==f.async){var C={};C.popup=f,C.feature=u,C.layer=p,void 0!==window.c4gMapsHooks&&"object"===(0,a.default)(window.c4gMapsHooks.proxy_fillPopup)&&_.utils.callHookFunctions(window.c4gMapsHooks.proxy_fillPopup,C),this.config.mapController.proxy.setPopup(C)}else jQuery.ajax({dataType:"json",url:this.api_infowindow_url+"/"+f.content,done:function(e){var t={async:f.async,content:e.content,popup:f.popup,routing_link:f.routing_link};(C={}).popup=t,C.feature=u,C.layer=p,void 0!==window.c4gMapsHooks&&"object"===(0,a.default)(window.c4gMapsHooks.proxy_fillPopup)&&_.utils.callHookFunctions(window.c4gMapsHooks.proxy_fillPopup,C),this.setPopup(C)}});else window.c4gMapsPopup.popup.removeClass(m.cssConstants.ACTIVE)}else window&&window.c4gMapsPopup&&window.c4gMapsPopup.popup&&jQuery(window.c4gMapsPopup.popup).removeClass(m.cssConstants.ACTIVE)}this.config.autopick&&this.config.mapController.geopicker&&"function"==typeof this.config.mapController.geopicker.pick&&this.config.mapController.geopicker.pick(n)}else{var v=(0,h.getLanguage)(this.options.mapController.data);alert(v.SEARCH_NOT_FOUND)}if(this.results){for(var b=[],w=0;w<this.results.length;w++)b.push(this.results[w].display_name);this.setState({results:b,currentCoordinate:o,openResults:!0,currentResult:b[0]})}}}},{key:"flyTo",value:function(e,t,o,n,s,a,r,l,i,c){var u,p=i,f=o,d=2,h=!1,m=this;function g(o){if(--d,!(h||0!==d&&o)){if(h=!0,n&&s&&null!==s[0]&&null!==s[1]&&null!==s[2]&&null!==s[3]){var g=[];g.push(parseFloat(s[2])),g.push(parseFloat(s[0])),g.push(parseFloat(s[3])),g.push(parseFloat(s[1])),u=(0,y.transformExtent)(g,"EPSG:4326","EPSG:3857"),window.setTimeout((function(){c.fit(u,e.getSize(),{minZoom:c.get("minZoom")||2,maxZoom:f||c.get("maxZoom")||18,duration:p/2,easing:C.easeOut})}),p)}m.completeSearch(a,l,"bounce",i,t,r)}}e.getView().animate({center:t,duration:p},g),e.getView().animate({zoom:f-1,duration:p/2},{zoom:f,duration:p/2},g)}},{key:"completeSearch",value:function(e,t,o,n,s,a){if(e){var r,l,i,c;l=new v.Vector;var u=this.config.resultStyle;u&&"0"!==u||(u=[new w.Style({image:new w.Circle({radius:7,snapToPixel:!1,stroke:new w.Stroke({color:"rgba(200, 0, 0, 0.9)",width:2,opacity:.9})})}),new w.Style({image:new w.Circle({radius:20,snapToPixel:!1,stroke:new w.Stroke({color:"rgba(200, 0, 0, 0.9)",width:2,opacity:.9})})}),new w.Style({image:new w.Circle({radius:33,snapToPixel:!1,stroke:new w.Stroke({color:"rgba(200, 0, 0, 0.9)",width:2,opacity:.9})})})]),i=new b.Vector({style:u,source:l,zIndex:99999}),this.props.mapController.map.addLayer(i),r=function(){l.addFeature(new k.Feature(new j.Point(s)))},c=function(e){var t,o,n,s;o=(new Date).getTime(),n=a,t=function(t){var a,r,i,c,u;a=(0,R.getVectorContext)(t),r=t.frameState,u=e.getGeometry().clone(),c=(i=r.time-o)/n,(0,C.linear)(1-c),(0,C.linear)(c);var p=new w.Style;if(a.setStyle(p),a.drawGeometry(u,null),i>n)return l.clear(),void(0,S.unByKey)(s);r.animate=!0},s=i.on("postrender",t)},l.on("addfeature",(function(e){c(e.feature)})),t?window.setTimeout(r,n/2):r()}}},{key:"zoomTo",value:function(e){var t,o,n,s,a=(t=this.props.mapController.map).getView(),r=this.state.currentCoordinate;if(o=this.results[e],n=(0,y.transform)([parseFloat(o.lon),parseFloat(o.lat)],"EPSG:4326","EPSG:3857"),this.config.animate){a.getResolution();var l=a.calculateExtent(t.getSize());if((0,P.containsCoordinate)(l,n))s="zoom";else{if(Math.abs(r[0]-n[0])>Math.abs(r[1]-n[1]))Math.abs(r[0]-n[0]),(0,P.getWidth)(l);else Math.abs(r[1]-n[1]),(0,P.getHeight)(l);s="bounce"}this.flyTo(t,n,this.config.zoomlevel,this.config.zoombounds,o.bounding_box,this.config.markResult,this.config.resultDuration,this.config.animate,this.config.animateDuration,a)}else this.completeSearch(this.config.markResult,this.config.animate,s,this.config.animateDuration,n,this.config.resultDuration),t.getView().setCenter(n),this.config.zoomlevel>=0&&t.getView().setZoom(this.config.zoomlevel)}}]),s}(f.Component);t.default=O}}]);