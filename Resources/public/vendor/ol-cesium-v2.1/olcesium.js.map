{"version":3,"sources":["webpack://olcs/webpack/universalModuleDefinition","webpack://olcs/webpack/bootstrap","webpack://olcs/./src/goog/asserts.js","webpack://olcs/./src/index.library.js","webpack://olcs/./src/olcs/AbstractSynchronizer.js","webpack://olcs/./src/olcs/AutoRenderLoop.js","webpack://olcs/./src/olcs/Camera.js","webpack://olcs/./src/olcs/FeatureConverter.js","webpack://olcs/./src/olcs/OLCesium.js","webpack://olcs/./src/olcs/OverlaySynchronizer.js","webpack://olcs/./src/olcs/RasterSynchronizer.js","webpack://olcs/./src/olcs/SynchronizedOverlay.js","webpack://olcs/./src/olcs/VectorSynchronizer.js","webpack://olcs/./src/olcs/core.js","webpack://olcs/./src/olcs/core/OLImageryProvider.js","webpack://olcs/./src/olcs/core/VectorLayerCounterpart.js","webpack://olcs/./src/olcs/util.js","webpack://olcs/external \"ol/Observable.js\"","webpack://olcs/external \"ol/Overlay.js\"","webpack://olcs/external \"ol/array.js\"","webpack://olcs/external \"ol/dom.js\"","webpack://olcs/external \"ol/easing.js\"","webpack://olcs/external \"ol/events.js\"","webpack://olcs/external \"ol/extent.js\"","webpack://olcs/external \"ol/geom/Geometry.js\"","webpack://olcs/external \"ol/geom/Point.js\"","webpack://olcs/external \"ol/geom/Polygon.js\"","webpack://olcs/external \"ol/geom/SimpleGeometry.js\"","webpack://olcs/external \"ol/layer/Group.js\"","webpack://olcs/external \"ol/layer/Image.js\"","webpack://olcs/external \"ol/layer/Layer.js\"","webpack://olcs/external \"ol/layer/Tile.js\"","webpack://olcs/external \"ol/layer/Vector.js\"","webpack://olcs/external \"ol/math.js\"","webpack://olcs/external \"ol/proj.js\"","webpack://olcs/external \"ol/source/Cluster.js\"","webpack://olcs/external \"ol/source/Image.js\"","webpack://olcs/external \"ol/source/ImageWMS.js\"","webpack://olcs/external \"ol/source/TileImage.js\"","webpack://olcs/external \"ol/source/TileWMS.js\"","webpack://olcs/external \"ol/source/Vector.js\"","webpack://olcs/external \"ol/style/Icon.js\"","webpack://olcs/external \"ol/util.js\""],"names":["AbstractSynchronizer","map","scene","view","getView","olLayers","getLayerGroup","getLayers","mapLayerGroup","layerMap","olLayerListenKeys","olGroupListenKeys_","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","layer","parents","olLayerWithParents","splice","olLayer","olLayerId","olGetUid","toString","googAsserts","assert","cesiumObjects","listenForGroupChanges_","createSingleLayerCounterparts","forEach","l","newOlLayerWithParents","concat","push","layerId","layerWithParents","onLayerChange","e","cesiumObjs","un","addCesiumObjects_","length","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","keys","key","olObservableUnByKey","removeLayer_","done","uuid","undefined","listenKeyArray","contentKeys","listenAddRemove","collection","on","event","element","bind","el","i","indexOf","removeAllCesiumObjects","objKey","object","destroy","AutoRenderLoop","ol3d","scene_","getCesiumScene","canvas_","canvas","_boundNotifyRepaintRequired","notifyRepaintRequired","repaintEventNames_","enable","requestRenderMode","repaintKey","addEventListener","window","getOlMap","disable","removeEventListener","restartRenderLoop","requestRender","Camera","cam_","camera","map_","view_","viewListenKey_","toLonLat_","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","input","opt_output","opt_dimension","dim","toLonLat","getProjection","fromLonLat","handleViewEvent_","readFromView","setHeading","heading","setRotation","getHeading","rotation","getRotation","setTilt","tilt","updateCamera_","getTilt","setDistance","distance","updateView","getDistance","setCenter","center","getCenter","setPosition","position","ll","carto","Cesium","Cartographic","getAltitude","setView","destination","Ellipsoid","WGS84","cartographicToCartesian","getPosition","cartesianToCartographic","pos","longitude","latitude","setAltitude","altitude","height","globe","getHeight","orientation","pitch","Math","PI_OVER_TWO","roll","moveBackward","checkCameraChange","resolution","getResolution","calcDistanceForResolution","ellipsoid","target","olcsCore","pickCenterPoint","bestTarget","positionCartographic","clone","Cartesian3","bestTargetCartographic","setResolution","calcResolutionForDistance","targetNormal","geocentricSurfaceNormal","targetToCamera","subtract","normalize","up","right","normal","y","x","angleBetween","cross","z","tiltAngle","acos","dot","isNaN","PI","opt_dontSync","old","current","viewMatrix","Matrix4","equalsEpsilon","fovy","frustum","metersPerUnit","getMetersPerUnit","visibleMapUnits","clientHeight","relativeCircumference","cos","abs","visibleMeters","requiredDistance","tan","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","evt","source","assertInstanceof","cancellers","olcsUtil","obj","feature","id","canceller","hasOwnProperty","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","geometry","color","opt_lineWidth","createInstance","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","options","flat","renderState","depthTest","enabled","lineWidth","instances","heightReference","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","constructor","GroundPrimitive","geometryInstances","appearance","PerInstanceColorAppearance","Primitive","extractColorFromOlStyle","style","outline","fillColor","getFill","getColor","strokeColor","getStroke","olColor","convertColorToCesium","extractLineWidthFromOlStyle","width","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","primitives","PrimitiveCollection","p1","add","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","billboards","bbOptions","bb","olCircleGeometryToCesium","projection","olGeometryCloneTo4326","getType","point","slice","getRadius","ol4326CoordinateToCesiumCartesian","radius","CircleGeometry","outlinePrimitive","circlePolygon","olCreateCircularPolygon","positions","ol4326CoordinateArrayToCsCartesians","getLinearRing","getCoordinates","GroundPolylinePrimitive","isSupported","createStackedGroundCorridors","GroundPolylineGeometry","PolylineMaterialAppearance","material","olStyleToCesium","classificationType","ClassificationType","TERRAIN","readyPromise","then","_primitive","CircleOutlineGeometry","extrudedHeight","Array","isArray","max","previousDistance","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","linePositions","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","primitiveOptions","PolylineGeometry","olPolygonGeometryToCesium","getGeometry","get","coordinates","extent","rectangle","Rectangle","fromDegrees","maxHeight","c","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","olPos","holes","PolygonGeometry","perPositionHeight","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","load","image","getImage","isImageLoaded","src","naturalHeight","naturalWidth","complete","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","opacity","getOpacity","Color","scale","getScale","verticalOrigin","VerticalOrigin","BOTTOM","cancelled","getSource","fuid","listener","isDestroyed","olEvents","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","Object","assign","cesiumOptions","model","Model","fromGltf","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","accumulate","geometries","functor","subgeos","getPoints","result","getLineStrings","getPolygons","fail","labels","LabelCollection","extentCenter","getExtent","first","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","Cartesian2","pixelOffset","font","getFont","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","horizontalOrigin","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","TOP","fill","stroke","getLineDash","Material","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getStyleFunction","call","getGeometryFromFeature","opt_geom","geom3d","geomFuncRes","getGeometryFunction","olFeatureToCesium","context","geom","proj","newBillboardAddedCallback","featureBb","featureToCesiumMap","getGeometries","prims","bbs","result2","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","features","getFeatures","layerStyle","styles","prim","getRootPrimitive","convert","OLCesium","autoRenderLoop_","time_","time","JulianDate","now","to4326Transform_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","fillArea","container_","document","createElement","containerAttribute","createAttribute","value","setAttributeNode","targetElement","getElementById","appendChild","oc","getViewport","querySelector","parentNode","insertBefore","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","stopPropagation","canvasAttribute","supportsImageRenderingPixelated","imageRenderingValue","oncontextmenu","onselectstart","enabled_","pausedInteractions_","hiddenRootGroup_","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","UNIT_Z","camera_","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","SingleTileImageryProvider","url","imageryLayers","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers","createSynchronizers","handleResize_","credits","nextElementSibling","display","lastFrameTime_","renderId_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","BoundingSphere","eventHelper","EventHelper","postRender","prototype","updateTrackedEntity_","enableSuspendTerrainAdjustment","render_","cancelAnimationFrame","requestAnimationFrame","onAnimationFrame_","frameTime","interval","delta","julianDate","initializeFrame","update","trackedEntity","trackedState","getBoundingSphere","BoundingSphereState","DONE","render","state","PENDING","enableTilt","bs","FAILED","EntityView","mapProjection","clientWidth","resolutionScale","devicePixelRatio","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","visibility","interactions","throwOnUnitializedMap_","getInteractions","arr","clear","rootGroup","getVisible","setVisible","getOverlayContainer","classList","getOverlayContainerStopEvent","interaction","remove","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","defineProperties","defaultDataSource","entities","lookAtTransform","IDENTITY","to4326Transform","toCesiumPosition","coo","coo4326","CallbackProperty","TRANSPARENT","OverlaySynchronizer","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","synchronizer","parent","overlayId","removedOverlay","removeOverlay","csOverlay","RasterSynchronizer","cesiumLayers_","ourLayers_","ImageryLayerCollection","removeAll","convertLayerToCesiumImageries","viewProj","tileLayerToImageryLayer","olLayerItem","updateCesiumLayerProperties","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","olArray","layer1","layer2","raiseToTop","SynchronizedOverlay","getOptions","scenePostRenderListenerRemover_","synchronizer_","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","setProperties","getProperties","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","set","getScene","olDom","updatePixelPosition","container","stopEvent","insertFirst","handlePositionChanged","sourceProjection","getMap","cloneNode","Node","TEXT_NODE","dispatchEvent","MouseEvent","nodes","getElement","clonedNode","cartesian","fromDegreesArray","fromDegreesArrayHeights","ellipsoidBoundingSphere","occluder","Occluder","isPointVisible","cullingVolume","computeCullingVolume","direction","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","pixel","mapSize","updateRenderedPosition","removeNode","VectorSynchronizer","opt_converter","converter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","visible","layerVisible","show","csPrimitives","olListenKeys","onAddFeature","onRemoveFeature","Billboard","exports","computePixelSizeAtCoordinate","magnitude","pixelSize","getPixelDimensions","computeBoundingBoxAtTarget","amount","transform","Transforms","eastNorthUpToFixedFrame","bottomLeft","multiplyByPoint","topRight","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","applyTransform","output","stride","createMatrixAtCoordinates","translation","ZERO","rawMatrix","quaternion","Quaternion","fromAxisAngle","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","angle","axis","opt_options","clamp","defaultValue","duration","easing","callback","lastProgress","oldTransform","start","Date","step","timestamp","timeDifference","progress","stepAngle","rotate","setHeadingUsingBottomCenter","bottomCenter","angleToZenith","computeAngleToZenith","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","fromTranslation","pickOnTerrainOrEllipsoid","ray","getPickRay","pick","pickEllipsoid","pickBottomPoint","bottom","computeSignedTiltAngleOnGlobe","Ray","IntersectionTests","rayEllipsoid","getPoint","signedAngleBetween","convertLongitudeRange","bottomFovRay","fovy2","matrix","second","a","b","cosine","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","provider","getUrl","getImageLoadFunction","sourceProps","attributions","getAttributions","params","getParams","getSourceProjection","isCesiumProjection","layerOptions","forcedExtent","cesiumLayer","ImageryLayer","csLayer","layerOpacity","alpha","coordinate","toCartesian","cartesians","proj4326","properties","byteToFloat","fromCssColorString","convertUrlToCesium","subdomains","re","match","exec","replace","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","resetToNorthZenith","Promise","resolve","reject","currentHeading","normalizeView","rotateAroundBottomCenter","constrainResolution","is3857","is4326","OLImageryProvider","opt_fallbackProj","source_","projection_","fallbackProj_","ready_","credit_","tilingScheme_","rectangle_","proxy","proxy_","DefaultProxy","errorEvent_","Event","emptyCanvas_","handleSourceChanged_","getState","GeographicTilingScheme","WebMercatorTilingScheme","createCreditForSource","htmlOrAttr","html","getHTML","Credit","getTileCredits","level","requestImage","tileUrlFunction","getTileUrlFunction","z_","y_","getURL","ImageryProvider","loadImage","tg","getTileGrid","getTileSize","getMaxZoom","VectorLayerCounterpart","layerProjection","BillboardCollection","rootCollection_","param","supportsImageRenderingPixelatedResult_","imageRenderingValueResult_","setAttribute","tmp"],"mappings":"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","file":"olcesium.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"ol/Observable.js\"), require(\"ol/Overlay.js\"), require(\"ol/array.js\"), require(\"ol/dom.js\"), require(\"ol/easing.js\"), require(\"ol/events.js\"), require(\"ol/extent.js\"), require(\"ol/geom/Geometry.js\"), require(\"ol/geom/Point.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/Image.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/math.js\"), require(\"ol/proj.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/source/Image.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/Vector.js\"), require(\"ol/style/Icon.js\"), require(\"ol/util.js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"ol/Observable.js\", \"ol/Overlay.js\", \"ol/array.js\", \"ol/dom.js\", \"ol/easing.js\", \"ol/events.js\", \"ol/extent.js\", \"ol/geom/Geometry.js\", \"ol/geom/Point.js\", \"ol/geom/Polygon.js\", \"ol/geom/SimpleGeometry.js\", \"ol/layer/Group.js\", \"ol/layer/Image.js\", \"ol/layer/Layer.js\", \"ol/layer/Tile.js\", \"ol/layer/Vector.js\", \"ol/math.js\", \"ol/proj.js\", \"ol/source/Cluster.js\", \"ol/source/Image.js\", \"ol/source/ImageWMS.js\", \"ol/source/TileImage.js\", \"ol/source/TileWMS.js\", \"ol/source/Vector.js\", \"ol/style/Icon.js\", \"ol/util.js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"olcs\"] = factory(require(\"ol/Observable.js\"), require(\"ol/Overlay.js\"), require(\"ol/array.js\"), require(\"ol/dom.js\"), require(\"ol/easing.js\"), require(\"ol/events.js\"), require(\"ol/extent.js\"), require(\"ol/geom/Geometry.js\"), require(\"ol/geom/Point.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/Image.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/math.js\"), require(\"ol/proj.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/source/Image.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/Vector.js\"), require(\"ol/style/Icon.js\"), require(\"ol/util.js\"));\n\telse\n\t\troot[\"olcs\"] = factory(root[\"ol/Observable.js\"], root[\"ol/Overlay.js\"], root[\"ol/array.js\"], root[\"ol/dom.js\"], root[\"ol/easing.js\"], root[\"ol/events.js\"], root[\"ol/extent.js\"], root[\"ol/geom/Geometry.js\"], root[\"ol/geom/Point.js\"], root[\"ol/geom/Polygon.js\"], root[\"ol/geom/SimpleGeometry.js\"], root[\"ol/layer/Group.js\"], root[\"ol/layer/Image.js\"], root[\"ol/layer/Layer.js\"], root[\"ol/layer/Tile.js\"], root[\"ol/layer/Vector.js\"], root[\"ol/math.js\"], root[\"ol/proj.js\"], root[\"ol/source/Cluster.js\"], root[\"ol/source/Image.js\"], root[\"ol/source/ImageWMS.js\"], root[\"ol/source/TileImage.js\"], root[\"ol/source/TileWMS.js\"], root[\"ol/source/Vector.js\"], root[\"ol/style/Icon.js\"], root[\"ol/util.js\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE_ol_Observable_js__, __WEBPACK_EXTERNAL_MODULE_ol_Overlay_js__, __WEBPACK_EXTERNAL_MODULE_ol_array_js__, __WEBPACK_EXTERNAL_MODULE_ol_dom_js__, __WEBPACK_EXTERNAL_MODULE_ol_easing_js__, __WEBPACK_EXTERNAL_MODULE_ol_events_js__, __WEBPACK_EXTERNAL_MODULE_ol_extent_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_Geometry_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_Point_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_Polygon_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_SimpleGeometry_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Group_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Image_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Layer_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Tile_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Vector_js__, __WEBPACK_EXTERNAL_MODULE_ol_math_js__, __WEBPACK_EXTERNAL_MODULE_ol_proj_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_Cluster_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_Image_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_ImageWMS_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_TileImage_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_TileWMS_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_Vector_js__, __WEBPACK_EXTERNAL_MODULE_ol_style_Icon_js__, __WEBPACK_EXTERNAL_MODULE_ol_util_js__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.library.js\");\n","export default {\n  assert(condition) {\n    console.assert(condition);\n  },\n  assertInstanceof(object, type) {\n    console.assert(object instanceof type);\n  },\n  fail() {\n    console.fail();\n  },\n  assertNumber(number) {\n    console.assert(typeof number === 'number');\n  }\n};\n","import OLCesium from './olcs/OLCesium.js';\nexport default OLCesium;\n","/**\n * @module olcs.AbstractSynchronizer\n */\nimport googAsserts from 'goog/asserts.js';\nimport {getUid as olGetUid} from 'ol/util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport * as olEvents from 'ol/events.js';\nimport olLayerGroup from 'ol/layer/Group.js';\n\nclass AbstractSynchronizer {\n  /**\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @template T\n   * @abstract\n   * @api\n   */\n  constructor(map, scene) {\n    /**\n     * @type {!ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.View}\n     * @protected\n     */\n    this.view = map.getView();\n\n    /**\n     * @type {!Cesium.Scene}\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * @type {ol.Collection.<ol.layer.Base>}\n     * @protected\n     */\n    this.olLayers = map.getLayerGroup().getLayers();\n\n    /**\n     * @type {ol.layer.Group}\n     */\n    this.mapLayerGroup = map.getLayerGroup();\n\n    /**\n     * Map of OpenLayers layer ids (from ol.getUid) to the Cesium ImageryLayers.\n     * Null value means, that we are unable to create equivalent layers.\n     * @type {Object.<string, ?Array.<T>>}\n     * @protected\n     */\n    this.layerMap = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer layers ids (from ol.getUid).\n     * @type {!Object.<string, Array<ol.EventsKey>>}\n     * @protected\n     */\n    this.olLayerListenKeys = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer groups ids (from ol.getUid).\n     * @type {!Object.<string, !Array.<ol.EventsKey>>}\n     * @private\n     */\n    this.olGroupListenKeys_ = {};\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   * @api\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @protected\n   */\n  orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  addLayers_(root) {\n    /** @type {Array<olcsx.LayerWithParents>} */\n    const fifo = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = olGetUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      googAsserts.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof olLayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = (e) => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange, this);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olEvents.listen(layerWithParents.layer, 'change', onLayerChange, this));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   * @param {Array.<T>} cesiumObjects\n   * @param {string} layerId\n   * @param {ol.layer.Base} layer\n   * @private\n   */\n  addCesiumObjects_(cesiumObjects, layerId, layer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olEvents.listen(layer, 'change:zIndex', this.orderLayers, this));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   * @private\n   */\n  removeAndDestroySingleLayer_(layer) {\n    const uid = olGetUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  unlistenSingleGroup_(group) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = olGetUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  removeLayer_(root) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof olLayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  listenForGroupChanges_(group) {\n    const uuid = olGetUid(group).toString();\n\n    googAsserts.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   * @protected\n   */\n  destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  addCesiumObject(object) {}\n\n  /**\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  destroyCesiumObject(object) {}\n\n  /**\n   * Remove single Cesium object from the collection.\n   * @param {!T} object\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeSingleCesiumObject(object, destroy) {}\n\n  /**\n   * Remove all Cesium objects from the collection.\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeAllCesiumObjects(destroy) {}\n\n  /**\n   * @param {olcsx.LayerWithParents} olLayerWithParents\n   * @return {?Array.<T>}\n   * @abstract\n   * @protected\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {}\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * @module olcs.Camera\n */\n\nimport googAsserts from 'goog/asserts.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport * as olEvents from 'ol/events.js';\nimport * as olMath from 'ol/math.js';\nimport * as olProj from 'ol/proj.js';\nimport olcsCore from './core.js';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = olProj.getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = olProj.getTransform('EPSG:4326', view.getProjection());\n      googAsserts.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = olEvents.listen(view, 'propertychange',\n          this.handleViewEvent_, this);\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    googAsserts.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        olMath.toRadians(ll[0]),\n        olMath.toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      olMath.toDegrees(carto.longitude),\n      olMath.toDegrees(carto.latitude)\n    ]);\n    googAsserts.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    googAsserts.assert(ll);\n\n    const carto = new Cesium.Cartographic(olMath.toRadians(ll[0]),\n        olMath.toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    googAsserts.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, olMath.toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = olcsCore.pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      olMath.toDegrees(bestTargetCartographic.longitude),\n      olMath.toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    const canvas = this.scene_.canvas;\n    const fovy = this.cam_.frustum.fovy; // vertical field of view\n    googAsserts.assert(!isNaN(fovy));\n    const metersPerUnit = this.view_.getProjection().getMetersPerUnit();\n\n    // number of \"map units\" visible in 2D (vertically)\n    const visibleMapUnits = resolution * canvas.clientHeight;\n\n    // The metersPerUnit does not take latitude into account, but it should\n    // be lower with increasing latitude -- we have to compensate.\n    // In 3D it is not possible to maintain the resolution at more than one point,\n    // so it only makes sense to use the latitude of the \"target\" point.\n    const relativeCircumference = Math.cos(Math.abs(latitude));\n\n    // how many meters should be visible in 3D\n    const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n    // distance required to view the calculated length in meters\n    //\n    //  fovy/2\n    //    |\\\n    //  x | \\\n    //    |--\\\n    // visibleMeters/2\n    const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n    // NOTE: This calculation is not absolutely precise, because metersPerUnit\n    // is a great simplification. It does not take ellipsoid/terrain into account.\n\n    return requiredDistance;\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    // See the reverse calculation (calcDistanceForResolution) for details\n    const canvas = this.scene_.canvas;\n    const fovy = this.cam_.frustum.fovy;\n    const metersPerUnit = this.view_.getProjection().getMetersPerUnit();\n\n    const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n    const relativeCircumference = Math.cos(Math.abs(latitude));\n    const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n    const resolution = visibleMapUnits / canvas.clientHeight;\n\n    return resolution;\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport googAsserts from 'goog/asserts.js';\nimport {getUid as olGetUid} from 'ol/util.js';\nimport * as olEvents from 'ol/events.js';\nimport * as olExtent from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil from './util.js';\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ =\n        this.onRemoveOrClearFeature_.bind(this);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    googAsserts.assertInstanceof(source, olSourceVector);\n\n    const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = olGetUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      return new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry,\n        attributes: {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        }\n      });\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        // always update Cesium externs before adding a property\n        geometryInstances: instances\n      });\n    } else {\n      const appearance = new Cesium.PerInstanceColorAppearance(options);\n      primitive = new Cesium.Primitive({\n        // always update Cesium externs before adding a property\n        geometryInstances: instances,\n        appearance\n      });\n    }\n\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return olcsCore.convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      googAsserts.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    googAsserts.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!Cesium.GroundPolylinePrimitive.isSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          outlinePrimitive.readyPromise.then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    googAsserts.assert(olGeometry.getType() == 'LineString');\n\n    const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !Cesium.GroundPolylinePrimitive.isSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        outlinePrimitive.readyPromise.then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    googAsserts.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = olExtent.boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      googAsserts.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n        googAsserts.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!Cesium.GroundPolylinePrimitive.isSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            outlinePrimitive.readyPromise.then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale: imageStyle.getScale(),\n        heightReference,\n        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\n        position\n      });\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = olGetUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      olEvents.listenOnce(image, 'load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    googAsserts.assert(olGeometry.getType() == 'Point');\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        const model = Cesium.Model.fromGltf(options);\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        modelPrimitive.add(model);\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            googAsserts.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            googAsserts.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        googAsserts.fail(`Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = olExtent.getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          googAsserts.fail(`unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = olcsCore.convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction.call(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!olcsx.core.OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[olGetUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[olGetUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      googAsserts.fail('View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    googAsserts.assertInstanceof(source, olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[olGetUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!olcsx.core.OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport googAsserts from 'goog/asserts.js';\nimport * as olProj from 'ol/proj.js';\nimport * as olEvents from 'ol/events.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\nclass OLCesium {\n  /**\n   * @param {!olcsx.OLCesiumOptions} options Options.\n   * @constructor\n   * @api\n   */\n  constructor(options) {\n\n    /**\n     * @type {olcs.AutoRenderLoop}\n     * @private\n     */\n    this.autoRenderLoop_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = options.map;\n\n    /**\n     * @type {!function(): Cesium.JulianDate}\n     * @private\n     */\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     * @private\n     */\n    this.to4326Transform_ = olProj.getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.resolutionScale_ = 1.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientWidth_ = 0.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientHeight_ = 0.0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.resolutionScaleChanged_ = true; // force resize\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n    /**\n     * @type {!Element}\n     * @private\n     */\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || null;\n    if (targetElement) {\n      if (typeof targetElement === 'string') {\n        targetElement = document.getElementById(targetElement);\n      }\n      targetElement.appendChild(this.container_);\n    } else {\n      const oc = this.map_.getViewport().querySelector('.ol-overlaycontainer');\n      if (oc && oc.parentNode) {\n        oc.parentNode.insertBefore(this.container_, oc);\n      }\n    }\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * @type {boolean}\n     * @private\n     */\n    this.isOverMap_ = !targetElement;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        olEvents.listen(this.container_, overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n\n    /**\n     * @type {!HTMLCanvasElement}\n     * @private\n     */\n    this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (olcsUtil.supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() { return false; };\n    this.canvas_.onselectstart = function() { return false; };\n\n    this.container_.appendChild(this.canvas_);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * @type {!Array.<ol.interaction.Interaction>}\n     * @private\n     */\n    this.pausedInteractions_ = [];\n\n    /**\n     * @type {?ol.layer.Group}\n     * @private\n     */\n    this.hiddenRootGroup_ = null;\n\n    const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n      /** @type {Cesium.SceneOptions} */ ({});\n    sceneOptions.canvas = this.canvas_;\n    sceneOptions.scene3DOnly = true;\n\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.SHIFT\n    });\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.ALT\n    });\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    /**\n     * @type {!olcs.Camera}\n     * @private\n     */\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    /**\n     * @type {!Cesium.Globe}\n     * @private\n     */\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    const synchronizers = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = synchronizers.length - 1; i >= 0; --i) {\n      synchronizers[i].synchronize();\n    }\n\n    if (this.isOverMap_) {\n      // if in \"stacked mode\", hide everything except canvas (including credits)\n      const credits = this.canvas_.nextElementSibling;\n      if (credits) {\n        credits.style.display = 'none';\n      }\n    }\n\n    /**\n     * Time of the last rendered frame, as returned by `performance.now()`.\n     * @type {number}\n     * @private\n     */\n    this.lastFrameTime_ = 0;\n\n    /**\n     * The identifier returned by `requestAnimationFrame`.\n     * @type {number|undefined}\n     * @private\n     */\n    this.renderId_ = undefined;\n\n    /**\n     * Target frame rate for the render loop.\n     * @type {number}\n     * @private\n     */\n    this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n    /**\n     * If the Cesium render loop is being blocked.\n     * @type {boolean}\n     * @private\n     */\n    this.blockCesiumRendering_ = false;\n\n    /**\n     * If the warmup routine is active.\n     * @type {boolean}\n     * @private\n     */\n    this.warmingUp_ = false;\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.trackedFeature_ = null;\n\n    /**\n     * @type {Cesium.Entity}\n     * @private\n     */\n    this.trackedEntity_ = null;\n\n    /**\n     * @type {Cesium.EntityView}\n     * @private\n     */\n    this.entityView_ = null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.needTrackedEntityUpdate_ = false;\n\n    /**\n     * @type {!Cesium.BoundingSphere}\n     */\n    this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n\n    // Cesium has a mechanism to prevent the camera to go under the terrain.\n    // Unfortunately, it is only active when all the terrain has been loaded, which:\n    // - does not prevent the camera to sink under terrain anymore;\n    // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n    // The property below enables a workaround found in the Camptocamp Cesium fork.\n    // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n    Cesium.Camera.enableSuspendTerrainAdjustment = false;\n  }\n\n  /**\n   * Render the Cesium scene.\n   * @private\n   */\n  render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   * @private\n   */\n  onAnimationFrame_(frameTime) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === Cesium.BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  /**\n   * @private\n   */\n  updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === Cesium.BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  /**\n   * @private\n   */\n  handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 | height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!olcsUtil.supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    this.scene_.camera.frustum.aspectRatio = width / height;\n  }\n\n  /**\n   * @return {!olcs.Camera}\n   * @api\n   */\n  getCamera() {\n    return this.camera_;\n  }\n\n  /**\n   * @return {!ol.Map}\n   * @api\n   */\n  getOlMap() {\n    return this.map_;\n  }\n\n  /**\n   * @return {!ol.View}\n   * @api\n   */\n  getOlView() {\n    const view = this.map_.getView();\n    googAsserts.assert(view);\n    return view;\n  }\n\n  /**\n   * @return {!Cesium.Scene}\n   * @api\n   */\n  getCesiumScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceCollection}\n   * @api\n   */\n  getDataSources() {\n    return this.dataSourceCollection_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceDisplay}\n   * @api\n   */\n  getDataSourceDisplay() {\n    return this.dataSourceDisplay_;\n  }\n\n  /**\n   * @return {boolean}\n   * @api\n   */\n  getEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   * @param {boolean} enable\n   * @api\n   */\n  setEnabled(enable) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n        this.map_.getOverlayContainerStopEvent().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        this.map_.getOverlayContainerStopEvent().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n   * @api\n  */\n  warmUp(height, timeout) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n   * @api\n  */\n  setBlockCesiumRendering(block) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   * @api\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n   * @return {?olcs.AutoRenderLoop}\n   * @api\n  */\n  getAutoRenderLoop() {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   *\n   * @param {number} value\n   * @this {olcs.OLCesium}\n   * @api\n   */\n  setResolutionScale(value) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   * @api\n   */\n  setTargetFrameRate(value) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   * @private\n   */\n  throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n}\n\n\nObject.defineProperties(OLCesium.prototype, {\n  'trackedFeature': {\n    'get': /** @this {olcs.OLCesium} */ function() {\n      return this.trackedFeature_;\n    },\n    'set': /** @this {olcs.OLCesium} */ function(feature) {\n      if (this.trackedFeature_ !== feature) {\n\n        const scene = this.scene_;\n\n        //Stop tracking\n        if (!feature || !feature.getGeometry()) {\n          this.needTrackedEntityUpdate_ = false;\n          scene.screenSpaceCameraController.enableTilt = true;\n\n          if (this.trackedEntity_) {\n            this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n          }\n          this.trackedEntity_ = null;\n          this.trackedFeature_ = null;\n          this.entityView_ = null;\n          scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n          return;\n        }\n\n        this.trackedFeature_ = feature;\n\n        //We can't start tracking immediately, so we set a flag and start tracking\n        //when the bounding sphere is ready (most likely next frame).\n        this.needTrackedEntityUpdate_ = true;\n\n        const to4326Transform = this.to4326Transform_;\n        const toCesiumPosition = function() {\n          const geometry = feature.getGeometry();\n          googAsserts.assertInstanceof(geometry, olGeomPoint);\n          const coo = geometry.getCoordinates();\n          const coo4326 = to4326Transform(coo, undefined, coo.length);\n          return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n        };\n\n        // Create an invisible point entity for tracking.\n        // It is independant from the primitive/geometry created by the vector synchronizer.\n        const options = {\n          'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n          'point': {\n            'pixelSize': 1,\n            'color': Cesium.Color.TRANSPARENT\n          }\n        };\n\n        this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n      }\n    }\n  }\n});\n\n\nexport default OLCesium;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid as olGetUid} from 'ol/util.js';\nimport * as olEvents from 'ol/events.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      olEvents.listen(this.overlayContainerStopEvent_, event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = olGetUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = olGetUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport googAsserts from 'goog/asserts.js';\nimport {getUid as olGetUid} from 'ol/util.js';\nimport * as olArray from 'ol/array.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @constructor\n   * @extends {olcsAbstractSynchronizer.<Cesium.ImageryLayer>}\n   * @api\n   */\n  constructor(map, scene) {\n    super(map, scene);\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.cesiumLayers_ = scene.imageryLayers;\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(object) {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   * @param {!ol.layer.Base} olLayer\n   * @param {!ol.proj.Projection} viewProj Projection of the view.\n   * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n   * (or supported)\n   * @protected\n   */\n  convertLayerToCesiumImageries(olLayer, viewProj) {\n    const result = olcsCore.tileLayerToImageryLayer(olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    const uid = olGetUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    googAsserts.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          googAsserts.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[olGetUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices = {};\n    const queue = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[olGetUid(olLayer)] = olLayer.getZIndex();\n\n      if (olLayer instanceof olLayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    olArray.stableSort(layers, (layer1, layer2) =>\n      zIndices[olGetUid(layer1)] - zIndices[olGetUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = olGetUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  /**\n   * @param {Cesium.ImageryLayer} counterpart\n   */\n  raiseToTop(counterpart) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport * as olProj from 'ol/proj.js';\nimport * as olDom from 'ol/dom.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      olDom.removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = olProj.transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    olDom.removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let cartesian;\n    if (position.length === 2) {\n      cartesian = Cesium.Cartesian3.fromDegreesArray(position)[0];\n    } else {\n      cartesian = Cesium.Cartesian3.fromDegreesArrayHeights(position)[0];\n    }\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport googAsserts from 'goog/asserts.js';\nimport {getUid as olGetUid} from 'ol/util.js';\nimport * as olEvents from 'ol/events.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @param {olcs.FeatureConverter=} opt_converter\n   * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n   * @api\n   */\n  constructor(map, scene, opt_converter) {\n    super(map, scene);\n\n    /**\n     * @protected\n     */\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n    /**\n     * @private\n     */\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(counterpart) {\n    googAsserts.assert(counterpart);\n    counterpart.getRootPrimitive()['counterpart'] = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.getRootPrimitive().destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   * @param {olcsx.LayerWithParents} olLayerWithParents\n   * @param {!Cesium.Primitive} csPrimitive\n   */\n  updateLayerVisibility(olLayerWithParents, csPrimitive) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible &= layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector)) {\n      return null;\n    }\n    googAsserts.assertInstanceof(olLayer, olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    googAsserts.assertInstanceof(source, olSourceVector);\n    googAsserts.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap = {};\n    const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olEvents.listen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature) {\n      googAsserts.assert(\n          (olLayer instanceof olLayerVector) ||\n          (olLayer instanceof olLayerImage)\n      );\n      const context = counterpart.context;\n      const prim = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[olGetUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature) {\n      const id = olGetUid(feature);\n      const context = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olEvents.listen(source, 'addfeature', (e) => {\n      googAsserts.assert(e.feature);\n      onAddFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olEvents.listen(source, 'removefeature', (e) => {\n      googAsserts.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olEvents.listen(source, 'changefeature', (e) => {\n      const feature = e.feature;\n      googAsserts.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }, this));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.core\n */\nconst exports = {};\nimport * as olEasing from 'ol/easing.js';\nimport googAsserts from 'goog/asserts.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport * as olProj from 'ol/proj.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport olcsUtil from './util.js';\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @return {!Cesium.Cartesian2} the pixel size\n * @api\n */\nexports.computePixelSizeAtCoordinate = function(scene, target) {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  const pixelSize = new Cesium.Cartesian2();\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight,\n      distance, pixelSize);\n};\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexports.computeBoundingBoxAtTarget = function(scene, target, amount) {\n  const pixelSize = exports.computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n};\n\n\n/**\n *\n * @param {!ol.geom.Geometry} geometry\n * @param {number} height\n * @api\n */\nexports.applyHeightOffsetToGeometry = function(geometry, height) {\n  geometry.applyTransform((input, output, stride) => {\n    googAsserts.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n};\n\n\n/**\n * @param {ol.Coordinate} coordinates\n * @param {number=} rotation\n * @param {!Cesium.Cartesian3=} translation\n * @param {!Cesium.Cartesian3=} scale\n * @return {!Cesium.Matrix4}\n * @api\n */\nexports.createMatrixAtCoordinates = function(coordinates, rotation = 0, translation = Cesium.Cartesian3.ZERO, scale = new Cesium.Cartesian3(1, 1, 1)) {\n  const position = exports.ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n};\n\n\n/**\n * @param {!Cesium.Camera} camera\n * @param {number} angle\n * @param {!Cesium.Cartesian3} axis\n * @param {!Cesium.Matrix4} transform\n * @param {olcsx.core.RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.rotateAroundAxis = function(camera, angle, axis, transform,\n    opt_options) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options = opt_options || {};\n  const duration = defaultValue(options.duration, 500); // ms\n  const easing = defaultValue(options.easing, olEasing.linear);\n  const callback = options.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    googAsserts.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} heading\n * @param {!Cesium.Cartesian3} bottomCenter\n * @param {olcsx.core.RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.setHeadingUsingBottomCenter = function(scene, heading,\n    bottomCenter, opt_options) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = exports.computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  const rotateAroundAxis = exports.rotateAroundAxis;\n  rotateAroundAxis(camera, heading, zenith, transform, opt_options);\n};\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian2} pixel\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickOnTerrainOrEllipsoid = function(scene, pixel) {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n};\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickBottomPoint = function(scene) {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return exports.pickOnTerrainOrEllipsoid(scene, bottom);\n};\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickCenterPoint = function(scene) {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return exports.pickOnTerrainOrEllipsoid(scene, center);\n};\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n * intersection of the camera direction with the globe.\n * @param {!Cesium.Scene} scene\n * @return {number|undefined}\n * @api\n */\nexports.computeSignedTiltAngleOnGlobe = function(scene) {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = exports.signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n};\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Ray}\n */\nexports.bottomFovRay = function(scene) {\n  const camera = scene.camera;\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n};\n\n\n/**\n * Compute the angle between two Cartesian3.\n * @param {!Cesium.Cartesian3} first\n * @param {!Cesium.Cartesian3} second\n * @param {!Cesium.Cartesian3} normal Normal to test orientation against.\n * @return {number}\n */\nexports.signedAngleBetween = function(first, second, normal) {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n};\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} pivot Point around which the camera rotates.\n * @return {number}\n * @api\n */\nexports.computeAngleToZenith = function(scene, pivot) {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  const fy = camera.frustum.fovy / 2;\n  const ray = exports.bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = exports.signedAngleBetween(normal, direction, left);\n  return a + fy;\n};\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n * @api\n */\nexports.extentToRectangle = function(extent, projection) {\n  if (extent && projection) {\n    const ext = olProj.transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Cesium.ImageryLayer} null if not possible (or supported)\n * @api\n */\nexports.tileLayerToImageryLayer = function(olLayer, viewProj) {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage)) {\n    return null;\n  }\n\n  let provider = null;\n  let source = olLayer.getSource();\n\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n    source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection))  {\n      provider = new olcsCoreOLImageryProvider(source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n\n  } else {\n    // sources other than TileImage are currently not supported\n    return null;\n  }\n\n  // the provider is always non-null if we got this far\n\n  const layerOptions = {};\n\n  const forcedExtent = /** @type {ol.Extent} */ (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = exports.extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n};\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.ImageryLayer} csLayer\n * @api\n */\nexports.updateCesiumLayerProperties = function(olLayerWithParents, csLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n};\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n * @param {ol.Coordinate} coordinate Ol3 coordinate.\n * @return {!Cesium.Cartesian3} Cesium cartesian coordinate\n * @api\n */\nexports.ol4326CoordinateToCesiumCartesian = function(coordinate) {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n};\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n * @param {Array.<!ol.Coordinate>} coordinates Ol3 coordinates.\n * @return {!Array.<Cesium.Cartesian3>} Cesium cartesian coordinates\n * @api\n */\nexports.ol4326CoordinateArrayToCsCartesians = function(coordinates) {\n  googAsserts.assert(coordinates !== null);\n  const toCartesian = exports.ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n};\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n * @param {!T} geometry\n * @param {!ol.ProjectionLike} projection\n * @return {!T}\n * @template T\n * @api\n */\nexports.olGeometryCloneTo4326 = function(geometry, projection) {\n  googAsserts.assert(projection);\n\n  const proj4326 = olProj.get('EPSG:4326');\n  const proj = olProj.get(projection);\n  if (proj !== proj4326) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n};\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n * @param {ol.Color|CanvasGradient|CanvasPattern|string} olColor\n * @return {!Cesium.Color}\n * @api\n */\nexports.convertColorToCesium = function(olColor) {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  }\n  googAsserts.fail('impossible');\n};\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n * @param {string} url\n * @return {!olcsx.core.CesiumUrlDefinition}\n * @api\n */\nexports.convertUrlToCesium = function(url) {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n};\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @return {Promise<undefined>}\n * @api\n */\nexports.resetToNorthZenith = function(map, scene) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = exports.computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    exports.setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options = {\n      callback: () => {\n        const view = map.getView();\n        exports.normalizeView(view);\n        resolve();\n      }\n    };\n    exports.rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexports.rotateAroundBottomCenter = function(scene, angle) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options = {callback: resolve};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const rotateAroundAxis = exports.rotateAroundAxis;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n * @param {ol.View} view\n * @param {number=} angle\n * @api\n */\nexports.normalizeView = function(view, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n  view.setResolution(view.constrainResolution(resolution));\n};\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n *\n * @param {ol.proj.Projection} projection Projection to check.\n * @returns {boolean} Whether it's managed by Cesium.\n */\nexports.isCesiumProjection = function(projection) {\n  const is3857 = projection === olProj.get('EPSG:3857');\n  const is4326 = projection === olProj.get('EPSG:4326');\n  return is3857 || is4326;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport * as olProj from 'ol/proj.js';\nimport olcsUtil from '../util.js';\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.Credit}\n     * @private\n     */\n    this.credit_ = null;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = null;\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_() {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = olcsUtil.getSourceProjection(this.source_) || this.fallbackProj_;\n      if (this.projection_ == olProj.get('EPSG:4326')) {\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme();\n      } else if (this.projection_ == olProj.get('EPSG:3857')) {\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme();\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.credit_ = OLImageryProvider.createCreditForSource(this.source_);\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Try to create proper Cesium.Credit for the given ol.source.Source as closely as possible.\n   * @param {!ol.source.Source} source\n   * @return {?Cesium.Credit}\n   */\n  static createCreditForSource(source) {\n    let text = '';\n    let attributions = source.getAttributions();\n    if (typeof attributions === 'function') {\n      attributions = attributions();\n    }\n    if (attributions) {\n      attributions.forEach((htmlOrAttr) => {\n        const html = typeof htmlOrAttr === 'string' ? htmlOrAttr : htmlOrAttr.getHTML();\n        text += html;\n      });\n    }\n\n    return text.length > 0 ? new Cesium.Credit(text, true) : null;\n  }\n\n  /**\n   * TODO: attributions for individual tile ranges\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    return undefined;\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      // Perform mapping of Cesium tile coordinates to OpenLayers tile coordinates:\n      // 1) Cesium zoom level 0 is OpenLayers zoom level 1 for EPSG:4326\n      const z_ = this.tilingScheme_ instanceof Cesium.GeographicTilingScheme ? level + 1 : level;\n      // 2) OpenLayers tile coordinates increase from bottom to top\n      const y_ = -y - 1;\n\n      let url = tileUrlFunction.call(this.source_,\n          [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'credit': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.credit_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\nclass VectorLayerCounterpart {\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  * @param {!(ol.proj.Projection|string)} layerProjection\n  * @param {!Cesium.Scene} scene\n  */\n  constructor(layerProjection, scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n\n    /**\n    * @type {!Array.<ol.EventsKey>}\n    */\n    this.olListenKeys = [];\n\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    /**\n    * @type {!olcsx.core.OlFeatureToCesiumContext}\n    */\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  /**\n  * @return {!Cesium.Primitive}\n  */\n  getRootPrimitive() {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * @module olcs.util\n */\nconst exports = {};\n\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexports.obj = function(param) {\n  return param;\n};\n\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nexports.supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nexports.imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexports.supportsImageRenderingPixelated = function() {\n  if (exports.supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    exports.supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (exports.supportsImageRenderingPixelatedResult_) {\n      exports.imageRenderingValueResult_ = tmp;\n    }\n  }\n  return exports.supportsImageRenderingPixelatedResult_;\n};\n\n\n/**\n * @return {string}\n */\nexports.imageRenderingValue = function() {\n  exports.supportsImageRenderingPixelated();\n  return exports.imageRenderingValueResult_ || '';\n};\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexports.getSourceProjection = function(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n    || source.getProjection();\n};\n\n\nexport default exports;\n","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_Observable_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_Overlay_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_array_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_dom_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_easing_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_events_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_extent_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_Geometry_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_Point_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_Polygon_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_SimpleGeometry_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Group_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Image_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Layer_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Tile_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Vector_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_math_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_proj_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_Cluster_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_Image_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_ImageWMS_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_TileImage_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_TileWMS_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_Vector_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_style_Icon_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_util_js__;"],"sourceRoot":""}