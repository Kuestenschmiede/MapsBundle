(function(e){function t(r){if(o[r])return o[r].exports;var i=o[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var o={};return t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(o,'a',o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=1)})([function(e,t,o){'use strict';function r(e,t){return this instanceof r?void(this._maxEntries=T(4,e||9),this._minEntries=T(2,x(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()):new r(e,t)}function n(e,t,o){if(!o)return t.indexOf(e);for(var r=0;r<t.length;r++)if(o(e,t[r]))return r;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,o,r,n){n||(n=h(null)),n.minX=Infinity,n.minY=Infinity,n.maxX=-Infinity,n.maxY=-Infinity;for(var a=t,i;a<o;a++)i=e.children[a],l(n,e.leaf?r(i):i);return n}function l(e,t){return e.minX=f(e.minX,t.minX),e.minY=f(e.minY,t.minY),e.maxX=T(e.maxX,t.maxX),e.maxY=T(e.maxY,t.maxY),e}function i(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function g(e){return e.maxX-e.minX+(e.maxY-e.minY)}function _(e,t){return(T(t.maxX,e.maxX)-f(t.minX,e.minX))*(T(t.maxY,e.maxY)-f(t.minY,e.minY))}function u(e,t){var o=T(e.minX,t.minX),r=T(e.minY,t.minY),i=f(e.maxX,t.maxX),n=f(e.maxY,t.maxY);return T(0,i-o)*T(0,n-r)}function c(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function h(e){return{children:e,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function m(e,t,o,r,i){for(var n=[t,o],a;n.length;)o=n.pop(),t=n.pop(),o-t<=r||(a=t+x((o-t)/r/2)*r,S(e,a,t,o,i),n.push(t,a,a,o))}var f=Math.min,E=Math.log,x=Math.ceil,T=Math.max;e.exports=r,e.exports.default=r;var S=o(2);r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,o=[],r=this.toBBox;if(!y(e,t))return o;for(var n=[],a,i,s,l;t;){for(a=0,i=t.children.length;a<i;a++)s=t.children[a],l=t.leaf?r(s):s,y(e,l)&&(t.leaf?o.push(s):c(e,l)?this._all(s,o):n.push(s));t=n.pop()}return o},collides:function(e){var t=this.data,o=this.toBBox;if(!y(e,t))return!1;for(var r=[],n,i,a,s;t;){for(n=0,i=t.children.length;n<i;n++)if(a=t.children[n],s=t.leaf?o(a):a,y(e,s)){if(t.leaf||c(e,s))return!0;r.push(a)}t=r.pop()}return!1},load:function(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(var t=0,o=e.length;t<o;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=h([]),this},remove:function(e,t){if(!e)return this;for(var o=this.data,r=this.toBBox(e),a=[],s=[],l,i,d,p;o||a.length;){if(o||(o=a.pop(),i=a[a.length-1],l=s.pop(),p=!0),o.leaf&&(d=n(e,o.children,t),-1!==d))return o.children.splice(d,1),a.push(o),this._condense(a),this;p||o.leaf||!c(o,r)?i?(l++,o=i.children[l],p=!1):o=null:(a.push(o),s.push(l),l=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:i,compareMinY:d,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var o=[];e;)e.leaf?t.push.apply(t,e.children):o.push.apply(o,e.children),e=o.pop();return t},_build:function(e,t,o,r){var n=o-t+1,s=this._maxEntries,l;if(n<=s)return l=h(e.slice(t,o+1)),a(l,this.toBBox),l;r||(r=x(E(n)/E(s)),s=x(n/Math.pow(s,r-1))),l=h([]),l.leaf=!1,l.height=r;var d=x(n/s),p=d*x(Math.sqrt(s)),g,i,_,u;for(m(e,t,o,p,this.compareMinX),g=t;g<=o;g+=p)for(_=f(g+p-1,o),m(e,g,_,d,this.compareMinY),i=g;i<=_;i+=d)u=f(i+d-1,_),l.children.push(this._build(e,i,u,r-1));return a(l,this.toBBox),l},_chooseSubtree:function(e,t,o,r){for(var n,i,a,s,l,d,g,u;r.push(t),!(t.leaf||r.length-1===o);){for(g=u=Infinity,n=0,i=t.children.length;n<i;n++)a=t.children[n],l=p(a),d=_(e,a)-l,d<u?(u=d,g=l<g?l:g,s=a):d==u&&l<g&&(g=l,s=a);t=s||t.children[0]}return t},_insert:function(e,t,o){var r=this.toBBox,i=o?e:r(e),n=[],a=this._chooseSubtree(i,this.data,t,n);for(a.children.push(e),l(a,i);0<=t&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(i,n,t)},_split:function(e,t){var o=e[t],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);var n=this._chooseSplitIndex(o,i,r),s=h(o.children.splice(n,o.children.length-n));s.height=o.height,s.leaf=o.leaf,a(o,this.toBBox),a(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(o,s)},_splitRoot:function(e,t){this.data=h([e,t]),this.data.height=e.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,o){var r,i,n,a,l,d,g,_;for(d=g=Infinity,r=t;r<=o-t;r++)i=s(e,0,r,this.toBBox),n=s(e,r,o,this.toBBox),a=u(i,n),l=p(i)+p(n),a<d?(d=a,_=r,g=l<g?l:g):a===d&&l<g&&(g=l,_=r);return _},_chooseSplitAxis:function(e,t,o){var r=e.leaf?this.compareMinX:i,n=e.leaf?this.compareMinY:d,a=this._allDistMargin(e,t,o,r),s=this._allDistMargin(e,t,o,n);a<s&&e.children.sort(r)},_allDistMargin:function(e,t,o,r){e.children.sort(r);var n=this.toBBox,a=s(e,0,t,n),d=s(e,o-t,o,n),p=g(a)+g(d),_,i;for(_=t;_<o-t;_++)i=e.children[_],l(a,e.leaf?n(i):i),p+=g(a);for(_=o-t-1;_>=t;_--)i=e.children[_],l(d,e.leaf?n(i):i),p+=g(d);return p},_adjustParentBBoxes:function(e,t,o){for(var r=o;0<=r;r--)l(t[r],e)},_condense:function(e){for(var t=e.length-1,o;0<=t;t--)0===e[t].children.length?0<t?(o=e[t-1].children,o.splice(o.indexOf(e[t]),1)):this.clear():a(e[t],this.toBBox)},_initFormat:function(e){var t=['return a',' - b',';'];this.compareMinX=new Function('a','b',t.join(e[0])),this.compareMinY=new Function('a','b',t.join(e[1])),this.toBBox=new Function('a','return {minX: a'+e[0]+', minY: a'+e[1]+', maxX: a'+e[2]+', maxY: a'+e[3]+'};')}}},function(e,t,o){'use strict';function r(e,t){const o=Ld.length;for(let r=0;r<o;++r)try{const o=e.getContext(Ld[r],t);if(o)return o}catch(t){}return null}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function n(e){return e.ol_uid||(e.ol_uid=++Nd)}function a(e){for(const t in e)delete e[t]}function s(e){const t=[];for(const o in e)t.push(e[o]);return t}function l(e){for(var t in e)return!1;return!t}function d(e){const t=function(t){const o=e.listener,r=e.bindTo||e.target;return e.callOnce&&h(e),o.call(r,t)};return e.boundListener=t,t}function p(e,t,o,r){let n;for(let a=0,i=e.length;a<i;++a)if(n=e[a],n.listener===t&&n.bindTo===o)return r&&(n.deleteIndex=a),n}function g(e,t){const o=e.ol_lm;return o?o[t]:void 0}function _(e){let t=e.ol_lm;return t||(t=e.ol_lm={}),t}function u(e,t){const o=g(e,t);if(o){for(let r=0,i=o.length;r<i;++r)e.removeEventListener(t,o[r].boundListener),a(o[r]);o.length=0;const r=e.ol_lm;r&&(delete r[t],0===Object.keys(r).length&&delete e.ol_lm)}}function c(e,t,o,r,i){const n=_(e);let a=n[t];a||(a=n[t]=[]);let s=p(a,o,r,!1);return s?!i&&(s.callOnce=!1):(s={bindTo:r,callOnce:!!i,listener:o,target:e,type:t},e.addEventListener(t,d(s)),a.push(s)),s}function y(e,t,o,r){return c(e,t,o,r,!0)}function m(e,t,o,r){const i=g(e,t);if(i){const e=p(i,o,r,!0);e&&h(e)}}function h(e){if(e&&e.target){e.target.removeEventListener(e.type,e.boundListener);const t=g(e.target,e.type);if(t){const o='deleteIndex'in e?e.deleteIndex:t.indexOf(e);-1!==o&&t.splice(o,1),0===t.length&&u(e.target,e.type)}a(e)}}function f(e){const t=_(e);for(const o in t)u(e,o)}function E(){return!0}function x(){return!1}function T(){}function S(e){e.stopPropagation()}function C(e){return Zd.hasOwnProperty(e)?Zd[e]:Zd[e]='change:'+e}function R(t,o){const r=o.cloneEvent(t,t),e=r.preventDefault;return r.preventDefault=function(){t.preventDefault(),e()},r.pointerId=Rp,r.isPrimary=!0,r.pointerType=Ip,r}function I(e,t,o){let r,i;let n=0,a=e.length,s=!1;for(;n<a;)r=n+(a-n>>1),i=+(o||L)(e[r],t),0>i?n=r+1:(a=r,s=!i);return s?n:~n}function L(e,t){return e>t?1:e<t?-1:0}function P(e,t){return 0<=e.indexOf(t)}function v(e,t,o){const r=e.length;if(e[0]<=t)return 0;if(t<=e[r-1])return r-1;else{let n;if(0<o){for(n=1;n<r;++n)if(e[n]<t)return n-1;}else if(0>o){for(n=1;n<r;++n)if(e[n]<=t)return n;}else for(n=1;n<r;++n){if(e[n]==t)return n;if(e[n]<t)return e[n-1]-t<t-e[n]?n-1:n}return r-1}}function F(e,t,o){for(;t<o;){const r=e[t];e[t]=e[o],e[o]=r,++t,--o}}function O(e,t){const o=Array.isArray(t)?t:[t],r=o.length;for(let n=0;n<r;n++)e[e.length]=o[n]}function w(e,t){const o=e.indexOf(t),r=-1<o;return r&&e.splice(o,1),r}function N(e,t){const o=e.length>>>0;let r;for(let n=0;n<o;n++)if(r=e[n],t(r,n,e))return r;return null}function A(e,t){const o=e.length;if(o!==t.length)return!1;for(let r=0;r<o;r++)if(e[r]!==t[r])return!1;return!0}function b(e,t){const o=e.length,r=Array(e.length);let n;for(n=0;n<o;n++)r[n]={index:n,value:e[n]};for(r.sort(function(e,o){return t(e.value,o.value)||e.index-o.index}),n=0;n<e.length;n++)e[n]=r[n].value}function G(e,t){let o;const r=!e.every(function(r,i){return o=i,!t(r,i,e)});return r?o:-1}function D(e,t,o){return e.every(function(r,i){if(0===i)return!0;const n=(t||L)(e[i-1],r);return!(0<n||o&&0===n)})}function k(e,t){if(!e)throw new bd(t)}function U(e,t,o){return rd(ld(e,t),o)}function Y(e){return k(0<e,29),nd(2,sd(ad(e)/ed))}function B(e,o,r,i,n,a){const s=n-r,l=a-i;if(0!=s||0!=l){const d=((e-r)*s+(o-i)*l)/(s*s+l*l);1<d?(r=n,i=a):0<d&&(r+=s*d,i+=l*d)}return j(e,o,r,i)}function j(e,t,o,r){const i=o-e,n=r-t;return i*i+n*n}function V(e){const t=e.length;for(let o=0;o<t;o++){let i=o,n=od(e[o][o]);for(let a=o+1;a<t;a++){const t=od(e[a][o]);t>n&&(n=t,i=a)}if(0===n)return null;const r=e[i];e[i]=e[o],e[o]=r;for(let r=o+1;r<t;r++){const i=-e[r][o]/e[o][o];for(let n=o;n<t+1;n++)o==n?e[r][n]=0:e[r][n]+=i*e[o][n]}}const o=Array(t);for(let r=t-1;0<=r;r--){o[r]=e[r][t]/e[r][r];for(let i=r-1;0<=i;i--)e[i][t]-=e[i][r]*o[r]}return o}function z(e){return 180*e/$l}function X(e){return e*$l/180}function W(e,t){const o=e%t;return 0>o*t?o+t:o}function K(e,t,o){return e+o*(t-e)}function H(e){return function(t){return t?[U(t[0],e[0],e[2]),U(t[1],e[1],e[3])]:void 0}}function q(e){return e}function J(e){return function(t,o,r){if(t!==void 0){let i=v(e,t,r);i=U(i+o,0,e.length-1);const n=Ql(i);if(i!=n&&n<e.length-1){const t=e[n]/e[n+1];return e[n]/nd(t,i-n)}return e[n]}}}function Q(e,t,o){return function(r,i,n){if(void 0!==r){const a=Ql(ad(t/r)/ad(e)+(-n/2+.5));let s=ld(a+i,0);return void 0!==o&&(s=rd(s,o)),t/nd(e,s)}}}function $(e){return void 0===e?void 0:0}function ee(e,t){return void 0===e?void 0:e+t}function te(e){const t=2*$l/e;return function(e,o){return void 0===e?void 0:(e=Ql((e+o)/t+.5)*t,e)}}function oe(e){const t=e||X(5);return function(e,o){return void 0===e?void 0:od(e+o)<=t?0:e+o}}function re(e,t,o){const r=void 0===o?''+e:e.toFixed(o);let i=r.indexOf('.');return i=-1===i?r.length:i,i>t?r:Array(1+t-i).join('0')+r}function ie(e,t){const o=(''+e).split('.'),r=(''+t).split('.');for(let n=0;n<ld(o.length,r.length);n++){const e=parseInt(o[n]||'0',10),t=parseInt(r[n]||'0',10);if(e>t)return 1;if(t>e)return-1}return 0}function ne(e,t){return e[0]+=t[0],e[1]+=t[1],e}function ae(e,t){const o=t.getRadius(),r=t.getCenter(),i=r[0],n=r[1],a=e[0],s=e[1];let l=a-i;const p=s-n;0==l&&0==p&&(l=1);const g=id(l*l+p*p),d=i+o*l/g;return[d,n+o*p/g]}function se(e,t){const o=e[0],r=e[1],i=t[0],n=t[1],a=i[0],s=i[1],l=n[0],d=n[1],p=l-a,g=d-s,_=0===p&&0===g?0:(p*(o-a)+g*(r-s))/(p*p+g*g||0);let u,c;return 0>=_?(u=a,c=s):1<=_?(u=l,c=d):(u=a+_*p,c=s+_*g),[u,c]}function le(e,t,o){const r=W(t+180,360)-180,i=od(3600*r),n=o||0,a=nd(10,n);let s=Ql(i/3600),l=Ql((i-3600*s)/60),d=i-3600*s-60*l;return d=sd(d*a)/a,60<=d&&(d=0,l+=1),60<=l&&(l=0,s+=1),s+'\xB0 '+re(l,2)+'\u2032 '+re(d,2,n)+'\u2033'+(0==r?'':' '+e.charAt(0>r?1:0))}function de(e,t,o){return e?t.replace('{x}',e[0].toFixed(o)).replace('{y}',e[1].toFixed(o)):''}function pe(e,t){let o=!0;for(let r=e.length-1;0<=r;--r)if(e[r]!=t[r]){o=!1;break}return o}function ge(e,t){const o=Jl(t),r=ql(t),i=e[0]*o-e[1]*r,n=e[1]*o+e[0]*r;return e[0]=i,e[1]=n,e}function _e(e,t){return e[0]*=t,e[1]*=t,e}function ue(e,t){const o=e[0]-t[0],r=e[1]-t[1];return o*o+r*r}function ce(e,t){return id(ue(e,t))}function ye(e,t){return ue(e,se(e,t))}function me(e,t){return de(e,'{x}, {y}',t)}function he(e){return nd(e,3)}function fe(e){return 1-he(1-e)}function Ee(e){return 3*e*e-2*e*e*e}function xe(e){return e}function Te(e){const t=Oe();for(let o=0,r=e.length;o<r;++o)ke(t,e[o]);return t}function Se(e,t,o){const r=rd.apply(null,e),i=rd.apply(null,t),n=ld.apply(null,e),a=ld.apply(null,t);return we(r,i,n,a,o)}function Ce(e,t,o){return o?(o[0]=e[0]-t,o[1]=e[1]-t,o[2]=e[2]+t,o[3]=e[3]+t,o):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function Re(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function Ie(e,t,o){let r,i;return r=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0,i=o<e[1]?e[1]-o:e[3]<o?o-e[3]:0,r*r+i*i}function Le(e,t){return ve(e,t[0],t[1])}function Pe(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function ve(e,t,o){return e[0]<=t&&t<=e[2]&&e[1]<=o&&o<=e[3]}function Fe(e,t){const o=e[0],r=e[1],i=e[2],n=e[3],a=t[0],s=t[1];let l=Qp.UNKNOWN;return a<o?l|=Qp.LEFT:a>i&&(l|=Qp.RIGHT),s<r?l|=Qp.BELOW:s>n&&(l|=Qp.ABOVE),l===Qp.UNKNOWN&&(l=Qp.INTERSECTING),l}function Oe(){return[Infinity,Infinity,-Infinity,-Infinity]}function we(e,t,o,r,i){return i?(i[0]=e,i[1]=t,i[2]=o,i[3]=r,i):[e,t,o,r]}function Ne(e){return we(Infinity,Infinity,-Infinity,-Infinity,e)}function Ae(e,t){const o=e[0],r=e[1];return we(o,r,o,r,t)}function be(e,t){const o=Ne(t);return Ue(o,e)}function Me(e,t,o,r,i){const n=Ne(i);return Ye(n,e,t,o,r)}function Ge(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function De(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function ke(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Ue(e,t){for(let o=0,r=t.length;o<r;++o)ke(e,t[o]);return e}function Ye(e,t,o,r,i){for(;o<r;o+=i)Be(e,t[o],t[o+1]);return e}function Be(e,t,o){e[0]=rd(e[0],t),e[1]=rd(e[1],o),e[2]=ld(e[2],t),e[3]=ld(e[3],o)}function je(e,t,o){let r;return(r=t.call(o,ze(e)),r)?r:(r=t.call(o,Xe(e)),r)?r:(r=t.call(o,Qe(e)),r)?r:(r=t.call(o,Je(e)),!!r&&r)}function Ve(e){let t=0;return tt(e)||(t=$e(e)*Ze(e)),t}function ze(e){return[e[0],e[1]]}function Xe(e){return[e[2],e[1]]}function We(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function Ke(e,t){let o;return t===Jp.BOTTOM_LEFT?o=ze(e):t===Jp.BOTTOM_RIGHT?o=Xe(e):t===Jp.TOP_LEFT?o=Je(e):t===Jp.TOP_RIGHT?o=Qe(e):k(!1,13),o}function He(e,t,o,r,i){const n=t*r[0]/2,a=t*r[1]/2,s=Jl(o),l=ql(o),d=n*s,p=n*l,g=a*s,_=a*l,u=e[0],c=e[1],y=u-d+_,m=u-d-_,h=u+d-_,f=u+d+_,E=c-p-g,x=c-p+g,T=c+p+g,S=c+p-g;return we(rd(y,m,h,f),rd(E,x,T,S),ld(y,m,h,f),ld(E,x,T,S),i)}function Ze(e){return e[3]-e[1]}function qe(e,t,o){const r=o?o:Oe();return et(e,t)?(r[0]=e[0]>t[0]?e[0]:t[0],r[1]=e[1]>t[1]?e[1]:t[1],r[2]=e[2]<t[2]?e[2]:t[2],r[3]=e[3]<t[3]?e[3]:t[3]):Ne(r),r}function Je(e){return[e[0],e[3]]}function Qe(e){return[e[2],e[3]]}function $e(e){return e[2]-e[0]}function et(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function tt(e){return e[2]<e[0]||e[3]<e[1]}function ot(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function rt(e,t){const o=(e[2]-e[0])/2*(t-1),r=(e[3]-e[1])/2*(t-1);e[0]-=o,e[2]+=o,e[1]-=r,e[3]+=r}function it(e,t,o){let r=!1;const i=Fe(e,t),n=Fe(e,o);if(i===Qp.INTERSECTING||n===Qp.INTERSECTING)r=!0;else{const a=e[0],s=e[1],l=e[2],d=e[3],p=t[0],g=t[1],_=o[0],u=o[1],c=(u-g)/(_-p);let m,h;!(n&Qp.ABOVE)||i&Qp.ABOVE||(m=_-(u-d)/c,r=m>=a&&m<=l),r||!(n&Qp.RIGHT)||i&Qp.RIGHT||(h=u-(_-l)*c,r=h>=s&&h<=d),r||!(n&Qp.BELOW)||i&Qp.BELOW||(m=_-(u-s)/c,r=m>=a&&m<=l),r||!(n&Qp.LEFT)||i&Qp.LEFT||(h=u-(_-a)*c,r=h>=s&&h<=d)}return r}function nt(e,t,o){const r=[e[0],e[1],e[0],e[3],e[2],e[1],e[2],e[3]];t(r,r,2);const i=[r[0],r[2],r[4],r[6]],n=[r[1],r[3],r[5],r[7]];return Se(i,n,o)}function at(e,t,o,r,n,a){const s=a?a:[];let l=0;for(let i=t;i<o;i+=r){const t=e[i],o=e[i+1];s[l++]=n[0]*t+n[2]*o+n[4],s[l++]=n[1]*t+n[3]*o+n[5]}return a&&s.length!=l&&(s.length=l),s}function st(e,t,o,r,n,a,s){const l=s?s:[],d=Jl(n),p=ql(n),g=a[0],_=a[1];let u=0;for(let i=t;i<o;i+=r){const t=e[i]-g,o=e[i+1]-_;l[u++]=g+t*d-o*p,l[u++]=_+t*p+o*d;for(let t=i+2;t<i+r;++t)l[u++]=e[t]}return s&&l.length!=u&&(l.length=u),l}function lt(e,t,o,r,n,a,s,l){const d=l?l:[],p=s[0],g=s[1];let _=0;for(let i=t;i<o;i+=r){const t=e[i]-p,o=e[i+1]-g;d[_++]=p+n*t,d[_++]=g+a*o;for(let t=i+2;t<i+r;++t)d[_++]=e[t]}return l&&d.length!=_&&(d.length=_),d}function dt(e,t,o,r,n,a,s){const l=s?s:[];let d=0;for(let i=t;i<o;i+=r){l[d++]=e[i]+n,l[d++]=e[i+1]+a;for(let t=i+2;t<i+r;++t)l[d++]=e[t]}return s&&l.length!=d&&(l.length=d),l}/**
 * @license
 * Latitude/longitude spherical geodesy formulae taken from
 * http://www.movable-type.co.uk/scripts/latlong.html
 * Licensed under CC-BY-3.0.
 */function pt(e,t,o){const r=X(e[1]),i=X(t[1]),n=(i-r)/2,s=X(t[0]-e[0])/2,l=ql(n)*ql(n)+ql(s)*ql(s)*Jl(r)*Jl(i);return 2*(o||tg)*Zl(id(l),id(1-l))}function gt(e,t){let o=0;for(let r=0,i=e.length;r<i-1;++r)o+=pt(e[r],e[r+1],t);return o}function _t(e,t){const o=t||{},r=o.radius||tg,n=o.projection||'EPSG:3857',a=e.getType();a!==$p.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,'EPSG:4326'));let s=0,l,d,p,i,g,_;switch(a){case $p.POINT:case $p.MULTI_POINT:break;case $p.LINE_STRING:case $p.LINEAR_RING:{l=e.getCoordinates(),s=gt(l,r);break}case $p.MULTI_LINE_STRING:case $p.POLYGON:{for(l=e.getCoordinates(),p=0,i=l.length;p<i;++p)s+=gt(l[p],r);break}case $p.MULTI_POLYGON:{for(l=e.getCoordinates(),p=0,i=l.length;p<i;++p)for(d=l[p],g=0,_=d.length;g<_;++g)s+=gt(d[g],r);break}case $p.GEOMETRY_COLLECTION:{const o=e.getGeometries();for(p=0,i=o.length;p<i;++p)s+=_t(o[p],t);break}default:throw new Error('Unsupported geometry type: '+a);}return s}function ut(e,t){let o=0;const r=e.length;let n=e[r-1][0],a=e[r-1][1];for(let s=0;s<r;s++){const t=e[s][0],r=e[s][1];o+=X(t-n)*(2+ql(X(a))+ql(X(r))),n=t,a=r}return o*t*t/2}function ct(e,t){const o=t||{},r=o.radius||tg,n=o.projection||'EPSG:3857',a=e.getType();a!==$p.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,'EPSG:4326'));let s=0,l,d,p,i,g,_;switch(a){case $p.POINT:case $p.MULTI_POINT:case $p.LINE_STRING:case $p.MULTI_LINE_STRING:case $p.LINEAR_RING:break;case $p.POLYGON:{for(l=e.getCoordinates(),s=od(ut(l[0],r)),(p=1,i=l.length);p<i;++p)s-=od(ut(l[p],r));break}case $p.MULTI_POLYGON:{for(l=e.getCoordinates(),p=0,i=l.length;p<i;++p)for(d=l[p],s+=od(ut(d[0],r)),(g=1,_=d.length);g<_;++g)s-=od(ut(d[g],r));break}case $p.GEOMETRY_COLLECTION:{const o=e.getGeometries();for(p=0,i=o.length;p<i;++p)s+=ct(o[p],t);break}default:throw new Error('Unsupported geometry type: '+a);}return s}function yt(e,t,o,r){const i=X(e[1]),n=X(e[0]),a=t/(r||tg),s=Hl(ql(i)*Jl(a)+Jl(i)*ql(a)*Jl(o)),l=n+Zl(ql(o)*ql(a)*Jl(i),Jl(a)-ql(i)*ql(s));return[z(l),z(s)]}function mt(e){ag.call(this,{code:e,units:ig.METERS,extent:dg,global:!0,worldExtent:pg,getPointResolution:function(e,t){return e/Hp(t[1]/sg)}})}function ht(e,t,o){const r=e.length,n=1<o?o:2;let a=t;a===void 0&&(2<n?a=e.slice():a=Array(r));const s=lg;for(let l=0;l<r;l+=n){a[l]=s*e[l]/180;let t=sg*ad(Math.tan($l*(e[l+1]+90)/360));t>s?t=s:t<-s&&(t=-s),a[l+1]=t}return a}function ft(e,t,o){const r=e.length,n=1<o?o:2;let a=t;a===void 0&&(2<n?a=e.slice():a=Array(r));for(let s=0;s<r;s+=n)a[s]=180*e[s]/lg,a[s+1]=360*Kl(td(e[s+1]/sg))/$l-90;return a}function Et(e,t){ag.call(this,{code:e,units:ig.DEGREES,extent:_g,axisOrientation:t,global:!0,metersPerUnit:ug,worldExtent:_g})}function xt(e){return yg[e]||null}function Tt(e,t){yg[e]=t}function St(e,t,o){const r=e.getCode(),i=t.getCode();r in mg||(mg[r]={}),mg[r][i]=o}function Ct(e,t){let o;return e in mg&&t in mg[e]&&(o=mg[e][t]),o}function Rt(e,t){let o;if(t!==void 0){for(let o=0,r=e.length;o<r;++o)t[o]=e[o];o=t}else o=e.slice();return o}function It(e,t){if(t!==void 0&&e!==t){for(let o=0,r=e.length;o<r;++o)t[o]=e[o];e=t}return e}function Lt(e){Tt(e.getCode(),e),St(e,e,Rt)}function Pt(e){e.forEach(Lt)}function vt(e){let t=null;if(e instanceof ag)t=e;else if('string'==typeof e){t=xt(e)}return t}function Ft(e,t,o,r){e=vt(e);let i;const n=e.getPointResolutionFunc();if(n)i=n(t,o);else{const n=e.getUnits();if(n==ig.DEGREES&&!r||r==ig.DEGREES)i=t;else{const n=Gt(e,vt('EPSG:4326'));let a=[o[0]-t/2,o[1],o[0]+t/2,o[1],o[0],o[1]-t/2,o[0],o[1]+t/2];a=n(a,a,2);const s=pt(a.slice(0,2),a.slice(2,4)),l=pt(a.slice(4,6),a.slice(6,8));i=(s+l)/2;const d=r?rg[r]:e.getMetersPerUnit();d!==void 0&&(i/=d)}}return i}function Ot(e){Pt(e),e.forEach(function(t){e.forEach(function(e){t!==e&&St(t,e,Rt)})})}function wt(e,t,o,r){e.forEach(function(e){t.forEach(function(t){St(e,t,o),St(t,e,r)})})}function Nt(e,t){return e?'string'==typeof e?vt(e):e:vt(t)}function At(e){return function(t,o,r){const n=t.length,a=r===void 0?2:r,s=o===void 0?Array(n):o;let l,d,i;for(d=0;d<n;d+=a)for(l=e([t[d],t[d+1]]),s[d]=l[0],s[d+1]=l[1],i=a-1;2<=i;--i)s[d+i]=t[d+i];return s}}function bt(e,t,o,r){const i=vt(e),n=vt(t);St(i,n,At(o)),St(n,i,At(r))}function Mt(e,t){if(e===t)return!0;const o=e.getUnits()===t.getUnits();if(e.getCode()===t.getCode())return o;else{const r=Gt(e,t);return r===Rt&&o}}function Gt(e,t){const o=e.getCode(),r=t.getCode();let i=Ct(o,r);return i||(i=It),i}function Dt(e,t){const o=vt(e),r=vt(t);return Gt(o,r)}function kt(e,t,o){const r=Dt(t,o);return r(e,void 0,e.length)}function Ut(e,t,o){const r=Dt(t,o);return nt(e,r)}function Yt(){return[1,0,0,1,0,0]}function Bt(e){return Vt(e,1,0,0,1,0,0)}function jt(e,t){const o=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],l=t[0],d=t[1],p=t[2],g=t[3],_=t[4],u=t[5];return e[0]=o*l+i*d,e[1]=r*l+n*d,e[2]=o*p+i*g,e[3]=r*p+n*g,e[4]=o*_+i*u+a,e[5]=r*_+n*u+s,e}function Vt(t,o,r,i,n,a,e){return t[0]=o,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=e,t}function zt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Xt(e,t){const o=t[0],r=t[1];return t[0]=e[0]*o+e[2]*r+e[4],t[1]=e[1]*o+e[3]*r+e[5],t}function Wt(e,t){const o=Jl(t),r=ql(t);return jt(e,Vt(hg,o,r,-r,o,0,0))}function Kt(e,t,o){return jt(e,Vt(hg,t,0,0,o,0,0))}function Ht(e,t,o){return jt(e,Vt(hg,1,0,0,1,t,o))}function Zt(e,t,o,r,i,n,a,s){const l=ql(n),d=Jl(n);return e[0]=r*d,e[1]=i*l,e[2]=-r*l,e[3]=i*d,e[4]=a*r*d-s*r*l+t,e[5]=a*i*l+s*i*d+o,e}function qt(t){const o=Jt(t);k(0!==o,32);const r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],e=t[5];return t[0]=a/o,t[1]=-i/o,t[2]=-n/o,t[3]=r/o,t[4]=(n*e-a*s)/o,t[5]=-(r*e-i*s)/o,t}function Jt(e){return e[0]*e[3]-e[1]*e[2]}function Qt(e){let t;return 2==e?t=eg.XY:3==e?t=eg.XYZ:4==e&&(t=eg.XYZM),t}function $t(e){let t;return e==eg.XY?t=2:e==eg.XYZ||e==eg.XYM?t=3:e==eg.XYZM&&(t=4),t}function eo(e,t,o){const r=e.getFlatCoordinates();if(!r)return null;else{const i=e.getStride();return at(r,0,r.length,i,t,o)}}function to(e,t,o,r){let i=0,n=e[o-r],a=e[o-r+1];for(;t<o;t+=r){const o=e[t],r=e[t+1];i+=a*o-n*r,n=o,a=r}return i/2}function oo(e,t,o,r){let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a];n+=to(e,t,i,r),t=i}return n}function ro(e,t,o,r){let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a];n+=oo(e,t,i,r),t=i[i.length-1]}return n}function io(e,o,r,n,i,a,s){const l=e[o],d=e[o+1],p=e[r]-l,g=e[r+1]-d;let _;if(0==p&&0==g)_=o;else{const u=((i-l)*p+(a-d)*g)/(p*p+g*g);if(1<u)_=r;else{if(0<u){for(let t=0;t<n;++t)s[t]=K(e[o+t],e[r+t],u);return void(s.length=n)}_=o}}for(let t=0;t<n;++t)s[t]=e[_+t];s.length=n}function no(e,t,o,r,i){let n=e[t],a=e[t+1];for(t+=r;t<o;t+=r){const o=e[t],r=e[t+1],s=j(n,a,o,r);s>i&&(i=s),n=o,a=r}return i}function ao(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a];n=no(e,t,i,r,n),t=i}return n}function so(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a];n=ao(e,t,i,r,n),t=i[i.length-1]}return n}function lo(e,t,o,r,n,a,s,l,d,p,g){if(t==o)return p;let _,i;if(0===n){if(i=j(s,l,e[t],e[t+1]),i<p){for(_=0;_<r;++_)d[_]=e[t+_];return d.length=r,i}return p}const u=g?g:[NaN,NaN];for(let c=t+r;c<o;)if(io(e,c-r,c,r,s,l,u),i=j(s,l,u[0],u[1]),i<p){for(p=i,_=0;_<r;++_)d[_]=u[_];d.length=r,c+=r}else c+=r*ld(0|(id(i)-id(p))/n,1);if(a&&(io(e,o-r,t,r,s,l,u),i=j(s,l,u[0],u[1]),i<p)){for(p=i,_=0;_<r;++_)d[_]=u[_];d.length=r}return p}function po(e,t,o,r,n,a,s,l,d,p,i){const g=i?i:[NaN,NaN];for(let _=0,u=o.length;_<u;++_){const i=o[_];p=lo(e,t,i,r,n,a,s,l,d,p,g),t=i}return p}function go(e,t,o,r,n,a,s,l,d,p,i){const g=i?i:[NaN,NaN];for(let _=0,u=o.length;_<u;++_){const i=o[_];p=po(e,t,i,r,n,a,s,l,d,p,g),t=i[i.length-1]}return p}function _o(e,t,o){for(let r=0,i=o.length;r<i;++r)e[t++]=o[r];return t}function uo(e,t,o,r){for(let n=0,i=o.length;n<i;++n){const i=o[n];for(let o=0;o<r;++o)e[t++]=i[o]}return t}function co(e,t,o,r,n){const a=n?n:[];let s=0;for(let i=0,l=o.length;i<l;++i){const n=uo(e,t,o[i],r);a[s++]=n,t=n}return a.length=s,a}function yo(e,t,o,r,n){const a=n?n:[];let s=0;for(let i=0,l=o.length;i<l;++i){const n=co(e,t,o[i],r,a[s]);a[s++]=n,t=n[n.length-1]}return a.length=s,a}function mo(e,t,o,r,n){const a=void 0===n?[]:n;let s=0;for(let i=t;i<o;i+=r)a[s++]=e.slice(i,i+r);return a.length=s,a}function ho(e,t,o,r,n){const a=void 0===n?[]:n;let s=0;for(let i=0,l=o.length;i<l;++i){const n=o[i];a[s++]=mo(e,t,n,r,a[s]),t=n}return a.length=s,a}function fo(e,t,o,r,n){const a=void 0===n?[]:n;let s=0;for(let i=0,l=o.length;i<l;++i){const n=o[i];a[s++]=ho(e,t,n,r,a[s]),t=n[n.length-1]}return a.length=s,a}function Eo(e,t,o,r,i,a,s){const l=(o-t)/r;if(3>l){for(;t<o;t+=r)a[s++]=e[t],a[s++]=e[t+1];return s}const n=Array(l);n[0]=1,n[l-1]=1;const d=[t,o-r];for(let l=0;0<d.length;){const o=d.pop(),a=d.pop();let s=0;const p=e[a],g=e[a+1],_=e[o],u=e[o+1];for(let t=a+r;t<o;t+=r){const o=e[t],r=e[t+1],i=B(o,r,p,g,_,u);i>s&&(l=t,s=i)}s>i&&(n[(l-t)/r]=1,a+r<l&&d.push(a,l),l+r<o&&d.push(l,o))}for(let d=0;d<l;++d)n[d]&&(a[s++]=e[t+d*r],a[s++]=e[t+d*r+1]);return s}function xo(e,t,o,r,n,a,s,l){for(let d=0,i=o.length;d<i;++d){const i=o[d];s=Eo(e,t,i,r,n,a,s),l.push(s),t=i}return s}function To(e,t){return t*Wl(e/t)}function So(e,t,o,r,i,n,a){if(t==o)return a;let s=To(e[t],i),l=To(e[t+1],i);t+=r,n[a++]=s,n[a++]=l;let d,p;do if(d=To(e[t],i),p=To(e[t+1],i),t+=r,t==o)return n[a++]=d,n[a++]=p,a;while(d==s&&p==l);for(;t<o;){const o=To(e[t],i),g=To(e[t+1],i);if(t+=r,o==d&&g==p)continue;const _=d-s,u=p-l,c=o-s,y=g-l;if(_*y==u*c&&(0>_&&c<_||_==c||0<_&&c>_)&&(0>u&&y<u||u==y||0<u&&y>u)){d=o,p=g;continue}n[a++]=d,n[a++]=p,s=d,l=p,d=o,p=g}return n[a++]=d,n[a++]=p,a}function Co(e,t,o,r,n,a,s,l){for(let d=0,i=o.length;d<i;++d){const i=o[d];s=So(e,t,i,r,n,a,s),l.push(s),t=i}return s}function Ro(e,t,o,r,n,a,s,l){for(let d=0,i=o.length;d<i;++d){const i=o[d],p=[];s=Co(e,t,i,r,n,a,s,p),l.push(p),t=i[i.length-1]}return s}function Io(e,t,o,r,i){const n=je(i,function(i){return!Lo(e,t,o,r,i[0],i[1])});return!n}function Lo(e,t,o,r,i,n){let a=0,s=e[o-r],l=e[o-r+1];for(;t<o;t+=r){const o=e[t],r=e[t+1];l<=n?r>n&&0<(o-s)*(n-l)-(i-s)*(r-l)&&a++:r<=n&&0>(o-s)*(n-l)-(i-s)*(r-l)&&a--,s=o,l=r}return 0!=a}function Po(e,t,o,r,n,a){if(0===o.length)return!1;if(!Lo(e,t,o[0],r,n,a))return!1;for(let s=1,i=o.length;s<i;++s)if(Lo(e,o[s-1],o[s],r,n,a))return!1;return!0}function vo(e,t,o,r,n,a){if(0===o.length)return!1;for(let s=0,i=o.length;s<i;++s){const i=o[s];if(Po(e,t,i,r,n,a))return!0;t=i[i.length-1]}return!1}function Fo(e,t,o,r,n,a,s){let l,i,d,p,g,_,u;const c=n[a+1],y=[];for(let i=0,m=o.length;i<m;++i){const n=o[i];for(p=e[n-r],_=e[n-r+1],l=t;l<n;l+=r)g=e[l],u=e[l+1],(c<=_&&u<=c||_<=c&&c<=u)&&(d=(c-_)/(u-_)*(g-p)+p,y.push(d)),p=g,_=u}let m=NaN,h=-Infinity;for(y.sort(L),p=y[0],(l=1,i=y.length);l<i;++l){g=y[l];const i=od(g-p);i>h&&(d=(p+g)/2,Po(e,t,o,r,d,c)&&(m=d,h=i)),p=g}return isNaN(m)&&(m=n[a]),s?(s.push(m,c,h),s):[m,c,h]}function Oo(e,t,o,r,n){let a=[];for(let s=0,i=o.length;s<i;++s){const i=o[s];a=Fo(e,t,i,r,n,2*s,a),t=i[i.length-1]}return a}function wo(e,t,o,r,i,n){const a=[e[t],e[t+1]],s=[];for(let l;t+r<o;t+=r){if(s[0]=e[t+r],s[1]=e[t+r+1],l=i.call(n,a,s),l)return l;a[0]=s[0],a[1]=s[1]}return!1}function No(e,t,o,r,i){const n=Ye(Oe(),e,t,o,r);return!!et(i,n)&&(!!Pe(i,n)||!!(n[0]>=i[0]&&n[2]<=i[2])||!!(n[1]>=i[1]&&n[3]<=i[3])||wo(e,t,o,r,function(e,t){return it(i,e,t)}))}function Ao(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){if(No(e,t,o[a],r,n))return!0;t=o[a]}return!1}function bo(e,t,o,r,i){return!!No(e,t,o,r,i)||!!Lo(e,t,o,r,i[0],i[1])||!!Lo(e,t,o,r,i[0],i[3])||!!Lo(e,t,o,r,i[2],i[1])||!!Lo(e,t,o,r,i[2],i[3])}function Mo(e,t,o,r,n){if(!bo(e,t,o[0],r,n))return!1;if(1===o.length)return!0;for(let a=1,i=o.length;a<i;++a)if(Io(e,o[a-1],o[a],r,n))return!1;return!0}function Go(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a];if(Mo(e,t,i,r,n))return!0;t=i[i.length-1]}return!1}function Do(e,t,o,r){for(;t<o-r;){for(let n=0;n<r;++n){const i=e[t+n];e[t+n]=e[o-r+n],e[o-r+n]=i}t+=r,o-=r}}function ko(e,t,o,r){let i=0,n=e[o-r],a=e[o-r+1];for(;t<o;t+=r){const o=e[t],r=e[t+1];i+=(o-n)*(r+a),n=o,a=r}return 0<i}function Uo(e,t,o,r,i){const n=i!==void 0&&i;for(let a=0,s=o.length;a<s;++a){const i=o[a],s=ko(e,t,i,r);if(0===a){if(n&&s||!n&&!s)return!1;}else if(n&&!s||!n&&s)return!1;t=i}return!0}function Yo(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a)if(!Uo(e,t,o[a],r,n))return!1;return!0}function Bo(e,t,o,r,i){const n=i!==void 0&&i;for(let a=0,s=o.length;a<s;++a){const i=o[a],s=ko(e,t,i,r),l=0===a?n&&s||!n&&!s:n&&!s||!n&&s;l&&Do(e,t,i,r),t=i}return t}function jo(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a)t=Bo(e,t,o[a],r,n);return t}function Vo(e,t,o,r){const a=o?o:32,n=[];for(let s=0;s<a;++s)O(n,yt(e,t,2*$l*s/a,r));n.push(n[0],n[1]);const i=new Pg(null);return i.setFlatCoordinates(eg.XY,n,[n.length]),i}function zo(e){const t=e[0],o=e[1],r=e[2],i=e[3],n=[t,o,t,i,r,i,r,o,t,o],a=new Pg(null);return a.setFlatCoordinates(eg.XY,n,[n.length]),a}function Xo(e,t,o){const r=t?t:32,i=e.getStride(),n=e.getLayout(),a=new Pg(null,n),s=i*(r+1),l=Array(s);for(let r=0;r<s;r++)l[r]=0;const d=[l.length];return a.setFlatCoordinates(n,l,d),Wo(a,e.getCenter(),e.getRadius(),o),a}function Wo(e,t,o,r){const n=e.getFlatCoordinates(),i=e.getLayout(),a=e.getStride(),s=e.getEnds(),l=n.length/a-1,d=r?r:0;for(let s=0;s<=l;++s){const e=s*a,r=d+2*W(s,l)*$l/l;n[e]=t[0]+o*Jl(r),n[e+1]=t[1]+o*ql(r)}e.setFlatCoordinates(i,n,s)}function Ko(e){return void 0===e.extent?q:H(e.extent)}function Ho(e){let t,o,r;let i=e.minZoom===void 0?Fg:e.minZoom,n=e.maxZoom===void 0?28:e.maxZoom;const a=e.zoomFactor===void 0?2:e.zoomFactor;if(e.resolutions!==void 0){const a=e.resolutions;o=a[i],r=a[n]===void 0?a[a.length-1]:a[n],t=J(a)}else{const s=Nt(e.projection,'EPSG:3857'),l=s.getExtent(),d=l?ld($e(l),Ze(l)):360*rg[ig.DEGREES]/s.getMetersPerUnit(),p=d/Kp/1;o=e.maxResolution,o===void 0?o=p/nd(a,i):i=0,r=e.minResolution,r===void 0&&(e.maxZoom===void 0?r=p/268435456:e.maxResolution===void 0?r=p/nd(a,n):r=o/nd(a,n)),n=i+Ql(ad(o/r)/ad(a)),r=o/nd(a,n-i),t=Q(a,o,n-i)}return{constraint:t,maxResolution:o,minResolution:r,minZoom:i,zoomFactor:a}}function Zo(e){const t=!(e.enableRotation!==void 0)||e.enableRotation;if(t){const t=e.constrainRotation;return void 0===t||!0===t?oe():!1===t?ee:'number'==typeof t?te(t):ee}return $}function qo(e){return!(e.sourceCenter&&e.targetCenter&&!pe(e.sourceCenter,e.targetCenter))&&!(e.sourceResolution!==e.targetResolution)&&!(e.sourceRotation!==e.targetRotation)}function Jo(e,t){const o=document.createElement('CANVAS');return e&&(o.width=e),t&&(o.height=t),o.getContext('2d')}function Qo(e){let t=e.offsetWidth;const o=getComputedStyle(e);return t+=parseInt(o.marginLeft,10)+parseInt(o.marginRight,10),t}function $o(e){let t=e.offsetHeight;const o=getComputedStyle(e);return t+=parseInt(o.marginTop,10)+parseInt(o.marginBottom,10),t}function er(e,t){const o=t.parentNode;o&&o.replaceChild(e,t)}function tr(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function or(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function rr(){return Yg}function ir(){return Bg}function nr(e,t){let o;switch(e){case Ug.MAP_RENDERER:{o=Yg,o.push(t);break}case Ug.LAYER_RENDERER:{o=Bg,o.push(t);break}default:throw new Error('Unsupported plugin type: '+e);}}function ar(e,t){for(let o=0,r=t.length;o<r;++o)nr(e,t[o])}function sr(e,t,o){return void 0===o&&(o=[0,0]),o[0]=e[0]+2*t,o[1]=e[1]+2*t,o}function lr(e){return 0<e[0]&&0<e[1]}function dr(e,t,o){return void 0===o&&(o=[0,0]),o[0]=0|e[0]*t+.5,o[1]=0|e[1]*t+.5,o}function pr(e,t){return Array.isArray(e)?e:(void 0===t?t=[e,e]:t[0]=t[1]=e,t)}function gr(e){let t=null;void 0!==e.keyboardEventTarget&&(t='string'==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const o={},r=e.layers instanceof kg?e.layers:new kg({layers:e.layers});o[Up.LAYERGROUP]=r,o[Up.TARGET]=e.target,o[Up.VIEW]=void 0===e.view?new wg:e.view;let n;void 0===e.renderer?n=zg:(Array.isArray(e.renderer)?n=e.renderer:'string'==typeof e.renderer?n=[e.renderer]:k(!1,46),0<=n.indexOf('dom')&&(n=n.concat(zg)));let i;const a=rr();outer:for(let e=0,t=n.length;e<t;++e){const t=n[e];for(let e=0,o=a.length;e<o;++e){const o=a[e];if(o.handles(t)){i=o;break outer}}}if(!i)throw new Error('Unable to create a map renderer for types: '+n.join(', '));let s;void 0!==e.controls&&(Array.isArray(e.controls)?s=new ep(e.controls.slice()):(k(e.controls instanceof ep,47),s=e.controls));let l;void 0!==e.interactions&&(Array.isArray(e.interactions)?l=new ep(e.interactions.slice()):(k(e.interactions instanceof ep,48),l=e.interactions));let d;return void 0===e.overlays?d=new ep:Array.isArray(e.overlays)?d=new ep(e.overlays.slice()):(k(e.overlays instanceof ep,49),d=e.overlays),{controls:s,interactions:l,keyboardEventTarget:t,overlays:d,mapRendererPlugin:i,values:o}}function _r(e,t){return e.visible&&t>=e.minResolution&&t<e.maxResolution}function ur(e){this.updateElement_(e.frameState)}function cr(e){const t=e.frameState;if(t){const e=t.viewState.rotation;if(e!=this.rotation_){const t='rotate('+e+'rad)';if(this.autoHide_){const t=this.element.classList.contains(Hg);t||0!==e?t&&0!==e&&this.element.classList.remove(Hg):this.element.classList.add(Hg)}this.label_.style.msTransform=t,this.label_.style.webkitTransform=t,this.label_.style.transform=t}this.rotation_=e}}function yr(e){const t=e?e:{},o=new ep,r=void 0===t.zoom||t.zoom;r&&o.push(new s_(t.zoomOptions));const i=void 0===t.rotate||t.rotate;i&&o.push(new n_(t.rotateOptions));const n=void 0===t.attribution||t.attribution;return n&&o.push(new r_(t.attributionOptions)),o}function mr(e,t,o){const r=e.getCenter();if(r){const i=e.constrainCenter([r[0]+t[0],r[1]+t[1]]);o?e.animate({duration:o,easing:xe,center:i}):e.setCenter(i)}}function hr(e,t,o,r){t=e.constrainRotation(t,0),fr(e,t,o,r)}function fr(e,t,o,r){if(t!==void 0){const i=e.getRotation(),n=e.getCenter();i!==void 0&&n&&0<r?e.animate({rotation:t,anchor:o,duration:r,easing:fe}):e.rotate(t,o)}}function Er(e,t,o,r,i){t=e.constrainResolution(t,0,i),Tr(e,t,o,r)}function xr(e,t,o,r){const i=e.getResolution();let n=e.constrainResolution(i,t,0);if(n!==void 0){const t=e.getResolutions();n=U(n,e.getMinResolution()||t[t.length-1],e.getMaxResolution()||t[0])}if(o&&void 0!==n&&n!==i){const t=e.getCenter();let r=e.calculateCenterZoom(n,o);r=e.constrainCenter(r),o=[(n*t[0]-i*r[0])/(n-i),(n*t[1]-i*r[1])/(n-i)]}Tr(e,n,o,r)}function Tr(e,t,o,r){if(t){const i=e.getResolution(),n=e.getCenter();if(i!==void 0&&n&&t!==i&&r)e.animate({resolution:t,anchor:o,duration:r,easing:fe});else{if(o){const r=e.calculateCenterZoom(t,o);e.setCenter(r)}e.setResolution(t)}}}function Sr(e){let t=!1;const o=e.originalEvent;if(e.type==hp.DBLCLICK){const r=e.map,i=e.coordinate,n=o.shiftKey?-this.delta_:this.delta_,a=r.getView();xr(a,n,i,this.duration_),e.preventDefault(),t=!0}return!t}function Cr(e){const t=e.length;let o=0,r=0;for(let n=0;n<t;n++)o+=e[n].clientX,r+=e[n].clientY;return[o/t,r/t]}function Rr(e){const t=e.type;return t===hp.POINTERDOWN||t===hp.POINTERDRAG||t===hp.POINTERUP}function Ir(e){if(!(e instanceof Ep))return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==hp.POINTERDRAG)this.handleDragEvent_(e);else if(e.type==hp.POINTERUP){const t=this.handleUpEvent_(e);this.handlingDownUpSequence=t&&0<this.targetPointers.length}}else if(e.type==hp.POINTERDOWN){const o=this.handleDownEvent_(e);this.handlingDownUpSequence=o,t=this.shouldStopEvent(o)}else e.type==hp.POINTERMOVE&&this.handleMoveEvent_(e);return!t}function Lr(e){const t=this.targetPointers,o=Cr(t);if(t.length!=this.lastPointersCount_)this.kinetic_&&this.kinetic_.begin();else if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){const t=this.lastCentroid[0]-o[0],r=o[1]-this.lastCentroid[1],i=e.map,n=i.getView();let a=[t,r];_e(a,n.getResolution()),ge(a,n.getRotation()),ne(a,n.getCenter()),a=n.constrainCenter(a),n.setCenter(a)}this.lastCentroid=o,this.lastPointersCount_=t.length}function Pr(e){const t=e.map,o=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),i=o.getCenter(),n=t.getPixelFromCoordinate(i),a=t.getCoordinateFromPixel([n[0]-e*Jl(r),n[1]-e*ql(r)]);o.animate({center:o.constrainCenter(a),duration:500,easing:fe})}return o.setHint(Zp.INTERACTING,-1),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}function vr(e){if(0<this.targetPointers.length&&this.condition_(e)){const t=e.map,o=t.getView();return this.lastCentroid=null,this.handlingDownUpSequence||o.setHint(Zp.INTERACTING,1),o.getAnimating()&&o.setCenter(e.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=1<this.targetPointers.length,!0}return!1}function Fr(e){if(I_(e)){const t=e.map,o=t.getView();if(o.getConstraints().rotation!==$){const r=t.getSize(),i=e.pixel,n=Zl(r[1]/2-i[1],i[0]-r[0]/2);if(void 0!==this.lastAngle_){const e=n-this.lastAngle_,t=o.getRotation();fr(o,t-e)}this.lastAngle_=n}}}function wr(e){if(!I_(e))return!0;const t=e.map,o=t.getView();o.setHint(Zp.INTERACTING,-1);const r=o.getRotation();return hr(o,r,void 0,this.duration_),!1}function Nr(e){if(!I_(e))return!1;if(f_(e)&&this.condition_(e)){const t=e.map;return t.getView().setHint(Zp.INTERACTING,1),this.lastAngle_=void 0,!0}return!1}function Ar(e,t,o){const r=o[0]-t[0],i=o[1]-t[1];return r*r+i*i>=this.minArea_}function br(e){I_(e)&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new M_(b_.BOXDRAG,e.coordinate,e)))}function Mr(e){return!I_(e)||(this.box_.setMap(null),this.boxEndCondition_(e,this.startPixel_,e.pixel)&&(this.onBoxEnd(e),this.dispatchEvent(new M_(b_.BOXEND,e.coordinate,e))),!1)}function Gr(e){return!!I_(e)&&!!(f_(e)&&this.condition_(e))&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new M_(b_.BOXSTART,e.coordinate,e)),!0)}function Dr(e){let t=!1;if(e.type==zd.KEYDOWN){const o=e.originalEvent,r=o.keyCode;if(this.condition_(e)&&(r==Y_.DOWN||r==Y_.LEFT||r==Y_.RIGHT||r==Y_.UP)){const o=e.map,i=o.getView(),n=i.getResolution()*this.pixelDelta_;let a=0,s=0;r==Y_.DOWN?s=-n:r==Y_.LEFT?a=-n:r==Y_.RIGHT?a=n:s=n;const l=[a,s];ge(l,i.getRotation()),mr(i,l,this.duration_),e.preventDefault(),t=!0}}return!t}function kr(e){let t=!1;if(e.type==zd.KEYDOWN||e.type==zd.KEYPRESS){const o=e.originalEvent,r=o.charCode;if(this.condition_(e)&&(r==43||r==45)){const o=e.map,i=r==43?this.delta_:-this.delta_,n=o.getView();xr(n,i,void 0,this.duration_),e.preventDefault(),t=!0}}return!t}function Ur(e){if(!this.condition_(e))return!0;const t=e.type;if(t!==zd.WHEEL&&t!==zd.MOUSEWHEEL)return!0;e.preventDefault();const o=e.map,r=e.originalEvent;this.useAnchor_&&(this.lastAnchor_=e.coordinate);let i;if(e.type==zd.WHEEL?(i=r.deltaY,ap&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=pp),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)):e.type==zd.MOUSEWHEEL&&(i=-r.wheelDeltaY,sp&&(i/=3)),0===i)return!1;const n=Date.now();if(void 0===this.startTime_&&(this.startTime_=n),(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=4>od(i)?X_.TRACKPAD:X_.WHEEL),this.mode_===X_.TRACKPAD){const e=o.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):e.setHint(Zp.INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);let t=e.getResolution()*nd(2,i/this.trackpadDeltaPerZoom_);const r=e.getMinResolution(),a=e.getMaxResolution();let s=0;if(t<r?(t=ld(t,r/this.trackpadZoomBuffer_),s=1):t>a&&(t=rd(t,a*this.trackpadZoomBuffer_),s=-1),this.lastAnchor_){const o=e.calculateCenterZoom(t,this.lastAnchor_);e.setCenter(e.constrainCenter(o))}return e.setResolution(t),0==s&&this.constrainResolution_&&e.animate({resolution:e.constrainResolution(t,0<i?-1:1),easing:fe,anchor:this.lastAnchor_,duration:this.duration_}),0<s?e.animate({resolution:r,easing:fe,anchor:this.lastAnchor_,duration:500}):0>s&&e.animate({resolution:a,easing:fe,anchor:this.lastAnchor_,duration:500}),this.startTime_=n,!1}this.delta_+=i;const a=ld(this.timeout_-(n-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,o),a),!1}function Yr(e){let t=0;const o=this.targetPointers[0],r=this.targetPointers[1],i=Zl(r.clientY-o.clientY,r.clientX-o.clientX);if(void 0!==this.lastAngle_){const e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&od(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=i;const n=e.map,a=n.getView();if(a.getConstraints().rotation!==$){const e=n.getViewport().getBoundingClientRect(),o=Cr(this.targetPointers);if(o[0]-=e.left,o[1]-=e.top,this.anchor_=n.getCoordinateFromPixel(o),this.rotating_){const e=a.getRotation();n.render(),fr(a,e+t,this.anchor_)}}}function Br(e){if(2>this.targetPointers.length){const t=e.map,o=t.getView();if(o.setHint(Zp.INTERACTING,-1),this.rotating_){const e=o.getRotation();hr(o,e,this.anchor_,this.duration_)}return!1}return!0}function jr(e){if(2<=this.targetPointers.length){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().setHint(Zp.INTERACTING,1),!0}return!1}function Vr(e){let t=1;const o=this.targetPointers[0],r=this.targetPointers[1],i=o.clientX-r.clientX,n=o.clientY-r.clientY,a=id(i*i+n*n);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const s=e.map,l=s.getView(),d=l.getResolution(),p=l.getMaxResolution(),g=l.getMinResolution();let _=d*t;_>p?(t=p/d,_=p):_<g&&(t=g/d,_=g),1!=t&&(this.lastScaleDelta_=t);const u=s.getViewport().getBoundingClientRect(),c=Cr(this.targetPointers);c[0]-=u.left,c[1]-=u.top,this.anchor_=s.getCoordinateFromPixel(c),s.render(),Tr(l,_,this.anchor_)}function zr(e){if(2>this.targetPointers.length){const t=e.map,o=t.getView();o.setHint(Zp.INTERACTING,-1);const r=o.getResolution();if(this.constrainResolution_||r<o.getMinResolution()||r>o.getMaxResolution()){const e=this.lastScaleDelta_-1;Er(o,r,this.anchor_,this.duration_,e)}return!1}return!0}function Xr(e){if(2<=this.targetPointers.length){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().setHint(Zp.INTERACTING,1),!0}return!1}function Wr(e){const t=e?e:{},o=new ep,r=new d_(-.005,.05,100),i=void 0===t.altShiftDragRotate||t.altShiftDragRotate;i&&o.push(new N_);const n=void 0===t.doubleClickZoom||t.doubleClickZoom;n&&o.push(new c_({delta:t.zoomDelta,duration:t.zoomDuration}));const a=void 0===t.dragPan||t.dragPan;a&&o.push(new O_({kinetic:r}));const s=void 0===t.pinchRotate||t.pinchRotate;s&&o.push(new Z_);const l=void 0===t.pinchZoom||t.pinchZoom;l&&o.push(new J_({constrainResolution:t.constrainResolution,duration:t.zoomDuration}));const d=void 0===t.keyboard||t.keyboard;d&&(o.push(new j_),o.push(new z_({delta:t.zoomDelta,duration:t.zoomDuration})));const p=void 0===t.mouseWheelZoom||t.mouseWheelZoom;p&&o.push(new K_({constrainResolution:t.constrainResolution,duration:t.zoomDuration}));const g=void 0===t.shiftDragZoom||t.shiftDragZoom;return g&&o.push(new U_({duration:t.zoomDuration})),o}function Kr(){return Ru||(Ru=Jo(1,1)),Ru}function Hr(e,t){const o=Kr();return e!=o.font&&(o.font=e),o.measureText(t).width}function Zr(e,t,o,r){0!==t&&(e.translate(o,r),e.rotate(t),e.translate(-o,-r))}function qr(e,t,o,r,i,n,a,s,l,d,p){let g;1!=o&&(g=e.globalAlpha,e.globalAlpha=g*o),t&&e.setTransform.apply(e,t),e.drawImage(r,i,n,a,s,l,d,a*p,s*p),g&&(e.globalAlpha=g),t&&e.setTransform.apply(e,vu)}function Jr(e){return'string'==typeof e?e:oi(e)}function Qr(e){const t=document.createElement('div');if(t.style.color=e,''!==t.style.color){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}return''}function $r(e){return Array.isArray(e)?e:wu(e)}function ei(e){let t,o,r,i,a;if(Ou.exec(e)&&(e=Qr(e)),Fu.exec(e)){const s=e.length-1;let n=4>=s?1:2;const l=4==s||8==s;t=parseInt(e.substr(1+0*n,n),16),o=parseInt(e.substr(1+1*n,n),16),r=parseInt(e.substr(1+2*n,n),16),i=l?parseInt(e.substr(1+3*n,n),16):255,1==n&&(t=(t<<4)+t,o=(o<<4)+o,r=(r<<4)+r,l&&(i=(i<<4)+i)),a=[t,o,r,i/255]}else 0==e.indexOf('rgba(')?(a=e.slice(5,-1).split(',').map(Number),ti(a)):0==e.indexOf('rgb(')?(a=e.slice(4,-1).split(',').map(Number),a.push(1),ti(a)):k(!1,14);return a}function ti(e){return e[0]=U(0|e[0]+.5,0,255),e[1]=U(0|e[1]+.5,0,255),e[2]=U(0|e[2]+.5,0,255),e[3]=U(e[3],0,1),e}function oi(e){let t=e[0];t!=(0|t)&&(t=0|t+.5);let o=e[1];o!=(0|o)&&(o=0|o+.5);let r=e[2];r!=(0|r)&&(r=0|r+.5);const i=e[3]===void 0?1:e[3];return'rgba('+t+','+o+','+r+','+i+')'}function ri(e){return ii(e)?e:oi(e)}function ii(e){return'string'==typeof e||e instanceof CanvasPattern||e instanceof CanvasGradient}function ni(e,t,o){const r=o?Jr(o):'null';return t+':'+e+':'+r}function ai(){Xu.expire()}function si(e,t){return e.zIndex-t.zIndex}function li(e,t,o,r,i){return void 0===i?new qu(e,t,o,r):(i.minX=e,i.maxX=t,i.minY=o,i.maxY=r,i)}function di(e,t,o,r){let n=e[t],a=e[t+1],s=0;for(let l=t+r;l<o;l+=r){const t=e[l],o=e[l+1];s+=id((t-n)*(t-n)+(o-a)*(o-a)),n=t,a=o}return s}function pi(e,t,o,r,n,a,s,i){const l=[],d=e[t]>e[o-r],p=n.length;let g=e[t],_=e[t+1];t+=r;let u=e[t],c=e[t+1],m=0,h=id(nd(u-g,2)+nd(c-_,2)),f='',E=0,T,S,C;for(let R=0;R<p;++R){S=d?p-R-1:R;const I=n.charAt(S);f=d?I+f:f+I;const L=a(f)-E;E+=L;const P=s+L/2;for(;t<o-r&&m+h<P;)g=u,_=c,t+=r,u=e[t],c=e[t+1],m+=h,h=id(nd(u-g,2)+nd(c-_,2));const v=P-m;let F=Zl(c-_,u-g);if(d&&(F+=0<F?-$l:$l),void 0!==C){let e=F-C;if(e+=e>$l?-2*$l:e<-$l?2*$l:0,od(e)>i)return null}const O=v/h,w=K(g,u,O),x=K(_,c,O);C==F?(d&&(T[0]=w,T[1]=x,T[2]=L/2),T[4]=f):(f=I,E=L,T=[w,x,L/2,F,f],d?l.unshift(T):l.push(T),C=F),s+=L}return l}function gi(e,t,o,r,n){let a=o,s=o,l=0,d=0,p=o,g,_,i,u,c,y,m,h,f,E;for(_=o;_<r;_+=n){const o=t[_],r=t[_+1];void 0!==c&&(f=o-c,E=r-y,u=id(f*f+E*E),void 0!=m&&(d+=i,g=Xl((m*f+h*E)/(i*u)),g>e&&(d>l&&(l=d,a=p,s=_),d=0,p=_-n)),i=u,m=f,h=E),c=o,y=r}return d+=u,d>l?[p,_]:[a,s]}function _i(e,t,o){const r=t.length;let n=0;for(let a=0;a<r;++a){const r=Hr(e,t[a]);n=ld(n,r),o.push(r)}return n}function ui(e,t,o){let r;const i=Ql(e.length/2);if(t>=i)for(r=i;r<t;r++)e[r][o]=!0;else if(t<i)for(r=t+1;r<i;r++)e[r][o]=!0}function ci(e){if(void 0!==Ic[e])return Ic[e];const t=2*e+1,o=Array(t);for(let r=0;r<t;r++)o[r]=Array(t);for(let t=e,r=0,i=0;t>=r;)ui(o,e+t,e+r),ui(o,e+r,e+t),ui(o,e-r,e+t),ui(o,e-t,e+r),ui(o,e-t,e-r),ui(o,e-r,e-t),ui(o,e+r,e-t),ui(o,e+t,e-r),r++,i+=1+2*r,0<2*(i-t)+1&&(t-=1,i+=1-2*t);return Ic[e]=o,o}function yi(e,t,o){const r=Object.keys(e).map(Number).sort(L),n={};for(let i=0,a=r.length;i<a;++i){const a=e[r[i].toString()];for(let e=0,r=a.length;e<r;){const r=a[e++],i=a[e++];r.replay(t,i,o,n)}}}function mi(e,t){return n(e)-n(t)}function hi(e,t){const o=fi(e,t);return o*o}function fi(e,t){return Pc*e/t}function Ei(e,t,o,r,i,n){let a=!1;const s=o.getImage();if(s){let e=s.getImageState();e==tu.LOADED||e==tu.ERROR?s.unlistenImageChange(i,n):(e==tu.IDLE&&s.load(),e=s.getImageState(),s.listenImageChange(i,n),a=!0)}return xi(e,t,o,r),a}function xi(e,t,o,r){const i=o.getGeometryFunction()(t);if(i){const n=i.getSimplifiedGeometry(r),a=o.getRenderer();if(a)Ti(e,n,o,t);else{const r=vc[n.getType()];r(e,n,o,t)}}}function Ti(e,t,o,r){if(t.getType()==$p.GEOMETRY_COLLECTION){const n=t.getGeometries();for(let t=0,i=n.length;t<i;++t)Ti(e,n[t],o,r);return}const i=e.getReplay(o.getZIndex(),ic.DEFAULT);i.drawCustom(t,r,o.getRenderer())}function Si(e){let t;if('function'==typeof e)t=e;else{let o;Array.isArray(e)?o=e:(k(e instanceof Kc,41),o=[e]),t=function(){return o}}return t}function Ci(){if(!Hc){const e=new zc({color:'rgba(255,255,255,0.4)'}),t=new Wc({color:'#3399CC',width:1.25});Hc=[new Kc({image:new jc({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}return Hc}function Ri(){const e={},t=[255,255,255,1],o=[0,153,255,1],r=3;return e[$p.POLYGON]=[new Kc({fill:new zc({color:[255,255,255,.5]})})],e[$p.MULTI_POLYGON]=e[$p.POLYGON],e[$p.LINE_STRING]=[new Kc({stroke:new Wc({color:t,width:r+2})}),new Kc({stroke:new Wc({color:o,width:r})})],e[$p.MULTI_LINE_STRING]=e[$p.LINE_STRING],e[$p.CIRCLE]=e[$p.POLYGON].concat(e[$p.LINE_STRING]),e[$p.POINT]=[new Kc({image:new jc({radius:2*r,fill:new zc({color:o}),stroke:new Wc({color:t,width:r/2})}),zIndex:Infinity})],e[$p.MULTI_POINT]=e[$p.POINT],e[$p.GEOMETRY_COLLECTION]=e[$p.POLYGON].concat(e[$p.LINE_STRING],e[$p.POINT]),e}function Ii(e){return e.getGeometry()}function Li(e){if('function'==typeof e)return e;else{let t;return Array.isArray(e)?t=e:(k(e instanceof Zc,41),t=[e]),function(){return t}}}function Pi(e,r,t,a,o,i){let s=NaN,l=NaN;const d=(t-r)/a;if(1==d)s=e[r],l=e[r+1];else if(2==d)s=(1-o)*e[r]+o*e[r+a],l=(1-o)*e[r+1]+o*e[r+a+1];else if(0!=d){let n=e[r],d=e[r+1],p=0;const g=[0];for(let o=r+a;o<t;o+=a){const t=e[o],r=e[o+1];p+=id((t-n)*(t-n)+(r-d)*(r-d)),g.push(p),n=t,d=r}const i=o*p,_=I(g,i);if(0>_){const n=(i-g[-_-2])/(g[-_-1]-g[-_-2]),t=r+(-_-2)*a;s=K(e[t],e[t+a],n),l=K(e[t+1],e[t+a+1],n)}else s=e[r+_*a],l=e[r+_*a+1]}return i?(i[0]=s,i[1]=l,i):[s,l]}function vi(e,t,o,r,n,i){if(o==t)return null;let a;if(n<e[t+r-1])return i?(a=e.slice(t,t+r),a[r-1]=n,a):null;if(e[o-1]<n)return i?(a=e.slice(o-r,o),a[r-1]=n,a):null;if(n==e[t+r-1])return e.slice(t,t+r);let s=t/r,l=o/r;for(;s<l;){const t=s+l>>1;n<e[(t+1)*r-1]?l=t:s=t+1}const d=e[s*r-1];if(n==d)return e.slice((s-1)*r,(s-1)*r+r);const p=e[(s+1)*r-1];a=[];for(let l=0;l<r-1;++l)a.push(K(e[(s-1)*r+l],e[s*r+l],(n-d)/(p-d)));return a.push(n),a}function Fi(e,t,o,r,i,n,a){if(a)return vi(e,t,o[o.length-1],r,i,n);let s;if(i<e[r-1])return n?(s=e.slice(0,r),s[r-1]=i,s):null;if(e[e.length-1]<i)return n?(s=e.slice(e.length-r),s[r-1]=i,s):null;for(let s=0,l=o.length;s<l;++s){const n=o[s];if(t!=n){if(i<e[t+r-1])return null;if(i<=e[n-1])return vi(e,t,n,r,i,!1);t=n}}return null}function Oi(e,t,o){const r=[];let i=e(0),n=e(1),s=t(i),a=t(n);const l=[n,i],d=[a,s],p=[1,0],g={};for(let _=1e5,u,c,y,m,h,f;0<--_&&0<p.length;)y=p.pop(),i=l.pop(),s=d.pop(),f=y.toString(),f in g||(r.push(s[0],s[1]),g[f]=!0),m=p.pop(),n=l.pop(),a=d.pop(),h=(y+m)/2,u=e(h),c=t(u),B(c[0],c[1],s[0],s[1],a[0],a[1])<o?(r.push(a[0],a[1]),f=m.toString(),g[f]=!0):(p.push(m,h,h,y),d.push(a,c,c,s),l.push(n,u,u,i));return r}function wi(e,t,o,r,i){const n=vt('EPSG:4326');return Oi(function(r){return[e,t+(o-t)*r]},Dt(n,r),i)}function Ni(e,t,o,r,i){const n=vt('EPSG:4326');return Oi(function(r){return[t+(o-t)*r,e]},Dt(n,r),i)}function Ai(){const e=Jo(1,1);return e.fillStyle='rgba(0,0,0,0)',e.fillRect(0,0,1,1),e.canvas}function bi(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Mi(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}function Gi(e,t,o){const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),void 0!==t&&e.texParameteri(Cd,Td,t),void 0!==o&&e.texParameteri(Cd,Sd,o),r}function Di(e,t,o,r,i){const n=Gi(e,r,i);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,o,0,e.RGBA,e.UNSIGNED_BYTE,null),n}function ki(e,t,o,r){const i=Gi(e,o,r);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}function Ui(e,t,o,r){const i=o-r;return!!(e[t]===e[i]&&e[t+1]===e[i+1]&&3<(o-t)/r)&&!!to(e,t,o,r)}function Yi(e,t,o,r){return function(i,n,a){const s=new XMLHttpRequest;s.open('GET','function'==typeof e?e(i,n,a):e,!0),t.getType()==Ym.ARRAY_BUFFER&&(s.responseType='arraybuffer'),s.onload=function(){if(!s.status||200<=s.status&&300>s.status){const e=t.getType();let i;e==Ym.JSON||e==Ym.TEXT?i=s.responseText:e==Ym.XML?(i=s.responseXML,!i&&(i=new DOMParser().parseFromString(s.responseText,'application/xml'))):e==Ym.ARRAY_BUFFER&&(i=s.response),i?o.call(this,t.readFeatures(i,{featureProjection:a}),t.readProjection(i),t.getLastExtent()):r.call(this)}else r.call(this)}.bind(this),s.onerror=function(){r.call(this)}.bind(this),s.send()}}function Bi(e,t){return Yi(e,t,function(e){this.addFeatures(e)},T)}function ji(e,t){const o=Yi(t,e.getFormat(),e.onLoad.bind(e),e.onError.bind(e));e.setLoader(o)}function Vi(){const e=document.body;return!!(e.webkitRequestFullscreen||e.mozRequestFullScreen&&document.mozFullScreenEnabled||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)}function zi(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}function Xi(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function Wi(e){e.mozRequestFullScreenWithKeys?e.mozRequestFullScreenWithKeys():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):Xi(e)}function Ki(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function Hi(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null,this.updateHTML_(this.lastMouseMovePixel_)}function Zi(){this.validateExtent_(),this.updateBox_()}function qi(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}function Ji(e){if(e.frameState){this.sliderInitialized_||this.initSlider_();const t=e.frameState.viewState.resolution;t!==this.currentResolution_&&(this.currentResolution_=t,this.setThumbPosition_(t))}}function Qi(e,t,o){const r=o?vt(o.featureProjection):null,i=o?vt(o.dataProjection):null;let n;if(n=r&&i&&!Mt(r,i)?e instanceof xg?(t?e.clone():e).transform(t?r:i,t?i:r):Ut(e,i,r):e,t&&o&&void 0!==o.decimals){const t=nd(10,o.decimals);n===e&&(n=n.clone()),n.applyTransform(function(e){for(let o=0,r=e.length;o<r;++o)e[o]=Wl(e[o]*t)/t;return e})}return n}function $i(e){if('string'==typeof e){const t=JSON.parse(e);return t?t:null}return null===e?null:e}function en(e,t,o,r){const n=[];let a=Oe();for(let s=0,i=o.length;s<i;++s){const i=o[s];a=Me(e,t,i[0],r),n.push((a[0]+a[2])/2,(a[1]+a[3])/2),t=i[i.length-1]}return n}function tn(e,t){if(!e)return null;let o;if('number'==typeof e.x&&'number'==typeof e.y)o=$p.POINT;else if(e.points)o=$p.MULTI_POINT;else if(e.paths)o=1===e.paths.length?$p.LINE_STRING:$p.MULTI_LINE_STRING;else if(e.rings){const t=rn(e),r=on(e.rings,t);e=Dd({},e),1===r.length?(o=$p.POLYGON,e.rings=r[0]):(o=$p.MULTI_POLYGON,e.rings=r)}const r=yh[o];return Qi(r(e),!1,t)}function on(e,t){const o=[],r=[],n=[];let a,i;for(a=0,i=e.length;a<i;++a){o.length=0,uo(o,0,e[a],t.length);const i=ko(o,0,o.length,t.length);i?r.push([e[a]]):n.push(e[a])}for(;n.length;){const e=n.shift();let t=!1;for(a=r.length-1;0<=a;a--){const o=r[a][0],i=Pe(new Rg(o).getExtent(),new Rg(e).getExtent());if(i){r[a].push(e),t=!0;break}}t||r.push([e.reverse()])}return r}function rn(e){let t=eg.XY;return!0===e.hasZ&&!0===e.hasM?t=eg.XYZM:!0===e.hasZ?t=eg.XYZ:!0===e.hasM&&(t=eg.XYM),t}function nn(e){const t=e.getLayout();return{hasZ:t===eg.XYZ||t===eg.XYZM,hasM:t===eg.XYM||t===eg.XYZM}}function an(e,t){const o=mh[e.getType()];return o(Qi(e,!0,t),t)}function sn(e,t){return fh.createElementNS(e,t)}function ln(e,t){return dn(e,t,[]).join('')}function dn(e,t,o){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?o.push((e.nodeValue+'').replace(/(\r\n|\r|\n)/g,'')):o.push(e.nodeValue);else{let r;for(r=e.firstChild;r;r=r.nextSibling)dn(r,t,o)}return o}function pn(e){return e instanceof Document}function gn(e){return e instanceof Node}function _n(e,t,o){return e.getAttributeNS(t,o)||''}function un(e){return new DOMParser().parseFromString(e,'application/xml')}function cn(e,t){return function(o,r){const i=e.call(t,o,r);if(i!==void 0){const e=r[r.length-1];O(e,i)}}}function yn(e,t){return function(o,r){const i=e.call(t===void 0?this:t,o,r);if(i!==void 0){const e=r[r.length-1];e.push(i)}}}function mn(e,t){return function(o,r){const i=e.call(t===void 0?this:t,o,r);i!==void 0&&(r[r.length-1]=i)}}function hn(e,t,o){return function(r,i){const n=e.call(o===void 0?this:o,r,i);if(n!==void 0){const e=i[i.length-1],o=t===void 0?r.localName:t;let a;a=o in e?e[o]:e[o]=[],a.push(n)}}}function fn(e,t,o){return function(r,i){const n=e.call(o===void 0?this:o,r,i);if(n!==void 0){const e=i[i.length-1],o=t===void 0?r.localName:t;e[o]=n}}}function En(e,t){return function(o,r,i){e.call(t===void 0?this:t,o,r,i);const n=i[i.length-1],a=n.node;a.appendChild(o)}}function xn(e){let t,o;return function(r,i,n){if(t===void 0){t={};const i={};i[r.localName]=e,t[r.namespaceURI]=i,o=Tn(r.localName)}Ln(t,o,i,n)}}function Tn(e,t){const o=e;return function(e,r,i){const n=r[r.length-1],a=n.node;let s=o;void 0===s&&(s=i);let l=t;return void 0===t&&(l=a.namespaceURI),sn(l,s)}}function Sn(e,t){const o=t.length,r=Array(o);for(let n=0;n<o;++n)r[n]=e[t[n]];return r}function Cn(e,t,o){const r=o===void 0?{}:o;let n,i;for(n=0,i=e.length;n<i;++n)r[e[n]]=t;return r}function Rn(e,t,o,r){let i;for(i=t.firstElementChild;i;i=i.nextElementSibling){const t=e[i.namespaceURI];if(t!==void 0){const e=t[i.localName];e!==void 0&&e.call(r,i,o)}}}function In(e,t,o,r,i){return r.push(e),Rn(t,o,r,i),r.pop()}function Ln(e,t,o,r,n,a){const s=(n===void 0?o:n).length;let l,d;for(let p=0;p<s;++p)l=o[p],void 0!==l&&(d=t.call(a,l,r,void 0===n?void 0:n[p]),void 0!==d&&e[d.namespaceURI][d.localName].call(a,d,l,r))}function Pn(e,t,o,r,i,n,a){return i.push(e),Ln(t,o,r,i,n,a),i.pop()}function vn(e){const t=ln(e,!1);return Fn(t)}function Fn(e){const t=/^\s*(true|1)|(false|0)\s*$/.exec(e);return t?void 0!==t[1]||!1:void 0}function On(e){const t=ln(e,!1),o=Date.parse(t);return isNaN(o)?void 0:o/1e3}function wn(e){const t=ln(e,!1);return Nn(t)}function Nn(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);return t?parseFloat(t[1]):void 0}function An(e){const t=ln(e,!1);return bn(t)}function bn(e){const t=/^\s*(\d+)\s*$/.exec(e);return t?parseInt(t[1],10):void 0}function Mn(e){return ln(e,!1).trim()}function Gn(e,t){Yn(e,t?'1':'0')}function Dn(e,t){e.appendChild(fh.createCDATASection(t))}function kn(e,t){const o=t.toPrecision();e.appendChild(fh.createTextNode(o))}function Un(e,t){const o=t.toString();e.appendChild(fh.createTextNode(o))}function Yn(e,t){e.appendChild(fh.createTextNode(t))}function Bn(e,t){const o=e.getGeometry();if(o){const e=of[o.getType()];if(e){const o=t[t.length-1].node;return sn(o.namespaceURI,e)}}}function jn(e,t,o,r){return e.push(parseFloat(o.getAttribute('lon')),parseFloat(o.getAttribute('lat'))),'ele'in r?(e.push(r.ele),delete r.ele,t.hasZ=!0):e.push(0),'time'in r?(e.push(r.time),delete r.time,t.hasM=!0):e.push(0),e}function Vn(e,t,o){let r=eg.XY,n=2;if(e.hasZ&&e.hasM?(r=eg.XYZM,n=4):e.hasZ?(r=eg.XYZ,n=3):e.hasM&&(r=eg.XYM,n=3),4!=n){for(let o=0,r=t.length/4;o<r;o++)t[o*n]=t[4*o],t[o*n+1]=t[4*o+1],e.hasZ&&(t[o*n+2]=t[4*o+2]),e.hasM&&(t[o*n+2]=t[4*o+3]);if(t.length=t.length/4*n,o)for(let e=0,t=o.length;e<t;e++)o[e]=o[e]/4*n}return r}function zn(e,t){const o=t[t.length-1],r=e.getAttribute('href');null!==r&&(o.link=r),Rn(kh,e,t)}function Xn(e,t){const o=t[t.length-1];o.extensionsNode_=e}function Wn(e,t){const o=t[0],r=In({flatCoordinates:[],layoutOptions:{}},Uh,e,t);if(r){const e=r.flatCoordinates;delete r.flatCoordinates;const t=r.layoutOptions;delete r.layoutOptions;const i=Vn(t,e),n=new ty(null);n.setFlatCoordinates(i,e),Qi(n,!1,o);const a=new Jc(n);return a.setProperties(r),a}}function Kn(e,t){const o=t[0],r=In({flatCoordinates:[],ends:[],layoutOptions:{}},Bh,e,t);if(r){const e=r.flatCoordinates;delete r.flatCoordinates;const t=r.ends;delete r.ends;const i=r.layoutOptions;delete r.layoutOptions;const n=Vn(i,e,t),a=new ph(null);a.setFlatCoordinates(n,e,t),Qi(a,!1,o);const s=new Jc(a);return s.setProperties(r),s}}function Hn(e,t){const o=t[0],r=In({},zh,e,t);if(r){const t={},i=jn([],t,e,r),n=Vn(t,i),a=new Lg(i,n);Qi(a,!1,o);const s=new Jc(a);return s.setProperties(r),s}}function Zn(e,t,o){e.setAttribute('href',t);const r=o[o.length-1],i=r.properties,n=[i.linkText,i.linkType];Pn({node:e},Wh,xh,n,o,Xh)}function qn(e,t,o){const r=o[o.length-1],i=r.node,n=i.namespaceURI,a=r.properties;e.setAttributeNS(null,'lat',t[1]),e.setAttributeNS(null,'lon',t[0]);const s=r.geometryLayout;switch(s){case eg.XYZM:0!==t[3]&&(a.time=t[3]);case eg.XYZ:0!==t[2]&&(a.ele=t[2]);break;case eg.XYM:0!==t[2]&&(a.time=t[2]);break;default:}const l='rtept'==e.nodeName?Zh[n]:ef[n],d=Sn(a,l);Pn({node:e,properties:a},tf,xh,d,o,l)}function Jn(e){const t=[];for(let o=0,r=e.length;o<r;++o)t.push(e[o].clone());return t}function Qn(e,t){if(!e)return null;const o=lf[e.type];return Qi(o(e),!1,t)}function $n(e,t){const o=df[e.getType()];return o(Qi(e,!0,t),t)}function ea(e){return'string'==typeof e?e:''}function ta(e,t,o,r,i,n){let a=Xu.get(t,r,n);return a||(a=new Ef(e,t,o,r,i,n),Xu.set(t,r,n,a)),a}function oa(){Ff=[255,255,255,1],Cf=new zc({color:Ff}),Of=[20,2],wf=ff.PIXELS,Nf=ff.PIXELS,Af=[64,64],bf='https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png',Mf=.5,Rf=new Sf({anchor:Of,anchorOrigin:xf.BOTTOM_LEFT,anchorXUnits:wf,anchorYUnits:Nf,crossOrigin:'anonymous',rotation:0,scale:Mf,size:Af,src:bf}),Gf='NO_IMAGE',If=new Wc({color:Ff,width:1}),Df=new Wc({color:[51,51,51,1],width:2}),Lf=new ry({font:'bold 16px Helvetica',fill:Cf,stroke:Df,scale:.8}),Pf=new Zc({fill:Cf,image:Rf,text:Lf,stroke:If,zIndex:0}),vf=[Pf]}function ra(e,t){let o=null;const r=[0,0];let i='start';if(e.getImage()){let t=e.getImage().getImageSize();if(null===t&&(t=Af),2==t.length){const o=e.getImage().getScale();r[0]=o*t[0]/2,r[1]=-o*t[1]/2,i='left'}}if(null!==e.getText()){const t=e.getText();o=t.clone(),o.setFont(t.getFont()||Lf.getFont()),o.setScale(t.getScale()||Lf.getScale()),o.setFill(t.getFill()||Lf.getFill()),o.setStroke(t.getStroke()||Df)}else o=Lf.clone();o.setText(t),o.setOffsetX(r[0]),o.setOffsetY(r[1]),o.setTextAlign(i);const n=new Zc({text:o});return n}function ia(e,t,o,r,i){return function(n){let a=i,s='',l;if(a){const e=n.getGeometry();e&&(a=e.getType()===$p.POINT)}if(a&&(s=n.get('name'),a=a&&s),e)return a?(l=ra(e[0],s),e.concat(l)):e;if(t){const e=na(t,o,r);return a?(l=ra(e[0],s),e.concat(l)):e}return a?(l=ra(o[0],s),o.concat(l)):o}}function na(e,t,o){return Array.isArray(e)?e:'string'==typeof e?(!(e in o)&&'#'+e in o&&(e='#'+e),na(o[e],t,o)):t}function aa(e){const t=ln(e,!1),o=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(o){const e=o[1];return[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]}}function sa(e){let t=ln(e,!1);const o=[],r=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;for(let i;i=r.exec(t);){const e=parseFloat(i[1]),r=parseFloat(i[2]),n=i[3]?parseFloat(i[3]):0;o.push(e,r,n),t=t.substr(i[0].length)}return''===t?o:void 0}function la(e){const t=ln(e,!1).trim();let o=e.baseURI;if(o&&'about:blank'!=o||(o=window.location.href),o){const e=new URL(t,o);return e.href}return t}function da(e){return wn(e)}function pa(e,t){return In(void 0,jf,e,t)}function ga(e,t){const o=In({},Vf,e,t);if(!o)return;const r=t[t.length-1],i='Icon'in o?o.Icon:{},n=!('Icon'in o)||0<Object.keys(i).length;let a;const s=i.href;s?a=s:n&&(a=bf);let l=xf.BOTTOM_LEFT,d,p,g;const _=o.hotSpot;_?(d=[_.x,_.y],p=_.xunits,g=_.yunits,l=_.origin):a===bf?(d=Of,p=wf,g=Nf):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(d=[.5,0],p=ff.FRACTION,g=ff.FRACTION);let u;const c=i.x,m=i.y;c!==void 0&&m!==void 0&&(u=[c,m]);let y;const f=i.w,E=i.h;f!==void 0&&E!==void 0&&(y=[f,E]);let h;const x=o.heading;x!==void 0&&(h=X(x));let T=o.scale;if(n){a==bf&&(y=Af,T===void 0&&(T=Mf));const e=new Sf({anchor:d,anchorOrigin:l,anchorXUnits:p,anchorYUnits:g,crossOrigin:'anonymous',offset:u,offsetOrigin:xf.BOTTOM_LEFT,rotation:h,scale:T,size:y,src:a});r.imageStyle=e}else r.imageStyle=Gf}function _a(e,t){const o=In({},zf,e,t);if(o){const e=t[t.length-1],r=new ry({fill:new zc({color:'color'in o?o.color:Ff}),scale:o.scale});e.textStyle=r}}function ua(e,t){const o=In({},Xf,e,t);if(o){const e=t[t.length-1],r=new Wc({color:'color'in o?o.color:Ff,width:'width'in o?o.width:1});e.strokeStyle=r}}function ca(e,t){const o=In({},Wf,e,t);if(o){const e=t[t.length-1],r=new zc({color:'color'in o?o.color:Ff});e.fillStyle=r;const i=o.fill;void 0!==i&&(e.fill=i);const n=o.outline;void 0!==n&&(e.outline=n)}}function ya(e,t){return In(null,Kf,e,t)}function ma(e,t){const o=In({flatCoordinates:[],whens:[]},Zf,e,t);if(o){const e=o.flatCoordinates,t=o.whens;for(let o=0,r=rd(e.length,t.length);o<r;++o)e[4*o+3]=t[o];const r=new ty(null);return r.setFlatCoordinates(eg.XYZM,e),r}}function ha(e,t){return In(null,Jf,e,t)}function fa(e,t){const o=In({},Qf,e,t),r=ha(e,t);if(r){const e=new ty(null);return e.setFlatCoordinates(eg.XYZ,r),e.setProperties(o),e}}function Ea(e,t){const o=In({},Qf,e,t),r=ha(e,t);if(r){const e=new vg(null);return e.setFlatCoordinates(eg.XYZ,r,[r.length]),e.setProperties(o),e}}function xa(e,t){const o=In([],$f,e,t);if(!o)return null;if(0===o.length)return new af(o);let r=!0,i;const n=o[0].getType();let a;for(let s=1,i=o.length;s<i;++s)if(a=o[s],a.getType()!=n){r=!1;break}if(r){let e,t;if(n==$p.POINT){const r=o[0];e=r.getLayout(),t=r.getFlatCoordinates();for(let e=1,r=o.length;e<r;++e)a=o[e],O(t,a.getFlatCoordinates());i=new _h(null),i.setFlatCoordinates(e,t),Ra(i,o)}else n==$p.LINE_STRING?(i=new ph(null),i.setLineStrings(o),Ra(i,o)):n==$p.POLYGON?(i=new ch(null),i.setPolygons(o),Ra(i,o)):n==$p.GEOMETRY_COLLECTION?i=new af(o):k(!1,37)}else i=new af(o);return i}function Ta(e,t){const o=In({},Qf,e,t),r=ha(e,t);if(r){const e=new Lg(null);return e.setFlatCoordinates(eg.XYZ,r),e.setProperties(o),e}}function Sa(e,t){const o=In({},Qf,e,t),r=In([null],eE,e,t);if(r&&r[0]){const e=new vg(null),t=r[0],n=[t.length];for(let e=1,o=r.length;e<o;++e)O(t,r[e]),n.push(t.length);return e.setFlatCoordinates(eg.XYZ,t,n),e.setProperties(o),e}}function Ca(e,t){const o=In({},tE,e,t);if(!o)return null;let r='fillStyle'in o?o.fillStyle:Cf;const i=o.fill;void 0===i||i||(r=null);let n='imageStyle'in o?o.imageStyle:Rf;n==Gf&&(n=void 0);const a='textStyle'in o?o.textStyle:Lf;let s='strokeStyle'in o?o.strokeStyle:If;const l=o.outline;return void 0===l||l||(s=null),[new Zc({fill:r,image:n,stroke:s,text:a,zIndex:void 0})]}function Ra(e,t){const o=t.length,r=Array(t.length),n=Array(t.length),a=Array(t.length);let s,l,d;s=l=d=!1;for(let p=0;p<o;++p){const e=t[p];r[p]=e.get('extrude'),n[p]=e.get('tessellate'),a[p]=e.get('altitudeMode'),s=s||r[p]!==void 0,l=l||n[p]!==void 0,d=d||a[p]}s&&e.set('extrude',r),l&&e.set('tessellate',n),d&&e.set('altitudeMode',a)}function Ia(e,t){Rn(rE,e,t)}function La(e,t){Rn(iE,e,t)}function Pa(e,t){const o=$r(t),r=4==o.length?o[3]:1,n=[255*r,o[2],o[1],o[0]];for(let o=0;4>o;++o){const e=parseInt(n[o],10).toString(16);n[o]=1==e.length?'0'+e:e}Yn(e,n.join(''))}function va(e,t,o){const r=t.getType();let i,n;r==$p.GEOMETRY_COLLECTION?(i=t.getGeometries(),n=vE):r==$p.MULTI_POINT?(i=t.getPoints(),n=FE):r==$p.MULTI_LINE_STRING?(i=t.getLineStrings(),n=OE):r==$p.MULTI_POLYGON?(i=t.getPolygons(),n=NE):k(!1,39),Pn({node:e},AE,n,i,o)}function Fa(e,t,o){Pn({node:e},bE,wE,[t],o)}function Oa(e,t,o){const r={node:e};t.getId()&&e.setAttribute('id',t.getId());const i=t.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;const a=Object.keys(i||{}).sort().filter(function(e){return!n[e]});if(0<a.length){const e=Sn(i,a);Pn(r,ME,DE,[{names:a,values:e}],o)}const s=t.getStyleFunction();if(s){const e=s(t,0);if(e){const t=Array.isArray(e)?e[0]:e;this.writeStyles_&&(i.Style=t);const o=t.getText();o&&(i.name=o.getText())}}const l=o[o.length-1].node,d=GE[l.namespaceURI],p=Sn(i,d);Pn(r,ME,xh,p,o,d);const g=o[0];let _=t.getGeometry();_&&(_=Qi(_,!0,g)),Pn(r,ME,vE,[_],o)}function wa(e,t,o){const r=t.getFlatCoordinates(),i={node:e};i.layout=t.getLayout(),i.stride=t.getStride();const n=t.getProperties();n.coordinates=r;const a=o[o.length-1].node,s=kE[a.namespaceURI],l=Sn(n,s);Pn(i,UE,xh,l,o,s)}function Na(e,t,o){const r=t.getLinearRings(),i=r.shift(),n={node:e};Pn(n,YE,BE,r,o),Pn(n,YE,jE,[i],o)}function Aa(e,t){kn(e,Wl(1e6*t)/1e6)}function ba(e,t,o){if(3===e){const e={keys:[],values:[],features:[]},r=o.readVarint()+o.pos;o.readFields(Ma,e,r),e.length=e.features.length,e.length&&(t[e.name]=e)}}function Ma(e,t,o){if(15===e)t.version=o.readVarint();else if(1===e)t.name=o.readString();else if(5===e)t.extent=o.readVarint();else if(2===e)t.features.push(o.pos);else if(3===e)t.keys.push(o.readString());else if(4===e){let r=null;for(const t=o.readVarint()+o.pos;o.pos<t;)e=o.readVarint()>>3,r=1===e?o.readString():2===e?o.readFloat():3===e?o.readDouble():4===e?o.readVarint64():5===e?o.readVarint():6===e?o.readSVarint():7===e?o.readBoolean():null;t.values.push(r)}}function Ga(e,t,o){if(1==e)t.id=o.readVarint();else if(2==e)for(const e=o.readVarint()+o.pos;o.pos<e;){const e=t.layer.keys[o.readVarint()],r=t.layer.values[o.readVarint()];t.properties[e]=r}else 3==e?t.type=o.readVarint():4==e&&(t.geometry=o.pos)}function Da(e,t,o){e.pos=t.features[o];const r=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};return e.readFields(Ga,i,r),i}function ka(e,t){let o;return 1===e?o=1===t?$p.POINT:$p.MULTI_POINT:2===e?o=1===t?$p.LINE_STRING:$p.MULTI_LINE_STRING:3==e&&(o=$p.POLYGON),o}function Ua(e,t){const o=t[t.length-1];o.tags[e.getAttribute('k')]=e.getAttribute('v')}function Ya(e,t,o,r,i,n){let a,s;void 0===i?(a=[],s=0):(a=i,s=void 0===n?0:n);for(let l=t;l<o;){const t=e[l++];a[s++]=e[l++],a[s++]=t;for(let t=2;t<r;++t)a[s++]=e[l++]}return a.length=s,a}function Ba(e,t,o){const r=o?o:1e5;let n;const a=Array(t);for(n=0;n<t;++n)a[n]=0;for(let r=0,i=e.length;r<i;)for(n=0;n<t;++n,++r){const t=e[r],o=t-a[n];a[n]=t,e[r]=o}return Va(e,r)}function ja(e,t,o){const r=o?o:1e5;let n;const a=Array(t);for(n=0;n<t;++n)a[n]=0;const s=za(e,r);for(let r=0,i=s.length;r<i;)for(n=0;n<t;++n,++r)a[n]+=s[r],s[r]=a[n];return s}function Va(e,t){const o=t?t:1e5;for(let r=0,i=e.length;r<i;++r)e[r]=Wl(e[r]*o);return Xa(e)}function za(e,t){const o=t?t:1e5,r=Wa(e);for(let n=0,i=r.length;n<i;++n)r[n]/=o;return r}function Xa(e){for(let t=0,o=e.length;t<o;++t){const o=e[t];e[t]=0>o?~(o<<1):o<<1}return Ka(e)}function Wa(e){const t=Ha(e);for(let o=0,r=t.length;o<r;++o){const e=t[o];t[o]=1&e?~(e>>1):e>>1}return t}function Ka(e){let t='';for(let o=0,r=e.length;o<r;++o)t+=Za(e[o]);return t}function Ha(e){const t=[];let o=0,r=0;for(let n=0,i=e.length;n<i;++n){const i=e.charCodeAt(n)-63;o|=(31&i)<<r,32>i?(t.push(o),o=0,r=0):r+=5}return t}function Za(e){let t='',o;for(;32<=e;)o=(32|31&e)+63,t+=zl(o),e>>=5;return o=e+63,t+=zl(o),t}function qa(e,t){const o=[];let r,n;for(let a=0,i=e.length;a<i;++a)r=e[a],0<a&&o.pop(),n=0<=r?t[r]:t[~r].slice().reverse(),o.push.apply(o,n);for(let r=0,i=o.length;r<i;++r)o[r]=o[r].slice();return o}function Ja(e,t,o,r,n,a,s){const l=e.geometries,d=[];for(let p=0,i=l.length;p<i;++p)d[p]=Qa(l[p],t,o,r,n,a,s);return d}function Qa(e,t,o,r,i,n,a){let s;const l=e.type,d=lx[l];s='Point'===l||'MultiPoint'===l?d(e,o,r):d(e,t);const p=new Jc;p.setGeometry(Qi(s,!1,a)),void 0!==e.id&&p.setId(e.id);let g=e.properties;return i&&(!g&&(g={}),g[i]=n),g&&p.setProperties(g),p}function $a(e,t,o){for(let r=0,i=e.length;r<i;++r)es(e[r],t,o)}function es(e,t,o){let r=0,n=0;for(let a=0,i=e.length;a<i;++a){const i=e[a];r+=i[0],n+=i[1],i[0]=r,i[1]=n,ts(i,t,o)}}function ts(e,t,o){e[0]=e[0]*t[0]+o[0],e[1]=e[1]*t[1]+o[1]}function os(){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(cx,e))}function rs(e,t,o){return new mx(e,t,o)}function is(e,t){const o=sn(eT,'Filter'),r=sn(eT,'FeatureId');o.appendChild(r),r.setAttribute('fid',t),e.appendChild(o)}function ns(e,t){e=e?e:Qx;const o=e+':';return 0===t.indexOf(o)?t:o+t}function as(e,t,o){Pn({node:e},_T,Tn(t.getTagName()),[t],o)}function ss(e,t,o){const r={node:e},n=t.conditions;for(let a=0,i=n.length;a<i;++a){const e=n[a];Pn(r,_T,Tn(e.getTagName()),[e],o)}}function ls(e,t){t.matchCase!==void 0&&e.setAttribute('matchCase',t.matchCase.toString()),ps(e,t.propertyName),gs(e,''+t.expression)}function ds(e,t,o){const r=sn(eT,e);Yn(r,o),t.appendChild(r)}function ps(e,t){ds('PropertyName',e,t)}function gs(e,t){ds('Literal',e,t)}function _s(e,t){const o=sn(Ch,'TimeInstant');e.appendChild(o);const r=sn(Ch,'timePosition');o.appendChild(r),Yn(r,t)}function us(e,t,o){const r=o[o.length-1],i=Dd({},r);i.node=e,Pn(i,_T,Tn('Query'),t,o)}function cs(e){const t=e.getCoordinates();return 0===t.length?'':t.join(' ')}function ys(e){const t=e.getCoordinates(),o=[];for(let r=0,i=t.length;r<i;++r)o.push(t[r].join(' '));return o.join(',')}function ms(e){const t=[],o=e.getLinearRings();for(let r=0,i=o.length;r<i;++r)t.push('('+ys(o[r])+')');return t.join(',')}function hs(e){const t=e.getLayout();let o='';return(t===eg.XYZ||t===eg.XYZM)&&(o+=cT),(t===eg.XYM||t===eg.XYZM)&&(o+=Z),o}function fs(e){let t=e.getType();const o=fT[t],r=o(e);if(t=t.toUpperCase(),e instanceof Sg){const o=hs(e);0<o.length&&(t+=' '+o)}return 0===r.length?t+' '+uT:t+'('+r+')'}function Es(e){return e.getAttributeNS(TT,'href')}function xs(e,t){return In({},BT,e,t)}function Ts(e,t){return In({},DT,e,t)}function Ss(e,t){const o=xs(e,t);if(o){const t=[bn(e.getAttribute('width')),bn(e.getAttribute('height'))];return o.size=t,o}}function Cs(e,t){return In([],jT,e,t)}function Rs(e){const t=Mn(e).split(' ');if(t&&2==t.length){const e=+t[0],o=+t[1];return isNaN(e)||isNaN(o)?void 0:[e,o]}}function Is(e){const t=e.dataTransfer.files;for(let o=0,r=t.length;o<r;++o){const e=t.item(o),r=new FileReader;r.addEventListener(zd.LOAD,this.handleResult_.bind(this,e)),r.readAsText(e)}}function Ls(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect='copy'}function Ps(e){if(I_(e)){const t=e.map,o=t.getSize(),r=e.pixel,i=r[0]-o[0]/2,n=o[1]/2-r[1],a=Zl(n,i),s=id(i*i+n*n),l=t.getView();if(l.getConstraints().rotation!==$&&void 0!==this.lastAngle_){const e=a-this.lastAngle_;fr(l,l.getRotation()-e)}if(this.lastAngle_=a,void 0!==this.lastMagnitude_){const e=this.lastMagnitude_*(l.getResolution()/s);Tr(l,e)}void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/s),this.lastMagnitude_=s}}function vs(e){if(!I_(e))return!0;const t=e.map,o=t.getView();o.setHint(Zp.INTERACTING,-1);const r=this.lastScaleDelta_-1;return hr(o,o.getRotation()),Er(o,o.getResolution(),void 0,this.duration_,r),this.lastScaleDelta_=0,!1}function Fs(e){return!!I_(e)&&!!this.condition_(e)&&(e.map.getView().setHint(Zp.INTERACTING,1),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0)}function Os(){return[[-Infinity,-Infinity,Infinity,Infinity]]}function ws(){const e=Ri();return function(t){return e[t.getGeometry().getType()]}}function Ns(e){e.originalEvent.type===zd.CONTEXTMENU&&e.preventDefault(),this.freehand_=this.mode_!==MS.POINT&&this.freehandCondition_(e);let t=e.type===hp.POINTERMOVE,o=!0;if(this.lastDragTime_&&e.type===hp.POINTERDRAG){const o=Date.now();o-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)}return this.freehand_&&e.type===hp.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e),o=!1):this.freehand_&&e.type===hp.POINTERDOWN?o=!1:t?(o=e.type===hp.POINTERMOVE,o&&this.freehand_?o=this.handlePointerMove_(e):(e.pointerEvent.pointerType==Ip||e.type===hp.POINTERDRAG&&!this.downTimeout_)&&this.handlePointerMove_(e)):e.type===hp.DBLCLICK&&(o=!1),Ir.call(this,e)&&o}function As(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e),!0):!!this.condition_(e)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Ep(hp.POINTERMOVE,e.map,e.pointerEvent,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0)}function bs(e){let t=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const o=this.mode_===MS.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||o?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e):(this.startDrawing_(e),this.mode_===MS.POINT&&this.finishDrawing()),t=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!t&&this.stopClick_&&e.stopPropagation(),t}function Ms(e){let t;return e===$p.POINT||e===$p.MULTI_POINT?t=MS.POINT:e===$p.LINE_STRING||e===$p.MULTI_LINE_STRING?t=MS.LINE_STRING:e===$p.POLYGON||e===$p.MULTI_POLYGON?t=MS.POLYGON:e===$p.CIRCLE&&(t=MS.CIRCLE),t}function Gs(e){return!(e instanceof Ep)||(e.type!=hp.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),Ir.call(this,e),!1)}function Ds(e){const t=e.pixel,o=e.map,r=this.getExtent();let i=this.snapToVertex_(t,o);const n=function(e){let t=null,o=null;return e[0]==r[0]?t=r[2]:e[0]==r[2]&&(t=r[0]),e[1]==r[1]?o=r[3]:e[1]==r[3]&&(o=r[1]),null!==t&&null!==o?[t,o]:null};if(i&&r){const e=i[0]==r[0]||i[0]==r[2]?i[0]:null,t=i[1]==r[1]||i[1]==r[3]?i[1]:null;null!==e&&null!==t?this.pointerHandler_=js(n(i)):null===e?null!==t&&(this.pointerHandler_=Vs(n([r[0],t]),n([r[2],t]))):this.pointerHandler_=Vs(n([e,r[1]]),n([e,r[3]]))}else i=o.getCoordinateFromPixel(t),this.setExtent([i[0],i[1],i[0],i[1]]),this.pointerHandler_=js(i);return!0}function ks(e){if(this.pointerHandler_){const t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}return!0}function Us(){this.pointerHandler_=null;const e=this.getExtent();return e&&0!==Ve(e)||this.setExtent(null),!1}function Ys(){const e=Ri();return function(){return e[$p.POLYGON]}}function Bs(){const e=Ri();return function(){return e[$p.POINT]}}function js(e){return function(t){return Te([e,t])}}function Vs(e,t){return e[0]==t[0]?function(o){return Te([e,[o[0],t[1]]])}:e[1]==t[1]?function(o){return Te([e,[t[0],o[1]]])}:null}function zs(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]}function Xs(e,t){return e.index-t.index}function Ws(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);const t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0,this.modified_=!1;const o=this.vertexFeature_;if(o){const r=[],i=o.getGeometry(),a=i.getCoordinates(),s=Te([a]),l=this.rBush_.getInExtent(s),d={};l.sort(Xs);for(let o=0,i=l.length;o<i;++o){const i=l[o],s=i.segment;let p=n(i.feature);const g=i.depth;if(g&&(p+='-'+g.join('-')),d[p]||(d[p]=[,,]),i.geometry.getType()===$p.CIRCLE&&i.index===WS){const e=Js(t,i);pe(e,a)&&!d[p][0]&&(this.dragSegments_.push([i,0]),d[p][0]=i)}else if(pe(s[0],a)&&!d[p][0])this.dragSegments_.push([i,0]),d[p][0]=i;else if(pe(s[1],a)&&!d[p][1]){if((i.geometry.getType()===$p.LINE_STRING||i.geometry.getType()===$p.MULTI_LINE_STRING)&&d[p][0]&&0===d[p][0].index)continue;this.dragSegments_.push([i,1]),d[p][1]=i}else this.insertVertexCondition_(e)&&n(s)in this.vertexSegments_&&!d[p][0]&&!d[p][1]&&r.push([i,a])}r.length&&this.willModifyFeatures_(e);for(let e=r.length-1;0<=e;--e)this.insertVertex_.apply(this,r[e])}return!!this.vertexFeature_}function Ks(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);const t=e.coordinate;for(let o=0,r=this.dragSegments_.length;o<r;++o){const e=this.dragSegments_[o],r=e[0],i=r.depth,n=r.geometry;let a;const s=r.segment,l=e[1];for(;t.length<n.getStride();)t.push(s[l][t.length]);switch(n.getType()){case $p.POINT:a=t,s[0]=s[1]=t;break;case $p.MULTI_POINT:a=n.getCoordinates(),a[r.index]=t,s[0]=s[1]=t;break;case $p.LINE_STRING:a=n.getCoordinates(),a[r.index+l]=t,s[l]=t;break;case $p.MULTI_LINE_STRING:a=n.getCoordinates(),a[i[0]][r.index+l]=t,s[l]=t;break;case $p.POLYGON:a=n.getCoordinates(),a[i[0]][r.index+l]=t,s[l]=t;break;case $p.MULTI_POLYGON:a=n.getCoordinates(),a[i[1]][i[0]][r.index+l]=t,s[l]=t;break;case $p.CIRCLE:s[0]=s[1]=t,r.index===XS?(this.changingFeature_=!0,n.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,n.setRadius(ce(n.getCenter(),t)),this.changingFeature_=!1);break;default:}a&&this.setGeometryCoordinates_(n,a)}this.createOrUpdateVertexFeature_(t)}function Hs(e){for(let t=this.dragSegments_.length-1;0<=t;--t){const e=this.dragSegments_[t][0],o=e.geometry;if(o.getType()===$p.CIRCLE){const t=o.getCenter(),r=e.featureSegments[0],i=e.featureSegments[1];r.segment[0]=r.segment[1]=t,i.segment[0]=i.segment[1]=t,this.rBush_.update(Ae(t),r),this.rBush_.update(o.getExtent(),i)}else this.rBush_.update(Te(e.segment),e)}return this.modified_&&(this.dispatchEvent(new VS(jS.MODIFYEND,this.features_,e)),this.modified_=!1),!1}function Zs(e){if(!(e instanceof Ep))return!0;this.lastPointerEvent_=e;let t;return e.map.getView().getInteracting()||e.type!=hp.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type==hp.SINGLECLICK&&this.ignoreNextSingleClick_?t=!0:t=this.removePoint()),e.type==hp.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),Ir.call(this,e)&&!t}function qs(e,t){const o=t.geometry;if(o.getType()===$p.CIRCLE){const r=o;if(t.index===WS){const t=ue(r.getCenter(),e),o=id(t)-r.getRadius();return o*o}}return ye(e,t.segment)}function Js(e,t){const o=t.geometry;return o.getType()===$p.CIRCLE&&t.index===WS?o.getClosestPoint(e):se(e,t.segment)}function Qs(){const e=Ri();return function(){return e[$p.POINT]}}function $s(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),o=this.removeCondition_(e),r=this.toggleCondition_(e),i=e.map,n=this.featureOverlay_.getSource().getFeaturesCollection(),s=[],l=[];if(!t&&!o&&!r){a(this.featureLayerAssociation_),i.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return l.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=n.getLength()-1;0<=e;--e){const t=n.item(e),o=l.indexOf(t);-1<o?l.splice(o,1):(n.remove(t),s.push(t))}0!==l.length&&n.extend(l)}else{i.forEachFeatureAtPixel(e.pixel,function(e,i){if(this.filter_(e,i))return(t||r)&&!P(n.getArray(),e)?(l.push(e),this.addFeatureLayerAssociation_(e,i)):(o||r)&&P(n.getArray(),e)&&(s.push(e),this.removeFeatureLayerAssociation_(e)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=s.length-1;0<=e;--e)n.remove(s[e]);n.extend(l)}return(0<l.length||0<s.length)&&this.dispatchEvent(new HS(KS.SELECT,l,s,e)),x_(e)}function el(){const e=Ri();return O(e[$p.POLYGON],e[$p.LINE_STRING]),O(e[$p.GEOMETRY_COLLECTION],e[$p.LINE_STRING]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}function tl(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t.snapped&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel),Ir.call(this,e)}function rl(){const e=s(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}function il(e,t){const o=ye(this.pixelCoordinate_,e.segment),r=ye(this.pixelCoordinate_,t.segment);return o-r}function nl(e){if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate,ll.call(this,e);const t=this.features_||new ep([this.lastFeature_]);return this.dispatchEvent(new QS(JS.TRANSLATESTART,t,e.coordinate)),!0}return!1}function al(e){if(this.lastCoordinate_){this.lastCoordinate_=null,ll.call(this,e);const t=this.features_||new ep([this.lastFeature_]);return this.dispatchEvent(new QS(JS.TRANSLATEEND,t,e.coordinate)),!0}return!1}function sl(e){if(this.lastCoordinate_){const t=e.coordinate,o=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],i=this.features_||new ep([this.lastFeature_]);i.forEach(function(e){const t=e.getGeometry();t.translate(o,r),e.setGeometry(t)}),this.lastCoordinate_=t,this.dispatchEvent(new QS(JS.TRANSLATING,i,t))}}function ll(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?'ol-grab':'ol-grabbing'),t.classList.add(this.lastCoordinate_?'ol-grabbing':'ol-grab')):t.classList.remove('ol-grab','ol-grabbing')}function dl(e,t,o,r){const i=kt(o,t,e);let n=Ft(t,r,o);const a=t.getMetersPerUnit();a!==void 0&&(n*=a);const s=e.getMetersPerUnit();s!==void 0&&(n/=s);const l=e.getExtent();if(!l||Le(l,i)){const t=Ft(e,n,i)/n;isFinite(t)&&0<t&&(n/=t)}return n}function pl(e,t,o,r){const i=o-e,n=r-t,a=id(i*i+n*n);return[Wl(o+i/a),Wl(r+n/a)]}function gl(e,t,o,r,i,n,a,s,l,d,p){const g=Jo(Wl(o*e),Wl(o*t));if(0===l.length)return g.canvas;g.scale(o,o);const _=Oe();l.forEach(function(e){De(_,e.extent)});const u=$e(_),c=Ze(_),y=Jo(Wl(o*u/r),Wl(o*c/r)),m=o/r;l.forEach(function(e){const t=e.extent[0]-_[0],o=-(e.extent[3]-_[3]),r=$e(e.extent),i=Ze(e.extent);y.drawImage(e.image,d,d,e.image.width-2*d,e.image.height-2*d,t*m,o*m,r*m,i*m)});const h=Je(a);return s.getTriangles().forEach(function(e){const t=e.source,i=e.target;let a=t[0][0],s=t[0][1],l=t[1][0],d=t[1][1],p=t[2][0],u=t[2][1];const c=(i[0][0]-h[0])/n,m=-(i[0][1]-h[1])/n,f=(i[1][0]-h[0])/n,E=-(i[1][1]-h[1])/n,x=(i[2][0]-h[0])/n,T=-(i[2][1]-h[1])/n,S=a,C=s;a=0,s=0,l-=S,d-=C,p-=S,u-=C;const R=[[l,d,0,0,f-c],[p,u,0,0,x-c],[0,0,l,d,E-m],[0,0,p,u,T-m]],I=V(R);if(I){g.save(),g.beginPath();const e=(c+f+x)/3,t=(m+E+T)/3,i=pl(e,t,c,m),n=pl(e,t,f,E),a=pl(e,t,x,T);g.moveTo(n[0],n[1]),g.lineTo(i[0],i[1]),g.lineTo(a[0],a[1]),g.clip(),g.transform(I[0],I[2],I[1],I[3],c,m),g.translate(_[0]-S,_[3]-C),g.scale(r/o,-r/o),g.drawImage(y.canvas,0,0),g.restore()}}),p&&(g.save(),g.strokeStyle='black',g.lineWidth=1,s.getTriangles().forEach(function(e){const t=e.target,o=(t[0][0]-h[0])/n,r=-(t[0][1]-h[1])/n,i=(t[1][0]-h[0])/n,a=-(t[1][1]-h[1])/n,s=(t[2][0]-h[0])/n,l=-(t[2][1]-h[1])/n;g.beginPath(),g.moveTo(i,a),g.lineTo(o,r),g.lineTo(s,l),g.closePath(),g.stroke()}),g.restore()),g.canvas}function _l(e,t,o,r){return void 0===r?[e,t,o]:(r[0]=e,r[1]=t,r[2]=o,r)}function ul(e,t,o){return e+'/'+t+'/'+o}function cl(e){return ul(e[0],e[1],e[2])}function yl(e){return e.split('/').map(Number)}function ml(e){return(e[1]<<e[0])+e[2]}function hl(e){const t=e[0],o=Array(t);let r=1<<t-1,n,i;for(n=0;n<t;++n)i=48,e[1]&r&&(i+=1),e[2]&r&&(i+=2),o[n]=zl(i),r>>=1;return o.join('')}function fl(e,t){const o=e[0],r=e[1],i=e[2];if(t.getMinZoom()>o||o>t.getMaxZoom())return!1;const n=t.getExtent();let a;return a=n?t.getTileRangeForExtentAndZ(n,o):t.getFullTileRange(o),!a||a.containsXY(r,i)}function El(e,t){const o=/\{z\}/g,r=/\{x\}/g,i=/\{y\}/g,n=/\{-y\}/g;return function(a){return a?e.replace(o,a[0].toString()).replace(r,a[1].toString()).replace(i,function(){const e=-a[2]-1;return e.toString()}).replace(n,function(){const e=a[0],o=t.getFullTileRange(e);k(o,55);const r=o.getHeight()+a[2];return r.toString()}):void 0}}function xl(e,t){const o=e.length,r=Array(o);for(let n=0;n<o;++n)r[n]=El(e[n],t);return Tl(r)}function Tl(e){return 1===e.length?e[0]:function(t,o,r){if(!t)return;else{const i=ml(t),n=W(i,e.length);return e[n](t,o,r)}}}function Sl(){}function Cl(e){const t=[];let o=/\{([a-z])-([a-z])\}/.exec(e);if(o){const r=o[1].charCodeAt(0),i=o[2].charCodeAt(0);let n;for(n=r;n<=i;++n)t.push(e.replace(o[0],zl(n)));return t}if(o=o=/\{(\d+)-(\d+)\}/.exec(e),o){const r=parseInt(o[2],10);for(let n=parseInt(o[1],10);n<=r;n++)t.push(e.replace(o[0],n.toString()));return t}return t.push(e),t}function Rl(e,t,o,r){function i(){delete window[s],a.parentNode.removeChild(a)}const a=document.createElement('script'),s='olc_'+n(t);a.async=!0,a.src=e+(-1==e.indexOf('?')?'?':'&')+(r||'callback')+'='+s;const l=setTimeout(function(){i(),o&&o()},1e4);window[s]=function(e){clearTimeout(l),i(),t(e)},document.getElementsByTagName('head')[0].appendChild(a)}function Il(e){let t=e.getDefaultTileGrid();return t||(t=Ol(e),e.setDefaultTileGrid(t)),t}function Ll(e,t,o){const r=t[0],i=e.getTileCoordCenter(t),n=wl(o);if(!Le(n,i)){const t=$e(n),o=sd((n[0]-i[0])/t);return i[0]+=t*o,e.getTileCoordForCoordAndZ(i,r)}return t}function Pl(e,t,o,r){const i=r===void 0?Jp.TOP_LEFT:r,n=Fl(e,t,o);return new fC({extent:e,origin:Ke(e,i),resolutions:n,tileSize:o})}function vl(e){const t={};return Dd(t,void 0===e?{}:e),void 0===t.extent&&(t.extent=vt('EPSG:3857').getExtent()),t.resolutions=Fl(t.extent,t.maxZoom,t.tileSize),delete t.maxZoom,new fC(t)}function Fl(e,t,o){const r=t===void 0?Wp:t,i=Ze(e),n=$e(e),a=pr(o===void 0?Kp:o),s=ld(n/a[0],i/a[1]),l=r+1,d=Array(l);for(let r=0;r<l;++r)d[r]=s/nd(2,r);return d}function Ol(e,t,o,r){const i=wl(e);return Pl(i,t,o,r)}function wl(e){e=vt(e);let t=e.getExtent();if(!t){const o=180*rg[ig.DEGREES]/e.getMetersPerUnit();t=we(-o,-o,o,o)}return t}function Nl(e,t){e.getImage().src=t}function Al(e,t){e.getImage().src=t}function bl(e,t){const o=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&o.push(e+'='+encodeURIComponent(t[e]))});const r=o.join('&');return e=e.replace(/[?&]$/,''),e=-1===e.indexOf('?')?e+'?':e+'&',e+r}function Ml(e,t,o,r){const i=$e(e),n=Ze(e),a=t[0],s=t[1],l=.0254/r;return s*i>a*n?i*o/(a*l):n*o/(s*l)}function Gl(e,t,o){if(!e.prepareFrame(t,o))return null;const r=t.size[0],i=t.size[1];if(!$C)$C=Jo(r,i);else{const e=$C.canvas;e.width!==r||e.height!==i?$C=Jo(r,i):$C.clearRect(0,0,r,i)}return e.composeFrame(t,o,$C),$C.getImageData(0,0,r,i)}function Dl(e){return e.map(function(e){return e.getLayer().getLayerState()})}function kl(e){const t=e.length,o=Array(t);for(let r=0;r<t;++r)o[r]=Ul(e[r]);return o}function Ul(e){let t=null;return e instanceof TC?t=Bl(e):e instanceof GC&&(t=Yl(e)),t}function Yl(e){const t=new nC({source:e});return new Vu(t)}function Bl(e){const t=new lC({source:e});return new $u(t)}function jl(e,t,o){const r=[],i=[],n=[],a=[],s=[],l=void 0===o?[]:o,d='TileMatrix',p='Identifier',g='ScaleDenominator',_='TopLeftCorner',u=e['SupportedCRS'],c=vt(u.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,'$1:$3'))||vt(u),y=c.getMetersPerUnit(),m='ne'==c.getAxisOrientation().substr(0,2);return e[d].sort(function(e,t){return t[g]-e[g]}),e[d].forEach(function(e){let t;if(t=!(0<l.length)||N(l,function(t){return e[p]==t[d]}),t){i.push(e[p]);const t=28e-5*e[g]/y,o=e['TileWidth'],l=e['TileHeight'];m?n.push([e[_][1],e[_][0]]):n.push(e[_]),r.push(t),a.push(o==l?o:[o,l]),s.push([e.MatrixWidth,-e.MatrixHeight])}}),new uR({extent:t,origins:n,resolutions:r,matrixIds:i,tileSizes:a,sizes:s})}function Vl(e,t){const o=e.Contents.Layer,r=N(o,function(e){return e.Identifier==t.layer});if(null===r)return null;const i=e.Contents.TileMatrixSet;let n;n=1<r.TileMatrixSetLink.length?'projection'in t?G(r.TileMatrixSetLink,function(e){const o=N(i,function(t){return t.Identifier==e.TileMatrixSet}),r=o.SupportedCRS,n=vt(r.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,'$1:$3'))||vt(r),a=vt(t.projection);return n&&a?Mt(n,a):r==t.projection}):G(r.TileMatrixSetLink,function(e){return e.TileMatrixSet==t.matrixSet}):0,0>n&&(n=0);const a=r.TileMatrixSetLink[n].TileMatrixSet,s=r.TileMatrixSetLink[n].TileMatrixSetLimits;let l=r.Format[0];'format'in t&&(l=t.format),n=G(r.Style,function(e){return'style'in t?e.Title==t.style:e.isDefault}),0>n&&(n=0);const d=r.Style[n].Identifier,p={};'Dimension'in r&&r.Dimension.forEach(function(e){const t=e.Identifier;let o=e.Default;void 0===o&&(o=e.Value[0]),p[t]=o});const g=e.Contents.TileMatrixSet,_=N(g,function(e){return e.Identifier==a});let u;const c=_.SupportedCRS;if(c&&(u=vt(c.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,'$1:$3'))||vt(c)),'projection'in t){const e=vt(t.projection);e&&(!u||Mt(e,u))&&(u=e)}const y=r.WGS84BoundingBox;let m,h;if(void 0!==y){const e=vt('EPSG:4326').getExtent();h=y[0]==e[0]&&y[2]==e[2],m=Ut(y,'EPSG:4326',u);const t=u.getExtent();t&&!Pe(t,m)&&(m=void 0)}const f=jl(_,m,s),E=[];let x=t.requestEncoding;if(x=void 0===x?'':x,'OperationsMetadata'in e&&'GetTile'in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,o=t.length;e<o;++e)if(t[e].Constraint){const o=N(t[e].Constraint,function(e){return'GetEncoding'==e.name}),r=o.AllowedValues.Value;if(''===x&&(x=r[0]),x===_R.KVP)P(r,_R.KVP)&&E.push(t[e].href);else break}else t[e].href&&(x=_R.KVP,E.push(t[e].href))}return 0===E.length&&(x=_R.REST,r.ResourceURL.forEach(function(e){'tile'===e.resourceType&&(l=e.format,E.push(e.template))})),{urls:E,layer:t.layer,matrixSet:a,format:l,projection:u,requestEncoding:x,tileGrid:f,style:d,dimensions:p,wrapX:h,crossOrigin:t.crossOrigin}}var zl=String.fromCharCode,Xl=Math.acos,Wl=Math.round,Kl=Math.atan,Hl=Math.asin,Zl=Math.atan2,ql=Math.sin,Jl=Math.cos,Ql=Math.floor,$l=Math.PI,ed=Math.LN2,td=Math.exp,od=Math.abs,rd=Math.min,id=Math.sqrt,nd=Math.pow,ad=Math.log,sd=Math.ceil,ld=Math.max;Object.defineProperty(t,'__esModule',{value:!0});const dd=16384,pd=5,gd=771,_d=34962,ud=34963,cd=3042,yd=5121,md=5126,hd=6408,fd=9729,Ed=10240,xd=10241,Td=10242,Sd=10243,Cd=3553,Rd=33071,Id=36160,Ld=['experimental-webgl','webgl','webkit-3d','moz-webgl'],Pd=!0;let vd=!1,Fd,Od;if('undefined'!=typeof window&&'WebGLRenderingContext'in window)try{const e=document.createElement('CANVAS'),t=r(e,{failIfMajorPerformanceCaveat:!0});t&&(vd=!0,Fd=t.getParameter(t.MAX_TEXTURE_SIZE),Od=t.getSupportedExtensions())}catch(t){}const wd='v4.6.4';let Nd=0;const Ad=function(e){const t=wd.split('-')[0];this.message='Assertion failed. See https://openlayers.org/en/'+t+'/doc/errors/#'+e+' for details.',this.code=e,this.name='AssertionError'};i(Ad,Error);var bd=Ad,Md={ADD:'add',REMOVE:'remove'},Gd={PROPERTYCHANGE:'propertychange'};const Dd='function'==typeof Object.assign?Object.assign:function(e){if(e===void 0||null===e)throw new TypeError('Cannot convert undefined or null to object');const t=Object(e);for(let o=1,r=arguments.length;o<r;++o){const e=arguments[o];if(e!==void 0&&null!==e)for(const o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t},kd=function(){};kd.prototype.disposed_=!1,kd.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},kd.prototype.disposeInternal=T;var Ud=kd;const Yd=function(e){this.propagationStopped,this.type=e,this.target=null};Yd.prototype.preventDefault=Yd.prototype.stopPropagation=function(){this.propagationStopped=!0};var Bd=Yd;const jd=function(){Ud.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}};i(jd,Ud),jd.prototype.addEventListener=function(e,t){let o=this.listeners_[e];o||(o=this.listeners_[e]=[]),-1===o.indexOf(t)&&o.push(t)},jd.prototype.dispatchEvent=function(e){const t='string'==typeof e?new Bd(e):e,o=t.type;t.target=this;const r=this.listeners_[o];let i;if(r){o in this.dispatching_||(this.dispatching_[o]=0,this.pendingRemovals_[o]=0),++this.dispatching_[o];for(let e=0,o=r.length;e<o;++e)if(!1===r[e].call(this,t)||t.propagationStopped){i=!1;break}if(--this.dispatching_[o],0===this.dispatching_[o]){let e=this.pendingRemovals_[o];for(delete this.pendingRemovals_[o];e--;)this.removeEventListener(o,T);delete this.dispatching_[o]}return i}},jd.prototype.disposeInternal=function(){f(this)},jd.prototype.getListeners=function(e){return this.listeners_[e]},jd.prototype.hasListener=function(e){return e?e in this.listeners_:0<Object.keys(this.listeners_).length},jd.prototype.removeEventListener=function(e,t){const o=this.listeners_[e];if(o){const r=o.indexOf(t);e in this.pendingRemovals_?(o[r]=T,++this.pendingRemovals_[e]):(o.splice(r,1),0===o.length&&delete this.listeners_[e])}};var Vd=jd,zd={CHANGE:'change',CLEAR:'clear',CONTEXTMENU:'contextmenu',CLICK:'click',DBLCLICK:'dblclick',DRAGENTER:'dragenter',DRAGOVER:'dragover',DROP:'drop',ERROR:'error',KEYDOWN:'keydown',KEYPRESS:'keypress',LOAD:'load',MOUSEDOWN:'mousedown',MOUSEMOVE:'mousemove',MOUSEOUT:'mouseout',MOUSEUP:'mouseup',MOUSEWHEEL:'mousewheel',MSPOINTERDOWN:'MSPointerDown',RESIZE:'resize',TOUCHSTART:'touchstart',TOUCHMOVE:'touchmove',TOUCHEND:'touchend',WHEEL:'wheel'};const Xd=function(){Vd.call(this),this.revision_=0};i(Xd,Vd),Xd.prototype.changed=function(){++this.revision_,this.dispatchEvent(zd.CHANGE)},Xd.prototype.dispatchEvent,Xd.prototype.getRevision=function(){return this.revision_},Xd.prototype.on=function(e,t){if(Array.isArray(e)){const o=e.length,r=Array(o);for(let n=0;n<o;++n)r[n]=c(this,e[n],t);return r}return c(this,e,t)},Xd.prototype.once=function(e,t){if(Array.isArray(e)){const o=e.length,r=Array(o);for(let n=0;n<o;++n)r[n]=y(this,e[n],t);return r}return y(this,e,t)},Xd.prototype.un=function(e,t){if(Array.isArray(e)){for(let o=0,r=e.length;o<r;++o)m(this,e[o],t);return}m(this,e,t)};var Wd=Xd;const Kd=function(e,t,o){Bd.call(this,e),this.key=t,this.oldValue=o};i(Kd,Bd);const Hd=function(e){Wd.call(this),n(this),this.values_={},e!==void 0&&this.setProperties(e)};i(Hd,Wd);const Zd={};Hd.prototype.get=function(e){let t;return this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},Hd.prototype.getKeys=function(){return Object.keys(this.values_)},Hd.prototype.getProperties=function(){return Dd({},this.values_)},Hd.prototype.notify=function(e,t){let o;o=C(e),this.dispatchEvent(new Kd(o,e,t)),o=Gd.PROPERTYCHANGE,this.dispatchEvent(new Kd(o,e,t))},Hd.prototype.set=function(e,t,o){if(o)this.values_[e]=t;else{const o=this.values_[e];this.values_[e]=t,o!==t&&this.notify(e,o)}},Hd.prototype.setProperties=function(e,t){for(const o in e)this.set(o,e[o],t)},Hd.prototype.unset=function(e,t){if(e in this.values_){const o=this.values_[e];delete this.values_[e],t||this.notify(e,o)}};var qd=Hd;const Jd={LENGTH:'length'},Qd=function(e,t){Bd.call(this,e),this.element=t};i(Qd,Bd);const $d=function(e,t){qd.call(this);if(this.unique_=!!(t||{}).unique,this.array_=e?e:[],this.unique_)for(let e=0,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()};i($d,qd),$d.prototype.clear=function(){for(;0<this.getLength();)this.pop()},$d.prototype.extend=function(e){let t,o;for(t=0,o=e.length;t<o;++t)this.push(e[t]);return this},$d.prototype.forEach=function(e){const t=this.array_;for(let o=0,r=t.length;o<r;++o)e(t[o],o,t)},$d.prototype.getArray=function(){return this.array_},$d.prototype.item=function(e){return this.array_[e]},$d.prototype.getLength=function(){return this.get(Jd.LENGTH)},$d.prototype.insertAt=function(e,t){this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Qd(Md.ADD,t))},$d.prototype.pop=function(){return this.removeAt(this.getLength()-1)},$d.prototype.push=function(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()},$d.prototype.remove=function(e){const t=this.array_;let o,r;for(o=0,r=t.length;o<r;++o)if(t[o]===e)return this.removeAt(o)},$d.prototype.removeAt=function(e){const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Qd(Md.REMOVE,t)),t},$d.prototype.setAt=function(e,t){const o=this.getLength();if(e<o){this.unique_&&this.assertUnique_(t,e);const o=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Qd(Md.REMOVE,o)),this.dispatchEvent(new Qd(Md.ADD,t))}else{let r;for(r=o;r<e;++r)this.insertAt(r,void 0);this.insertAt(e,t)}},$d.prototype.updateLength_=function(){this.set(Jd.LENGTH,this.array_.length)},$d.prototype.assertUnique_=function(e,t){for(let o=0,r=this.array_.length;o<r;++o)if(this.array_[o]===e&&o!==t)throw new bd(58)};var ep=$d;const tp=function(e,t,o){Bd.call(this,e),this.map=t,this.frameState=o===void 0?null:o};i(tp,Bd);var op=tp;const rp=function(e,t,o,r,i){op.call(this,e,t,i),this.originalEvent=o,this.pixel=t.getEventPixel(o),this.coordinate=t.getCoordinateFromPixel(this.pixel),this.dragging=r!==void 0&&r};i(rp,op),rp.prototype.preventDefault=function(){op.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},rp.prototype.stopPropagation=function(){op.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()};var ip=rp;const np='undefined'==typeof navigator?'':navigator.userAgent.toLowerCase(),ap=-1!==np.indexOf('firefox'),sp=-1!==np.indexOf('safari')&&-1==np.indexOf('chrom'),lp=-1!==np.indexOf('webkit')&&-1==np.indexOf('edge'),dp=-1!==np.indexOf('macintosh'),pp=window.devicePixelRatio||1,gp=function(){let e=!1;try{e=!!document.createElement('CANVAS').getContext('2d').setLineDash}catch(t){}return e}(),_p='geolocation'in navigator,up='ontouchstart'in window,cp='PointerEvent'in window,yp=!!navigator.msPointerEnabled,mp=vd;var hp={SINGLECLICK:'singleclick',CLICK:zd.CLICK,DBLCLICK:zd.DBLCLICK,POINTERDRAG:'pointerdrag',POINTERMOVE:'pointermove',POINTERDOWN:'pointerdown',POINTERUP:'pointerup',POINTEROVER:'pointerover',POINTEROUT:'pointerout',POINTERENTER:'pointerenter',POINTERLEAVE:'pointerleave',POINTERCANCEL:'pointercancel'};const fp=function(e,t,o,r,i){ip.call(this,e,t,o.originalEvent,r,i),this.pointerEvent=o};i(fp,ip);var Ep=fp,xp={POINTERMOVE:'pointermove',POINTERDOWN:'pointerdown',POINTERUP:'pointerup',POINTEROVER:'pointerover',POINTEROUT:'pointerout',POINTERENTER:'pointerenter',POINTERLEAVE:'pointerleave',POINTERCANCEL:'pointercancel'};const Tp=function(e,t){this.dispatcher=e,this.mapping_=t};Tp.prototype.getEvents=function(){return Object.keys(this.mapping_)},Tp.prototype.getHandlerForEvent=function(e){return this.mapping_[e]};var Sp=Tp;const Cp=function(e){const t={mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout};Sp.call(this,e,t),this.pointerMap=e.pointerMap,this.lastTouches=[]};i(Cp,Sp);const Rp=1,Ip='mouse',Lp=25;Cp.prototype.isEventSimulatedFromTouch_=function(e){const o=this.lastTouches,r=e.clientX,i=e.clientY;for(let n=0,a=o.length,s;n<a&&(s=o[n]);n++){const e=od(r-s[0]),t=od(i-s[1]);if(e<=Lp&&t<=Lp)return!0}return!1},Cp.prototype.mousedown=function(t){if(!this.isEventSimulatedFromTouch_(t)){Rp.toString()in this.pointerMap&&this.cancel(t);const o=R(t,this.dispatcher);this.pointerMap[Rp.toString()]=t,this.dispatcher.down(o,t)}},Cp.prototype.mousemove=function(t){if(!this.isEventSimulatedFromTouch_(t)){const o=R(t,this.dispatcher);this.dispatcher.move(o,t)}},Cp.prototype.mouseup=function(t){if(!this.isEventSimulatedFromTouch_(t)){const e=this.pointerMap[Rp.toString()];if(e&&e.button===t.button){const o=R(t,this.dispatcher);this.dispatcher.up(o,t),this.cleanupMouse()}}},Cp.prototype.mouseover=function(t){if(!this.isEventSimulatedFromTouch_(t)){const o=R(t,this.dispatcher);this.dispatcher.enterOver(o,t)}},Cp.prototype.mouseout=function(t){if(!this.isEventSimulatedFromTouch_(t)){const o=R(t,this.dispatcher);this.dispatcher.leaveOut(o,t)}},Cp.prototype.cancel=function(t){const o=R(t,this.dispatcher);this.dispatcher.cancel(o,t),this.cleanupMouse()},Cp.prototype.cleanupMouse=function(){delete this.pointerMap[Rp.toString()]};var Pp=Cp;const vp=function(e){const t={MSPointerDown:this.msPointerDown,MSPointerMove:this.msPointerMove,MSPointerUp:this.msPointerUp,MSPointerOut:this.msPointerOut,MSPointerOver:this.msPointerOver,MSPointerCancel:this.msPointerCancel,MSGotPointerCapture:this.msGotPointerCapture,MSLostPointerCapture:this.msLostPointerCapture};Sp.call(this,e,t),this.pointerMap=e.pointerMap};i(vp,Sp);const Fp=['','unavailable','touch','pen','mouse'];vp.prototype.prepareEvent_=function(t){let o=t;return'number'==typeof t.pointerType&&(o=this.dispatcher.cloneEvent(t,t),o.pointerType=Fp[t.pointerType]),o},vp.prototype.cleanup=function(e){delete this.pointerMap[e.toString()]},vp.prototype.msPointerDown=function(t){this.pointerMap[t.pointerId.toString()]=t;const o=this.prepareEvent_(t);this.dispatcher.down(o,t)},vp.prototype.msPointerMove=function(t){const o=this.prepareEvent_(t);this.dispatcher.move(o,t)},vp.prototype.msPointerUp=function(t){const o=this.prepareEvent_(t);this.dispatcher.up(o,t),this.cleanup(t.pointerId)},vp.prototype.msPointerOut=function(t){const o=this.prepareEvent_(t);this.dispatcher.leaveOut(o,t)},vp.prototype.msPointerOver=function(t){const o=this.prepareEvent_(t);this.dispatcher.enterOver(o,t)},vp.prototype.msPointerCancel=function(t){const o=this.prepareEvent_(t);this.dispatcher.cancel(o,t),this.cleanup(t.pointerId)},vp.prototype.msLostPointerCapture=function(t){const o=this.dispatcher.makeEvent('lostpointercapture',t,t);this.dispatcher.dispatchEvent(o)},vp.prototype.msGotPointerCapture=function(t){const o=this.dispatcher.makeEvent('gotpointercapture',t,t);this.dispatcher.dispatchEvent(o)};const Op=function(e){const t={pointerdown:this.pointerDown,pointermove:this.pointerMove,pointerup:this.pointerUp,pointerout:this.pointerOut,pointerover:this.pointerOver,pointercancel:this.pointerCancel,gotpointercapture:this.gotPointerCapture,lostpointercapture:this.lostPointerCapture};Sp.call(this,e,t)};i(Op,Sp),Op.prototype.pointerDown=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.pointerMove=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.pointerUp=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.pointerOut=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.pointerOver=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.pointerCancel=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.lostPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)},Op.prototype.gotPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)};const wp=function(e,t,o){Bd.call(this,e),this.originalEvent=t;const r=o?o:{};this.buttons=this.getButtons_(r),this.pressure=this.getPressure_(r,this.buttons),this.bubbles=!!('bubbles'in r)&&r.bubbles,this.cancelable=!!('cancelable'in r)&&r.cancelable,this.view='view'in r?r.view:null,this.detail='detail'in r?r.detail:null,this.screenX='screenX'in r?r.screenX:0,this.screenY='screenY'in r?r.screenY:0,this.clientX='clientX'in r?r.clientX:0,this.clientY='clientY'in r?r.clientY:0,this.ctrlKey=!!('ctrlKey'in r)&&r.ctrlKey,this.altKey=!!('altKey'in r)&&r.altKey,this.shiftKey=!!('shiftKey'in r)&&r.shiftKey,this.metaKey=!!('metaKey'in r)&&r.metaKey,this.button='button'in r?r.button:0,this.relatedTarget='relatedTarget'in r?r.relatedTarget:null,this.pointerId='pointerId'in r?r.pointerId:0,this.width='width'in r?r.width:0,this.height='height'in r?r.height:0,this.tiltX='tiltX'in r?r.tiltX:0,this.tiltY='tiltY'in r?r.tiltY:0,this.pointerType='pointerType'in r?r.pointerType:'',this.hwTimestamp='hwTimestamp'in r?r.hwTimestamp:0,this.isPrimary=!!('isPrimary'in r)&&r.isPrimary,t.preventDefault&&(this.preventDefault=function(){t.preventDefault()})};i(wp,Bd);let Np=!1;wp.prototype.getButtons_=function(e){let t;if(e.buttons||Np)t=e.buttons;else switch(e.which){case 1:t=1;break;case 2:t=4;break;case 3:t=2;break;default:t=0;}return t},wp.prototype.getPressure_=function(e,t){let o=0;return o=e.pressure?e.pressure:t?.5:0,o},function(){try{const e=new MouseEvent('click',{buttons:1});Np=1===e.buttons}catch(t){}}();const Ap=function(e,t){const o={touchstart:this.touchstart,touchmove:this.touchmove,touchend:this.touchend,touchcancel:this.touchcancel};Sp.call(this,e,o),this.pointerMap=e.pointerMap,this.mouseSource=t,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_=void 0,this.dedupTimeout_=2500};i(Ap,Sp);Ap.prototype.isPrimaryTouch_=function(e){return this.firstTouchId_===e.identifier},Ap.prototype.setPrimaryTouch_=function(e){const t=Object.keys(this.pointerMap).length;(0===t||1===t&&Rp.toString()in this.pointerMap)&&(this.firstTouchId_=e.identifier,this.cancelResetClickCount_())},Ap.prototype.removePrimaryPointer_=function(e){e.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},Ap.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)},Ap.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},Ap.prototype.cancelResetClickCount_=function(){this.resetId_!==void 0&&clearTimeout(this.resetId_)},Ap.prototype.touchToPointer_=function(t,o){const r=this.dispatcher.cloneEvent(t,o);return r.pointerId=o.identifier+2,r.bubbles=!0,r.cancelable=!0,r.detail=this.clickCount_,r.button=0,r.buttons=1,r.width=o.webkitRadiusX||o.radiusX||0,r.height=o.webkitRadiusY||o.radiusY||0,r.pressure=o.webkitForce||o.force||.5,r.isPrimary=this.isPrimaryTouch_(o),r.pointerType='touch',r.clientX=o.clientX,r.clientY=o.clientY,r.screenX=o.screenX,r.screenY=o.screenY,r},Ap.prototype.processTouches_=function(e,t){function o(){e.preventDefault()}const r=Array.prototype.slice.call(e.changedTouches),n=r.length;let a,i;for(a=0;a<n;++a)i=this.touchToPointer_(e,r[a]),i.preventDefault=o,t.call(this,e,i)},Ap.prototype.findTouch_=function(e,t){const o=e.length;let r;for(let n=0;n<o;n++)if(r=e[n],r.identifier===t)return!0;return!1},Ap.prototype.vacuumTouches_=function(e){const t=e.touches,o=Object.keys(this.pointerMap),r=o.length;if(r>=t.length){const n=[];let a,i,s;for(a=0;a<r;++a)i=o[a],s=this.pointerMap[i],i==Rp||this.findTouch_(t,i-2)||n.push(s.out);for(a=0;a<n.length;++a)this.cancelOut_(e,n[a])}},Ap.prototype.touchstart=function(e){this.vacuumTouches_(e),this.setPrimaryTouch_(e.changedTouches[0]),this.dedupSynthMouse_(e),this.clickCount_++,this.processTouches_(e,this.overDown_)},Ap.prototype.overDown_=function(e,t){this.pointerMap[t.pointerId]={target:t.target,out:t,outTarget:t.target},this.dispatcher.over(t,e),this.dispatcher.enter(t,e),this.dispatcher.down(t,e)},Ap.prototype.touchmove=function(e){e.preventDefault(),this.processTouches_(e,this.moveOverOut_)},Ap.prototype.moveOverOut_=function(e,t){const o=t,r=this.pointerMap[o.pointerId];if(r){const t=r.out,i=r.outTarget;this.dispatcher.move(o,e),t&&i!==o.target&&(t.relatedTarget=o.target,o.relatedTarget=i,t.target=i,o.target?(this.dispatcher.leaveOut(t,e),this.dispatcher.enterOver(o,e)):(o.target=i,o.relatedTarget=null,this.cancelOut_(e,o))),r.out=o,r.outTarget=o.target}},Ap.prototype.touchend=function(e){this.dedupSynthMouse_(e),this.processTouches_(e,this.upOut_)},Ap.prototype.upOut_=function(e,t){this.dispatcher.up(t,e),this.dispatcher.out(t,e),this.dispatcher.leave(t,e),this.cleanUpPointer_(t)},Ap.prototype.touchcancel=function(e){this.processTouches_(e,this.cancelOut_)},Ap.prototype.cancelOut_=function(e,t){this.dispatcher.cancel(t,e),this.dispatcher.out(t,e),this.dispatcher.leave(t,e),this.cleanUpPointer_(t)},Ap.prototype.cleanUpPointer_=function(e){delete this.pointerMap[e.pointerId],this.removePrimaryPointer_(e)},Ap.prototype.dedupSynthMouse_=function(e){const o=this.mouseSource.lastTouches,r=e.changedTouches[0];if(this.isPrimaryTouch_(r)){const e=[r.clientX,r.clientY];o.push(e),setTimeout(function(){w(o,e)},this.dedupTimeout_)}};const bp=function(e){Vd.call(this),this.element_=e,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()};i(bp,Vd);const Mp=[['bubbles',!1],['cancelable',!1],['view',null],['detail',null],['screenX',0],['screenY',0],['clientX',0],['clientY',0],['ctrlKey',!1],['altKey',!1],['shiftKey',!1],['metaKey',!1],['button',0],['relatedTarget',null],['buttons',0],['pointerId',0],['width',0],['height',0],['pressure',0],['tiltX',0],['tiltY',0],['pointerType',''],['hwTimestamp',0],['isPrimary',!1],['type',''],['target',null],['currentTarget',null],['which',0]];bp.prototype.registerSources=function(){if(cp)this.registerSource('native',new Op(this));else if(yp)this.registerSource('ms',new vp(this));else{const e=new Pp(this);this.registerSource('mouse',e),up&&this.registerSource('touch',new Ap(this,e))}this.register_()},bp.prototype.registerSource=function(e,t){const o=t,r=o.getEvents();r&&(r.forEach(function(t){const e=o.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(o))}.bind(this)),this.eventSourceList_.push(o))},bp.prototype.register_=function(){const e=this.eventSourceList_.length;let t;for(let o=0;o<e;o++)t=this.eventSourceList_[o],this.addEvents_(t.getEvents())},bp.prototype.unregister_=function(){const e=this.eventSourceList_.length;let t;for(let o=0;o<e;o++)t=this.eventSourceList_[o],this.removeEvents_(t.getEvents())},bp.prototype.eventHandler_=function(e){const t=e.type,o=this.eventMap_[t];o&&o(e)},bp.prototype.addEvents_=function(e){e.forEach(function(e){c(this.element_,e,this.eventHandler_,this)}.bind(this))},bp.prototype.removeEvents_=function(e){e.forEach(function(t){m(this.element_,t,this.eventHandler_,this)}.bind(this))},bp.prototype.cloneEvent=function(e,t){const o={};for(let r=0,i=Mp.length;r<i;r++){const i=Mp[r][0];o[i]=e[i]||t[i]||Mp[r][1]}return o},bp.prototype.down=function(e,t){this.fireEvent(xp.POINTERDOWN,e,t)},bp.prototype.move=function(e,t){this.fireEvent(xp.POINTERMOVE,e,t)},bp.prototype.up=function(e,t){this.fireEvent(xp.POINTERUP,e,t)},bp.prototype.enter=function(e,t){e.bubbles=!1,this.fireEvent(xp.POINTERENTER,e,t)},bp.prototype.leave=function(e,t){e.bubbles=!1,this.fireEvent(xp.POINTERLEAVE,e,t)},bp.prototype.over=function(e,t){e.bubbles=!0,this.fireEvent(xp.POINTEROVER,e,t)},bp.prototype.out=function(e,t){e.bubbles=!0,this.fireEvent(xp.POINTEROUT,e,t)},bp.prototype.cancel=function(e,t){this.fireEvent(xp.POINTERCANCEL,e,t)},bp.prototype.leaveOut=function(e,t){this.out(e,t),this.contains_(e.target,e.relatedTarget)||this.leave(e,t)},bp.prototype.enterOver=function(e,t){this.over(e,t),this.contains_(e.target,e.relatedTarget)||this.enter(e,t)},bp.prototype.contains_=function(e,t){return!!(e&&t)&&e.contains(t)},bp.prototype.makeEvent=function(e,t,o){return new wp(e,o,t)},bp.prototype.fireEvent=function(t,o,r){const i=this.makeEvent(t,o,r);this.dispatchEvent(i)},bp.prototype.fireNativeEvent=function(t){const o=this.makeEvent(t.type,t,t);this.dispatchEvent(o)},bp.prototype.wrapMouseEvent=function(e,t){const o=this.makeEvent(e,Pp.prepareEvent(t,this),t);return o},bp.prototype.disposeInternal=function(){this.unregister_(),Vd.prototype.disposeInternal.call(this)};var Gp=bp;const Dp=function(e,t){Vd.call(this),this.map_=e,this.clickTimeoutId_=0,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t?t*pp:pp,this.down_=null;const o=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new Gp(o),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=c(this.pointerEventHandler_,xp.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=c(this.pointerEventHandler_,xp.POINTERMOVE,this.relayEvent_,this)};i(Dp,Vd),Dp.prototype.emulateClick_=function(e){let t=new Ep(hp.CLICK,this.map_,e);this.dispatchEvent(t),0===this.clickTimeoutId_?this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=0;const t=new Ep(hp.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250):(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=0,t=new Ep(hp.DBLCLICK,this.map_,e),this.dispatchEvent(t))},Dp.prototype.updateActivePointers_=function(e){const t=e;t.type==hp.POINTERUP||t.type==hp.POINTERCANCEL?delete this.trackedTouches_[t.pointerId]:t.type==hp.POINTERDOWN&&(this.trackedTouches_[t.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},Dp.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);const t=new Ep(hp.POINTERUP,this.map_,e);this.dispatchEvent(t),t.propagationStopped||this.dragging_||!this.isMouseActionButton_(e)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(h),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},Dp.prototype.isMouseActionButton_=function(e){return 0===e.button},Dp.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);const t=new Ep(hp.POINTERDOWN,this.map_,e);this.dispatchEvent(t),this.down_=e,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new Gp(document),this.dragListenerKeys_.push(c(this.documentPointerEventHandler_,hp.POINTERMOVE,this.handlePointerMove_,this),c(this.documentPointerEventHandler_,hp.POINTERUP,this.handlePointerUp_,this),c(this.pointerEventHandler_,hp.POINTERCANCEL,this.handlePointerUp_,this)))},Dp.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;const t=new Ep(hp.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(t)}e.preventDefault()},Dp.prototype.relayEvent_=function(e){const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Ep(e.type,this.map_,e,t))},Dp.prototype.isMoving_=function(e){return od(e.clientX-this.down_.clientX)>this.moveTolerance_||od(e.clientY-this.down_.clientY)>this.moveTolerance_},Dp.prototype.disposeInternal=function(){this.relayedListenerKey_&&(h(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(h(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(h),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),Vd.prototype.disposeInternal.call(this)};var kp={POSTRENDER:'postrender',MOVESTART:'movestart',MOVEEND:'moveend'},Up={LAYERGROUP:'layergroup',SIZE:'size',TARGET:'target',VIEW:'view'},Yp={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};const Bp=function(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}},jp=Infinity;Bp.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,a(this.queuedElements_)},Bp.prototype.dequeue=function(){const e=this.elements_,t=this.priorities_,o=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(o);return delete this.queuedElements_[r],o},Bp.prototype.enqueue=function(e){k(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=jp&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},Bp.prototype.getCount=function(){return this.elements_.length},Bp.prototype.getLeftChildIndex_=function(e){return 2*e+1},Bp.prototype.getRightChildIndex_=function(e){return 2*e+2},Bp.prototype.getParentIndex_=function(e){return e-1>>1},Bp.prototype.heapify_=function(){let e;for(e=(this.elements_.length>>1)-1;0<=e;e--)this.siftUp_(e)},Bp.prototype.isEmpty=function(){return 0===this.elements_.length},Bp.prototype.isKeyQueued=function(e){return e in this.queuedElements_},Bp.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))},Bp.prototype.siftUp_=function(e){const t=this.elements_,o=this.priorities_,r=t.length,i=t[e],n=o[e],a=e;for(;e<r>>1;){const i=this.getLeftChildIndex_(e),n=this.getRightChildIndex_(e),a=n<r&&o[n]<o[i]?n:i;t[e]=t[a],o[e]=o[a],e=a}t[e]=i,o[e]=n,this.siftDown_(a,e)},Bp.prototype.siftDown_=function(e,t){const o=this.elements_,r=this.priorities_,i=o[t],n=r[t];for(;t>e;){const e=this.getParentIndex_(t);if(r[e]>n)o[t]=o[e],r[t]=r[e],t=e;else break}o[t]=i,r[t]=n},Bp.prototype.reprioritize=function(){const e=this.priorityFunction_,t=this.elements_,o=this.priorities_;let r=0;const a=t.length;let n,s,i;for(s=0;s<a;++s)n=t[s],i=e(n),i==jp?delete this.queuedElements_[this.keyFunction_(n)]:(o[r]=i,t[r++]=n);t.length=r,o.length=r,this.heapify_()};var Vp=Bp;const zp=function(e,t){Vp.call(this,function(t){return e.apply(null,t)},function(e){return e[0].getKey()}),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}};i(zp,Vp),zp.prototype.enqueue=function(e){const t=Vp.prototype.enqueue.call(this,e);if(t){const t=e[0];c(t,zd.CHANGE,this.handleTileChange,this)}return t},zp.prototype.getTilesLoading=function(){return this.tilesLoading_},zp.prototype.handleTileChange=function(e){const t=e.target,o=t.getState();if(o===Yp.LOADED||o===Yp.ERROR||o===Yp.EMPTY||o===Yp.ABORT){m(t,zd.CHANGE,this.handleTileChange,this);const e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}},zp.prototype.loadMoreTiles=function(e,t){let o=0,r=!1,i,n,a;for(;this.tilesLoading_<e&&o<t&&0<this.getCount();)n=this.dequeue()[0],a=n.getKey(),i=n.getState(),i===Yp.ABORT?r=!0:i===Yp.IDLE&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++o,n.load());0==o&&r&&this.tileChangeCallback_()};var Xp=zp;const Wp=42,Kp=256,Hp=function(){let e;return e='cosh'in Math?Math.cosh:function(e){const t=td(e);return(t+1/t)/2},e}();var Zp={ANIMATING:0,INTERACTING:1},qp={CENTER:'center',RESOLUTION:'resolution',ROTATION:'rotation'},Jp={BOTTOM_LEFT:'bottom-left',BOTTOM_RIGHT:'bottom-right',TOP_LEFT:'top-left',TOP_RIGHT:'top-right'},Qp={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},$p={POINT:'Point',LINE_STRING:'LineString',LINEAR_RING:'LinearRing',POLYGON:'Polygon',MULTI_POINT:'MultiPoint',MULTI_LINE_STRING:'MultiLineString',MULTI_POLYGON:'MultiPolygon',GEOMETRY_COLLECTION:'GeometryCollection',CIRCLE:'Circle'},eg={XY:'XY',XYZ:'XYZ',XYM:'XYM',XYZM:'XYZM'};const tg=6371008.8,og={DEGREES:'degrees',FEET:'ft',METERS:'m',PIXELS:'pixels',TILE_PIXELS:'tile-pixels',USFEET:'us-ft'},rg={};rg[og.DEGREES]=6370997*(2*$l)/360,rg[og.FEET]=.3048,rg[og.METERS]=1,rg[og.USFEET]=1200/3937;var ig=og;const ng=function(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent===void 0?null:e.extent,this.worldExtent_=e.worldExtent===void 0?null:e.worldExtent,this.axisOrientation_=e.axisOrientation===void 0?'enu':e.axisOrientation,this.global_=e.global!==void 0&&e.global,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit};ng.prototype.canWrapX=function(){return this.canWrapX_},ng.prototype.getCode=function(){return this.code_},ng.prototype.getExtent=function(){return this.extent_},ng.prototype.getUnits=function(){return this.units_},ng.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||rg[this.units_]},ng.prototype.getWorldExtent=function(){return this.worldExtent_},ng.prototype.getAxisOrientation=function(){return this.axisOrientation_},ng.prototype.isGlobal=function(){return this.global_},ng.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)},ng.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},ng.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},ng.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)},ng.prototype.setWorldExtent=function(e){this.worldExtent_=e},ng.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},ng.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var ag=ng;const sg=6378137,lg=$l*sg,dg=[-lg,-lg,lg,lg],pg=[-180,-85,180,85];i(mt,ag);const gg=[new mt('EPSG:3857'),new mt('EPSG:102100'),new mt('EPSG:102113'),new mt('EPSG:900913'),new mt('urn:ogc:def:crs:EPSG:6.18:3:3857'),new mt('urn:ogc:def:crs:EPSG::3857'),new mt('http://www.opengis.net/gml/srs/epsg.xml#3857')],_g=[-180,-90,180,90],ug=$l*6378137/180;i(Et,ag);const cg=[new Et('CRS:84'),new Et('EPSG:4326','neu'),new Et('urn:ogc:def:crs:EPSG::4326','neu'),new Et('urn:ogc:def:crs:EPSG:6.6:4326','neu'),new Et('urn:ogc:def:crs:OGC:1.3:CRS84'),new Et('urn:ogc:def:crs:OGC:2:84'),new Et('http://www.opengis.net/gml/srs/epsg.xml#4326','neu'),new Et('urn:x-ogc:def:crs:EPSG:4326','neu')];let yg={},mg={};(function(){Ot(gg),Ot(cg),wt(cg,gg,ht,ft)})();const hg=[,,,,,,],fg=function(){qd.call(this),this.extent_=Oe(),this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0};i(fg,qd);const Eg=Yt();fg.prototype.clone=function(){},fg.prototype.closestPointXY=function(){},fg.prototype.getClosestPoint=function(e,t){const o=t?t:[NaN,NaN];return this.closestPointXY(e[0],e[1],o,Infinity),o},fg.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])},fg.prototype.computeExtent=function(){},fg.prototype.containsXY=x,fg.prototype.getExtent=function(e){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),ot(this.extent_,e)},fg.prototype.rotate=function(){},fg.prototype.scale=function(){},fg.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)},fg.prototype.getSimplifiedGeometry=function(){},fg.prototype.getType=function(){},fg.prototype.applyTransform=function(){},fg.prototype.intersectsExtent=function(){},fg.prototype.translate=function(){},fg.prototype.transform=function(e,t){e=vt(e);const o=e.getUnits()==ig.TILE_PIXELS?function(o,r,i){const n=e.getExtent(),a=e.getWorldExtent(),s=Ze(a)/Ze(n);return Zt(Eg,a[0],a[3],s,-s,0,0,0),at(o,0,o.length,i,Eg,r),Dt(e,t)(o,r,i)}:Dt(e,t);return this.applyTransform(o),this};var xg=fg;const Tg=function(){xg.call(this),this.layout=eg.XY,this.stride=2,this.flatCoordinates=null};i(Tg,xg),Tg.prototype.containsXY=x,Tg.prototype.computeExtent=function(e){return Me(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},Tg.prototype.getCoordinates=function(){},Tg.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},Tg.prototype.getFlatCoordinates=function(){return this.flatCoordinates},Tg.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},Tg.prototype.getLayout=function(){return this.layout},Tg.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!=this.getRevision()&&(a(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),0>e||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];else{const o=this.getSimplifiedGeometryInternal(e),r=o.getFlatCoordinates();return r.length<this.flatCoordinates.length?(this.simplifiedGeometryCache[t]=o,o):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}},Tg.prototype.getSimplifiedGeometryInternal=function(){return this},Tg.prototype.getStride=function(){return this.stride},Tg.prototype.setFlatCoordinatesInternal=function(e,t){this.stride=$t(e),this.layout=e,this.flatCoordinates=t},Tg.prototype.setCoordinates=function(){},Tg.prototype.setLayout=function(e,t,o){let r;if(e)r=$t(e);else{for(let e=0;e<o;++e){if(0===t.length)return this.layout=eg.XY,void(this.stride=2);t=t[0]}r=t.length,e=Qt(r)}this.layout=e,this.stride=r},Tg.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},Tg.prototype.rotate=function(e,t){const o=this.getFlatCoordinates();if(o){const r=this.getStride();st(o,0,o.length,r,e,t,o),this.changed()}},Tg.prototype.scale=function(e,t,o){let r=t;r===void 0&&(r=e);let i=o;i||(i=We(this.getExtent()));const n=this.getFlatCoordinates();if(n){const t=this.getStride();lt(n,0,n.length,t,e,r,i,n),this.changed()}},Tg.prototype.translate=function(e,t){const o=this.getFlatCoordinates();if(o){const r=this.getStride();dt(o,0,o.length,r,e,t,o),this.changed()}};var Sg=Tg;const Cg=function(e,t){Sg.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(e,t)};i(Cg,Sg),Cg.prototype.clone=function(){const e=new Cg(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},Cg.prototype.closestPointXY=function(e,t,o,r){return r<Ie(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=id(no(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),lo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,o,r))},Cg.prototype.getArea=function(){return to(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},Cg.prototype.getCoordinates=function(){return mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},Cg.prototype.getSimplifiedGeometryInternal=function(e){const t=[];t.length=Eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);const o=new Cg(null);return o.setFlatCoordinates(eg.XY,t),o},Cg.prototype.getType=function(){return $p.LINEAR_RING},Cg.prototype.intersectsExtent=function(){},Cg.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=uo(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(eg.XY,null)},Cg.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var Rg=Cg;const Ig=function(e,t){Sg.call(this),this.setCoordinates(e,t)};i(Ig,Sg),Ig.prototype.clone=function(){const e=new Ig(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},Ig.prototype.closestPointXY=function(e,t,o,r){const n=this.flatCoordinates,i=j(e,t,n[0],n[1]);if(i<r){const e=this.stride;for(let t=0;t<e;++t)o[t]=n[t];return o.length=e,i}return r},Ig.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},Ig.prototype.computeExtent=function(e){return Ae(this.flatCoordinates,e)},Ig.prototype.getType=function(){return $p.POINT},Ig.prototype.intersectsExtent=function(e){return ve(e,this.flatCoordinates[0],this.flatCoordinates[1])},Ig.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,0),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=_o(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(eg.XY,null)},Ig.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var Lg=Ig;const Pg=function(e,t){Sg.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(e,t)};i(Pg,Sg),Pg.prototype.appendLinearRing=function(e){this.flatCoordinates?O(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},Pg.prototype.clone=function(){const e=new Pg(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),e},Pg.prototype.closestPointXY=function(e,t,o,r){return r<Ie(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=id(ao(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),po(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,o,r))},Pg.prototype.containsXY=function(e,t){return Po(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)},Pg.prototype.getArea=function(){return oo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},Pg.prototype.getCoordinates=function(e){let t;return void 0===e?t=this.flatCoordinates:(t=this.getOrientedFlatCoordinates().slice(),Bo(t,0,this.ends_,this.stride,e)),ho(t,0,this.ends_,this.stride)},Pg.prototype.getEnds=function(){return this.ends_},Pg.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=We(this.getExtent());this.flatInteriorPoint_=Fo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},Pg.prototype.getInteriorPoint=function(){return new Lg(this.getFlatInteriorPoint(),eg.XYM)},Pg.prototype.getLinearRingCount=function(){return this.ends_.length},Pg.prototype.getLinearRing=function(e){if(0>e||this.ends_.length<=e)return null;const t=new Rg(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e])),t},Pg.prototype.getLinearRings=function(){const e=this.layout,t=this.flatCoordinates,o=this.ends_,r=[];let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a],s=new Rg(null);s.setFlatCoordinates(e,t.slice(n,i)),r.push(s),n=i}return r},Pg.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Uo(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Bo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},Pg.prototype.getSimplifiedGeometryInternal=function(e){const t=[],o=[];t.length=Co(this.flatCoordinates,0,this.ends_,this.stride,id(e),t,0,o);const r=new Pg(null);return r.setFlatCoordinates(eg.XY,t,o),r},Pg.prototype.getType=function(){return $p.POLYGON},Pg.prototype.intersectsExtent=function(e){return Mo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)},Pg.prototype.setCoordinates=function(e,t){if(!e)this.setFlatCoordinates(eg.XY,null,this.ends_);else{this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const o=co(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===o.length?0:o[o.length-1],this.changed()}},Pg.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t),this.ends_=o,this.changed()};var vg=Pg;const Fg=0,Og=function(e){qd.call(this);const t=Dd({},e);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=Nt(t.projection,'EPSG:3857'),this.applyOptions_(t)};i(Og,qd),Og.prototype.applyOptions_=function(e){const t={};t[qp.CENTER]=e.center===void 0?null:e.center;const o=Ho(e);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=e.resolutions,this.minZoom_=o.minZoom;const r=Ko(e),i=o.constraint,n=Zo(e);this.constraints_={center:r,resolution:i,rotation:n},e.resolution===void 0?e.zoom!==void 0&&(t[qp.RESOLUTION]=this.constrainResolution(this.maxResolution_,e.zoom-this.minZoom_),this.resolutions_&&(t[qp.RESOLUTION]=U(+(this.getResolution()||t[qp.RESOLUTION]),this.minResolution_,this.maxResolution_))):t[qp.RESOLUTION]=e.resolution,t[qp.ROTATION]=e.rotation===void 0?0:e.rotation,this.setProperties(t),this.options_=e},Og.prototype.getUpdatedOptions_=function(e){const t=Dd({},this.options_);return void 0===t.resolution?t.zoom=this.getZoom():t.resolution=this.getResolution(),t.center=this.getCenter(),t.rotation=this.getRotation(),Dd({},t,e)},Og.prototype.animate=function(){let e=arguments.length,t;if(1<e&&'function'==typeof arguments[e-1]&&(t=arguments[e-1],--e),!this.isDef()){const o=arguments[e-1];return o.center&&this.setCenter(o.center),void 0!==o.zoom&&this.setZoom(o.zoom),void 0!==o.rotation&&this.setRotation(o.rotation),void(t&&setTimeout(function(){t(!0)},0))}let o=Date.now(),r=this.getCenter().slice(),n=this.getResolution(),i=this.getRotation();const a=[];for(let s=0;s<e;++s){const e=arguments[s],l={start:o,complete:!1,anchor:e.anchor,duration:void 0===e.duration?1e3:e.duration,easing:e.easing||Ee};if(e.center&&(l.sourceCenter=r,l.targetCenter=e.center,r=l.targetCenter),void 0===e.zoom?e.resolution&&(l.sourceResolution=n,l.targetResolution=e.resolution,n=l.targetResolution):(l.sourceResolution=n,l.targetResolution=this.constrainResolution(this.maxResolution_,e.zoom-this.minZoom_,0),n=l.targetResolution),void 0!==e.rotation){l.sourceRotation=i;const t=W(e.rotation-i+$l,2*$l)-$l;l.targetRotation=i+t,i=l.targetRotation}l.callback=t,qo(l)?l.complete=!0:o+=l.duration,a.push(l)}this.animations_.push(a),this.setHint(Zp.ANIMATING,1),this.updateAnimations_()},Og.prototype.getAnimating=function(){return 0<this.hints_[Zp.ANIMATING]},Og.prototype.getInteracting=function(){return 0<this.hints_[Zp.INTERACTING]},Og.prototype.cancelAnimations=function(){this.setHint(Zp.ANIMATING,-this.hints_[Zp.ANIMATING]);for(let e=0,t=this.animations_.length;e<t;++e){const t=this.animations_[e];t[0].callback&&t[0].callback(!1)}this.animations_.length=0},Og.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let o=this.animations_.length-1;0<=o;--o){const r=this.animations_[o];let i=!0;for(let o=0,n=r.length;o<n;++o){const n=r[o];if(n.complete)continue;const a=e-n.start;let s=0<n.duration?a/n.duration:1;1<=s?(n.complete=!0,s=1):i=!1;const l=n.easing(s);if(n.sourceCenter){const e=n.sourceCenter[0],t=n.sourceCenter[1],o=n.targetCenter[0],r=n.targetCenter[1];this.set(qp.CENTER,[e+l*(o-e),t+l*(r-t)])}if(n.sourceResolution&&n.targetResolution){const e=1===l?n.targetResolution:n.sourceResolution+l*(n.targetResolution-n.sourceResolution);n.anchor&&this.set(qp.CENTER,this.calculateCenterZoom(e,n.anchor)),this.set(qp.RESOLUTION,e)}if(void 0!==n.sourceRotation&&void 0!==n.targetRotation){const e=1===l?W(n.targetRotation+$l,2*$l)-$l:n.sourceRotation+l*(n.targetRotation-n.sourceRotation);n.anchor&&this.set(qp.CENTER,this.calculateCenterRotate(e,n.anchor)),this.set(qp.ROTATION,e)}if(t=!0,!n.complete)break}if(i){this.animations_[o]=null,this.setHint(Zp.ANIMATING,-1);const e=r[0].callback;e&&setTimeout(function(){e(!0)},0)}}this.animations_=this.animations_.filter(Boolean),t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))},Og.prototype.calculateCenterRotate=function(e,t){let o;const r=this.getCenter();return void 0!==r&&(o=[r[0]-t[0],r[1]-t[1]],ge(o,e-this.getRotation()),ne(o,t)),o},Og.prototype.calculateCenterZoom=function(e,t){let o;const r=this.getCenter(),i=this.getResolution();if(r!==void 0&&i!==void 0){const n=t[0]-e*(t[0]-r[0])/i,a=t[1]-e*(t[1]-r[1])/i;o=[n,a]}return o},Og.prototype.getSizeFromViewport_=function(){const e=[100,100],t='.ol-viewport[data-view="'+n(this)+'"]',o=document.querySelector(t);if(o){const t=getComputedStyle(o);e[0]=parseInt(t.width,10),e[1]=parseInt(t.height,10)}return e},Og.prototype.constrainCenter=function(e){return this.constraints_.center(e)},Og.prototype.constrainResolution=function(e,t,o){return this.constraints_.resolution(e,t||0,o||0)},Og.prototype.constrainRotation=function(e,t){return this.constraints_.rotation(e,t||0)},Og.prototype.getCenter=function(){return this.get(qp.CENTER)},Og.prototype.getConstraints=function(){return this.constraints_},Og.prototype.getHints=function(e){return void 0===e?this.hints_.slice():(e[0]=this.hints_[0],e[1]=this.hints_[1],e)},Og.prototype.calculateExtent=function(e){const t=e||this.getSizeFromViewport_(),o=this.getCenter();k(o,1);const r=this.getResolution();k(void 0!==r,2);const i=this.getRotation();return k(void 0!==i,3),He(o,r,i,t)},Og.prototype.getMaxResolution=function(){return this.maxResolution_},Og.prototype.getMinResolution=function(){return this.minResolution_},Og.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},Og.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))},Og.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},Og.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))},Og.prototype.getProjection=function(){return this.projection_},Og.prototype.getResolution=function(){return this.get(qp.RESOLUTION)},Og.prototype.getResolutions=function(){return this.resolutions_},Og.prototype.getResolutionForExtent=function(e,t){const o=t||this.getSizeFromViewport_(),r=$e(e)/o[0],i=Ze(e)/o[1];return ld(r,i)},Og.prototype.getResolutionForValueFunction=function(e){const t=e||2,o=this.maxResolution_,r=this.minResolution_,i=ad(o/r)/ad(t);return function(e){const r=o/nd(t,e*i);return r}},Og.prototype.getRotation=function(){return this.get(qp.ROTATION)},Og.prototype.getValueForResolutionFunction=function(e){const t=e||2,o=this.maxResolution_,r=this.minResolution_,i=ad(o/r)/ad(t);return function(e){const r=ad(o/e)/ad(t)/i;return r}},Og.prototype.getState=function(){const e=this.getCenter(),t=this.getProjection(),o=this.getResolution(),r=this.getRotation();return{center:e.slice(),projection:t===void 0?null:t,resolution:o,rotation:r,zoom:this.getZoom()}},Og.prototype.getZoom=function(){let e;const t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e},Og.prototype.getZoomForResolution=function(e){let t=this.minZoom_||0,o,r;if(this.resolutions_){const i=v(this.resolutions_,e,1);t=i,o=this.resolutions_[i],r=i==this.resolutions_.length-1?2:o/this.resolutions_[i+1]}else o=this.maxResolution_,r=this.zoomFactor_;return t+ad(o/e)/ad(r)},Og.prototype.getResolutionForZoom=function(e){return this.constrainResolution(this.maxResolution_,e-this.minZoom_,0)},Og.prototype.fit=function(e,t){const o=t||{};let r=o.size;r||(r=this.getSizeFromViewport_());let i;e instanceof Sg?e.getType()===$p.CIRCLE?(e=e.getExtent(),i=zo(e),i.rotate(this.getRotation(),We(e))):i=e:(k(Array.isArray(e),24),k(!tt(e),25),i=zo(e));const n=void 0===o.padding?[0,0,0,0]:o.padding,a=void 0===o.constrainResolution||o.constrainResolution,s=void 0!==o.nearest&&o.nearest;let l=void 0===o.minResolution?void 0===o.maxZoom?0:this.constrainResolution(this.maxResolution_,o.maxZoom-this.minZoom_,0):o.minResolution;const d=i.getFlatCoordinates(),p=this.getRotation(),g=Jl(-p);let _=ql(-p),u=+Infinity,c=+Infinity,y=-Infinity,m=-Infinity;const h=i.getStride();for(let o=0,r=d.length;o<r;o+=h){const e=d[o]*g-d[o+1]*_,t=d[o]*_+d[o+1]*g;u=rd(u,e),c=rd(c,t),y=ld(y,e),m=ld(m,t)}let f=this.getResolutionForExtent([u,c,y,m],[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]);if(f=isNaN(f)?l:ld(f,l),a){let e=this.constrainResolution(f,0,0);!s&&e<f&&(e=this.constrainResolution(e,-1,0)),f=e}_=-_;let E=(u+y)/2,x=(c+m)/2;E+=(n[1]-n[3])/2*f,x+=(n[0]-n[2])/2*f;const S=E*g-x*_,C=x*g+E*_,R=[S,C],I=o.callback?o.callback:T;void 0===o.duration?(this.setResolution(f),this.setCenter(R),setTimeout(I.bind(void 0,!0),0)):this.animate({resolution:f,center:R,duration:o.duration,easing:o.easing},I)},Og.prototype.centerOn=function(e,t,o){const r=this.getRotation(),i=Jl(-r);let n=ql(-r),a=e[0]*i-e[1]*n,s=e[1]*i+e[0]*n;const l=this.getResolution();a+=(t[0]/2-o[0])*l,s+=(o[1]-t[1]/2)*l,n=-n;const d=a*i-s*n,p=s*i+a*n;this.setCenter([d,p])},Og.prototype.isDef=function(){return!!this.getCenter()&&this.getResolution()!==void 0},Og.prototype.rotate=function(e,t){if(t!==void 0){const o=this.calculateCenterRotate(e,t);this.setCenter(o)}this.setRotation(e)},Og.prototype.setCenter=function(e){this.set(qp.CENTER,e),this.getAnimating()&&this.cancelAnimations()},Og.prototype.setHint=function(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]},Og.prototype.setResolution=function(e){this.set(qp.RESOLUTION,e),this.getAnimating()&&this.cancelAnimations()},Og.prototype.setRotation=function(e){this.set(qp.ROTATION,e),this.getAnimating()&&this.cancelAnimations()},Og.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))};var wg=Og,Ng={OPACITY:'opacity',VISIBLE:'visible',EXTENT:'extent',Z_INDEX:'zIndex',MAX_RESOLUTION:'maxResolution',MIN_RESOLUTION:'minResolution',SOURCE:'source'};const Ag=function(e){qd.call(this);const t=Dd({},e);t[Ng.OPACITY]=e.opacity===void 0?1:e.opacity,t[Ng.VISIBLE]=!(e.visible!==void 0)||e.visible,t[Ng.Z_INDEX]=e.zIndex===void 0?0:e.zIndex,t[Ng.MAX_RESOLUTION]=e.maxResolution===void 0?Infinity:e.maxResolution,t[Ng.MIN_RESOLUTION]=e.minResolution===void 0?0:e.minResolution,this.setProperties(t),this.state_={layer:this,managed:!0},this.type};i(Ag,qd),Ag.prototype.getType=function(){return this.type},Ag.prototype.getLayerState=function(){return this.state_.opacity=U(this.getOpacity(),0,1),this.state_.sourceState=this.getSourceState(),this.state_.visible=this.getVisible(),this.state_.extent=this.getExtent(),this.state_.zIndex=this.getZIndex(),this.state_.maxResolution=this.getMaxResolution(),this.state_.minResolution=ld(this.getMinResolution(),0),this.state_},Ag.prototype.getLayersArray=function(){},Ag.prototype.getLayerStatesArray=function(){},Ag.prototype.getExtent=function(){return this.get(Ng.EXTENT)},Ag.prototype.getMaxResolution=function(){return this.get(Ng.MAX_RESOLUTION)},Ag.prototype.getMinResolution=function(){return this.get(Ng.MIN_RESOLUTION)},Ag.prototype.getOpacity=function(){return this.get(Ng.OPACITY)},Ag.prototype.getSourceState=function(){},Ag.prototype.getVisible=function(){return this.get(Ng.VISIBLE)},Ag.prototype.getZIndex=function(){return this.get(Ng.Z_INDEX)},Ag.prototype.setExtent=function(e){this.set(Ng.EXTENT,e)},Ag.prototype.setMaxResolution=function(e){this.set(Ng.MAX_RESOLUTION,e)},Ag.prototype.setMinResolution=function(e){this.set(Ng.MIN_RESOLUTION,e)},Ag.prototype.setOpacity=function(e){this.set(Ng.OPACITY,e)},Ag.prototype.setVisible=function(e){this.set(Ng.VISIBLE,e)},Ag.prototype.setZIndex=function(e){this.set(Ng.Z_INDEX,e)};var bg=Ag,Mg={UNDEFINED:'undefined',LOADING:'loading',READY:'ready',ERROR:'error'};const Gg={LAYERS:'layers'},Dg=function(e){const t=e||{},o=Dd({},t);delete o.layers;let r=t.layers;bg.call(this,o),this.layersListenerKeys_=[],this.listenerKeys_={},c(this,C(Gg.LAYERS),this.handleLayersChanged_,this),r?Array.isArray(r)?r=new ep(r.slice(),{unique:!0}):(k(r instanceof ep,43),r=r):r=new ep(void 0,{unique:!0}),this.setLayers(r)};i(Dg,bg),Dg.prototype.handleLayerChange_=function(){this.changed()},Dg.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(h),this.layersListenerKeys_.length=0;const e=this.getLayers();for(const t in this.layersListenerKeys_.push(c(e,Md.ADD,this.handleLayersAdd_,this),c(e,Md.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(h);a(this.listenerKeys_);const t=e.getArray();for(let e=0,o=t.length;e<o;e++){const o=t[e];this.listenerKeys_[n(o).toString()]=[c(o,Gd.PROPERTYCHANGE,this.handleLayerChange_,this),c(o,zd.CHANGE,this.handleLayerChange_,this)]}this.changed()},Dg.prototype.handleLayersAdd_=function(e){const t=e.element,o=n(t).toString();this.listenerKeys_[o]=[c(t,Gd.PROPERTYCHANGE,this.handleLayerChange_,this),c(t,zd.CHANGE,this.handleLayerChange_,this)],this.changed()},Dg.prototype.handleLayersRemove_=function(e){const t=e.element,o=n(t).toString();this.listenerKeys_[o].forEach(h),delete this.listenerKeys_[o],this.changed()},Dg.prototype.getLayers=function(){return this.get(Gg.LAYERS)},Dg.prototype.setLayers=function(e){this.set(Gg.LAYERS,e)},Dg.prototype.getLayersArray=function(e){const t=void 0===e?[]:e;return this.getLayers().forEach(function(e){e.getLayersArray(t)}),t},Dg.prototype.getLayerStatesArray=function(e){const t=e===void 0?[]:e,o=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});const r=this.getLayerState();for(let n=o,i=t.length;n<i;n++){const e=t[n];e.opacity*=r.opacity,e.visible=e.visible&&r.visible,e.maxResolution=rd(e.maxResolution,r.maxResolution),e.minResolution=ld(e.minResolution,r.minResolution),r.extent!==void 0&&(e.extent===void 0?e.extent=r.extent:e.extent=qe(e.extent,r.extent))}return t},Dg.prototype.getSourceState=function(){return Mg.READY};var kg=Dg,Ug={MAP_RENDERER:'MAP_RENDERER',LAYER_RENDERER:'LAYER_RENDERER'};const Yg=[],Bg=[];var jg={CANVAS:'canvas',WEBGL:'webgl'};const Vg=function(e){qd.call(this);const t=gr(e);this.maxTilesLoading_=void 0===e.maxTilesLoading?16:e.maxTilesLoading,this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting,this.pixelRatio_=void 0===e.pixelRatio?pp:e.pixelRatio,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=Yt(),this.pixelToCoordinateTransform_=Yt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement('DIV'),this.viewport_.className='ol-viewport'+(up?' ol-touch':''),this.viewport_.style.position='relative',this.viewport_.style.overflow='hidden',this.viewport_.style.width='100%',this.viewport_.style.height='100%',this.viewport_.style.msTouchAction='none',this.viewport_.style.touchAction='none',this.overlayContainer_=document.createElement('DIV'),this.overlayContainer_.className='ol-overlaycontainer',this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement('DIV'),this.overlayContainerStopEvent_.className='ol-overlaycontainer-stopevent';const o=[zd.CLICK,zd.DBLCLICK,zd.MOUSEDOWN,zd.TOUCHSTART,zd.MSPOINTERDOWN,hp.POINTERDOWN,zd.MOUSEWHEEL,zd.WHEEL];for(let t=0,r=o.length;t<r;++t)c(this.overlayContainerStopEvent_,o[t],S);for(const t in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new Dp(this,e.moveTolerance),hp)c(this.mapBrowserEventHandler_,hp[t],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=t.keyboardEventTarget,this.keyHandlerKeys_=null,c(this.viewport_,zd.CONTEXTMENU,this.handleBrowserEvent,this),c(this.viewport_,zd.WHEEL,this.handleBrowserEvent,this),c(this.viewport_,zd.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=t.controls||new ep,this.interactions=t.interactions||new ep,this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=t.mapRendererPlugin.create(this.viewport_,this),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new Xp(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},c(this,C(Up.LAYERGROUP),this.handleLayerGroupChanged_,this),c(this,C(Up.VIEW),this.handleViewChanged_,this),c(this,C(Up.SIZE),this.handleSizeChanged_,this),c(this,C(Up.TARGET),this.handleTargetChanged_,this),this.setProperties(t.values),this.controls.forEach(function(e){e.setMap(this)}.bind(this)),c(this.controls,Md.ADD,function(e){e.element.setMap(this)},this),c(this.controls,Md.REMOVE,function(e){e.element.setMap(null)},this),this.interactions.forEach(function(e){e.setMap(this)}.bind(this)),c(this.interactions,Md.ADD,function(e){e.element.setMap(this)},this),c(this.interactions,Md.REMOVE,function(e){e.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),c(this.overlays_,Md.ADD,function(e){this.addOverlayInternal_(e.element)},this),c(this.overlays_,Md.REMOVE,function(e){const t=e.element,o=t.getId();void 0!==o&&delete this.overlayIdIndex_[o.toString()],e.element.setMap(null)},this)};i(Vg,qd),Vg.prototype.addControl=function(e){this.getControls().push(e)},Vg.prototype.addInteraction=function(e){this.getInteractions().push(e)},Vg.prototype.addLayer=function(e){const t=this.getLayerGroup().getLayers();t.push(e)},Vg.prototype.addOverlay=function(e){this.getOverlays().push(e)},Vg.prototype.addOverlayInternal_=function(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)},Vg.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),m(this.viewport_,zd.CONTEXTMENU,this.handleBrowserEvent,this),m(this.viewport_,zd.WHEEL,this.handleBrowserEvent,this),m(this.viewport_,zd.MOUSEWHEEL,this.handleBrowserEvent,this),this.handleResize_!==void 0&&(removeEventListener(zd.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),qd.prototype.disposeInternal.call(this)},Vg.prototype.forEachFeatureAtPixel=function(e,t,o){if(this.frameState_){const r=this.getCoordinateFromPixel(e);o=void 0===o?{}:o;const i=void 0===o.hitTolerance?0:o.hitTolerance*this.frameState_.pixelRatio,n=void 0===o.layerFilter?E:o.layerFilter;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,i,t,null,n,null)}},Vg.prototype.getFeaturesAtPixel=function(e,t){let o=null;return this.forEachFeatureAtPixel(e,function(e){o||(o=[]),o.push(e)},t),o},Vg.prototype.forEachLayerAtPixel=function(e,t,o,r,i){if(this.frameState_){const n=void 0===o?null:o,a=void 0===r?E:r,s=void 0===i?null:i;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,t,n,a,s)}},Vg.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_)return!1;const o=this.getCoordinateFromPixel(e);t=t===void 0?{}:t;const r=t.layerFilter===void 0?E:t.layerFilter,i=t.hitTolerance===void 0?0:t.hitTolerance*this.frameState_.pixelRatio;return this.renderer_.hasFeatureAtCoordinate(o,this.frameState_,i,r,null)},Vg.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},Vg.prototype.getEventPixel=function(e){const t=this.viewport_.getBoundingClientRect(),o=e.changedTouches?e.changedTouches[0]:e;return[o.clientX-t.left,o.clientY-t.top]},Vg.prototype.getTarget=function(){return this.get(Up.TARGET)},Vg.prototype.getTargetElement=function(){const e=this.getTarget();return void 0===e?null:'string'==typeof e?document.getElementById(e):e},Vg.prototype.getCoordinateFromPixel=function(e){const t=this.frameState_;return t?Xt(t.pixelToCoordinateTransform,e.slice()):null},Vg.prototype.getControls=function(){return this.controls},Vg.prototype.getOverlays=function(){return this.overlays_},Vg.prototype.getOverlayById=function(e){const t=this.overlayIdIndex_[e.toString()];return t===void 0?null:t},Vg.prototype.getInteractions=function(){return this.interactions},Vg.prototype.getLayerGroup=function(){return this.get(Up.LAYERGROUP)},Vg.prototype.getLayers=function(){const e=this.getLayerGroup().getLayers();return e},Vg.prototype.getPixelFromCoordinate=function(e){const t=this.frameState_;return t?Xt(t.coordinateToPixelTransform,e.slice(0,2)):null},Vg.prototype.getRenderer=function(){return this.renderer_},Vg.prototype.getSize=function(){return this.get(Up.SIZE)},Vg.prototype.getView=function(){return this.get(Up.VIEW)},Vg.prototype.getViewport=function(){return this.viewport_},Vg.prototype.getOverlayContainer=function(){return this.overlayContainer_},Vg.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},Vg.prototype.getTilePriority=function(e,t,o,r){const i=this.frameState_;if(!i||!(t in i.wantedTiles))return jp;if(!i.wantedTiles[t][e.getKey()])return jp;const n=o[0]-i.focus[0],a=o[1]-i.focus[1];return 65536*ad(r)+id(n*n+a*a)/r},Vg.prototype.handleBrowserEvent=function(e,t){const o=t||e.type,r=new ip(o,this,e);this.handleMapBrowserEvent(r)},Vg.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){this.focus_=e.coordinate,e.frameState=this.frameState_;const t=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(let o=t.length-1;0<=o;o--){const r=t[o];if(!r.getActive())continue;const i=r.handleEvent(e);if(!i)break}}},Vg.prototype.handlePostRender=function(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let o=this.maxTilesLoading_,r=o;if(e){const t=e.viewHints;t[Zp.ANIMATING]&&(o=this.loadTilesWhileAnimating_?8:0,r=2),t[Zp.INTERACTING]&&(o=this.loadTilesWhileInteracting_?8:0,r=2)}t.getTilesLoading()<o&&(t.reprioritize(),t.loadMoreTiles(o,r))}const o=this.postRenderFunctions_;for(let t=0,r=o.length;t<r;++t)o[t](this,e);o.length=0},Vg.prototype.handleSizeChanged_=function(){this.render()},Vg.prototype.handleTargetChanged_=function(){let e;if(this.getTarget()&&(e=this.getTargetElement()),this.keyHandlerKeys_){for(let e=0,t=this.keyHandlerKeys_.length;e<t;++e)h(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(!e)this.renderer_.removeLayerRenderers(),tr(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(zd.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);else{e.appendChild(this.viewport_);const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[c(t,zd.KEYDOWN,this.handleBrowserEvent,this),c(t,zd.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),addEventListener(zd.RESIZE,this.handleResize_,!1))}this.updateSize()},Vg.prototype.handleTileChange_=function(){this.render()},Vg.prototype.handleViewPropertyChanged_=function(){this.render()},Vg.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(h(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(h(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.viewport_.setAttribute('data-view',n(e)),this.viewPropertyListenerKey_=c(e,Gd.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=c(e,zd.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},Vg.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(h),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[c(e,Gd.PROPERTYCHANGE,this.render,this),c(e,zd.CHANGE,this.render,this)]),this.render()},Vg.prototype.isRendered=function(){return!!this.frameState_},Vg.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},Vg.prototype.render=function(){this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},Vg.prototype.removeControl=function(e){return this.getControls().remove(e)},Vg.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},Vg.prototype.removeLayer=function(e){const t=this.getLayerGroup().getLayers();return t.remove(e)},Vg.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},Vg.prototype.renderFrame_=function(e){let t;const o=this.getSize(),r=this.getView(),i=Oe(),a=this.frameState_;let s=null;if(void 0!==o&&lr(o)&&r&&r.isDef()){const a=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=this.getLayerGroup().getLayerStatesArray(),d={};for(let e=0,t=l.length;e<t;++e)d[n(l[e].layer)]=l[e];t=r.getState();let p=this.focus_;if(!p){p=t.center;const e=t.resolution/this.pixelRatio_;p[0]=Wl(p[0]/e)*e,p[1]=Wl(p[1]/e)*e}s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:i,focus:p,index:this.frameIndex_++,layerStates:d,layerStatesArray:l,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:o,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:t,viewHints:a,wantedTiles:{}}}if(s&&(s.extent=He(t.center,t.resolution,t.rotation,s.size,i)),this.frameState_=s,this.renderer_.renderFrame(s),s){if(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a){const e=!this.previousExtent_||!tt(this.previousExtent_)&&!Ge(s.extent,this.previousExtent_);e&&(this.dispatchEvent(new op(kp.MOVESTART,this,a)),this.previousExtent_=Ne(this.previousExtent_))}const e=this.previousExtent_&&!s.viewHints[Zp.ANIMATING]&&!s.viewHints[Zp.INTERACTING]&&!Ge(s.extent,this.previousExtent_);e&&(this.dispatchEvent(new op(kp.MOVEEND,this,s)),Re(s.extent,this.previousExtent_))}this.dispatchEvent(new op(kp.POSTRENDER,this,s)),setTimeout(this.handlePostRender.bind(this),0)},Vg.prototype.setLayerGroup=function(e){this.set(Up.LAYERGROUP,e)},Vg.prototype.setSize=function(e){this.set(Up.SIZE,e)},Vg.prototype.setTarget=function(e){this.set(Up.TARGET,e)},Vg.prototype.setView=function(e){this.set(Up.VIEW,e)},Vg.prototype.skipFeature=function(e){const t=n(e).toString();this.skippedFeatureUids_[t]=!0,this.render()},Vg.prototype.updateSize=function(){const e=this.getTargetElement();if(!e)this.setSize(void 0);else{const t=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)])}},Vg.prototype.unskipFeature=function(e){const t=n(e).toString();delete this.skippedFeatureUids_[t],this.render()};const zg=[jg.CANVAS,jg.WEBGL];var Xg=Vg;const Wg=function(e){qd.call(this),this.element=e.element?e.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=e.render?e.render:T,e.target&&this.setTarget(e.target)};i(Wg,qd),Wg.prototype.disposeInternal=function(){tr(this.element),qd.prototype.disposeInternal.call(this)},Wg.prototype.getMap=function(){return this.map_},Wg.prototype.setMap=function(e){this.map_&&tr(this.element);for(let t=0,o=this.listenerKeys.length;t<o;++t)h(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,this.map_){const t=this.target_?this.target_:e.getOverlayContainerStopEvent();t.appendChild(this.element),this.render!==T&&this.listenerKeys.push(c(e,kp.POSTRENDER,this.render,this)),e.render()}},Wg.prototype.setTarget=function(e){this.target_='string'==typeof e?document.getElementById(e):e};var Kg=Wg;const Hg='ol-hidden',Zg='ol-unselectable',qg='ol-control',Jg='ol-collapsed',Qg=function(){let e;const t={};return function(o){if(e||(e=document.createElement('div').style),!(o in t)){e.font=o;const r=e.fontFamily;if(e.font='',!r)return null;t[o]=r.split(/,\s?/)}return t[o]}}();var $g={POSTCOMPOSE:'postcompose',PRECOMPOSE:'precompose',RENDER:'render'};const e_=function(e){const t=Dd({},e);delete t.source,bg.call(this,t),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),c(this,C(Ng.SOURCE),this.handleSourcePropertyChange_,this);const o=e.source?e.source:null;this.setSource(o)};i(e_,bg),e_.prototype.getLayersArray=function(e){const t=e?e:[];return t.push(this),t},e_.prototype.getLayerStatesArray=function(e){const t=e?e:[];return t.push(this.getLayerState()),t},e_.prototype.getSource=function(){const e=this.get(Ng.SOURCE);return e||null},e_.prototype.getSourceState=function(){const e=this.getSource();return e?e.getState():Mg.UNDEFINED},e_.prototype.handleSourceChange_=function(){this.changed()},e_.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(h(this.sourceChangeKey_),this.sourceChangeKey_=null);const e=this.getSource();e&&(this.sourceChangeKey_=c(e,zd.CHANGE,this.handleSourceChange_,this)),this.changed()},e_.prototype.setMap=function(e){this.mapPrecomposeKey_&&(h(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(h(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=c(e,$g.PRECOMPOSE,function(e){const t=this.getLayerState();t.managed=!1,t.zIndex=Infinity,e.frameState.layerStatesArray.push(t),e.frameState.layerStates[n(this)]=t},this),this.mapRenderKey_=c(this,zd.CHANGE,e.render,e),this.changed())},e_.prototype.setSource=function(e){this.set(Ng.SOURCE,e)};var t_=e_;const o_=function(e){const t=e?e:{};this.ulElement_=document.createElement('UL'),this.collapsed_=!(t.collapsed!==void 0)||t.collapsed,this.collapsible_=!(t.collapsible!==void 0)||t.collapsible,this.collapsible_||(this.collapsed_=!1);const o=t.className===void 0?'ol-attribution':t.className,r=t.tipLabel===void 0?'Attributions':t.tipLabel,i=t.collapseLabel===void 0?'\xBB':t.collapseLabel;'string'==typeof i?(this.collapseLabel_=document.createElement('span'),this.collapseLabel_.textContent=i):this.collapseLabel_=i;const n=t.label===void 0?'i':t.label;'string'==typeof n?(this.label_=document.createElement('span'),this.label_.textContent=n):this.label_=n;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,s=document.createElement('button');s.setAttribute('type','button'),s.title=r,s.appendChild(a),c(s,zd.CLICK,this.handleClick_,this);const l=o+' '+Zg+' '+qg+(this.collapsed_&&this.collapsible_?' '+Jg:'')+(this.collapsible_?'':' ol-uncollapsible'),d=document.createElement('div');d.className=l,d.appendChild(this.ulElement_),d.appendChild(s),Kg.call(this,{element:d,render:t.render||ur,target:t.target}),this.renderedAttributions_=[],this.renderedVisible_=!0};i(o_,Kg),o_.prototype.getSourceAttributions_=function(e){const t={},o=[],r=e.layerStatesArray,n=e.viewState.resolution;for(let a=0,i=r.length;a<i;++a){const i=r[a];if(!_r(i,n))continue;const s=i.layer.getSource();if(!s)continue;const l=s.getAttributions();if(!l)continue;const d=l(e);if(d)if(Array.isArray(d))for(let e=0,r=d.length;e<r;++e)d[e]in t||(o.push(d[e]),t[d[e]]=!0);else d in t||(o.push(d),t[d]=!0)}return o},o_.prototype.updateElement_=function(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display='none',this.renderedVisible_=!1));const t=this.getSourceAttributions_(e);if(!A(t,this.renderedAttributions_)){or(this.ulElement_);for(let e=0,o=t.length;e<o;++e){const o=document.createElement('LI');o.innerHTML=t[e],this.ulElement_.appendChild(o)}const e=0<t.length;this.renderedVisible_!=e&&(this.element.style.display=e?'':'none',this.renderedVisible_=e),this.renderedAttributions_=t}},o_.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},o_.prototype.handleToggle_=function(){this.element.classList.toggle(Jg),this.collapsed_?er(this.collapseLabel_,this.label_):er(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},o_.prototype.getCollapsible=function(){return this.collapsible_},o_.prototype.setCollapsible=function(e){this.collapsible_===e||(this.collapsible_=e,this.element.classList.toggle('ol-uncollapsible'),!e&&this.collapsed_&&this.handleToggle_())},o_.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},o_.prototype.getCollapsed=function(){return this.collapsed_};var r_=o_;const i_=function(e){const t=e?e:{},o=t.className===void 0?'ol-rotate':t.className,r=t.label===void 0?'\u21E7':t.label;this.label_=null,'string'==typeof r?(this.label_=document.createElement('span'),this.label_.className='ol-compass',this.label_.textContent=r):(this.label_=r,this.label_.classList.add('ol-compass'));const i=t.tipLabel?t.tipLabel:'Reset rotation',n=document.createElement('button');n.className=o+'-reset',n.setAttribute('type','button'),n.title=i,n.appendChild(this.label_),c(n,zd.CLICK,i_.prototype.handleClick_,this);const a=document.createElement('div');a.className=o+' '+Zg+' '+qg,a.appendChild(n),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,Kg.call(this,{element:a,render:t.render||cr,target:t.target}),this.duration_=t.duration===void 0?250:t.duration,this.autoHide_=!(t.autoHide!==void 0)||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Hg)};i(i_,Kg),i_.prototype.handleClick_=function(e){e.preventDefault(),this.callResetNorth_===void 0?this.resetNorth_():this.callResetNorth_()},i_.prototype.resetNorth_=function(){const e=this.getMap(),t=e.getView();t&&(t.getRotation()===void 0||(0<this.duration_?t.animate({rotation:0,duration:this.duration_,easing:fe}):t.setRotation(0)))};var n_=i_;const a_=function(e){const t=e?e:{},o=t.className===void 0?'ol-zoom':t.className,r=t.delta===void 0?1:t.delta,i=t.zoomInLabel===void 0?'+':t.zoomInLabel,n=t.zoomOutLabel===void 0?'\u2212':t.zoomOutLabel,a=t.zoomInTipLabel===void 0?'Zoom in':t.zoomInTipLabel,s=t.zoomOutTipLabel===void 0?'Zoom out':t.zoomOutTipLabel,l=document.createElement('button');l.className=o+'-in',l.setAttribute('type','button'),l.title=a,l.appendChild('string'==typeof i?document.createTextNode(i):i),c(l,zd.CLICK,a_.prototype.handleClick_.bind(this,r));const d=document.createElement('button');d.className=o+'-out',d.setAttribute('type','button'),d.title=s,d.appendChild('string'==typeof n?document.createTextNode(n):n),c(d,zd.CLICK,a_.prototype.handleClick_.bind(this,-r));const p=document.createElement('div');p.className=o+' '+Zg+' '+qg,p.appendChild(l),p.appendChild(d),Kg.call(this,{element:p,target:t.target}),this.duration_=t.duration===void 0?250:t.duration};i(a_,Kg),a_.prototype.handleClick_=function(e,t){t.preventDefault(),this.zoomByDelta_(e)},a_.prototype.zoomByDelta_=function(e){const t=this.getMap(),o=t.getView();if(o){const t=o.getResolution();if(t){const r=o.constrainResolution(t,e);0<this.duration_?(o.getAnimating()&&o.cancelAnimations(),o.animate({resolution:r,duration:this.duration_,easing:fe})):o.setResolution(r)}}};var s_=a_;const l_=function(e,t,o){this.decay_=e,this.minVelocity_=t,this.delay_=o,this.points_=[],this.angle_=0,this.initialVelocity_=0};l_.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},l_.prototype.update=function(e,t){this.points_.push(e,t,Date.now())},l_.prototype.end=function(){if(6>this.points_.length)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let o=t-3;for(;0<o&&this.points_[o+2]>e;)o-=3;const r=this.points_[t+2]-this.points_[o+2];if(r<1e3/60)return!1;const i=this.points_[t]-this.points_[o],n=this.points_[t+1]-this.points_[o+1];return this.angle_=Zl(n,i),this.initialVelocity_=id(i*i+n*n)/r,this.initialVelocity_>this.minVelocity_},l_.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},l_.prototype.getAngle=function(){return this.angle_};var d_=l_,p_={ACTIVE:'active'};const g_=function(e){qd.call(this),this.map_=null,this.setActive(!0),this.handleEvent=e.handleEvent};i(g_,qd),g_.prototype.getActive=function(){return this.get(p_.ACTIVE)},g_.prototype.getMap=function(){return this.map_},g_.prototype.setActive=function(e){this.set(p_.ACTIVE,e)},g_.prototype.setMap=function(e){this.map_=e};var __=g_;const u_=function(e){const t=e?e:{};this.delta_=t.delta?t.delta:1,__.call(this,{handleEvent:Sr}),this.duration_=t.duration===void 0?250:t.duration};i(u_,__);var c_=u_;const y_=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},m_=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},h_=E,f_=function(e){const t=e.originalEvent;return 0==t.button&&!(lp&&dp&&t.ctrlKey)},E_=x,x_=function(e){return'pointermove'==e.type},T_=function(e){return e.type==hp.SINGLECLICK},S_=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},C_=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},R_=function(e){const t=e.originalEvent.target,o=t.tagName;return'INPUT'!==o&&'SELECT'!==o&&'TEXTAREA'!==o},I_=function(e){return k(e.pointerEvent,56),'mouse'==e.pointerEvent.pointerType},L_=function(e){const t=e.pointerEvent;return t.isPrimary&&0===t.button},P_=function(e){const t=e?e:{};__.call(this,{handleEvent:t.handleEvent||Ir}),this.handleDownEvent_=t.handleDownEvent?t.handleDownEvent:x,this.handleDragEvent_=t.handleDragEvent?t.handleDragEvent:T,this.handleMoveEvent_=t.handleMoveEvent?t.handleMoveEvent:T,this.handleUpEvent_=t.handleUpEvent?t.handleUpEvent:x,this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]};i(P_,__),P_.prototype.updateTrackedPointers_=function(e){if(Rr(e)){const t=e.pointerEvent,o=t.pointerId.toString();e.type==hp.POINTERUP?delete this.trackedPointers_[o]:e.type==hp.POINTERDOWN?this.trackedPointers_[o]=t:o in this.trackedPointers_&&(this.trackedPointers_[o]=t),this.targetPointers=s(this.trackedPointers_)}},P_.prototype.shouldStopEvent=function(e){return e};var v_=P_;const F_=function(e){v_.call(this,{handleDownEvent:vr,handleDragEvent:Lr,handleUpEvent:Pr});const t=e?e:{};this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.condition_=t.condition?t.condition:S_,this.noKinetic_=!1};i(F_,v_),F_.prototype.shouldStopEvent=x;var O_=F_;const w_=function(e){const t=e?e:{};v_.call(this,{handleDownEvent:Nr,handleDragEvent:Fr,handleUpEvent:wr}),this.condition_=t.condition?t.condition:m_,this.lastAngle_=void 0,this.duration_=t.duration===void 0?250:t.duration};i(w_,v_),w_.prototype.shouldStopEvent=x;var N_=w_;const A_=function(e){this.geometry_=null,this.element_=document.createElement('div'),this.element_.style.position='absolute',this.element_.className='ol-box '+e,this.map_=null,this.startPixel_=null,this.endPixel_=null};i(A_,Ud),A_.prototype.disposeInternal=function(){this.setMap(null)},A_.prototype.render_=function(){const e=this.startPixel_,t=this.endPixel_,o='px',r=this.element_.style;r.left=rd(e[0],t[0])+o,r.top=rd(e[1],t[1])+o,r.width=od(t[0]-e[0])+o,r.height=od(t[1]-e[1])+o},A_.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left=e.top=e.width=e.height='inherit'}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},A_.prototype.setPixels=function(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()},A_.prototype.createOrUpdateGeometry=function(){const e=this.startPixel_,t=this.endPixel_,o=[e,[e[0],t[1]],t,[t[0],e[1]]],r=o.map(this.map_.getCoordinateFromPixel,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new vg([r])},A_.prototype.getGeometry=function(){return this.geometry_};const b_={BOXSTART:'boxstart',BOXDRAG:'boxdrag',BOXEND:'boxend'},M_=function(e,t,o){Bd.call(this,e),this.coordinate=t,this.mapBrowserEvent=o};i(M_,Bd);const G_=function(e){v_.call(this,{handleDownEvent:Gr,handleDragEvent:br,handleUpEvent:Mr});const t=e?e:{};this.box_=new A_(t.className||'ol-dragbox'),this.minArea_=t.minArea===void 0?64:t.minArea,this.startPixel_=null,this.condition_=t.condition?t.condition:h_,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:Ar};i(G_,v_),G_.prototype.getGeometry=function(){return this.box_.getGeometry()},G_.prototype.onBoxEnd=T;var D_=G_;const k_=function(e){const t=e?e:{},o=t.condition?t.condition:C_;this.duration_=t.duration===void 0?200:t.duration,this.out_=t.out!==void 0&&t.out,D_.call(this,{condition:o,className:t.className||'ol-dragzoom'})};i(k_,D_),k_.prototype.onBoxEnd=function(){const e=this.getMap(),t=e.getView(),o=e.getSize();let r=this.getGeometry().getExtent();if(this.out_){const i=t.calculateExtent(o),n=be([e.getPixelFromCoordinate(ze(r)),e.getPixelFromCoordinate(Qe(r))]),a=t.getResolutionForExtent(n,o);rt(i,1/a),r=i}const i=t.constrainResolution(t.getResolutionForExtent(r,o));let n=We(r);n=t.constrainCenter(n),t.animate({resolution:i,center:n,duration:this.duration_,easing:fe})};var U_=k_,Y_={LEFT:37,UP:38,RIGHT:39,DOWN:40};const B_=function(e){__.call(this,{handleEvent:Dr});const t=e||{};this.defaultCondition_=function(e){return S_(e)&&R_(e)},this.condition_=t.condition===void 0?this.defaultCondition_:t.condition,this.duration_=t.duration===void 0?100:t.duration,this.pixelDelta_=t.pixelDelta===void 0?128:t.pixelDelta};i(B_,__);var j_=B_;const V_=function(e){__.call(this,{handleEvent:kr});const t=e?e:{};this.condition_=t.condition?t.condition:R_,this.delta_=t.delta?t.delta:1,this.duration_=t.duration===void 0?100:t.duration};i(V_,__);var z_=V_;const X_={TRACKPAD:'trackpad',WHEEL:'wheel'},W_=function(e){__.call(this,{handleEvent:Ur});const t=e||{};this.delta_=0,this.duration_=t.duration===void 0?250:t.duration,this.timeout_=t.timeout===void 0?80:t.timeout,this.useAnchor_=!(t.useAnchor!==void 0)||t.useAnchor,this.constrainResolution_=t.constrainResolution||!1,this.condition_=t.condition?t.condition:h_,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_=void 0,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5};i(W_,__),W_.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;const e=this.getMap().getView();e.setHint(Zp.INTERACTING,-1)},W_.prototype.handleWheelZoom_=function(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();const o=1,r=U(this.delta_,-o,o);xr(t,-r,this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},W_.prototype.setMouseAnchor=function(e){this.useAnchor_=e,e||(this.lastAnchor_=null)};var K_=W_;const H_=function(e){v_.call(this,{handleDownEvent:jr,handleDragEvent:Yr,handleUpEvent:Br});const t=e||{};this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold===void 0?.3:t.threshold,this.duration_=t.duration===void 0?250:t.duration};i(H_,v_),H_.prototype.shouldStopEvent=x;var Z_=H_;const q_=function(e){v_.call(this,{handleDownEvent:Xr,handleDragEvent:Vr,handleUpEvent:zr});const t=e?e:{};this.constrainResolution_=t.constrainResolution||!1,this.anchor_=null,this.duration_=t.duration===void 0?400:t.duration,this.lastDistance_=void 0,this.lastScaleDelta_=1};i(q_,v_),q_.prototype.shouldStopEvent=x;var J_=q_;const Q_=.5,$_=function(e,t,o,r){Vd.call(this),this.extent=e,this.pixelRatio_=o,this.resolution=t,this.state=r};i($_,Vd),$_.prototype.changed=function(){this.dispatchEvent(zd.CHANGE)},$_.prototype.getExtent=function(){return this.extent},$_.prototype.getImage=function(){},$_.prototype.getPixelRatio=function(){return this.pixelRatio_},$_.prototype.getResolution=function(){return this.resolution},$_.prototype.getState=function(){return this.state},$_.prototype.load=function(){};var eu=$_,tu={IDLE:0,LOADING:1,LOADED:2,ERROR:3};const ou=function(e,t,o,r,i){this.loader_=i===void 0?null:i;const n=i===void 0?tu.LOADED:tu.IDLE;eu.call(this,e,t,o,n),this.canvas_=r,this.error_=null};i(ou,eu),ou.prototype.getError=function(){return this.error_},ou.prototype.handleLoad_=function(e){e?(this.error_=e,this.state=tu.ERROR):this.state=tu.LOADED,this.changed()},ou.prototype.load=function(){this.state==tu.IDLE&&(this.state=tu.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},ou.prototype.getImage=function(){return this.canvas_};var ru=ou,iu={IMAGE:'IMAGE',TILE:'TILE',VECTOR_TILE:'VECTOR_TILE',VECTOR:'VECTOR'},nu={IMAGE:'image',VECTOR:'vector'};const au=function(e,t,o,r,i){Bd.call(this,e),this.vectorContext=t,this.frameState=o,this.context=r,this.glContext=i};i(au,Bd);var su=au;const lu=function(e){Vd.call(this),this.highWaterMark=e===void 0?2048:e,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null};i(lu,Vd),lu.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},lu.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(zd.CLEAR)},lu.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},lu.prototype.forEach=function(e,t){for(let o=this.oldest_;o;)e.call(t,o.value_,o.key_,this),o=o.newer},lu.prototype.get=function(e){const t=this.entries_[e];return(k(void 0!==t,15),t===this.newest_)?t.value_:(t===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(t.newer.older=t.older,t.older.newer=t.newer),t.newer=null,t.older=this.newest_,this.newest_.newer=t,this.newest_=t,t.value_)},lu.prototype.remove=function(e){const t=this.entries_[e];return k(void 0!==t,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},lu.prototype.getCount=function(){return this.count_},lu.prototype.getKeys=function(){const e=Array(this.count_);let t=0,o;for(o=this.newest_;o;o=o.older)e[t++]=o.key_;return e},lu.prototype.getValues=function(){const e=Array(this.count_);let t=0,o;for(o=this.newest_;o;o=o.older)e[t++]=o.value_;return e},lu.prototype.peekLast=function(){return this.oldest_.value_},lu.prototype.peekLastKey=function(){return this.oldest_.key_},lu.prototype.peekFirstKey=function(){return this.newest_.key_},lu.prototype.pop=function(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},lu.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},lu.prototype.set=function(e,t){k(!(e in this.entries_),16);const o={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=o:this.oldest_=o,this.newest_=o,this.entries_[e]=o,++this.count_},lu.prototype.setSize=function(e){this.highWaterMark=e},lu.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};var du=lu;const pu='10px sans-serif',gu=[0,0,0,1],_u='round',uu=[],cu=0,yu='round',mu=10,hu=[0,0,0,1],fu='center',Eu='middle',xu=[0,0,0,0],Tu=1,Su=new du,Cu={};let Ru=null;const Iu={},Lu=function(){function e(e){const t=Kr();let o=!0;for(let r=0;r<l;++r){const i=s[r];if(t.font=n+i,g=t.measureText(d).width,e!=i){t.font=n+e+','+i;const r=t.measureText(d).width;o=o&&r!=g}}return o}function t(){let t=!0;for(const i in r)r[i]<o&&(e(i)?(r[i]=o,a(Iu),Ru=null,Su.clear()):(++r[i],t=!1));t&&(clearInterval(p),p=void 0)}const o=60,r=Cu,n='32px ',s=['monospace','serif'],l=s.length,d='wmytzilWMYTZIL@#/&?$%10\uF013';let p,g;return function(i){const n=Qg(i);if(n)for(let a=0,i=n.length;a<i;++a){const i=n[a];i in r||(r[i]=o,!e(i)&&(r[i]=0,void 0===p&&(p=setInterval(t,32))))}}}(),Pu=function(){let e;const t=Iu;return function(o){let r=t[o];return void 0==r&&(!e&&(e=document.createElement('span'),e.textContent='M',e.style.margin=e.style.padding='0 !important',e.style.position='absolute !important',e.style.left='-99999px !important'),e.style.font=o,document.body.appendChild(e),r=t[o]=e.offsetHeight,document.body.removeChild(e)),r}}(),vu=Yt(),Fu=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Ou=/^([a-z]*)$/i,wu=function(){const e={};let t=0;return function(o){let r;if(e.hasOwnProperty(o))r=e[o];else{if(t>=1024){let o=0;for(const r in e)0==(3&o++)&&(delete e[r],--t)}r=ei(o),e[o]=r,++t}return r}}(),Nu=function(){};Nu.prototype.drawCustom=function(){},Nu.prototype.drawGeometry=function(){},Nu.prototype.setStyle=function(){},Nu.prototype.drawCircle=function(){},Nu.prototype.drawFeature=function(){},Nu.prototype.drawGeometryCollection=function(){},Nu.prototype.drawLineString=function(){},Nu.prototype.drawMultiLineString=function(){},Nu.prototype.drawMultiPoint=function(){},Nu.prototype.drawMultiPolygon=function(){},Nu.prototype.drawPoint=function(){},Nu.prototype.drawPolygon=function(){},Nu.prototype.drawText=function(){},Nu.prototype.setFillStrokeStyle=function(){},Nu.prototype.setImageStyle=function(){},Nu.prototype.setTextStyle=function(){};var Au=Nu;const bu=function(e,t,o,r,i){Au.call(this),this.context_=e,this.pixelRatio_=t,this.extent_=o,this.transform_=r,this.viewRotation_=i,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageSnapToPixel_=!1,this.imageWidth_=0,this.text_='',this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Yt()};i(bu,Au),bu.prototype.drawImages_=function(e,t,o){if(!this.image_)return;const r=at(e,t,o,2,this.transform_,this.pixelCoordinates_),n=this.context_,i=this.tmpLocalTransform_,a=n.globalAlpha;1!=this.imageOpacity_&&(n.globalAlpha=a*this.imageOpacity_);let s=this.imageRotation_;this.imageRotateWithView_&&(s+=this.viewRotation_);for(let a=0,l=r.length;a<l;a+=2){let e=r[a]-this.imageAnchorX_,t=r[a+1]-this.imageAnchorY_;if(this.imageSnapToPixel_&&(e=Wl(e),t=Wl(t)),0!==s||1!=this.imageScale_){const o=e+this.imageAnchorX_,r=t+this.imageAnchorY_;Zt(i,o,r,this.imageScale_,this.imageScale_,s,-o,-r),n.setTransform.apply(n,i)}n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,t,this.imageWidth_,this.imageHeight_)}(0!==s||1!=this.imageScale_)&&n.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(n.globalAlpha=a)},bu.prototype.drawText_=function(e,t,o,r){if(!this.textState_||''===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const i=at(e,t,o,r,this.transform_,this.pixelCoordinates_),n=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);t<o;t+=r){const e=i[t]+this.textOffsetX_,o=i[t+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_){const t=Zt(this.tmpLocalTransform_,e,o,this.textScale_,this.textScale_,a,-e,-o);n.setTransform.apply(n,t)}this.textStrokeState_&&n.strokeText(this.text_,e,o),this.textFillState_&&n.fillText(this.text_,e,o)}(0!==a||1!=this.textScale_)&&n.setTransform(1,0,0,1,0,0)},bu.prototype.moveToLineTo_=function(e,t,o,r,i){const n=this.context_,a=at(e,t,o,r,this.transform_,this.pixelCoordinates_);n.moveTo(a[0],a[1]);let s=a.length;i&&(s-=2);for(let l=2;l<s;l+=2)n.lineTo(a[l],a[l+1]);return i&&n.closePath(),o},bu.prototype.drawRings_=function(e,t,o,r){for(let n=0,i=o.length;n<i;++n)t=this.moveToLineTo_(e,t,o[n],r,!0);return t},bu.prototype.drawCircle=function(e){if(et(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=eo(e,this.transform_,this.pixelCoordinates_),o=t[2]-t[0],r=t[3]-t[1],i=id(o*o+r*r),n=this.context_;n.beginPath(),n.arc(t[0],t[1],i,0,2*$l),this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}''!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}},bu.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},bu.prototype.drawGeometry=function(e){const t=e.getType();switch(t){case $p.POINT:this.drawPoint(e);break;case $p.LINE_STRING:this.drawLineString(e);break;case $p.POLYGON:this.drawPolygon(e);break;case $p.MULTI_POINT:this.drawMultiPoint(e);break;case $p.MULTI_LINE_STRING:this.drawMultiLineString(e);break;case $p.MULTI_POLYGON:this.drawMultiPolygon(e);break;case $p.GEOMETRY_COLLECTION:this.drawGeometryCollection(e);break;case $p.CIRCLE:this.drawCircle(e);break;default:}},bu.prototype.drawFeature=function(e,t){const o=t.getGeometryFunction()(e);o&&et(this.extent_,o.getExtent())&&(this.setStyle(t),this.drawGeometry(o))},bu.prototype.drawGeometryCollection=function(e){const t=e.getGeometriesArray();for(let o=0,r=t.length;o<r;++o)this.drawGeometry(t[o])},bu.prototype.drawPoint=function(e){const t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o),''!==this.text_&&this.drawText_(t,0,t.length,o)},bu.prototype.drawMultiPoint=function(e){const t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o),''!==this.text_&&this.drawText_(t,0,t.length,o)},bu.prototype.drawLineString=function(e){if(et(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(o,0,o.length,e.getStride(),!1),t.stroke()}if(''!==this.text_){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}},bu.prototype.drawMultiLineString=function(e){const t=e.getExtent();if(et(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getFlatCoordinates();let r=0;const n=e.getEnds(),a=e.getStride();t.beginPath();for(let e=0,t=n.length;e<t;++e)r=this.moveToLineTo_(o,r,n[e],a,!1);t.stroke()}if(''!==this.text_){const t=e.getFlatMidpoints();this.drawText_(t,0,t.length,2)}}},bu.prototype.drawPolygon=function(e){if(et(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(''!==this.text_){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}},bu.prototype.drawMultiPolygon=function(e){if(et(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getOrientedFlatCoordinates();let r=0;const n=e.getEndss(),a=e.getStride();t.beginPath();for(let e=0,t=n.length;e<t;++e){const t=n[e];r=this.drawRings_(o,r,t,a)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(''!==this.text_){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}},bu.prototype.setContextFillState_=function(e){const t=this.context_,o=this.contextFillState_;o?o.fillStyle!=e.fillStyle&&(o.fillStyle=t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})},bu.prototype.setContextStrokeState_=function(e){const t=this.context_,o=this.contextStrokeState_;o?(o.lineCap!=e.lineCap&&(o.lineCap=t.lineCap=e.lineCap),gp&&(!A(o.lineDash,e.lineDash)&&t.setLineDash(o.lineDash=e.lineDash),o.lineDashOffset!=e.lineDashOffset&&(o.lineDashOffset=t.lineDashOffset=e.lineDashOffset)),o.lineJoin!=e.lineJoin&&(o.lineJoin=t.lineJoin=e.lineJoin),o.lineWidth!=e.lineWidth&&(o.lineWidth=t.lineWidth=e.lineWidth),o.miterLimit!=e.miterLimit&&(o.miterLimit=t.miterLimit=e.miterLimit),o.strokeStyle!=e.strokeStyle&&(o.strokeStyle=t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,gp&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})},bu.prototype.setContextTextState_=function(e){const t=this.context_,o=this.contextTextState_,r=e.textAlign?e.textAlign:fu;o?(o.font!=e.font&&(o.font=t.font=e.font),o.textAlign!=r&&(o.textAlign=r),o.textBaseline!=e.textBaseline&&(o.textBaseline=t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})},bu.prototype.setFillStrokeStyle=function(e,t){if(!e)this.fillState_=null;else{const t=e.getColor();this.fillState_={fillStyle:ri(t?t:gu)}}if(!t)this.strokeState_=null;else{const e=t.getColor(),o=t.getLineCap(),r=t.getLineDash(),i=t.getLineDashOffset(),n=t.getLineJoin(),a=t.getWidth(),s=t.getMiterLimit();this.strokeState_={lineCap:void 0===o?_u:o,lineDash:r?r:uu,lineDashOffset:i?i:cu,lineJoin:void 0===n?yu:n,lineWidth:this.pixelRatio_*(void 0===a?Tu:a),miterLimit:void 0===s?mu:s,strokeStyle:ri(e?e:hu)}}},bu.prototype.setImageStyle=function(e){if(!e)this.image_=null;else{const t=e.getAnchor(),o=e.getImage(1),r=e.getOrigin(),i=e.getSize();this.imageAnchorX_=t[0],this.imageAnchorY_=t[1],this.imageHeight_=i[1],this.image_=o,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation(),this.imageScale_=e.getScale()*this.pixelRatio_,this.imageSnapToPixel_=e.getSnapToPixel(),this.imageWidth_=i[0]}},bu.prototype.setTextStyle=function(e){if(!e)this.text_='';else{const t=e.getFill();if(!t)this.textFillState_=null;else{const e=t.getColor();this.textFillState_={fillStyle:ri(e?e:gu)}}const o=e.getStroke();if(!o)this.textStrokeState_=null;else{const e=o.getColor(),t=o.getLineCap(),r=o.getLineDash(),i=o.getLineDashOffset(),n=o.getLineJoin(),a=o.getWidth(),s=o.getMiterLimit();this.textStrokeState_={lineCap:t===void 0?_u:t,lineDash:r?r:uu,lineDashOffset:i?i:cu,lineJoin:n===void 0?yu:n,lineWidth:a===void 0?Tu:a,miterLimit:s===void 0?mu:s,strokeStyle:ri(e?e:hu)}}const r=e.getFont(),i=e.getOffsetX(),n=e.getOffsetY(),a=e.getRotateWithView(),s=e.getRotation(),l=e.getScale(),d=e.getText(),p=e.getTextAlign(),g=e.getTextBaseline();this.textState_={font:r===void 0?pu:r,textAlign:p===void 0?fu:p,textBaseline:g===void 0?Eu:g},this.text_=d===void 0?'':d,this.textOffsetX_=i===void 0?0:this.pixelRatio_*i,this.textOffsetY_=n===void 0?0:this.pixelRatio_*n,this.textRotateWithView_=a!==void 0&&a,this.textRotation_=s===void 0?0:s,this.textScale_=this.pixelRatio_*(l===void 0?1:l)}};var Mu=bu;const Gu=function(e){Wd.call(this),this.layer_=e};i(Gu,Wd),Gu.prototype.forEachFeatureAtCoordinate=T,Gu.prototype.hasFeatureAtCoordinate=x,Gu.prototype.createLoadedTileFinder=function(e,t,o){return function(r,i){return e.forEachLoadedTile(t,r,i,function(e){o[r]||(o[r]={}),o[r][e.tileCoord.toString()]=e})}},Gu.prototype.getLayer=function(){return this.layer_},Gu.prototype.handleImageChange_=function(e){const t=e.target;t.getState()===tu.LOADED&&this.renderIfReadyAndVisible()},Gu.prototype.loadImage=function(e){let t=e.getState();return t!=tu.LOADED&&t!=tu.ERROR&&c(e,zd.CHANGE,this.handleImageChange_,this),t==tu.IDLE&&(e.load(),t=e.getState()),t==tu.LOADED},Gu.prototype.renderIfReadyAndVisible=function(){const e=this.getLayer();e.getVisible()&&e.getSourceState()==Mg.READY&&this.changed()},Gu.prototype.scheduleExpireCache=function(e,t){if(t.canExpireCache()){const o=function(e,t,o){const r=n(e).toString();r in o.usedTiles&&e.expireCache(o.viewState.projection,o.usedTiles[r])}.bind(null,t);e.postRenderFunctions.push(o)}},Gu.prototype.updateUsedTiles=function(e,t,o,r){const i=n(t).toString(),a=o.toString();i in e?a in e[i]?e[i][a].extend(r):e[i][a]=r:(e[i]={},e[i][a]=r)},Gu.prototype.manageTilePyramid=function(e,t,o,r,i,a,s,l,d,p){const g=n(t).toString();g in e.wantedTiles||(e.wantedTiles[g]={});const _=e.wantedTiles[g],u=e.tileQueue,c=o.getMinZoom();let m,h,f,E,x,y;for(y=c;y<=s;++y)for(h=o.getTileRangeForExtentAndZ(a,y,h),f=o.getResolution(y),E=h.minX;E<=h.maxX;++E)for(x=h.minY;x<=h.maxY;++x)s-y<=l?(m=t.getTile(y,E,x,r,i),m.getState()==Yp.IDLE&&(_[m.getKey()]=!0,!u.isKeyQueued(m.getKey())&&u.enqueue([m,g,o.getTileCoordCenter(m.tileCoord),f])),void 0!==d&&d.call(p,m)):t.useTile(y,E,x,i)};var Du=Gu;const ku=function(e){Du.call(this,e),this.renderedResolution,this.transform_=Yt()};i(ku,Du),ku.prototype.clip=function(e,t,o){const r=t.pixelRatio,i=t.size[0]*r,n=t.size[1]*r,a=t.viewState.rotation,s=Je(o),l=Qe(o),d=Xe(o),p=ze(o);Xt(t.coordinateToPixelTransform,s),Xt(t.coordinateToPixelTransform,l),Xt(t.coordinateToPixelTransform,d),Xt(t.coordinateToPixelTransform,p),e.save(),Zr(e,-a,i/2,n/2),e.beginPath(),e.moveTo(s[0]*r,s[1]*r),e.lineTo(l[0]*r,l[1]*r),e.lineTo(d[0]*r,d[1]*r),e.lineTo(p[0]*r,p[1]*r),e.clip(),Zr(e,a,i/2,n/2)},ku.prototype.dispatchComposeEvent_=function(e,t,o,r){const i=this.getLayer();if(i.hasListener(e)){const n=o.size[0]*o.pixelRatio,a=o.size[1]*o.pixelRatio,s=o.viewState.rotation;Zr(t,-s,n/2,a/2);const l=r===void 0?this.getTransform(o,0):r,d=new Mu(t,o.pixelRatio,o.extent,l,o.viewState.rotation),p=new su(e,d,o,t,null);i.dispatchEvent(p),Zr(t,s,n/2,a/2)}},ku.prototype.forEachLayerAtCoordinate=function(e,t,o,r){const i=this.forEachFeatureAtCoordinate(e,t,0,E,this);return i?o.call(r,this.getLayer(),null):void 0},ku.prototype.postCompose=function(e,t,o,r){this.dispatchComposeEvent_($g.POSTCOMPOSE,e,t,r)},ku.prototype.preCompose=function(e,t,o){this.dispatchComposeEvent_($g.PRECOMPOSE,e,t,o)},ku.prototype.dispatchRenderEvent=function(e,t,o){this.dispatchComposeEvent_($g.RENDER,e,t,o)},ku.prototype.getTransform=function(e,t){const o=e.viewState,r=e.pixelRatio,i=r*e.size[0]/2,n=r*e.size[1]/2,a=r/o.resolution,s=-o.rotation,l=-o.center[0]+t,d=-o.center[1];return Zt(this.transform_,i,n,a,-a,s,l,d)},ku.prototype.composeFrame=function(){},ku.prototype.prepareFrame=function(){};var Uu=ku;const Yu=function(e){Uu.call(this,e),this.coordinateToCanvasPixelTransform=Yt(),this.hitCanvasContext_=null};i(Yu,Uu),Yu.prototype.composeFrame=function(e,t,o){this.preCompose(o,e);const r=this.getImage();if(r){const i=t.extent,n=i!==void 0&&!Pe(i,e.extent)&&et(i,e.extent);n&&this.clip(o,e,i);const a=this.getImageTransform(),s=o.globalAlpha;o.globalAlpha=t.opacity;const l=a[4],d=a[5],p=r.width*a[0],g=r.height*a[3];o.drawImage(r,0,0,+r.width,+r.height,Wl(l),Wl(d),Wl(p),Wl(g)),o.globalAlpha=s,n&&o.restore()}this.postCompose(o,e,t)},Yu.prototype.getImage=function(){},Yu.prototype.getImageTransform=function(){},Yu.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){const n=this.getLayer(),a=n.getSource(),s=t.viewState.resolution,l=t.viewState.rotation,d=t.skippedFeatureUids;return a.forEachFeatureAtCoordinate(e,s,l,o,d,function(e){return r.call(i,e,n)})},Yu.prototype.forEachLayerAtCoordinate=function(e,t,o,r){if(this.getImage())if(this.getLayer().getSource().forEachFeatureAtCoordinate!==T)return Uu.prototype.forEachLayerAtCoordinate.apply(this,arguments);else{const i=Xt(this.coordinateToCanvasPixelTransform,e.slice());_e(i,t.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=Jo(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),i[0],i[1],1,1,0,0,1,1);const n=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<n[3]?o.call(r,this.getLayer(),n):void 0}};var Bu=Yu;const ju=function(e){Bu.call(this,e),this.image_=null,this.imageTransform_=Yt(),this.skippedFeatures_=[],this.vectorRenderer_=null};i(ju,Bu),ju.handles=function(e,t){return e===jg.CANVAS&&(t.getType()===iu.IMAGE||t.getType()===iu.VECTOR&&t.getRenderMode()===nu.IMAGE)},ju.create=function(e,t){const o=new ju(t);if(t.getType()===iu.VECTOR){const r=ir();for(let n=0,i=r.length;n<i;++n){const i=r[n];if(i!==ju&&i.handles(jg.CANVAS,t)){o.setVectorRenderer(i.create(e,t));break}}}return o},ju.prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),Bu.prototype.disposeInternal.call(this)},ju.prototype.getImage=function(){return this.image_?this.image_.getImage():null},ju.prototype.getImageTransform=function(){return this.imageTransform_},ju.prototype.prepareFrame=function(e,t){const o=e.pixelRatio,r=e.size,i=e.viewState,n=i.center,a=i.resolution;let s;const l=this.getLayer(),d=l.getSource(),p=e.viewHints;let g=e.extent;if(void 0!==t.extent&&(g=qe(g,t.extent)),!p[Zp.ANIMATING]&&!p[Zp.INTERACTING]&&!tt(g)){let r=i.projection;const n=this.vectorRenderer_;if(n){const r=n.context,i=Dd({},e,{size:[$e(g)/a,Ze(g)/a],viewState:Dd({},e.viewState,{rotation:0})}),s=Object.keys(i.skippedFeatureUids).sort();n.prepareFrame(i,t)&&(n.replayGroupChanged||!A(s,this.skippedFeatures_))&&(r.canvas.width=i.size[0]*o,r.canvas.height=i.size[1]*o,n.composeFrame(i,t,r),this.image_=new ru(g,a,o,r.canvas),this.skippedFeatures_=s)}else if(s=d.getImage(g,a,o,r),s){const e=this.loadImage(s);e&&(this.image_=s)}}if(this.image_){s=this.image_;const e=s.getExtent(),t=s.getResolution(),i=s.getPixelRatio(),l=o*t/(a*i),d=Zt(this.imageTransform_,o*r[0]/2,o*r[1]/2,l,l,0,i*(e[0]-n[0])/t,i*(n[1]-e[3])/t);Zt(this.coordinateToCanvasPixelTransform,o*r[0]/2-d[4],o*r[1]/2-d[5],o/a,-o/a,0,-n[0],-n[1]),this.renderedResolution=t*o/i}return!!this.image_},ju.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,o,r,i):Bu.prototype.forEachFeatureAtCoordinate.call(this,e,t,o,r,i)},ju.prototype.setVectorRenderer=function(e){this.vectorRenderer_&&this.vectorRenderer_.dispose(),this.vectorRenderer_=e};var Vu=ju;const zu=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};zu.prototype.clear=function(){this.cache_={},this.cacheSize_=0},zu.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){let e=0;for(const t in this.cache_){const o=this.cache_[t];0!=(3&e++)||o.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}},zu.prototype.get=function(e,t,o){const r=ni(e,t,o);return r in this.cache_?this.cache_[r]:null},zu.prototype.set=function(e,t,o,r){const i=ni(e,t,o);this.cache_[i]=r,++this.cacheSize_},zu.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()};const Xu=new zu,Wu=function(e,t){Ud.call(this),this.map_=t,this.layerRenderers_={},this.layerRendererListeners_={}};i(Wu,Ud),Wu.prototype.calculateMatrices2D=function(e){const t=e.viewState,o=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Zt(o,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),qt(zt(r,o))},Wu.prototype.removeLayerRenderers=function(){for(const e in this.layerRenderers_)this.removeLayerRendererByKey_(e).dispose()},Wu.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,a,s,l){function d(e,o){const i=n(e).toString(),s=t.layerStates[n(o)].managed;if(!(i in t.skippedFeatureUids)||s)return r.call(a,e,s?o:null)}let p;const g=t.viewState,_=g.resolution,u=g.projection;let c=e;if(u.canWrapX()){const t=u.getExtent(),o=$e(t),r=e[0];if(r<t[0]||r>t[2]){const i=sd((t[0]-r)/o);c=[r+o*i,e[1]]}}const y=t.layerStatesArray,m=y.length;let h;for(h=m-1;0<=h;--h){const r=y[h],i=r.layer;if(_r(r,_)&&s.call(l,i)){const r=this.getLayerRenderer(i);if(i.getSource()&&(p=r.forEachFeatureAtCoordinate(i.getSource().getWrapX()?c:e,t,o,d,a)),p)return p}}},Wu.prototype.forEachLayerAtPixel=function(){},Wu.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i){const n=this.forEachFeatureAtCoordinate(e,t,o,E,this,r,i);return n!==void 0},Wu.prototype.getLayerRenderer=function(e){const t=n(e).toString();if(t in this.layerRenderers_)return this.layerRenderers_[t];else{const o=ir();let r;const n=this.getType();for(let t=0,i=o.length;t<i;++t){const i=o[t];if(i.handles(n,e)){r=i.create(this,e);break}}if(r)this.layerRenderers_[t]=r,this.layerRendererListeners_[t]=c(r,zd.CHANGE,this.handleLayerRendererChange_,this);else throw new Error('Unable to create renderer for layer: '+e.getType());return r}},Wu.prototype.getLayerRendererByKey=function(e){return this.layerRenderers_[e]},Wu.prototype.getLayerRenderers=function(){return this.layerRenderers_},Wu.prototype.getMap=function(){return this.map_},Wu.prototype.getType=function(){},Wu.prototype.handleLayerRendererChange_=function(){this.map_.render()},Wu.prototype.removeLayerRendererByKey_=function(e){const t=this.layerRenderers_[e];return delete this.layerRenderers_[e],h(this.layerRendererListeners_[e]),delete this.layerRendererListeners_[e],t},Wu.prototype.renderFrame=T,Wu.prototype.removeUnusedLayerRenderers_=function(e,t){for(const o in this.layerRenderers_)t&&o in t.layerStates||this.removeLayerRendererByKey_(o).dispose()},Wu.prototype.scheduleExpireIconCache=function(e){e.postRenderFunctions.push(ai)},Wu.prototype.scheduleRemoveUnusedLayerRenderers=function(e){for(const t in this.layerRenderers_)if(!(t in e.layerStates))return void e.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))};var Ku=Wu;const Hu=function(e,t){Ku.call(this,e,t),this.context_=Jo(),this.canvas_=this.context_.canvas,this.canvas_.style.width='100%',this.canvas_.style.height='100%',this.canvas_.style.display='block',this.canvas_.className=Zg,e.insertBefore(this.canvas_,e.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=Yt()};i(Hu,Ku),Hu.handles=function(e){return e===jg.CANVAS},Hu.create=function(e,t){return new Hu(e,t)},Hu.prototype.dispatchComposeEvent_=function(e,t){const o=this.getMap(),r=this.context_;if(o.hasListener(e)){const i=t.extent,n=t.pixelRatio,a=t.viewState,s=a.rotation,l=this.getTransform(t),d=new Mu(r,n,i,l,s),p=new su(e,d,t,r,null);o.dispatchEvent(p)}},Hu.prototype.getTransform=function(e){const t=e.viewState,o=this.canvas_.width/2,r=this.canvas_.height/2,i=e.pixelRatio/t.resolution,n=-t.rotation,a=-t.center[0],s=-t.center[1];return Zt(this.transform_,o,r,i,-i,n,a,s)},Hu.prototype.getType=function(){return jg.CANVAS},Hu.prototype.renderFrame=function(e){if(!e)return void(this.renderedVisible_&&(this.canvas_.style.display='none',this.renderedVisible_=!1));const t=this.context_,o=e.pixelRatio,r=Wl(e.size[0]*o),n=Wl(e.size[1]*o);this.canvas_.width!=r||this.canvas_.height!=n?(this.canvas_.width=r,this.canvas_.height=n):t.clearRect(0,0,r,n);const a=e.viewState.rotation;this.calculateMatrices2D(e),this.dispatchComposeEvent_($g.PRECOMPOSE,e);const s=e.layerStatesArray;b(s,si),a&&(t.save(),Zr(t,a,r/2,n/2));const l=e.viewState.resolution;let d,i,p,g,_;for(d=0,i=s.length;d<i;++d)(_=s[d],p=_.layer,g=this.getLayerRenderer(p),_r(_,l)&&_.sourceState==Mg.READY)&&g.prepareFrame(e,_)&&g.composeFrame(e,_,t);a&&t.restore(),this.dispatchComposeEvent_($g.POSTCOMPOSE,e),this.renderedVisible_||(this.canvas_.style.display='',this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(e),this.scheduleExpireIconCache(e)},Hu.prototype.forEachLayerAtPixel=function(e,t,o,r,n,a){let s;const l=t.viewState,d=l.resolution,p=t.layerStatesArray,g=p.length,_=Xt(t.pixelToCoordinateTransform,e.slice());let u;for(u=g-1;0<=u;--u){const e=p[u],i=e.layer;if(_r(e,d)&&n.call(a,i)){const e=this.getLayerRenderer(i);if(s=e.forEachLayerAtCoordinate(_,t,o,r),s)return s}}};var Zu=Hu;const qu=function(e,t,o,r){this.minX=e,this.maxX=t,this.minY=o,this.maxY=r};qu.prototype.contains=function(e){return this.containsXY(e[1],e[2])},qu.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY},qu.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY},qu.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY},qu.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)},qu.prototype.getHeight=function(){return this.maxY-this.minY+1},qu.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},qu.prototype.getWidth=function(){return this.maxX-this.minX+1},qu.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY};var Ju=qu;const Qu=function(e){Bu.call(this,e),this.context=null===this.context?null:Jo(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.tmpExtent=Oe(),this.tmpTileRange_=new Ju(0,0,0,0),this.imageTransform_=Yt(),this.zDirection=0};i(Qu,Bu),Qu.handles=function(e,t){return e===jg.CANVAS&&t.getType()===iu.TILE},Qu.create=function(e,t){return new Qu(t)},Qu.prototype.isDrawableTile_=function(e){const t=e.getState(),o=this.getLayer().getUseInterimTilesOnError();return t==Yp.LOADED||t==Yp.EMPTY||t==Yp.ERROR&&!o},Qu.prototype.prepareFrame=function(e,t){const o=e.pixelRatio,r=e.size,i=e.viewState,a=i.projection,s=i.resolution,l=i.center,d=this.getLayer(),p=d.getSource(),g=p.getRevision(),_=p.getTileGridForProjection(a),u=_.getZForResolution(s,this.zDirection),c=_.getResolution(u);let m=Wl(s/c)||1,h=e.extent;if(void 0!==t.extent&&(h=qe(h,t.extent)),tt(h))return!1;const f=_.getTileRangeForExtentAndZ(h,u),E=_.getTileRangeExtent(u,f),T=p.getTilePixelRatio(o),S={};S[u]={};const C=this.createLoadedTileFinder(p,a,S),R=this.tmpExtent,I=this.tmpTileRange_;let L=!1,P,v,x;for(v=f.minX;v<=f.maxX;++v)for(x=f.minY;x<=f.maxY;++x){if(P=p.getTile(u,v,x,o,a),P.getState()==Yp.ERROR&&(d.getUseInterimTilesOnError()?0<d.getPreload()&&(L=!0):P.setState(Yp.LOADED)),this.isDrawableTile_(P)||(P=P.getInterimTile()),this.isDrawableTile_(P)){const t=n(this);if(P.getState()==Yp.LOADED){S[u][P.tileCoord.toString()]=P;const e=P.inTransition(t);!L&&(e||-1===this.renderedTiles.indexOf(P))&&(L=!0)}if(1===P.getAlpha(t,e.time))continue}const t=_.getTileCoordChildTileRange(P.tileCoord,I,R);let r=!1;t&&(r=C(u+1,t)),r||_.forEachTileCoordParentTileRange(P.tileCoord,C,null,I,R)}const y=c*o/T*m,F=e.viewHints,O=F[Zp.ANIMATING]||F[Zp.INTERACTING];if(!(this.renderedResolution&&16<Date.now()-e.time&&O)&&(L||!(this.renderedExtent_&&Pe(this.renderedExtent_,h))||this.renderedRevision!=g||m!=this.oversampling_||!O&&y!=this.renderedResolution)){const r=this.context;if(r){const e=p.getTilePixelSize(u,o,a),t=Wl(f.getWidth()*e[0]/m),i=Wl(f.getHeight()*e[1]/m),n=r.canvas;n.width!=t||n.height!=i?(this.oversampling_=m,n.width=t,n.height=i):(this.renderedExtent_&&!Ge(E,this.renderedExtent_)&&r.clearRect(0,0,t,i),m=this.oversampling_)}this.renderedTiles.length=0;const n=Object.keys(S).map(Number);n.sort(function(e,t){return e===u?1:t===u?-1:e>t?1:e<t?-1:0});let s,l,d,y,C,i,I,L,F,O,w;for(C=0,i=n.length;C<i;++C)for(const r in y=n[C],d=p.getTilePixelSize(y,o,a),s=_.getResolution(y),l=s/c,L=T*p.getGutter(a),F=S[y],F)P=F[r],I=_.getTileCoordExtent(P.getTileCoord(),R),v=(I[0]-E[0])/c*T/m,x=(E[3]-I[3])/c*T/m,O=d[0]*l/m,w=d[1]*l/m,this.drawTileImage(P,e,t,v,x,O,w,L,u===y),this.renderedTiles.push(P);this.renderedRevision=g,this.renderedResolution=c*o/T*m,this.renderedExtent_=E}const w=this.renderedResolution/s,N=Zt(this.imageTransform_,o*r[0]/2,o*r[1]/2,w,w,0,(this.renderedExtent_[0]-l[0])/this.renderedResolution*o,(l[1]-this.renderedExtent_[3])/this.renderedResolution*o);return Zt(this.coordinateToCanvasPixelTransform,o*r[0]/2-N[4],o*r[1]/2-N[5],o/s,-o/s,0,-l[0],-l[1]),this.updateUsedTiles(e.usedTiles,p,u,f),this.manageTilePyramid(e,p,_,o,a,h,u,d.getPreload()),this.scheduleExpireCache(e,p),0<this.renderedTiles.length},Qu.prototype.drawTileImage=function(e,t,o,r,i,a,s,l,d){const p=e.getImage(this.getLayer());if(p){const o=n(this),g=d?e.getAlpha(o,t.time):1;1!==g||this.getLayer().getSource().getOpaque(t.viewState.projection)||this.context.clearRect(r,i,a,s);const _=g!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=g),this.context.drawImage(p,l,l,p.width-2*l,p.height-2*l,r,i,a,s),_&&this.context.restore(),1===g?d&&e.endTransition(o):t.animate=!0}},Qu.prototype.getImage=function(){const e=this.context;return e?e.canvas:null},Qu.prototype.getLayer,Qu.prototype.getImageTransform=function(){return this.imageTransform_};var $u=Qu,ec=o(0),tc=o.n(ec);const oc=function(){};oc.prototype.getReplay=function(){},oc.prototype.isEmpty=function(){};var rc=oc,ic={CIRCLE:'Circle',DEFAULT:'Default',IMAGE:'Image',LINE_STRING:'LineString',POLYGON:'Polygon',TEXT:'Text'};const nc={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ac=[nc.FILL],sc=[nc.STROKE],lc=[nc.BEGIN_PATH],dc=[nc.CLOSE_PATH];var pc=nc;const gc=[ic.POLYGON,ic.CIRCLE,ic.LINE_STRING,ic.IMAGE,ic.TEXT,ic.DEFAULT],_c={};_c.left=0,_c.end=0,_c.center=.5,_c.right=1,_c.start=1,_c.top=0,_c.middle=.5,_c.hanging=.2,_c.alphabetic=.8,_c.ideographic=.8,_c.bottom=1;const uc=function(e,t,o,r,i,n){Au.call(this),this.declutterTree=n,this.tolerance=e,this.maxExtent=t,this.overlaps=i,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=o,this.fillOrigin_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=Yt(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0};i(uc,Au);const cc=Oe(),yc=Yt();uc.prototype.replayTextBackground_=function(e,t,o,r,i,n,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,o),e.lineTo.apply(e,r),e.lineTo.apply(e,i),e.lineTo.apply(e,t),n&&(this.fillOrigin_=n[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())},uc.prototype.replayImage_=function(e,t,o,r,i,n,a,s,l,d,p,g,_,u,c,y,m,f){const E=m||f;i*=_,n*=_,t-=i,o-=n;const x=c+d>r.width?r.width-d:c,T=s+p>r.height?r.height-p:s,h=y[3]+x*_+y[1],S=y[0]+T*_+y[2],C=t-y[3],R=o-y[0];let I,L,P,v;(E||0!==g)&&(I=[C,R],L=[C+h,R],P=[C+h,R+S],v=[C,R+S]);let F=null;if(0!==g){const e=t+i,r=o+n;F=Zt(yc,e,r,1,1,g,-e,-r),Ne(cc),ke(cc,Xt(yc,I)),ke(cc,Xt(yc,L)),ke(cc,Xt(yc,P)),ke(cc,Xt(yc,v))}else we(C,R,C+h,R+S,cc);const O=e.canvas,w=f?f[2]*_/2:0,N=cc[0]-w<=O.width&&0<=cc[2]+w&&cc[1]-w<=O.height&&0<=cc[3]+w;if(u&&(t=Wl(t),o=Wl(o)),a){if(!N&&1==a[4])return;De(a,cc);const i=N?[e,F?F.slice(0):null,l,r,d,p,x,T,t,o,_]:null;i&&E&&i.push(m,f,I,L,P,v),a.push(i)}else N&&(E&&this.replayTextBackground_(e,I,L,P,v,m,f),qr(e,F,l,r,d,p,x,T,t,o,_))},uc.prototype.applyPixelRatio=function(e){const t=this.pixelRatio;return 1==t?e:e.map(function(e){return e*t})},uc.prototype.appendFlatCoordinates=function(e,t,o,r,n,a){let s=this.coordinates.length;const l=this.getBufferedMaxExtent();a&&(t+=r);const d=[e[t],e[t+1]],p=[NaN,NaN];let g=!0,_,i,u;for(_=t+r;_<o;_+=r)p[0]=e[_],p[1]=e[_+1],u=Fe(l,p),u===i?u===Qp.INTERSECTING?(this.coordinates[s++]=p[0],this.coordinates[s++]=p[1],g=!1):g=!0:(g&&(this.coordinates[s++]=d[0],this.coordinates[s++]=d[1]),this.coordinates[s++]=p[0],this.coordinates[s++]=p[1],g=!1),d[0]=p[0],d[1]=p[1],i=u;return(n&&g||_===t+r)&&(this.coordinates[s++]=d[0],this.coordinates[s++]=d[1]),s},uc.prototype.drawCustomCoordinates_=function(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a],s=this.appendFlatCoordinates(e,t,i,r,!1,!1);n.push(s),t=i}return t},uc.prototype.drawCustom=function(e,t,o){this.beginGeometry(e,t);const r=e.getType(),n=e.getStride(),i=this.coordinates.length;let a,s,l,d,p;if(r==$p.MULTI_POLYGON){e=e,a=e.getOrientedFlatCoordinates(),d=[];const t=e.getEndss();p=0;for(let e=0,o=t.length;e<o;++e){const o=[];p=this.drawCustomCoordinates_(a,p,t[e],n,o),d.push(o)}this.instructions.push([pc.CUSTOM,i,d,e,o,fo])}else r==$p.POLYGON||r==$p.MULTI_LINE_STRING?(l=[],a=r==$p.POLYGON?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),p=this.drawCustomCoordinates_(a,0,e.getEnds(),n,l),this.instructions.push([pc.CUSTOM,i,l,e,o,ho])):r==$p.LINE_STRING||r==$p.MULTI_POINT?(a=e.getFlatCoordinates(),s=this.appendFlatCoordinates(a,0,a.length,n,!1,!1),this.instructions.push([pc.CUSTOM,i,s,e,o,mo])):r==$p.POINT&&(a=e.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),s=this.coordinates.length,this.instructions.push([pc.CUSTOM,i,s,e,o]));this.endGeometry(e,t)},uc.prototype.beginGeometry=function(e,t){this.beginGeometryInstruction1_=[pc.BEGIN_GEOMETRY,t,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[pc.BEGIN_GEOMETRY,t,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},uc.prototype.fill_=function(e){if(this.fillOrigin_){const t=Xt(this.renderedTransform_,this.fillOrigin_.slice());e.translate(t[0],t[1]),e.rotate(this.viewRotation_)}e.fill(),this.fillOrigin_&&e.setTransform.apply(e,vu)},uc.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],gp&&(e.lineDashOffset=t[7],e.setLineDash(t[6]))},uc.prototype.renderDeclutter_=function(e,t){if(e&&5<e.length){const o=e[4];if(1==o||o==e.length-5){const o={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};if(!this.declutterTree.collides(o)){this.declutterTree.insert(o);for(let t=5,o=e.length;t<o;++t){const o=e[t];o&&(11<o.length&&this.replayTextBackground_(o[0],o[13],o[14],o[15],o[16],o[11],o[12]),qr.apply(void 0,o))}}e.length=5,Ne(e)}}},uc.prototype.replay_=function(e,t,o,r,a,s){let p;this.pixelCoordinates_&&A(t,this.renderedTransform_)?p=this.pixelCoordinates_:(!this.pixelCoordinates_&&(this.pixelCoordinates_=[]),p=at(this.coordinates,0,this.coordinates.length,2,t,this.pixelCoordinates_),zt(this.renderedTransform_,t));const g=!l(o);let _=0;const i=r.length;let u=0,d=0,c=0,m=null,h=null,f,E,T,S,C,R,I,L,P;const v=this.coordinateCache_,y=this.viewRotation_,F={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:y},O=this.instructions!=r||this.overlaps?0:200;for(let l,w,x;_<i;){const t=r[_],i=t[0];switch(i){case pc.BEGIN_GEOMETRY:l=t[1],g&&o[n(l).toString()]||!l.getGeometry()?_=t[2]:void 0===s||et(s,l.getGeometry().getExtent())?++_:_=t[2]+1;break;case pc.BEGIN_PATH:d>O&&(this.fill_(e),d=0),c>O&&(e.stroke(),c=0),d||c||(e.beginPath(),S=C=NaN),++_;break;case pc.CIRCLE:u=t[1];const N=p[u],A=p[u+1],b=p[u+2],M=p[u+3],G=b-N,D=M-A,k=id(G*G+D*D);e.moveTo(N+k,A),e.arc(N,A,k,0,2*$l,!0),++_;break;case pc.CLOSE_PATH:e.closePath(),++_;break;case pc.CUSTOM:u=t[1],f=t[2];const r=t[3],U=t[4],Y=6==t.length?t[5]:void 0;F.geometry=r,F.feature=l,_ in v||(v[_]=[]);const B=v[_];Y?Y(p,u,f,2,B):(B[0]=p[u],B[1]=p[u+1],B.length=2),U(B,F),++_;break;case pc.DRAW_IMAGE:u=t[1],f=t[2],P=t[3],E=t[4],T=t[5],L=a?null:t[6];const j=t[7],V=t[8],z=t[9],X=t[10],W=t[11];let K=t[12];const H=t[13],Z=t[14],q=t[15];let J,Q,$;for(16<t.length?(J=t[16],Q=t[17],$=t[18]):(J=xu,Q=$=!1),W&&(K+=y);u<f;u+=2)this.replayImage_(e,p[u],p[u+1],P,E,T,L,j,V,z,X,K,H,Z,q,J,Q?m:null,$?h:null);this.renderDeclutter_(L,l),++_;break;case pc.DRAW_CHARS:const ee=t[1],te=t[2],oe=t[3];L=a?null:t[4];const re=t[5],ie=t[6],ne=t[7],ae=t[8],se=t[9],le=t[10],de=t[11],pe=t[12],ge=t[13],_e=t[14],ue=di(p,ee,te,2),ce=ae(pe);if(re||ce<=ue){const t=this.textStates[ge].textAlign,o=(ue-ce)*_c[t],r=pi(p,ee,te,2,pe,ae,o,ne);if(r){let t,o,i,n,a;if(le)for(t=0,o=r.length;t<o;++t)a=r[t],i=a[4],n=this.getImage(i,ge,'',le),E=a[2]+de,T=oe*n.height+2*(.5-oe)*de-se,this.replayImage_(e,a[0],a[1],n,E,T,L,n.height,1,0,0,a[3],_e,!1,n.width,xu,null,null);if(ie)for(t=0,o=r.length;t<o;++t)a=r[t],i=a[4],n=this.getImage(i,ge,ie,''),E=a[2],T=oe*n.height-se,this.replayImage_(e,a[0],a[1],n,E,T,L,n.height,1,0,0,a[3],_e,!1,n.width,xu,null,null)}}this.renderDeclutter_(L,l),++_;break;case pc.END_GEOMETRY:if(void 0!==a){l=t[1];const e=a(l);if(e)return e}++_;break;case pc.FILL:O?d++:this.fill_(e),++_;break;case pc.MOVE_TO_LINE_TO:for(u=t[1],f=t[2],w=p[u],x=p[u+1],R=0|w+.5,I=0|x+.5,(R!==S||I!==C)&&(e.moveTo(w,x),S=R,C=I),u+=2;u<f;u+=2)w=p[u],x=p[u+1],R=0|w+.5,I=0|x+.5,(u==f-2||R!==S||I!==C)&&(e.lineTo(w,x),S=R,C=I);++_;break;case pc.SET_FILL_STYLE:m=t,this.fillOrigin_=t[2],d&&(this.fill_(e),d=0,c&&(e.stroke(),c=0)),e.fillStyle=t[1],++_;break;case pc.SET_STROKE_STYLE:h=t,c&&(e.stroke(),c=0),this.setStrokeStyle_(e,t),++_;break;case pc.STROKE:O?c++:e.stroke(),++_;break;default:++_;}}return d&&this.fill_(e),void(c&&e.stroke())},uc.prototype.replay=function(e,t,o,r){this.viewRotation_=o,this.replay_(e,t,r,this.instructions,void 0,void 0)},uc.prototype.replayHitDetection=function(e,t,o,r,i,n){return this.viewRotation_=o,this.replay_(e,t,r,this.hitDetectionInstructions,i,n)},uc.prototype.reverseHitDetectionInstructions=function(){const e=this.hitDetectionInstructions;e.reverse();let t;const o=e.length;let r=-1,i,n;for(t=0;t<o;++t)i=e[t],n=i[0],n==pc.END_GEOMETRY?r=t:n==pc.BEGIN_GEOMETRY&&(i[2]=t,F(this.hitDetectionInstructions,r,t),r=-1)},uc.prototype.setFillStrokeStyle=function(e,t){const o=this.state;if(e){const t=e.getColor();o.fillStyle=ri(t?t:gu)}else o.fillStyle=void 0;if(t){const e=t.getColor();o.strokeStyle=ri(e?e:hu);const r=t.getLineCap();o.lineCap=void 0===r?_u:r;const i=t.getLineDash();o.lineDash=i?i.slice():uu;const n=t.getLineDashOffset();o.lineDashOffset=n?n:cu;const a=t.getLineJoin();o.lineJoin=void 0===a?yu:a;const s=t.getWidth();o.lineWidth=void 0===s?Tu:s;const l=t.getMiterLimit();o.miterLimit=void 0===l?mu:l,o.lineWidth>this.maxLineWidth&&(this.maxLineWidth=o.lineWidth,this.bufferedMaxExtent_=null)}else o.strokeStyle=void 0,o.lineCap=void 0,o.lineDash=null,o.lineDashOffset=void 0,o.lineJoin=void 0,o.lineWidth=void 0,o.miterLimit=void 0},uc.prototype.createFill=function(e,t){const o=e.fillStyle,r=[pc.SET_FILL_STYLE,o];if('string'!=typeof o){const e=t.getExtent();r.push([e[0],e[3]])}return r},uc.prototype.applyStroke=function(e){this.instructions.push(this.createStroke(e))},uc.prototype.createStroke=function(e){return[pc.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]},uc.prototype.updateFillStyle=function(e,t,o){const r=e.fillStyle;('string'!=typeof r||e.currentFillStyle!=r)&&(r!==void 0&&this.instructions.push(t.call(this,e,o)),e.currentFillStyle=r)},uc.prototype.updateStrokeStyle=function(e,t){const o=e.strokeStyle,r=e.lineCap,i=e.lineDash,n=e.lineDashOffset,a=e.lineJoin,s=e.lineWidth,l=e.miterLimit;e.currentStrokeStyle==o&&e.currentLineCap==r&&(i==e.currentLineDash||A(e.currentLineDash,i))&&e.currentLineDashOffset==n&&e.currentLineJoin==a&&e.currentLineWidth==s&&e.currentMiterLimit==l||(o!==void 0&&t.call(this,e),e.currentStrokeStyle=o,e.currentLineCap=r,e.currentLineDash=i,e.currentLineDashOffset=n,e.currentLineJoin=a,e.currentLineWidth=s,e.currentMiterLimit=l)},uc.prototype.endGeometry=function(e,t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const o=[pc.END_GEOMETRY,t];this.instructions.push(o),this.hitDetectionInstructions.push(o)},uc.prototype.finish=T,uc.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Re(this.maxExtent),0<this.maxLineWidth)){const e=this.resolution*(this.maxLineWidth+1)/2;Ce(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_};var mc=uc;const hc=function(e,t,o,r,i,n){mc.call(this,e,t,o,r,i,n),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.snapToPixel_=void 0,this.width_=void 0};i(hc,mc),hc.prototype.drawCoordinates_=function(e,t,o,r){return this.appendFlatCoordinates(e,t,o,r,!1,!1)},hc.prototype.drawPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);const o=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,n=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([pc.DRAW_IMAGE,i,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([pc.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(e,t)}},hc.prototype.drawMultiPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);const o=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,n=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([pc.DRAW_IMAGE,i,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([pc.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(e,t)}},hc.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.snapToPixel_=void 0,this.width_=void 0},hc.prototype.setImageStyle=function(e,t){const o=e.getAnchor(),r=e.getSize(),i=e.getHitDetectionImage(1),n=e.getImage(1),a=e.getOrigin();this.anchorX_=o[0],this.anchorY_=o[1],this.declutterGroup_=t,this.hitDetectionImage_=i,this.image_=n,this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScale(),this.snapToPixel_=e.getSnapToPixel(),this.width_=r[0]};const fc=function(e,t,o,r,i,n){mc.call(this,e,t,o,r,i,n)};i(fc,mc),fc.prototype.drawFlatCoordinates_=function(e,t,o,r){const i=this.coordinates.length,n=this.appendFlatCoordinates(e,t,o,r,!1,!1),a=[pc.MOVE_TO_LINE_TO,i,n];return this.instructions.push(a),this.hitDetectionInstructions.push(a),o},fc.prototype.drawLineString=function(e,t){const o=this.state,r=o.strokeStyle,i=o.lineWidth;if(void 0!==r&&void 0!==i){this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([pc.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],lc);const r=e.getFlatCoordinates(),i=e.getStride();this.drawFlatCoordinates_(r,0,r.length,i),this.hitDetectionInstructions.push(sc),this.endGeometry(e,t)}},fc.prototype.drawMultiLineString=function(e,t){const o=this.state,r=o.strokeStyle,i=o.lineWidth;if(void 0===r||void 0===i)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([pc.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],lc);const n=e.getEnds(),a=e.getFlatCoordinates(),s=e.getStride();let l=0;for(let o=0,r=n.length;o<r;++o)l=this.drawFlatCoordinates_(a,l,n[o],s);this.hitDetectionInstructions.push(sc),this.endGeometry(e,t)},fc.prototype.finish=function(){const e=this.state;e.lastStroke!=void 0&&e.lastStroke!=this.coordinates.length&&this.instructions.push(sc),this.reverseHitDetectionInstructions(),this.state=null},fc.prototype.applyStroke=function(e){e.lastStroke!=void 0&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(sc),e.lastStroke=this.coordinates.length),e.lastStroke=0,mc.prototype.applyStroke.call(this,e),this.instructions.push(lc)};const Ec=function(e,t,o,r,i,n){mc.call(this,e,t,o,r,i,n)};i(Ec,mc),Ec.prototype.drawFlatCoordinatess_=function(e,t,o,r){const i=this.state,n=void 0!==i.fillStyle,a=void 0!=i.strokeStyle,s=o.length;this.instructions.push(lc),this.hitDetectionInstructions.push(lc);for(let n=0;n<s;++n){const i=o[n],s=this.coordinates.length,l=this.appendFlatCoordinates(e,t,i,r,!0,!a),d=[pc.MOVE_TO_LINE_TO,s,l];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(dc),this.hitDetectionInstructions.push(dc)),t=i}return this.hitDetectionInstructions.push(ac),n&&this.instructions.push(ac),a&&(this.instructions.push(sc),this.hitDetectionInstructions.push(sc)),t},Ec.prototype.drawCircle=function(e,t){const o=this.state,r=o.fillStyle,i=o.strokeStyle;if(void 0!==r||void 0!==i){this.setFillStrokeStyles_(e),this.beginGeometry(e,t),this.hitDetectionInstructions.push([pc.SET_FILL_STYLE,Jr(gu)]),void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([pc.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);const r=e.getFlatCoordinates(),i=e.getStride(),n=this.coordinates.length;this.appendFlatCoordinates(r,0,r.length,i,!1,!1);const a=[pc.CIRCLE,n];this.instructions.push(lc,a),this.hitDetectionInstructions.push(lc,a),this.hitDetectionInstructions.push(ac),void 0!==o.fillStyle&&this.instructions.push(ac),void 0!==o.strokeStyle&&(this.instructions.push(sc),this.hitDetectionInstructions.push(sc)),this.endGeometry(e,t)}},Ec.prototype.drawPolygon=function(e,t){const o=this.state;this.setFillStrokeStyles_(e),this.beginGeometry(e,t),this.hitDetectionInstructions.push([pc.SET_FILL_STYLE,Jr(gu)]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([pc.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);const r=e.getEnds(),i=e.getOrientedFlatCoordinates(),n=e.getStride();this.drawFlatCoordinatess_(i,0,r,n),this.endGeometry(e,t)},Ec.prototype.drawMultiPolygon=function(e,t){const o=this.state,r=o.fillStyle,i=o.strokeStyle;if(void 0===r&&void 0===i)return;this.setFillStrokeStyles_(e),this.beginGeometry(e,t),this.hitDetectionInstructions.push([pc.SET_FILL_STYLE,Jr(gu)]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([pc.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);const n=e.getEndss(),a=e.getOrientedFlatCoordinates(),s=e.getStride();let l=0;for(let o=0,r=n.length;o<r;++o)l=this.drawFlatCoordinatess_(a,l,n[o],s);this.endGeometry(e,t)},Ec.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(0!==e){const t=this.coordinates;for(let o=0,r=t.length;o<r;++o)t[o]=To(t[o],e)}},Ec.prototype.setFillStrokeStyles_=function(e){const t=this.state,o=t.fillStyle;o!==void 0&&this.updateFillStyle(t,this.createFill,e),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)};var xc=Ec,Tc={POINT:'point',LINE:'line'};const Sc=function(e,t,o,r,i,n){mc.call(this,e,t,o,r,i,n),this.declutterGroup_,this.labels_=null,this.text_='',this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_='',this.fillKey_='',this.strokeKey_='',this.widths_={},Su.prune()};i(Sc,mc),Sc.prototype.drawText=function(e,t){const o=this.textFillState_,r=this.textStrokeState_,n=this.textState_;if(''===this.text_||!n||!o&&!r)return;let a=this.coordinates.length;const s=e.getType();let l=null,d=2,p=2,g,i;if(n.placement===Tc.LINE){if(!et(this.getBufferedMaxExtent(),e.getExtent()))return;let r;if(l=e.getFlatCoordinates(),p=e.getStride(),s==$p.LINE_STRING)r=[l.length];else if(s==$p.MULTI_LINE_STRING)r=e.getEnds();else if(s==$p.POLYGON)r=e.getEnds().slice(0,1);else if(s==$p.MULTI_POLYGON){const t=e.getEndss();for(r=[],g=0,i=t.length;g<i;++g)r.push(t[g][0])}this.beginGeometry(e,t);const _=n.textAlign;let u=0,c;for(let e=0,t=r.length;e<t;++e){if(void 0==_){const t=gi(n.maxAngle,l,u,r[e],p);u=t[0],c=t[1]}else c=r[e];for(g=u;g<c;g+=p)this.coordinates.push(l[g],l[g+1]);d=this.coordinates.length,u=r[e],this.drawChars_(a,d,this.declutterGroup_),a=d}this.endGeometry(e,t)}else{const o=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),r=o.width/this.pixelRatio;switch(s){case $p.POINT:case $p.MULTI_POINT:l=e.getFlatCoordinates(),d=l.length;break;case $p.LINE_STRING:l=e.getFlatMidpoint();break;case $p.CIRCLE:l=e.getCenter();break;case $p.MULTI_LINE_STRING:l=e.getFlatMidpoints(),d=l.length;break;case $p.POLYGON:if(l=e.getFlatInteriorPoint(),!n.overflow&&l[2]/this.resolution<r)return;p=3;break;case $p.MULTI_POLYGON:const t=e.getFlatInteriorPoints();for(l=[],g=0,i=t.length;g<i;g+=3)(n.overflow||t[g+2]/this.resolution>=r)&&l.push(t[g],t[g+1]);if(d=l.length,0==d)return;break;default:}d=this.appendFlatCoordinates(l,0,d,p,!1,!1),this.beginGeometry(e,t),(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),this.updateFillStyle(this.state,this.createFill,e),this.hitDetectionInstructions.push(this.createFill(this.state,e)),this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state))),this.drawTextImage_(o,a,d),this.endGeometry(e,t)}},Sc.prototype.getImage=function(e,t,o,r){let n;const a=r+t+e+o+this.pixelRatio;if(!Su.containsKey(a)){const s=r?this.strokeStates[r]||this.textStrokeState_:null,l=o?this.fillStates[o]||this.textFillState_:null,d=this.textStates[t]||this.textState_,p=this.pixelRatio,g=d.scale*p,_=_c[d.textAlign||fu],u=r&&s.lineWidth?s.lineWidth:0,c=e.split('\n'),y=c.length,m=[],h=_i(d.font,c,m),f=Pu(d.font),E=Jo(sd((h+u)*g),sd((f*y+u)*g));n=E.canvas,Su.set(a,n),1!=g&&E.scale(g,g),E.font=d.font,r&&(E.strokeStyle=s.strokeStyle,E.lineWidth=u*(sp?g:1),E.lineCap=s.lineCap,E.lineJoin=s.lineJoin,E.miterLimit=s.miterLimit,gp&&s.lineDash.length&&(E.setLineDash(s.lineDash),E.lineDashOffset=s.lineDashOffset)),o&&(E.fillStyle=l.fillStyle),E.textBaseline='middle',E.textAlign='center';const T=.5-_,S=_*n.width/g+T*u;let x;if(r)for(x=0;x<y;++x)E.strokeText(c[x],S+T*m[x],.5*(u+f)+x*f);if(o)for(x=0;x<y;++x)E.fillText(c[x],S+T*m[x],.5*(u+f)+x*f)}return Su.get(a)},Sc.prototype.drawTextImage_=function(e,t,o){const r=this.textState_,i=this.textStrokeState_,n=this.pixelRatio,a=_c[r.textAlign||fu],s=_c[r.textBaseline],l=i&&i.lineWidth?i.lineWidth:0,d=a*e.width/n+2*(.5-a)*l,p=s*e.height/n+2*(.5-s)*l;this.instructions.push([pc.DRAW_IMAGE,t,o,e,(d-this.textOffsetX_)*n,(p-this.textOffsetY_)*n,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,e.width,r.padding==xu?xu:r.padding.map(function(e){return e*n}),!!r.backgroundFill,!!r.backgroundStroke]),this.hitDetectionInstructions.push([pc.DRAW_IMAGE,t,o,e,(d-this.textOffsetX_)*n,(p-this.textOffsetY_)*n,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/n,!0,e.width,r.padding,!!r.backgroundFill,!!r.backgroundStroke])},Sc.prototype.drawChars_=function(e,t,o){const r=this.textStrokeState_,i=this.textState_,n=this.textFillState_,a=this.strokeKey_;r&&!(a in this.strokeStates)&&(this.strokeStates[a]={strokeStyle:r.strokeStyle,lineCap:r.lineCap,lineDashOffset:r.lineDashOffset,lineWidth:r.lineWidth,lineJoin:r.lineJoin,miterLimit:r.miterLimit,lineDash:r.lineDash});const s=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:i.font,textAlign:i.textAlign||fu,scale:i.scale});const l=this.fillKey_;n&&!(l in this.fillStates)&&(this.fillStates[l]={fillStyle:n.fillStyle});const d=this.pixelRatio,p=_c[i.textBaseline],g=this.textOffsetY_*d,_=this.text_,u=i.font,c=i.scale,y=r?r.lineWidth*c/2:0;let m=this.widths_[u];m||(this.widths_[u]=m={}),this.instructions.push([pc.DRAW_CHARS,e,t,p,o,i.overflow,l,i.maxAngle,function(e){let t=m[e];return t||(t=m[e]=Hr(u,e)),t*c*d},g,a,y*d,_,s,1]),this.hitDetectionInstructions.push([pc.DRAW_CHARS,e,t,p,o,i.overflow,l,i.maxAngle,function(e){let t=m[e];return t||(t=m[e]=Hr(u,e)),t*c},g,a,y,_,s,1/d])},Sc.prototype.setTextStyle=function(e,t){let o,r,i;if(!e)this.text_='';else{this.declutterGroup_=t;const a=e.getFill();a?(r=this.textFillState_,!r&&(r=this.textFillState_={}),r.fillStyle=ri(a.getColor()||gu)):r=this.textFillState_=null;const s=e.getStroke();if(!s)i=this.textStrokeState_=null;else{i=this.textStrokeState_,i||(i=this.textStrokeState_={});const e=s.getLineDash(),t=s.getLineDashOffset(),o=s.getWidth(),r=s.getMiterLimit();i.lineCap=s.getLineCap()||_u,i.lineDash=e?e.slice():uu,i.lineDashOffset=t===void 0?cu:t,i.lineJoin=s.getLineJoin()||yu,i.lineWidth=o===void 0?Tu:o,i.miterLimit=r===void 0?mu:r,i.strokeStyle=ri(s.getColor()||hu)}o=this.textState_;const l=e.getFont()||pu;Lu(l);const d=e.getScale();o.overflow=e.getOverflow(),o.font=l,o.maxAngle=e.getMaxAngle(),o.placement=e.getPlacement(),o.textAlign=e.getTextAlign(),o.textBaseline=e.getTextBaseline()||Eu,o.backgroundFill=e.getBackgroundFill(),o.backgroundStroke=e.getBackgroundStroke(),o.padding=e.getPadding()||xu,o.scale=d===void 0?1:d;const p=e.getOffsetX(),g=e.getOffsetY(),_=e.getRotateWithView(),u=e.getRotation();this.text_=e.getText()||'',this.textOffsetX_=p===void 0?0:p,this.textOffsetY_=g===void 0?0:g,this.textRotateWithView_=_!==void 0&&_,this.textRotation_=u===void 0?0:u,this.strokeKey_=i?('string'==typeof i.strokeStyle?i.strokeStyle:n(i.strokeStyle))+i.lineCap+i.lineDashOffset+'|'+i.lineWidth+i.lineJoin+i.miterLimit+'['+i.lineDash.join()+']':'',this.textKey_=o.font+o.scale+(o.textAlign||'?'),this.fillKey_=r?'string'==typeof r.fillStyle?r.fillStyle:'|'+n(r.fillStyle):''}};const Cc={Circle:xc,Default:mc,Image:hc,LineString:fc,Polygon:xc,Text:Sc},Rc=function(e,t,o,r,i,n,a){rc.call(this),this.declutterTree_=n,this.declutterGroup_=null,this.tolerance_=e,this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=r,this.resolution_=o,this.renderBuffer_=a,this.replaysByZIndex_={},this.hitDetectionContext_=Jo(1,1),this.hitDetectionTransform_=Yt()};i(Rc,rc);const Ic={0:[[!0]]};Rc.prototype.addDeclutter=function(e){let t=null;return this.declutterTree_&&(e?(t=this.declutterGroup_,t[4]++):(t=this.declutterGroup_=Oe(),t.push(1))),t},Rc.prototype.clip=function(e,t){const o=this.getClipCoords(t);e.beginPath(),e.moveTo(o[0],o[1]),e.lineTo(o[2],o[3]),e.lineTo(o[4],o[5]),e.lineTo(o[6],o[7]),e.clip()},Rc.prototype.hasReplays=function(e){for(const t in this.replaysByZIndex_){const o=this.replaysByZIndex_[t];for(let t=0,r=e.length;t<r;++t)if(e[t]in o)return!0}return!1},Rc.prototype.finish=function(){for(const e in this.replaysByZIndex_){const t=this.replaysByZIndex_[e];for(const e in t)t[e].finish()}},Rc.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,a,s){function l(e){const t=g.getImageData(0,0,d,d).data;for(let o=0;o<d;o++)for(let r=0;r<d;r++)if(u[o][r]&&0<t[4*(r*d+o)+3]){let t;return c&&(y==ic.IMAGE||y==ic.TEXT)&&-1===c.indexOf(e)||(t=a(e)),t?t:void g.clearRect(0,0,d,d)}}r=Wl(r);const d=2*r+1,p=Zt(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-o,-e[0],-e[1]),g=this.hitDetectionContext_;g.canvas.width!==d||g.canvas.height!==d?(g.canvas.width=d,g.canvas.height=d):g.clearRect(0,0,d,d);let _;this.renderBuffer_!==void 0&&(_=Oe(),ke(_,e),Ce(_,t*(this.renderBuffer_+r),_));const u=ci(r);let c;this.declutterTree_&&(c=this.declutterTree_.all().map(function(e){return e.value}));let y;const m=Object.keys(this.replaysByZIndex_).map(Number);m.sort(L);let h,i,f,E,x;for(h=m.length-1;0<=h;--h){const e=m[h].toString();for(f=this.replaysByZIndex_[e],i=gc.length-1;0<=i;--i)if(y=gc[i],E=f[y],void 0!==E)if(s&&(y==ic.IMAGE||y==ic.TEXT)){const t=s[e];t?t.push(E,p.slice(0)):s[e]=[E,p.slice(0)]}else if(x=E.replayHitDetection(g,p,o,n,l,_),x)return x}},Rc.prototype.getClipCoords=function(e){const t=this.maxExtent_,o=t[0],r=t[1],i=t[2],n=t[3],a=[o,r,o,n,i,n,i,r];return at(a,0,8,2,e,a),a},Rc.prototype.getReplay=function(e,t){const o=e===void 0?'0':e.toString();let r=this.replaysByZIndex_[o];r===void 0&&(r={},this.replaysByZIndex_[o]=r);let i=r[t];if(i===void 0){const e=Cc[t];i=new e(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),r[t]=i}return i},Rc.prototype.getReplays=function(){return this.replaysByZIndex_},Rc.prototype.isEmpty=function(){return l(this.replaysByZIndex_)},Rc.prototype.replay=function(e,t,o,r,n,a){const s=Object.keys(this.replaysByZIndex_).map(Number);s.sort(L),e.save(),this.clip(e,t);const l=n?n:gc;let d,i,p,g,_,u;for(d=0,i=s.length;d<i;++d){const i=s[d].toString();for(_=this.replaysByZIndex_[i],p=0,g=l.length;p<g;++p){const n=l[p];if(u=_[n],void 0!==u)if(a&&(n==ic.IMAGE||n==ic.TEXT)){const e=a[i];e?e.push(u,t.slice(0)):a[i]=[u,t.slice(0)]}else u.replay(e,t,o,r)}}e.restore()};var Lc=Rc;const Pc=.5,vc={Point:function(e,t,o,r){const i=o.getImage();if(i){if(i.getImageState()!=tu.LOADED)return;const n=e.getReplay(o.getZIndex(),ic.IMAGE);n.setImageStyle(i,e.addDeclutter(!1)),n.drawPoint(t,r)}const n=o.getText();if(n){const a=e.getReplay(o.getZIndex(),ic.TEXT);a.setTextStyle(n,e.addDeclutter(!!i)),a.drawText(t,r)}},LineString:function(e,t,o,r){const i=o.getStroke();if(i){const n=e.getReplay(o.getZIndex(),ic.LINE_STRING);n.setFillStrokeStyle(null,i),n.drawLineString(t,r)}const n=o.getText();if(n){const i=e.getReplay(o.getZIndex(),ic.TEXT);i.setTextStyle(n,e.addDeclutter(!1)),i.drawText(t,r)}},Polygon:function(e,t,o,r){const i=o.getFill(),n=o.getStroke();if(i||n){const a=e.getReplay(o.getZIndex(),ic.POLYGON);a.setFillStrokeStyle(i,n),a.drawPolygon(t,r)}const a=o.getText();if(a){const i=e.getReplay(o.getZIndex(),ic.TEXT);i.setTextStyle(a,e.addDeclutter(!1)),i.drawText(t,r)}},MultiPoint:function(e,t,o,r){const i=o.getImage();if(i){if(i.getImageState()!=tu.LOADED)return;const n=e.getReplay(o.getZIndex(),ic.IMAGE);n.setImageStyle(i,e.addDeclutter(!1)),n.drawMultiPoint(t,r)}const n=o.getText();if(n){const a=e.getReplay(o.getZIndex(),ic.TEXT);a.setTextStyle(n,e.addDeclutter(!!i)),a.drawText(t,r)}},MultiLineString:function(e,t,o,r){const i=o.getStroke();if(i){const n=e.getReplay(o.getZIndex(),ic.LINE_STRING);n.setFillStrokeStyle(null,i),n.drawMultiLineString(t,r)}const n=o.getText();if(n){const i=e.getReplay(o.getZIndex(),ic.TEXT);i.setTextStyle(n,e.addDeclutter(!1)),i.drawText(t,r)}},MultiPolygon:function(e,t,o,r){const i=o.getFill(),n=o.getStroke();if(n||i){const a=e.getReplay(o.getZIndex(),ic.POLYGON);a.setFillStrokeStyle(i,n),a.drawMultiPolygon(t,r)}const a=o.getText();if(a){const i=e.getReplay(o.getZIndex(),ic.TEXT);i.setTextStyle(a,e.addDeclutter(!1)),i.drawText(t,r)}},GeometryCollection:function(e,t,o,r){const n=t.getGeometriesArray();let a,i;for(a=0,i=n.length;a<i;++a){const t=vc[n[a].getType()];t(e,n[a],o,r)}},Circle:function(e,t,o,r){const i=o.getFill(),n=o.getStroke();if(i||n){const a=e.getReplay(o.getZIndex(),ic.CIRCLE);a.setFillStrokeStyle(i,n),a.drawCircle(t,r)}const a=o.getText();if(a){const i=e.getReplay(o.getZIndex(),ic.TEXT);i.setTextStyle(a,e.addDeclutter(!1)),i.drawText(t,r)}}},Fc=function(e){Uu.call(this,e),this.declutterTree_=e.getDeclutter()?tc()(9):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Oe(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=Jo(),c(Su,zd.CLEAR,this.handleFontsChanged_,this)};i(Fc,Uu),Fc.handles=function(e,t){return e===jg.CANVAS&&t.getType()===iu.VECTOR},Fc.create=function(e,t){return new Fc(t)},Fc.prototype.disposeInternal=function(){m(Su,zd.CLEAR,this.handleFontsChanged_,this),Uu.prototype.disposeInternal.call(this)},Fc.prototype.composeFrame=function(e,t,o){const r=e.extent,i=e.pixelRatio,n=t.managed?e.skippedFeatureUids:{},a=e.viewState,s=a.projection,l=a.rotation,d=s.getExtent(),p=this.getLayer().getSource();let g=this.getTransform(e,0);this.preCompose(o,e,g);const _=t.extent,u=_!==void 0;u&&this.clip(o,e,_);const c=this.replayGroup_;if(c&&!c.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();const a=this.getLayer();let _=0,u=0,y;const m=1!==t.opacity,h=a.hasListener($g.RENDER);if(m||h){let e=o.canvas.width,t=o.canvas.height;if(l){const o=Wl(id(e*e+t*t));_=(o-e)/2,u=(o-t)/2,e=t=o}this.context.canvas.width=e,this.context.canvas.height=t,y=this.context}else y=o;const f=y.globalAlpha;m||(y.globalAlpha=t.opacity),y!=o&&y.translate(_,u);const E=e.size[0]*i,x=e.size[1]*i;if(Zr(y,-l,E/2,x/2),c.replay(y,g,l,n),p.getWrapX()&&s.canWrapX()&&!Pe(d,r)){let t=r[0];const o=$e(d);let i=0,a;for(;t<d[0];)--i,a=o*i,g=this.getTransform(e,a),c.replay(y,g,l,n),t+=o;for(i=0,t=r[2];t>d[2];)++i,a=o*i,g=this.getTransform(e,a),c.replay(y,g,l,n),t-=o;g=this.getTransform(e,0)}if(Zr(y,l,E/2,x/2),y!=o){if(h&&this.dispatchRenderEvent(y,e,g),m){const e=o.globalAlpha;o.globalAlpha=t.opacity,o.drawImage(y.canvas,-_,-u),o.globalAlpha=e}else o.drawImage(y.canvas,-_,-u);y.translate(-_,-u)}m||(y.globalAlpha=f)}u&&o.restore(),this.postCompose(o,e,t,g)},Fc.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){if(!this.replayGroup_)return;else{const a=t.viewState.resolution,s=t.viewState.rotation,l=this.getLayer(),d={},p=this.replayGroup_.forEachFeatureAtCoordinate(e,a,s,o,{},function(e){const t=n(e).toString();if(!(t in d))return d[t]=!0,r.call(i,e,l)},null);return p}},Fc.prototype.handleFontsChanged_=function(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},Fc.prototype.handleStyleImageChange_=function(){this.renderIfReadyAndVisible()},Fc.prototype.prepareFrame=function(e){const t=this.getLayer(),o=t.getSource(),r=e.viewHints[Zp.ANIMATING],i=e.viewHints[Zp.INTERACTING],n=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(!this.dirty_&&!n&&r||!a&&i)return!0;const s=e.extent,l=e.viewState,d=l.projection,p=l.resolution,g=e.pixelRatio,_=t.getRevision(),u=t.getRenderBuffer();let c=t.getRenderOrder();void 0===c&&(c=mi);const y=Ce(s,u*p),m=l.projection.getExtent();if(o.getWrapX()&&l.projection.canWrapX()&&!Pe(m,e.extent)){const e=$e(m),t=ld($e(y)/2,e);y[0]=m[0]-t,y[2]=m[2]+t}if(!this.dirty_&&this.renderedResolution_==p&&this.renderedRevision_==_&&this.renderedRenderOrder_==c&&Pe(this.renderedExtent_,y))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;const h=new Lc(fi(p,g),y,p,g,o.getOverlaps(),this.declutterTree_,t.getRenderBuffer());o.loadFeatures(y,p,d);const f=function(e){let o;const r=e.getStyleFunction()||t.getStyleFunction();if(r&&(o=r(e,p)),o){const t=this.renderFeature(e,p,g,o,h);this.dirty_=this.dirty_||t}}.bind(this);if(c){const e=[];o.forEachFeatureInExtent(y,function(t){e.push(t)},this),e.sort(c);for(let t=0,o=e.length;t<o;++t)f(e[t])}else o.forEachFeatureInExtent(y,f,this);return h.finish(),this.renderedResolution_=p,this.renderedRevision_=_,this.renderedRenderOrder_=c,this.renderedExtent_=y,this.replayGroup_=h,this.replayGroupChanged=!0,!0},Fc.prototype.renderFeature=function(e,t,o,r,n){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let s=0,i=r.length;s<i;++s)a=Ei(n,e,r[s],hi(t,o),this.handleStyleImageChange_,this)||a;else a=Ei(n,e,r,hi(t,o),this.handleStyleImageChange_,this);return a};var Oc=Fc,wc={IMAGE:'image',HYBRID:'hybrid',VECTOR:'vector'};const Nc={image:[ic.POLYGON,ic.CIRCLE,ic.LINE_STRING,ic.IMAGE,ic.TEXT],hybrid:[ic.POLYGON,ic.LINE_STRING]},Ac={image:[ic.DEFAULT],hybrid:[ic.IMAGE,ic.TEXT,ic.DEFAULT],vector:gc},bc=function(e){this.context=null,$u.call(this,e),this.declutterTree_=e.getDeclutter()?tc()(9):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=Yt(),this.zDirection=e.getRenderMode()==wc.VECTOR?1:0,c(Su,zd.CLEAR,this.handleFontsChanged_,this)};i(bc,$u),bc.handles=function(e,t){return e===jg.CANVAS&&t.getType()===iu.VECTOR_TILE},bc.create=function(e,t){return new bc(t)},bc.prototype.disposeInternal=function(){m(Su,zd.CLEAR,this.handleFontsChanged_,this),$u.prototype.disposeInternal.call(this)},bc.prototype.prepareFrame=function(){const e=this.getLayer(),t=e.getRevision();if(this.renderedLayerRevision_!=t){this.renderedTiles.length=0;const t=e.getRenderMode();this.context||t==wc.VECTOR||(this.context=Jo()),this.context&&t==wc.VECTOR&&(this.context=null)}return this.renderedLayerRevision_=t,$u.prototype.prepareFrame.apply(this,arguments)},bc.prototype.createReplayGroup_=function(e,t){const o=this.getLayer(),r=t.pixelRatio,n=t.viewState.projection,i=o.getRevision(),a=o.getRenderOrder()||null,s=e.getReplayState(o);if(!s.dirty&&s.renderedRevision==i&&s.renderedRenderOrder==a)return;const l=o.getSource(),d=l.getTileGrid(),p=l.getTileGridForProjection(n),g=p.getResolution(e.tileCoord[0]),_=p.getTileCoordExtent(e.wrappedTileCoord),u={};for(let i=0,p=e.tileKeys.length;i<p;++i){const t=e.getTile(e.tileKeys[i]);if(t.getState()!=Yp.LOADED)continue;const p=t.tileCoord,c=d.getTileCoordExtent(p),y=qe(_,c),m=Ge(c,y)?null:Ce(y,o.getRenderBuffer()*g,this.tmpExtent),h=t.getProjection();let f=!1;Mt(n,h)||(f=!0,t.setProjection(n)),s.dirty=!1;const E=new Lc(0,y,g,r,l.getOverlaps(),this.declutterTree_,o.getRenderBuffer()),x=hi(g,r),T=function(e){let t;const r=e.getStyleFunction()||o.getStyleFunction();if(r&&(t=r(e,g)),t){const o=this.renderFeature(e,x,t,E);this.dirty_=this.dirty_||o,s.dirty=s.dirty||o}},S=t.getFeatures();a&&a!==s.renderedRenderOrder&&S.sort(a);for(let e=0,o=S.length;e<o;++e){const o=S[e];f&&(h.getUnits()==ig.TILE_PIXELS&&(h.setWorldExtent(c),h.setExtent(t.getExtent())),o.getGeometry().transform(h,n)),(!m||et(m,o.getGeometry().getExtent()))&&T.call(this,o)}for(const e in E.finish(),E.getReplays())u[e]=!0;t.setReplayGroup(o,e.tileCoord.toString(),E)}s.renderedRevision=i,s.renderedRenderOrder=a},bc.prototype.drawTileImage=function(e,t,o){const r=e;this.createReplayGroup_(r,t),this.context&&(this.renderTileImage_(r,t,o),$u.prototype.drawTileImage.apply(this,arguments))},bc.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,a){const s=t.viewState.resolution,l=t.viewState.rotation;o=o==void 0?0:o;const d=this.getLayer(),p={},g=this.renderedTiles,_=d.getSource(),u=_.getTileGridForProjection(t.viewState.projection);let c,y,m,i,h,f,E,x;for(m=0,i=g.length;m<i;++m)if(f=g[m],E=f.wrappedTileCoord,x=u.getTileCoordExtent(E,this.tmpExtent),c=Ce(x,o*s,c),!!Le(c,e))for(let i=0,t=f.tileKeys.length;i<t;++i){const t=f.getTile(f.tileKeys[i]);t.getState()==Yp.LOADED&&(h=t.getReplayGroup(d,f.tileCoord.toString()),y=y||h.forEachFeatureAtCoordinate(e,s,l,o,{},function(e){const t=n(e).toString();if(!(t in p))return p[t]=!0,r.call(a,e,d)},null))}return y},bc.prototype.getReplayTransform_=function(e,t){const o=this.getLayer(),r=o.getSource(),i=r.getTileGrid(),n=e.tileCoord,a=i.getResolution(n[0]),s=t.viewState,l=t.pixelRatio,d=s.resolution/l,p=i.getTileCoordExtent(n,this.tmpExtent),g=s.center,_=Je(p),u=t.size,c=Wl(l*u[0]/2),y=Wl(l*u[1]/2);return Zt(this.tmpTransform_,c,y,a/d,a/d,s.rotation,(_[0]-g[0])/a,(g[1]-_[1])/a)},bc.prototype.handleFontsChanged_=function(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()},bc.prototype.handleStyleImageChange_=function(){this.renderIfReadyAndVisible()},bc.prototype.postCompose=function(e,o,r){const i=this.getLayer(),n=i.getDeclutter()?{}:null,t=i.getSource(),a=i.getRenderMode(),s=Ac[a],l=o.pixelRatio,d=o.viewState.rotation,p=o.size;let g,_;d&&(g=Wl(l*p[0]/2),_=Wl(l*p[1]/2),Zr(e,-d,g,_)),n&&this.declutterTree_.clear();const u=this.renderedTiles,c=t.getTileGridForProjection(o.viewState.projection),y=[],m=[];for(let t=u.length-1;0<=t;--t){const l=u[t];if(l.getState()==Yp.ABORT)continue;const p=l.tileCoord,g=c.getTileCoordExtent(p,this.tmpExtent)[0]-c.getTileCoordExtent(l.wrappedTileCoord,this.tmpExtent)[0];let _;for(let u=0,t=l.tileKeys.length;u<t;++u){const t=l.getTile(l.tileKeys[u]);if(t.getState()!=Yp.LOADED)continue;const c=t.getReplayGroup(i,p.toString());if(a!=wc.VECTOR&&!c.hasReplays(s))continue;_||(_=this.getTransform(o,g));const h=t.tileCoord[0],f=c.getClipCoords(_);e.save(),e.globalAlpha=r.opacity;for(let t=0,o=y.length;t<o;++t){const o=y[t];h<m[t]&&(e.beginPath(),e.moveTo(f[0],f[1]),e.lineTo(f[2],f[3]),e.lineTo(f[4],f[5]),e.lineTo(f[6],f[7]),e.moveTo(o[6],o[7]),e.lineTo(o[4],o[5]),e.lineTo(o[2],o[3]),e.lineTo(o[0],o[1]),e.clip())}c.replay(e,_,d,{},s,n),e.restore(),y.push(f),m.push(h)}}n&&yi(n,e,d),d&&Zr(e,d,g,_),$u.prototype.postCompose.apply(this,arguments)},bc.prototype.renderFeature=function(e,t,o,r){if(!o)return!1;let n=!1;if(Array.isArray(o))for(let a=0,i=o.length;a<i;++a)n=Ei(r,e,o[a],t,this.handleStyleImageChange_,this)||n;else n=Ei(r,e,o,t,this.handleStyleImageChange_,this);return n},bc.prototype.renderTileImage_=function(e,t){const o=this.getLayer(),r=e.getReplayState(o),i=o.getRevision(),n=Nc[o.getRenderMode()];if(n&&r.renderedTileRevision!==i){r.renderedTileRevision=i;const a=e.wrappedTileCoord,s=a[0],l=t.pixelRatio,d=o.getSource(),p=d.getTileGridForProjection(t.viewState.projection),g=p.getResolution(s),_=e.getContext(o),u=d.getTilePixelSize(s,l,t.viewState.projection);_.canvas.width=u[0],_.canvas.height=u[1];const c=p.getTileCoordExtent(a,this.tmpExtent);for(let t=0,r=e.tileKeys.length;t<r;++t){const r=e.getTile(e.tileKeys[t]);if(r.getState()!=Yp.LOADED)continue;const i=l/g,a=Bt(this.tmpTransform_);Kt(a,i,-i),Ht(a,-c[0],-c[3]);const s=r.getReplayGroup(o,e.tileCoord.toString());s.replay(_,a,0,{},n)}}};var Mc=bc;nr(Ug.MAP_RENDERER,Zu),ar(Ug.LAYER_RENDERER,[Vu,$u,Oc,Mc]);const Gc=function(e){e=Dd({},e),delete e.renderer,e.controls||(e.controls=yr()),e.interactions||(e.interactions=Wr()),Xg.call(this,e)};i(Gc,Xg);const Dc=function(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.snapToPixel_=e.snapToPixel};Dc.prototype.getOpacity=function(){return this.opacity_},Dc.prototype.getRotateWithView=function(){return this.rotateWithView_},Dc.prototype.getRotation=function(){return this.rotation_},Dc.prototype.getScale=function(){return this.scale_},Dc.prototype.getSnapToPixel=function(){return this.snapToPixel_},Dc.prototype.getAnchor=function(){},Dc.prototype.getImage=function(){},Dc.prototype.getHitDetectionImage=function(){},Dc.prototype.getImageState=function(){},Dc.prototype.getImageSize=function(){},Dc.prototype.getHitDetectionImageSize=function(){},Dc.prototype.getOrigin=function(){},Dc.prototype.getSize=function(){},Dc.prototype.setOpacity=function(e){this.opacity_=e},Dc.prototype.setRotateWithView=function(e){this.rotateWithView_=e},Dc.prototype.setRotation=function(e){this.rotation_=e},Dc.prototype.setScale=function(e){this.scale_=e},Dc.prototype.setSnapToPixel=function(e){this.snapToPixel_=e},Dc.prototype.listenImageChange=function(){},Dc.prototype.load=function(){},Dc.prototype.unlistenImageChange=function(){};var kc=Dc;const Uc=function(e){this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=e.fill===void 0?null:e.fill,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius===void 0?e.radius1:e.radius,this.radius2_=e.radius2,this.angle_=e.angle===void 0?0:e.angle,this.stroke_=e.stroke===void 0?null:e.stroke,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=e.atlasManager,this.render_(this.atlasManager_);const t=!(e.snapToPixel!==void 0)||e.snapToPixel,o=e.rotateWithView!==void 0&&e.rotateWithView;kc.call(this,{opacity:1,rotateWithView:o,rotation:e.rotation===void 0?0:e.rotation,scale:1,snapToPixel:t})};i(Uc,kc),Uc.prototype.clone=function(){const e=new Uc({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),snapToPixel:this.getSnapToPixel(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},Uc.prototype.getAnchor=function(){return this.anchor_},Uc.prototype.getAngle=function(){return this.angle_},Uc.prototype.getFill=function(){return this.fill_},Uc.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_},Uc.prototype.getImage=function(){return this.canvas_},Uc.prototype.getImageSize=function(){return this.imageSize_},Uc.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},Uc.prototype.getImageState=function(){return tu.LOADED},Uc.prototype.getOrigin=function(){return this.origin_},Uc.prototype.getPoints=function(){return this.points_},Uc.prototype.getRadius=function(){return this.radius_},Uc.prototype.getRadius2=function(){return this.radius2_},Uc.prototype.getSize=function(){return this.size_},Uc.prototype.getStroke=function(){return this.stroke_},Uc.prototype.listenImageChange=function(){},Uc.prototype.load=function(){},Uc.prototype.unlistenImageChange=function(){},Uc.prototype.render_=function(e){let t='',o='',r=0,i=null,n=0,a=0,s,l;this.stroke_&&(l=this.stroke_.getColor(),null===l&&(l=hu),l=ri(l),a=this.stroke_.getWidth(),a===void 0&&(a=Tu),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),!gp&&(i=null,n=0),o=this.stroke_.getLineJoin(),o===void 0&&(o=yu),t=this.stroke_.getLineCap(),t===void 0&&(t=_u),r=this.stroke_.getMiterLimit(),r===void 0&&(r=mu));let d=2*(this.radius_+a)+1;const p={strokeStyle:l,strokeWidth:a,size:d,lineCap:t,lineDash:i,lineDashOffset:n,lineJoin:o,miterLimit:r};if(e===void 0){const e=Jo(d,d);this.canvas_=e.canvas,d=this.canvas_.width,s=d,this.draw_(p,e,0,0),this.createHitDetectionCanvas_(p)}else{d=Wl(d);const t=!this.fill_;let o;t&&(o=this.drawHitDetectionCanvas_.bind(this,p));const r=this.getChecksum(),i=e.add(r,d,d,this.draw_.bind(this,p),o);this.canvas_=i.image,this.origin_=[i.offsetX,i.offsetY],s=i.image.width,t?(this.hitDetectionCanvas_=i.hitImage,this.hitDetectionImageSize_=[i.hitImage.width,i.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[s,s])}this.anchor_=[d/2,d/2],this.size_=[d,d],this.imageSize_=[s,s]},Uc.prototype.draw_=function(e,t,o,r){let n,i,a;t.setTransform(1,0,0,1,0,0),t.translate(o,r),t.beginPath();let s=this.points_;if(s===Infinity)t.arc(e.size/2,e.size/2,this.radius_,0,2*$l,!0);else{const o=this.radius2_===void 0?this.radius_:this.radius2_;for(o!==this.radius_&&(s=2*s),n=0;n<=s;n++)i=2*n*$l/s-$l/2+this.angle_,a=0==n%2?this.radius_:o,t.lineTo(e.size/2+a*Jl(i),e.size/2+a*ql(i))}if(this.fill_){let e=this.fill_.getColor();null===e&&(e=gu),t.fillStyle=ri(e),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke()),t.closePath()},Uc.prototype.createHitDetectionCanvas_=function(e){if(this.hitDetectionImageSize_=[e.size,e.size],this.fill_)return void(this.hitDetectionCanvas_=this.canvas_);const t=Jo(e.size,e.size);this.hitDetectionCanvas_=t.canvas,this.drawHitDetectionCanvas_(e,t,0,0)},Uc.prototype.drawHitDetectionCanvas_=function(e,t,o,r){t.setTransform(1,0,0,1,0,0),t.translate(o,r),t.beginPath();let n=this.points_;if(n===Infinity)t.arc(e.size/2,e.size/2,this.radius_,0,2*$l,!0);else{const o=this.radius2_===void 0?this.radius_:this.radius2_;o!==this.radius_&&(n=2*n);let r,i,a;for(r=0;r<=n;r++)a=2*r*$l/n-$l/2+this.angle_,i=0==r%2?this.radius_:o,t.lineTo(e.size/2+i*Jl(a),e.size/2+i*ql(a))}t.fillStyle=gu,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.stroke()),t.closePath()},Uc.prototype.getChecksum=function(){const e=this.stroke_?this.stroke_.getChecksum():'-',t=this.fill_?this.fill_.getChecksum():'-',o=!this.checksums_||e!=this.checksums_[1]||t!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6];if(o){const o='r'+e+t+(this.radius_===void 0?'-':this.radius_.toString())+(this.radius2_===void 0?'-':this.radius2_.toString())+(this.angle_===void 0?'-':this.angle_.toString())+(this.points_===void 0?'-':this.points_.toString());this.checksums_=[o,e,t,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]};var Yc=Uc;const Bc=function(e){const t=e||{};Yc.call(this,{points:Infinity,fill:t.fill,radius:t.radius,snapToPixel:t.snapToPixel,stroke:t.stroke,atlasManager:t.atlasManager})};i(Bc,Yc),Bc.prototype.clone=function(){const e=new Bc({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),snapToPixel:this.getSnapToPixel(),atlasManager:this.atlasManager_});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},Bc.prototype.setRadius=function(e){this.radius_=e,this.render_(this.atlasManager_)};var jc=Bc;const Vc=function(e){const t=e||{};this.color_=t.color===void 0?null:t.color,this.checksum_=void 0};Vc.prototype.clone=function(){const e=this.getColor();return new Vc({color:e&&e.slice?e.slice():e||void 0})},Vc.prototype.getColor=function(){return this.color_},Vc.prototype.setColor=function(e){this.color_=e,this.checksum_=void 0},Vc.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=n(this.color_).toString():this.checksum_='f'+(this.color_?Jr(this.color_):'-')),this.checksum_};var zc=Vc;const Xc=function(e){const t=e||{};this.color_=t.color===void 0?null:t.color,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash===void 0?null:t.lineDash,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width,this.checksum_=void 0};Xc.prototype.clone=function(){const e=this.getColor();return new Xc({color:e&&e.slice?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},Xc.prototype.getColor=function(){return this.color_},Xc.prototype.getLineCap=function(){return this.lineCap_},Xc.prototype.getLineDash=function(){return this.lineDash_},Xc.prototype.getLineDashOffset=function(){return this.lineDashOffset_},Xc.prototype.getLineJoin=function(){return this.lineJoin_},Xc.prototype.getMiterLimit=function(){return this.miterLimit_},Xc.prototype.getWidth=function(){return this.width_},Xc.prototype.setColor=function(e){this.color_=e,this.checksum_=void 0},Xc.prototype.setLineCap=function(e){this.lineCap_=e,this.checksum_=void 0},Xc.prototype.setLineDash=function(e){this.lineDash_=e,this.checksum_=void 0},Xc.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e,this.checksum_=void 0},Xc.prototype.setLineJoin=function(e){this.lineJoin_=e,this.checksum_=void 0},Xc.prototype.setMiterLimit=function(e){this.miterLimit_=e,this.checksum_=void 0},Xc.prototype.setWidth=function(e){this.width_=e,this.checksum_=void 0},Xc.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_='s',this.checksum_+=this.color_?'string'==typeof this.color_?this.color_:n(this.color_).toString():'-',this.checksum_+=','+(void 0===this.lineCap_?'-':this.lineCap_.toString())+','+(this.lineDash_?this.lineDash_.toString():'-')+','+(void 0===this.lineDashOffset_?'-':this.lineDashOffset_)+','+(void 0===this.lineJoin_?'-':this.lineJoin_)+','+(void 0===this.miterLimit_?'-':this.miterLimit_.toString())+','+(void 0===this.width_?'-':this.width_.toString())),this.checksum_};var Wc=Xc;const Kc=function(e){const t=e||{};this.geometry_=null,this.geometryFunction_=Ii,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill===void 0?null:t.fill,this.image_=t.image===void 0?null:t.image,this.renderer_=t.renderer===void 0?null:t.renderer,this.stroke_=t.stroke===void 0?null:t.stroke,this.text_=t.text===void 0?null:t.text,this.zIndex_=t.zIndex};Kc.prototype.clone=function(){let e=this.getGeometry();return e&&e.clone&&(e=e.clone()),new Kc({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},Kc.prototype.getRenderer=function(){return this.renderer_},Kc.prototype.setRenderer=function(e){this.renderer_=e},Kc.prototype.getGeometry=function(){return this.geometry_},Kc.prototype.getGeometryFunction=function(){return this.geometryFunction_},Kc.prototype.getFill=function(){return this.fill_},Kc.prototype.setFill=function(e){this.fill_=e},Kc.prototype.getImage=function(){return this.image_},Kc.prototype.setImage=function(e){this.image_=e},Kc.prototype.getStroke=function(){return this.stroke_},Kc.prototype.setStroke=function(e){this.stroke_=e},Kc.prototype.getText=function(){return this.text_},Kc.prototype.setText=function(e){this.text_=e},Kc.prototype.getZIndex=function(){return this.zIndex_},Kc.prototype.setGeometry=function(e){'function'==typeof e?this.geometryFunction_=e:'string'==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Ii,this.geometry_=e},Kc.prototype.setZIndex=function(e){this.zIndex_=e};let Hc=null;var Zc=Kc;const qc=function(e){if(qd.call(this),this.id_=void 0,this.geometryName_='geometry',this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,c(this,C(this.geometryName_),this.handleGeometryChanged_,this),void 0!==e)if(e instanceof xg||!e){this.setGeometry(e)}else{this.setProperties(e)}};i(qc,qd),qc.prototype.clone=function(){const e=new qc(this.getProperties());e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const o=this.getStyle();return o&&e.setStyle(o),e},qc.prototype.getGeometry=function(){return this.get(this.geometryName_)},qc.prototype.getId=function(){return this.id_},qc.prototype.getGeometryName=function(){return this.geometryName_},qc.prototype.getStyle=function(){return this.style_},qc.prototype.getStyleFunction=function(){return this.styleFunction_},qc.prototype.handleGeometryChange_=function(){this.changed()},qc.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(h(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=c(e,zd.CHANGE,this.handleGeometryChange_,this)),this.changed()},qc.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},qc.prototype.setStyle=function(e){this.style_=e,this.styleFunction_=e?Li(e):void 0,this.changed()},qc.prototype.setId=function(e){this.id_=e,this.changed()},qc.prototype.setGeometryName=function(e){m(this,C(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=e,c(this,C(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()};var Jc=qc,Qc={ACCURACY:'accuracy',ACCURACY_GEOMETRY:'accuracyGeometry',ALTITUDE:'altitude',ALTITUDE_ACCURACY:'altitudeAccuracy',HEADING:'heading',POSITION:'position',PROJECTION:'projection',SPEED:'speed',TRACKING:'tracking',TRACKING_OPTIONS:'trackingOptions'};const $c=function(e){qd.call(this);const t=e||{};this.position_=null,this.transform_=It,this.watchId_=void 0,c(this,C(Qc.PROJECTION),this.handleProjectionChanged_,this),c(this,C(Qc.TRACKING),this.handleTrackingChanged_,this),t.projection!==void 0&&this.setProjection(t.projection),t.trackingOptions!==void 0&&this.setTrackingOptions(t.trackingOptions),this.setTracking(t.tracking!==void 0&&t.tracking)};i($c,qd),$c.prototype.disposeInternal=function(){this.setTracking(!1),qd.prototype.disposeInternal.call(this)},$c.prototype.handleProjectionChanged_=function(){const e=this.getProjection();e&&(this.transform_=Gt(vt('EPSG:4326'),e),this.position_&&this.set(Qc.POSITION,this.transform_(this.position_)))},$c.prototype.handleTrackingChanged_=function(){if(_p){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}},$c.prototype.positionChange_=function(e){const t=e.coords;this.set(Qc.ACCURACY,t.accuracy),this.set(Qc.ALTITUDE,null===t.altitude?void 0:t.altitude),this.set(Qc.ALTITUDE_ACCURACY,null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set(Qc.HEADING,null===t.heading?void 0:X(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const o=this.transform_(this.position_);this.set(Qc.POSITION,o),this.set(Qc.SPEED,null===t.speed?void 0:t.speed);const r=Vo(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(Qc.ACCURACY_GEOMETRY,r),this.changed()},$c.prototype.positionError_=function(e){e.type=zd.ERROR,this.setTracking(!1),this.dispatchEvent(e)},$c.prototype.getAccuracy=function(){return this.get(Qc.ACCURACY)},$c.prototype.getAccuracyGeometry=function(){return this.get(Qc.ACCURACY_GEOMETRY)||null},$c.prototype.getAltitude=function(){return this.get(Qc.ALTITUDE)},$c.prototype.getAltitudeAccuracy=function(){return this.get(Qc.ALTITUDE_ACCURACY)},$c.prototype.getHeading=function(){return this.get(Qc.HEADING)},$c.prototype.getPosition=function(){return this.get(Qc.POSITION)},$c.prototype.getProjection=function(){return this.get(Qc.PROJECTION)},$c.prototype.getSpeed=function(){return this.get(Qc.SPEED)},$c.prototype.getTracking=function(){return this.get(Qc.TRACKING)},$c.prototype.getTrackingOptions=function(){return this.get(Qc.TRACKING_OPTIONS)},$c.prototype.setProjection=function(e){this.set(Qc.PROJECTION,vt(e))},$c.prototype.setTracking=function(e){this.set(Qc.TRACKING,e)},$c.prototype.setTrackingOptions=function(e){this.set(Qc.TRACKING_OPTIONS,e)};const ey=function(e,t){Sg.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(e,t)};i(ey,Sg),ey.prototype.appendCoordinate=function(e){this.flatCoordinates?O(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()},ey.prototype.clone=function(){const e=new ey(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},ey.prototype.closestPointXY=function(e,t,o,r){return r<Ie(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=id(no(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),lo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,o,r))},ey.prototype.forEachSegment=function(e){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},ey.prototype.getCoordinateAtM=function(e,t){if(this.layout!=eg.XYM&&this.layout!=eg.XYZM)return null;return vi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t!==void 0&&t)},ey.prototype.getCoordinates=function(){return mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},ey.prototype.getCoordinateAt=function(e,t){return Pi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t)},ey.prototype.getLength=function(){return di(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},ey.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},ey.prototype.getSimplifiedGeometryInternal=function(e){const t=[];t.length=Eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);const o=new ey(null);return o.setFlatCoordinates(eg.XY,t),o},ey.prototype.getType=function(){return $p.LINE_STRING},ey.prototype.intersectsExtent=function(e){return No(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},ey.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=uo(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(eg.XY,null)},ey.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var ty=ey;const oy=function(e){const t=e||{};this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.text_=t.text,this.textAlign_=t.textAlign,this.textBaseline_=t.textBaseline,this.fill_=t.fill===void 0?new zc({color:'#333'}):t.fill,this.maxAngle_=t.maxAngle===void 0?$l/4:t.maxAngle,this.placement_=t.placement===void 0?Tc.POINT:t.placement,this.overflow_=!!t.overflow,this.stroke_=t.stroke===void 0?null:t.stroke,this.offsetX_=t.offsetX===void 0?0:t.offsetX,this.offsetY_=t.offsetY===void 0?0:t.offsetY,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding};oy.prototype.clone=function(){return new oy({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0})},oy.prototype.getOverflow=function(){return this.overflow_},oy.prototype.getFont=function(){return this.font_},oy.prototype.getMaxAngle=function(){return this.maxAngle_},oy.prototype.getPlacement=function(){return this.placement_},oy.prototype.getOffsetX=function(){return this.offsetX_},oy.prototype.getOffsetY=function(){return this.offsetY_},oy.prototype.getFill=function(){return this.fill_},oy.prototype.getRotateWithView=function(){return this.rotateWithView_},oy.prototype.getRotation=function(){return this.rotation_},oy.prototype.getScale=function(){return this.scale_},oy.prototype.getStroke=function(){return this.stroke_},oy.prototype.getText=function(){return this.text_},oy.prototype.getTextAlign=function(){return this.textAlign_},oy.prototype.getTextBaseline=function(){return this.textBaseline_},oy.prototype.getBackgroundFill=function(){return this.backgroundFill_},oy.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},oy.prototype.getPadding=function(){return this.padding_},oy.prototype.setOverflow=function(e){this.overflow_=e},oy.prototype.setFont=function(e){this.font_=e},oy.prototype.setMaxAngle=function(e){this.maxAngle_=e},oy.prototype.setOffsetX=function(e){this.offsetX_=e},oy.prototype.setOffsetY=function(e){this.offsetY_=e},oy.prototype.setPlacement=function(e){this.placement_=e},oy.prototype.setFill=function(e){this.fill_=e},oy.prototype.setRotation=function(e){this.rotation_=e},oy.prototype.setScale=function(e){this.scale_=e},oy.prototype.setStroke=function(e){this.stroke_=e},oy.prototype.setText=function(e){this.text_=e},oy.prototype.setTextAlign=function(e){this.textAlign_=e},oy.prototype.setTextBaseline=function(e){this.textBaseline_=e},oy.prototype.setBackgroundFill=function(e){this.backgroundFill_=e},oy.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e},oy.prototype.setPadding=function(e){this.padding_=e};var ry=oy;const iy=new Wc({color:'rgba(0,0,0,0.2)'}),ny=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],ay=function(e){const t=e||{};if(this.map_=null,this.postcomposeListenerKey_=null,this.projection_=null,this.maxLat_=Infinity,this.maxLon_=Infinity,this.minLat_=-Infinity,this.minLon_=-Infinity,this.maxLatP_=Infinity,this.maxLonP_=Infinity,this.minLatP_=-Infinity,this.minLonP_=-Infinity,this.targetSize_=void 0===t.targetSize?100:t.targetSize,this.maxLines_=void 0===t.maxLines?100:t.maxLines,this.meridians_=[],this.parallels_=[],this.strokeStyle_=void 0===t.strokeStyle?iy:t.strokeStyle,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,!0==t.showLabels){const e=le;this.lonLabelFormatter_=void 0==t.lonLabelFormatter?e.bind(this,'EW'):t.lonLabelFormatter,this.latLabelFormatter_=void 0==t.latLabelFormatter?e.bind(this,'NS'):t.latLabelFormatter,this.lonLabelPosition_=void 0==t.lonLabelPosition?0:t.lonLabelPosition,this.latLabelPosition_=void 0==t.latLabelPosition?1:t.latLabelPosition,this.lonLabelStyle_=void 0===t.lonLabelStyle?new ry({font:'12px Calibri,sans-serif',textBaseline:'bottom',fill:new zc({color:'rgba(0,0,0,1)'}),stroke:new Wc({color:'rgba(255,255,255,1)',width:3})}):t.lonLabelStyle,this.latLabelStyle_=void 0===t.latLabelStyle?new ry({font:'12px Calibri,sans-serif',textAlign:'end',fill:new zc({color:'rgba(0,0,0,1)'}),stroke:new Wc({color:'rgba(255,255,255,1)',width:3})}):t.latLabelStyle,this.meridiansLabels_=[],this.parallelsLabels_=[]}this.setMap(void 0===t.map?null:t.map)};ay.prototype.addMeridian_=function(e,t,o,r,i,n){const a=this.getMeridian_(e,t,o,r,n);if(et(a.getExtent(),i)){if(this.meridiansLabels_){const t=this.getMeridianPoint_(a,i,n);this.meridiansLabels_[n]={geom:t,text:this.lonLabelFormatter_(e)}}this.meridians_[n++]=a}return n},ay.prototype.getMeridianPoint_=function(e,t,o){const r=e.getFlatCoordinates(),i=ld(t[1],r[1]),n=rd(t[3],r[r.length-1]),a=U(t[1]+od(t[1]-t[3])*this.lonLabelPosition_,i,n),s=[r[0],a],l=void 0===this.meridiansLabels_[o]?new Lg(null):this.meridiansLabels_[o].geom;return l.setCoordinates(s),l},ay.prototype.addParallel_=function(e,t,o,r,i,n){const a=this.getParallel_(e,t,o,r,n);if(et(a.getExtent(),i)){if(this.parallelsLabels_){const t=this.getParallelPoint_(a,i,n);this.parallelsLabels_[n]={geom:t,text:this.latLabelFormatter_(e)}}this.parallels_[n++]=a}return n},ay.prototype.getParallelPoint_=function(e,t,o){const r=e.getFlatCoordinates(),i=ld(t[0],r[0]),n=rd(t[2],r[r.length-2]),a=U(t[0]+od(t[0]-t[2])*this.latLabelPosition_,i,n),s=[a,r[1]],l=void 0===this.parallelsLabels_[o]?new Lg(null):this.parallelsLabels_[o].geom;return l.setCoordinates(s),l},ay.prototype.createGraticule_=function(e,t,o,r){const i=this.getInterval_(o);if(-1==i)return this.meridians_.length=this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),void(this.parallelsLabels_&&(this.parallelsLabels_.length=0));const n=this.toLonLatTransform_(t);let a=n[0],s=n[1];const l=this.maxLines_;let d=[ld(e[0],this.minLonP_),ld(e[1],this.minLatP_),rd(e[2],this.maxLonP_),rd(e[3],this.maxLatP_)],p,g,_,u;d=Ut(d,this.projection_,'EPSG:4326');const c=d[3],y=d[2],m=d[1],h=d[0];for(a=Ql(a/i)*i,u=U(a,this.minLon_,this.maxLon_),g=this.addMeridian_(u,m,c,r,e,0),p=0;u!=this.minLon_&&p++<l;)u=ld(u-i,this.minLon_),g=this.addMeridian_(u,m,c,r,e,g);for(u=U(a,this.minLon_,this.maxLon_),p=0;u!=this.maxLon_&&p++<l;)u=rd(u+i,this.maxLon_),g=this.addMeridian_(u,m,c,r,e,g);for(this.meridians_.length=g,this.meridiansLabels_&&(this.meridiansLabels_.length=g),s=Ql(s/i)*i,_=U(s,this.minLat_,this.maxLat_),g=this.addParallel_(_,h,y,r,e,0),p=0;_!=this.minLat_&&p++<l;)_=ld(_-i,this.minLat_),g=this.addParallel_(_,h,y,r,e,g);for(_=U(s,this.minLat_,this.maxLat_),p=0;_!=this.maxLat_&&p++<l;)_=rd(_+i,this.maxLat_),g=this.addParallel_(_,h,y,r,e,g);this.parallels_.length=g,this.parallelsLabels_&&(this.parallelsLabels_.length=g)},ay.prototype.getInterval_=function(e){const t=this.projectionCenterLonLat_[0],o=this.projectionCenterLonLat_[1];let r=-1,n,i,a,s;const l=nd(this.targetSize_*e,2),d=[],p=[];for(n=0,i=ny.length;n<i&&(a=ny[n]/2,d[0]=t-a,d[1]=o-a,p[0]=t+a,p[1]=o+a,this.fromLonLatTransform_(d,d),this.fromLonLatTransform_(p,p),s=nd(p[0]-d[0],2)+nd(p[1]-d[1],2),!(s<=l));++n)r=ny[n];return r},ay.prototype.getMap=function(){return this.map_},ay.prototype.getMeridian_=function(e,t,o,r,i){const n=wi(e,t,o,this.projection_,r),a=void 0===this.meridians_[i]?new ty(null):this.meridians_[i];return a.setFlatCoordinates(eg.XY,n),a},ay.prototype.getMeridians=function(){return this.meridians_},ay.prototype.getParallel_=function(e,t,o,r,i){const n=Ni(e,t,o,this.projection_,r),a=void 0===this.parallels_[i]?new ty(null):this.parallels_[i];return a.setFlatCoordinates(eg.XY,n),a},ay.prototype.getParallels=function(){return this.parallels_},ay.prototype.handlePostCompose_=function(t){const e=t.vectorContext,o=t.frameState,r=o.extent,n=o.viewState,a=n.center,s=n.projection,d=n.resolution,p=o.pixelRatio,g=!this.projection_||!Mt(this.projection_,s);g&&this.updateProjectionInfo_(s),this.createGraticule_(r,a,d,d*d/(4*p*p)),e.setFillStrokeStyle(null,this.strokeStyle_);let _,i,l;for(_=0,i=this.meridians_.length;_<i;++_)l=this.meridians_[_],e.drawGeometry(l);for(_=0,i=this.parallels_.length;_<i;++_)l=this.parallels_[_],e.drawGeometry(l);let u;if(this.meridiansLabels_)for(_=0,i=this.meridiansLabels_.length;_<i;++_)u=this.meridiansLabels_[_],this.lonLabelStyle_.setText(u.text),e.setTextStyle(this.lonLabelStyle_),e.drawGeometry(u.geom);if(this.parallelsLabels_)for(_=0,i=this.parallelsLabels_.length;_<i;++_)u=this.parallelsLabels_[_],this.latLabelStyle_.setText(u.text),e.setTextStyle(this.latLabelStyle_),e.drawGeometry(u.geom)},ay.prototype.updateProjectionInfo_=function(e){const t=vt('EPSG:4326'),o=e.getExtent(),r=e.getWorldExtent(),i=Ut(r,t,e),n=r[3],a=r[2],s=r[1],l=r[0],d=i[3],p=i[2],g=i[1],_=i[0];this.maxLat_=n,this.maxLon_=a,this.minLat_=s,this.minLon_=l,this.maxLatP_=d,this.maxLonP_=p,this.minLatP_=g,this.minLonP_=_,this.fromLonLatTransform_=Dt(t,e),this.toLonLatTransform_=Dt(e,t),this.projectionCenterLonLat_=this.toLonLatTransform_(We(o)),this.projection_=e},ay.prototype.setMap=function(e){this.map_&&(h(this.postcomposeListenerKey_),this.postcomposeListenerKey_=null,this.map_.render()),e&&(this.postcomposeListenerKey_=c(e,$g.POSTCOMPOSE,this.handlePostCompose_,this),e.render()),this.map_=e};const sy=function(e,t,o,r,i,n){eu.call(this,e,t,o,tu.IDLE),this.src_=r,this.image_=new Image,null!==i&&(this.image_.crossOrigin=i),this.imageListenerKeys_=null,this.state=tu.IDLE,this.imageLoadFunction_=n};i(sy,eu),sy.prototype.getImage=function(){return this.image_},sy.prototype.handleImageError_=function(){this.state=tu.ERROR,this.unlistenImage_(),this.changed()},sy.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=Ze(this.extent)/this.image_.height),this.state=tu.LOADED,this.unlistenImage_(),this.changed()},sy.prototype.load=function(){(this.state==tu.IDLE||this.state==tu.ERROR)&&(this.state=tu.LOADING,this.changed(),this.imageListenerKeys_=[y(this.image_,zd.ERROR,this.handleImageError_,this),y(this.image_,zd.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},sy.prototype.setImage=function(e){this.image_=e},sy.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(h),this.imageListenerKeys_=null};var ly=sy;const dy=function(e,t,o){Vd.call(this);const r=o?o:{};this.tileCoord=e,this.state=t,this.interimTile=null,this.key='',this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={}};i(dy,Vd),dy.prototype.changed=function(){this.dispatchEvent(zd.CHANGE)},dy.prototype.getKey=function(){return this.key+'/'+this.tileCoord},dy.prototype.getInterimTile=function(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==Yp.LOADED)return e;e=e.interimTile}while(e);return this},dy.prototype.refreshInterimChain=function(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==Yp.LOADED){e.interimTile=null;break}else e.getState()==Yp.LOADING?t=e:e.getState()==Yp.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)},dy.prototype.getTileCoord=function(){return this.tileCoord},dy.prototype.getState=function(){return this.state},dy.prototype.setState=function(e){this.state=e,this.changed()},dy.prototype.load=function(){},dy.prototype.getAlpha=function(e,t){if(!this.transition_)return 1;let o=this.transitionStarts_[e];if(!o)o=t,this.transitionStarts_[e]=o;else if(-1===o)return 1;const r=t-o+1e3/60;return r>=this.transition_?1:he(r/this.transition_)},dy.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]},dy.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)};var py=dy;const gy=function(e,t,o,r,i,n){py.call(this,e,t,n),this.crossOrigin_=r,this.src_=o,this.image_=new Image,null!==r&&(this.image_.crossOrigin=r),this.imageListenerKeys_=null,this.tileLoadFunction_=i};i(gy,py),gy.prototype.disposeInternal=function(){this.state==Yp.LOADING&&(this.unlistenImage_(),this.image_=Ai()),this.interimTile&&this.interimTile.dispose(),this.state=Yp.ABORT,this.changed(),py.prototype.disposeInternal.call(this)},gy.prototype.getImage=function(){return this.image_},gy.prototype.getKey=function(){return this.src_},gy.prototype.handleImageError_=function(){this.state=Yp.ERROR,this.unlistenImage_(),this.image_=Ai(),this.changed()},gy.prototype.handleImageLoad_=function(){this.state=this.image_.naturalWidth&&this.image_.naturalHeight?Yp.LOADED:Yp.EMPTY,this.unlistenImage_(),this.changed()},gy.prototype.load=function(){this.state==Yp.ERROR&&(this.state=Yp.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Yp.IDLE&&(this.state=Yp.LOADING,this.changed(),this.imageListenerKeys_=[y(this.image_,zd.ERROR,this.handleImageError_,this),y(this.image_,zd.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},gy.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(h),this.imageListenerKeys_=null};var _y=gy;const uy=function(e){this.source_=e};uy.prototype.getType=function(){},uy.prototype.getSource=function(){return this.source_},uy.prototype.isAnimated=x;var cy=uy;const yy=function(e){cy.call(this,e)};i(yy,cy),yy.prototype.getType=function(){return 35632};var my=yy;const hy=function(e){cy.call(this,e)};i(hy,cy),hy.prototype.getType=function(){return 35633};var fy=hy;const Ey=new my('precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n'),xy=new fy('varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n');var Ty=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_lineWidth=e.getUniformLocation(t,'u_lineWidth'),this.u_pixelRatio=e.getUniformLocation(t,'u_pixelRatio'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_fillColor=e.getUniformLocation(t,'u_fillColor'),this.u_strokeColor=e.getUniformLocation(t,'u_strokeColor'),this.u_size=e.getUniformLocation(t,'u_size'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_instruction=e.getAttribLocation(t,'a_instruction'),this.a_radius=e.getAttribLocation(t,'a_radius')};const Sy=function(e,t){Au.call(this),this.tolerance=e,this.maxExtent=t,this.origin=We(t),this.projectionMatrix_=Yt(),this.offsetRotateMatrix_=Yt(),this.offsetScaleMatrix_=Yt(),this.tmpMat4_=bi(),this.indices=[],this.indicesBuffer=null,this.startIndices=[],this.startIndicesFeature=[],this.vertices=[],this.verticesBuffer=null,this.lineStringReplay=void 0};i(Sy,Au),Sy.prototype.getDeleteResourcesFunction=function(){},Sy.prototype.finish=function(){},Sy.prototype.setUpProgram=function(){},Sy.prototype.shutDownProgram=function(){},Sy.prototype.drawReplay=function(){},Sy.prototype.drawHitDetectionReplayOneByOne=function(){},Sy.prototype.drawHitDetectionReplay=function(e,t,o,r,i,n){return i?this.drawHitDetectionReplayOneByOne(e,t,o,r,n):this.drawHitDetectionReplayAll(e,t,o,r)},Sy.prototype.drawHitDetectionReplayAll=function(e,t,o,r){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawReplay(e,t,o,!0);const i=r(null);return i?i:void 0},Sy.prototype.replay=function(e,t,o,r,i,n,a,s,l,d,p){const g=e.getGL();let _,u,c,y,m,h,f,E;this.lineStringReplay&&(_=g.isEnabled(g.STENCIL_TEST),u=g.getParameter(g.STENCIL_FUNC),c=g.getParameter(g.STENCIL_VALUE_MASK),y=g.getParameter(g.STENCIL_REF),m=g.getParameter(g.STENCIL_WRITEMASK),h=g.getParameter(g.STENCIL_FAIL),f=g.getParameter(g.STENCIL_PASS_DEPTH_PASS),E=g.getParameter(g.STENCIL_PASS_DEPTH_FAIL),g.enable(g.STENCIL_TEST),g.clear(g.STENCIL_BUFFER_BIT),g.stencilMask(255),g.stencilFunc(g.ALWAYS,1,255),g.stencilOp(g.KEEP,g.KEEP,g.REPLACE),this.lineStringReplay.replay(e,t,o,r,i,n,a,s,l,d,p),g.stencilMask(0),g.stencilFunc(g.NOTEQUAL,1,255)),e.bindBuffer(_d,this.verticesBuffer),e.bindBuffer(ud,this.indicesBuffer);const x=this.setUpProgram(g,e,i,n),T=Bt(this.projectionMatrix_);Kt(T,2/(o*i[0]),2/(o*i[1])),Wt(T,-r),Ht(T,-(t[0]-this.origin[0]),-(t[1]-this.origin[1]));const S=Bt(this.offsetScaleMatrix_);Kt(S,2/i[0],2/i[1]);const C=Bt(this.offsetRotateMatrix_);0!==r&&Wt(C,-r),g.uniformMatrix4fv(x.u_projectionMatrix,!1,Mi(this.tmpMat4_,T)),g.uniformMatrix4fv(x.u_offsetScaleMatrix,!1,Mi(this.tmpMat4_,S)),g.uniformMatrix4fv(x.u_offsetRotateMatrix,!1,Mi(this.tmpMat4_,C)),g.uniform1f(x.u_opacity,a);let R;return void 0===l?this.drawReplay(g,e,s,!1):R=this.drawHitDetectionReplay(g,e,s,l,d,p),this.shutDownProgram(g,x),this.lineStringReplay&&(!_&&g.disable(g.STENCIL_TEST),g.clear(g.STENCIL_BUFFER_BIT),g.stencilFunc(u,y,c),g.stencilMask(m),g.stencilOp(h,E,f)),R},Sy.prototype.drawElements=function(e,t,o,r){const i=t.hasOESElementIndexUint?5125:5123,n=t.hasOESElementIndexUint?4:2;e.drawElements(4,r-o,i,o*n)};var Cy=Sy;const Ry=[0,0,0,1],Iy='round',Ly=[],Py=0,vy='round',Fy=10,Oy=[0,0,0,1],wy=1,Ny=Number.EPSILON||2220446049250313e-31,Ay=function(e,t,o,r,i,n){const a=(o-e)*(n-t)-(i-e)*(r-t);return a<=Ny&&a>=-Ny?void 0:0<a},by={STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048},My=function(e,t){this.arr_=e===void 0?[]:e,this.usage_=t===void 0?by.STATIC_DRAW:t};My.prototype.getArray=function(){return this.arr_},My.prototype.getUsage=function(){return this.usage_};var Gy=My;const Dy=function(e,t){Cy.call(this,e,t),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.radius_=0,this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}};i(Dy,Cy),Dy.prototype.drawCoordinates_=function(e,t,o,r){let a=this.vertices.length,s=this.indices.length,l=a/4,n,i;for(n=t,i=o;n<i;n+=r)this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=0,this.vertices[a++]=this.radius_,this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=1,this.vertices[a++]=this.radius_,this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=2,this.vertices[a++]=this.radius_,this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=3,this.vertices[a++]=this.radius_,this.indices[s++]=l,this.indices[s++]=l+1,this.indices[s++]=l+2,this.indices[s++]=l+2,this.indices[s++]=l+3,this.indices[s++]=l,l+=4},Dy.prototype.drawCircle=function(e,t){const o=e.getRadius(),r=e.getStride();if(o){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.radius_=o;let i=e.getFlatCoordinates();i=dt(i,0,2,r,-this.origin[0],-this.origin[1]),this.drawCoordinates_(i,0,2,r)}else if(this.state_.changed&&(this.styles_.pop(),this.styles_.length)){const e=this.styles_[this.styles_.length-1];this.state_.fillColor=e[0],this.state_.strokeColor=e[1],this.state_.lineWidth=e[2],this.state_.changed=!1}},Dy.prototype.finish=function(){this.verticesBuffer=new Gy(this.vertices),this.indicesBuffer=new Gy(this.indices),this.startIndices.push(this.indices.length),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},Dy.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t),e.deleteBuffer(o)}},Dy.prototype.setUpProgram=function(e,t,o,r){const i=t.getProgram(Ey,xy);let n;return this.defaultLocations_?n=this.defaultLocations_:(n=new Ty(e,i),this.defaultLocations_=n),t.useProgram(i),e.enableVertexAttribArray(n.a_position),e.vertexAttribPointer(n.a_position,2,md,!1,16,0),e.enableVertexAttribArray(n.a_instruction),e.vertexAttribPointer(n.a_instruction,1,md,!1,16,8),e.enableVertexAttribArray(n.a_radius),e.vertexAttribPointer(n.a_radius,1,md,!1,16,12),e.uniform2fv(n.u_size,o),e.uniform1f(n.u_pixelRatio,r),n},Dy.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position),e.disableVertexAttribArray(t.a_instruction),e.disableVertexAttribArray(t.a_radius)},Dy.prototype.drawReplay=function(e,t,o){if(!l(o))this.drawReplaySkipping_(e,t,o);else{let o,r,i,n;for(i=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;0<=o;--o)r=this.styleIndices_[o],n=this.styles_[o],this.setFillStyle_(e,n[0]),this.setStrokeStyle_(e,n[1],n[2]),this.drawElements(e,t,r,i),i=r}},Dy.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s,i,l,d,p,g,_,u;for(u=this.startIndices.length-2,l=this.startIndices[u+1],s=this.styleIndices_.length-1;0<=s;--s)for(d=this.styles_[s],this.setFillStyle_(e,d[0]),this.setStrokeStyle_(e,d[1],d[2]),p=this.styleIndices_[s];0<=u&&this.startIndices[u]>=p;){if(i=this.startIndices[u],g=this.startIndicesFeature[u],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||et(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,i,l);const o=r(g);if(o)return o}u--,l=i}},Dy.prototype.drawReplaySkipping_=function(e,t,o){let r,i,a,s,l,d,p,g,_;for(g=this.startIndices.length-2,a=i=this.startIndices[g+1],r=this.styleIndices_.length-1;0<=r;--r){for(s=this.styles_[r],this.setFillStyle_(e,s[0]),this.setStrokeStyle_(e,s[1],s[2]),l=this.styleIndices_[r];0<=g&&this.startIndices[g]>=l;)_=this.startIndices[g],d=this.startIndicesFeature[g],p=n(d).toString(),o[p]&&(i!==a&&this.drawElements(e,t,i,a),a=_),g--,i=_;i!==a&&this.drawElements(e,t,i,a),i=a=l}},Dy.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_fillColor,t)},Dy.prototype.setStrokeStyle_=function(e,t,o){e.uniform4fv(this.defaultLocations_.u_strokeColor,t),e.uniform1f(this.defaultLocations_.u_lineWidth,o)},Dy.prototype.setFillStrokeStyle=function(e,t){let o,r;if(t){const e=t.getLineDash();this.state_.lineDash=e?e:Ly;const i=t.getLineDashOffset();this.state_.lineDashOffset=i?i:Py,o=t.getColor(),o=o instanceof CanvasGradient||o instanceof CanvasPattern?Oy:$r(o).map(function(e,t){return 3==t?e:e/255})||Oy,r=t.getWidth(),r=r===void 0?wy:r}else o=[0,0,0,0],r=0;let i=e?e.getColor():[0,0,0,0];i=i instanceof CanvasGradient||i instanceof CanvasPattern?Ry:$r(i).map(function(e,t){return 3==t?e:e/255})||Ry,this.state_.strokeColor&&A(this.state_.strokeColor,o)&&this.state_.fillColor&&A(this.state_.fillColor,i)&&this.state_.lineWidth===r||(this.state_.changed=!0,this.state_.fillColor=i,this.state_.strokeColor=o,this.state_.lineWidth=r,this.styles_.push([i,o,r]))};const ky=new my('precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n'),Uy=new fy('varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n');var Yy=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_image=e.getUniformLocation(t,'u_image'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_texCoord=e.getAttribLocation(t,'a_texCoord'),this.a_offsets=e.getAttribLocation(t,'a_offsets'),this.a_opacity=e.getAttribLocation(t,'a_opacity'),this.a_rotateWithView=e.getAttribLocation(t,'a_rotateWithView')},By={LOST:'webglcontextlost',RESTORED:'webglcontextrestored'};const jy=function(e,t){this.canvas_=e,this.gl_=t,this.bufferCache_={},this.shaderCache_={},this.programCache_={},this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null,this.hasOESElementIndexUint=P(Od,'OES_element_index_uint'),this.hasOESElementIndexUint&&t.getExtension('OES_element_index_uint'),c(this.canvas_,By.LOST,this.handleWebGLContextLost,this),c(this.canvas_,By.RESTORED,this.handleWebGLContextRestored,this)};i(jy,Ud),jy.prototype.bindBuffer=function(e,t){const o=this.getGL(),r=t.getArray(),i=n(t)+'';if(i in this.bufferCache_){const t=this.bufferCache_[i];o.bindBuffer(e,t.buffer)}else{const n=o.createBuffer();o.bindBuffer(e,n);let a;e==_d?a=new Float32Array(r):e==ud&&(a=this.hasOESElementIndexUint?new Uint32Array(r):new Uint16Array(r)),o.bufferData(e,a,t.getUsage()),this.bufferCache_[i]={buf:t,buffer:n}}},jy.prototype.deleteBuffer=function(e){const t=this.getGL(),o=n(e)+'',r=this.bufferCache_[o];t.isContextLost()||t.deleteBuffer(r.buffer),delete this.bufferCache_[o]},jy.prototype.disposeInternal=function(){f(this.canvas_);const e=this.getGL();if(!e.isContextLost()){for(const t in this.bufferCache_)e.deleteBuffer(this.bufferCache_[t].buffer);for(const t in this.programCache_)e.deleteProgram(this.programCache_[t]);for(const t in this.shaderCache_)e.deleteShader(this.shaderCache_[t]);e.deleteFramebuffer(this.hitDetectionFramebuffer_),e.deleteRenderbuffer(this.hitDetectionRenderbuffer_),e.deleteTexture(this.hitDetectionTexture_)}},jy.prototype.getCanvas=function(){return this.canvas_},jy.prototype.getGL=function(){return this.gl_},jy.prototype.getHitDetectionFramebuffer=function(){return this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_(),this.hitDetectionFramebuffer_},jy.prototype.getShader=function(e){const t=n(e)+'';if(t in this.shaderCache_)return this.shaderCache_[t];else{const o=this.getGL(),r=o.createShader(e.getType());return o.shaderSource(r,e.getSource()),o.compileShader(r),this.shaderCache_[t]=r,r}},jy.prototype.getProgram=function(e,t){const o=n(e)+'/'+n(t);if(o in this.programCache_)return this.programCache_[o];else{const r=this.getGL(),i=r.createProgram();return r.attachShader(i,this.getShader(e)),r.attachShader(i,this.getShader(t)),r.linkProgram(i),this.programCache_[o]=i,i}},jy.prototype.handleWebGLContextLost=function(){a(this.bufferCache_),a(this.shaderCache_),a(this.programCache_),this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null},jy.prototype.handleWebGLContextRestored=function(){},jy.prototype.initHitDetectionFramebuffer_=function(){const e=this.gl_,t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const o=Di(e,1,1),r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1,1),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this.hitDetectionFramebuffer_=t,this.hitDetectionTexture_=o,this.hitDetectionRenderbuffer_=r},jy.prototype.useProgram=function(e){if(e==this.currentProgram_)return!1;else{const t=this.getGL();return t.useProgram(e),this.currentProgram_=e,!0}};const Vy=function(e,t){Cy.call(this,e,t),this.anchorX=void 0,this.anchorY=void 0,this.groupIndices=[],this.hitDetectionGroupIndices=[],this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.defaultLocations=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.width=void 0};i(Vy,Cy),Vy.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer,r=this.getTextures(!0),n=e.getGL();return function(){if(!n.isContextLost()){let e,t;for(e=0,t=r.length;e<t;++e)n.deleteTexture(r[e])}e.deleteBuffer(t),e.deleteBuffer(o)}},Vy.prototype.drawCoordinates=function(e,t,o,r){const a=this.anchorX,s=this.anchorY,l=this.height,d=this.imageHeight,p=this.imageWidth,g=this.opacity,_=this.originX,u=this.originY,c=this.rotateWithView?1:0,m=-this.rotation,h=this.scale,f=this.width,E=Jl(m),T=ql(m);let S=this.indices.length,C=this.vertices.length,R,i,n,I,L,x;for(R=t;R<o;R+=r)L=e[R]-this.origin[0],x=e[R+1]-this.origin[1],i=C/8,n=-h*a,I=-h*(l-s),this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=_/p,this.vertices[C++]=(u+l)/d,this.vertices[C++]=g,this.vertices[C++]=c,n=h*(f-a),I=-h*(l-s),this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=(_+f)/p,this.vertices[C++]=(u+l)/d,this.vertices[C++]=g,this.vertices[C++]=c,n=h*(f-a),I=h*s,this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=(_+f)/p,this.vertices[C++]=u/d,this.vertices[C++]=g,this.vertices[C++]=c,n=-h*a,I=h*s,this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=_/p,this.vertices[C++]=u/d,this.vertices[C++]=g,this.vertices[C++]=c,this.indices[S++]=i,this.indices[S++]=i+1,this.indices[S++]=i+2,this.indices[S++]=i,this.indices[S++]=i+2,this.indices[S++]=i+3;return C},Vy.prototype.createTextures=function(e,t,o,r){let a,s,l,d;const i=t.length;for(d=0;d<i;++d)s=t[d],l=n(s).toString(),l in o?a=o[l]:(a=ki(r,s,Rd,Rd),o[l]=a),e[d]=a},Vy.prototype.setUpProgram=function(e,t){const o=t.getProgram(ky,Uy);let r;return this.defaultLocations?r=this.defaultLocations:(r=new Yy(e,o),this.defaultLocations=r),t.useProgram(o),e.enableVertexAttribArray(r.a_position),e.vertexAttribPointer(r.a_position,2,md,!1,32,0),e.enableVertexAttribArray(r.a_offsets),e.vertexAttribPointer(r.a_offsets,2,md,!1,32,8),e.enableVertexAttribArray(r.a_texCoord),e.vertexAttribPointer(r.a_texCoord,2,md,!1,32,16),e.enableVertexAttribArray(r.a_opacity),e.vertexAttribPointer(r.a_opacity,1,md,!1,32,24),e.enableVertexAttribArray(r.a_rotateWithView),e.vertexAttribPointer(r.a_rotateWithView,1,md,!1,32,28),r},Vy.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position),e.disableVertexAttribArray(t.a_offsets),e.disableVertexAttribArray(t.a_texCoord),e.disableVertexAttribArray(t.a_opacity),e.disableVertexAttribArray(t.a_rotateWithView)},Vy.prototype.drawReplay=function(e,t,o,r){const n=r?this.getHitDetectionTextures():this.getTextures(),a=r?this.hitDetectionGroupIndices:this.groupIndices;if(!l(o))this.drawReplaySkipping(e,t,o,n,a);else{let o,r,i;for(o=0,r=n.length,i=0;o<r;++o){e.bindTexture(Cd,n[o]);const r=a[o];this.drawElements(e,t,i,r),i=r}}},Vy.prototype.drawReplaySkipping=function(e,t,o,r,a){let s=0,l,i;for(l=0,i=r.length;l<i;++l){e.bindTexture(Cd,r[l]);const i=0<l?a[l-1]:0,d=a[l];let p=i,g=i;for(;s<this.startIndices.length&&this.startIndices[s]<=d;){const r=this.startIndicesFeature[s],i=n(r).toString();o[i]===void 0?g=s==this.startIndices.length-1?d:this.startIndices[s+1]:(p!==g&&this.drawElements(e,t,p,g),p=s==this.startIndices.length-1?d:this.startIndices[s+1],g=p),s++}p!==g&&this.drawElements(e,t,p,g)}},Vy.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s=this.startIndices.length-1,l,i,d,p,g,_;const u=this.getHitDetectionTextures();for(l=u.length-1;0<=l;--l)for(e.bindTexture(Cd,u[l]),i=0<l?this.hitDetectionGroupIndices[l-1]:0,p=this.hitDetectionGroupIndices[l];0<=s&&this.startIndices[s]>=i;){if(d=this.startIndices[s],g=this.startIndicesFeature[s],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||et(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,d,p);const o=r(g);if(o)return o}p=d,s--}},Vy.prototype.finish=function(){this.anchorX=void 0,this.anchorY=void 0,this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.indices=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.vertices=null,this.width=void 0},Vy.prototype.getTextures=function(){},Vy.prototype.getHitDetectionTextures=function(){};var zy=Vy;const Xy=function(e,t){zy.call(this,e,t),this.images_=[],this.hitDetectionImages_=[],this.textures_=[],this.hitDetectionTextures_=[]};i(Xy,zy),Xy.prototype.drawMultiPoint=function(e,t){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t);const o=e.getFlatCoordinates(),r=e.getStride();this.drawCoordinates(o,0,o.length,r)},Xy.prototype.drawPoint=function(e,t){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t);const o=e.getFlatCoordinates(),r=e.getStride();this.drawCoordinates(o,0,o.length,r)},Xy.prototype.finish=function(e){const t=e.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices.push(this.indices.length),this.verticesBuffer=new Gy(this.vertices);const o=this.indices;this.indicesBuffer=new Gy(o);const r={};this.createTextures(this.textures_,this.images_,r,t),this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,r,t),this.images_=null,this.hitDetectionImages_=null,zy.prototype.finish.call(this,e)},Xy.prototype.setImageStyle=function(e){const t=e.getAnchor(),o=e.getImage(1),r=e.getImageSize(),i=e.getHitDetectionImage(1),a=e.getOpacity(),s=e.getOrigin(),l=e.getRotateWithView(),d=e.getRotation(),p=e.getSize(),g=e.getScale();let _;0===this.images_.length?this.images_.push(o):(_=this.images_[this.images_.length-1],n(_)!=n(o)&&(this.groupIndices.push(this.indices.length),this.images_.push(o))),0===this.hitDetectionImages_.length?this.hitDetectionImages_.push(i):(_=this.hitDetectionImages_[this.hitDetectionImages_.length-1],n(_)!=n(i)&&(this.hitDetectionGroupIndices.push(this.indices.length),this.hitDetectionImages_.push(i))),this.anchorX=t[0],this.anchorY=t[1],this.height=p[1],this.imageHeight=r[1],this.imageWidth=r[0],this.opacity=a,this.originX=s[0],this.originY=s[1],this.rotation=d,this.rotateWithView=l,this.scale=g,this.width=p[0]},Xy.prototype.getTextures=function(e){return e?this.textures_.concat(this.hitDetectionTextures_):this.textures_},Xy.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_};const Wy=new my('precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n'),Ky=new fy('varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n');var Hy=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_lineWidth=e.getUniformLocation(t,'u_lineWidth'),this.u_miterLimit=e.getUniformLocation(t,'u_miterLimit'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_color=e.getUniformLocation(t,'u_color'),this.u_size=e.getUniformLocation(t,'u_size'),this.u_pixelRatio=e.getUniformLocation(t,'u_pixelRatio'),this.a_lastPos=e.getAttribLocation(t,'a_lastPos'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_nextPos=e.getAttribLocation(t,'a_nextPos'),this.a_direction=e.getAttribLocation(t,'a_direction')};const Zy={ROUND:2,BEGIN_LINE:3,END_LINE:5,BEGIN_LINE_CAP:7,END_LINE_CAP:11,BEVEL_FIRST:13,BEVEL_SECOND:17,MITER_BOTTOM:19,MITER_TOP:23},qy=function(e,t){Cy.call(this,e,t),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}};i(qy,Cy),qy.prototype.drawCoordinates_=function(e,t,o,r){let a=this.vertices.length,s=this.indices.length,l,i;const d='bevel'===this.state_.lineJoin?0:'miter'===this.state_.lineJoin?1:2,p='butt'===this.state_.lineCap?0:'square'===this.state_.lineCap?1:2,g=Ui(e,t,o,r);let _=s,u=1,c,y,m,n,h,f;for(l=t,i=o;l<i;l+=r){if(m=a/7,n=h,h=f||[e[l],e[l+1]],l===t){if(f=[e[l+r],e[l+r+1]],o-t==2*r&&A(h,f))break;if(g)n=[e[o-2*r],e[o-2*r+1]],c=f;else{p&&(a=this.addVertices_([0,0],h,f,u*Zy.BEGIN_LINE_CAP*p,a),a=this.addVertices_([0,0],h,f,-u*Zy.BEGIN_LINE_CAP*p,a),this.indices[s++]=m+2,this.indices[s++]=m,this.indices[s++]=m+1,this.indices[s++]=m+1,this.indices[s++]=m+3,this.indices[s++]=m+2),a=this.addVertices_([0,0],h,f,u*Zy.BEGIN_LINE*(p||1),a),a=this.addVertices_([0,0],h,f,-u*Zy.BEGIN_LINE*(p||1),a),_=a/7-1;continue}}else if(l!==o-r)f=[e[l+r],e[l+r+1]];else if(g){f=c;break}else{n=n||[0,0],a=this.addVertices_(n,h,[0,0],u*Zy.END_LINE*(p||1),a),a=this.addVertices_(n,h,[0,0],-u*Zy.END_LINE*(p||1),a),this.indices[s++]=m,this.indices[s++]=_-1,this.indices[s++]=_,this.indices[s++]=_,this.indices[s++]=m+1,this.indices[s++]=m,p&&(a=this.addVertices_(n,h,[0,0],u*Zy.END_LINE_CAP*p,a),a=this.addVertices_(n,h,[0,0],-u*Zy.END_LINE_CAP*p,a),this.indices[s++]=m+2,this.indices[s++]=m,this.indices[s++]=m+1,this.indices[s++]=m+1,this.indices[s++]=m+3,this.indices[s++]=m+2);break}y=Ay(n[0],n[1],h[0],h[1],f[0],f[1])?-1:1,a=this.addVertices_(n,h,f,y*Zy.BEVEL_FIRST*(d||1),a),a=this.addVertices_(n,h,f,y*Zy.BEVEL_SECOND*(d||1),a),a=this.addVertices_(n,h,f,-y*Zy.MITER_BOTTOM*(d||1),a),l>t&&(this.indices[s++]=m,this.indices[s++]=_-1,this.indices[s++]=_,this.indices[s++]=m+2,this.indices[s++]=m,this.indices[s++]=0<u*y?_:_-1),this.indices[s++]=m,this.indices[s++]=m+2,this.indices[s++]=m+1,_=m+2,u=y,d&&(a=this.addVertices_(n,h,f,y*Zy.MITER_TOP*d,a),this.indices[s++]=m+1,this.indices[s++]=m+3,this.indices[s++]=m)}g&&(m=m||a/7,y=ko([n[0],n[1],h[0],h[1],f[0],f[1]],0,6,2)?1:-1,a=this.addVertices_(n,h,f,y*Zy.BEVEL_FIRST*(d||1),a),a=this.addVertices_(n,h,f,-y*Zy.MITER_BOTTOM*(d||1),a),this.indices[s++]=m,this.indices[s++]=_-1,this.indices[s++]=_,this.indices[s++]=m+1,this.indices[s++]=m,this.indices[s++]=0<u*y?_:_-1)},qy.prototype.addVertices_=function(e,t,o,r,i){return this.vertices[i++]=e[0],this.vertices[i++]=e[1],this.vertices[i++]=t[0],this.vertices[i++]=t[1],this.vertices[i++]=o[0],this.vertices[i++]=o[1],this.vertices[i++]=r,i},qy.prototype.isValid_=function(e,t,o,r){const i=o-t;if(i<2*r)return!1;if(i==2*r){const o=[e[t],e[t+1]],i=[e[t+r],e[t+r+1]];return!A(o,i)}return!0},qy.prototype.drawLineString=function(e,t){let o=e.getFlatCoordinates();const r=e.getStride();this.isValid_(o,0,o.length,r)&&(o=dt(o,0,o.length,r,-this.origin[0],-this.origin[1]),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.drawCoordinates_(o,0,o.length,r))},qy.prototype.drawMultiLineString=function(e,t){const o=this.indices.length,r=e.getEnds();r.unshift(0);const n=e.getFlatCoordinates(),a=e.getStride();let s,i;if(1<r.length)for(s=1,i=r.length;s<i;++s)if(this.isValid_(n,r[s-1],r[s],a)){const e=dt(n,r[s-1],r[s],a,-this.origin[0],-this.origin[1]);this.drawCoordinates_(e,0,e.length,a)}this.indices.length>o&&(this.startIndices.push(o),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(o),this.state_.changed=!1))},qy.prototype.drawPolygonCoordinates=function(e,t,o){if(Ui(e,0,e.length,o)||(e.push(e[0]),e.push(e[1])),this.drawCoordinates_(e,0,e.length,o),t.length){let e,r;for(e=0,r=t.length;e<r;++e)Ui(t[e],0,t[e].length,o)||(t[e].push(t[e][0]),t[e].push(t[e][1])),this.drawCoordinates_(t[e],0,t[e].length,o)}},qy.prototype.setPolygonStyle=function(e,t){const o=t===void 0?this.indices.length:t;this.startIndices.push(o),this.startIndicesFeature.push(e),this.state_.changed&&(this.styleIndices_.push(o),this.state_.changed=!1)},qy.prototype.getCurrentIndex=function(){return this.indices.length},qy.prototype.finish=function(){this.verticesBuffer=new Gy(this.vertices),this.indicesBuffer=new Gy(this.indices),this.startIndices.push(this.indices.length),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},qy.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t),e.deleteBuffer(o)}},qy.prototype.setUpProgram=function(e,t,o,r){const i=t.getProgram(Wy,Ky);let n;return this.defaultLocations_?n=this.defaultLocations_:(n=new Hy(e,i),this.defaultLocations_=n),t.useProgram(i),e.enableVertexAttribArray(n.a_lastPos),e.vertexAttribPointer(n.a_lastPos,2,md,!1,28,0),e.enableVertexAttribArray(n.a_position),e.vertexAttribPointer(n.a_position,2,md,!1,28,8),e.enableVertexAttribArray(n.a_nextPos),e.vertexAttribPointer(n.a_nextPos,2,md,!1,28,16),e.enableVertexAttribArray(n.a_direction),e.vertexAttribPointer(n.a_direction,1,md,!1,28,24),e.uniform2fv(n.u_size,o),e.uniform1f(n.u_pixelRatio,r),n},qy.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_lastPos),e.disableVertexAttribArray(t.a_position),e.disableVertexAttribArray(t.a_nextPos),e.disableVertexAttribArray(t.a_direction)},qy.prototype.drawReplay=function(e,t,o,r){const i=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK);if(r||(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.NOTEQUAL)),!l(o))this.drawReplaySkipping_(e,t,o);else{let o,r,i,n;for(i=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;0<=o;--o)r=this.styleIndices_[o],n=this.styles_[o],this.setStrokeStyle_(e,n[0],n[1],n[2]),this.drawElements(e,t,r,i),e.clear(e.DEPTH_BUFFER_BIT),i=r}r||(e.disable(e.DEPTH_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.depthMask(n),e.depthFunc(i))},qy.prototype.drawReplaySkipping_=function(e,t,o){let r,i,a,s,l,d,p,g,_;for(g=this.startIndices.length-2,a=i=this.startIndices[g+1],r=this.styleIndices_.length-1;0<=r;--r){for(s=this.styles_[r],this.setStrokeStyle_(e,s[0],s[1],s[2]),l=this.styleIndices_[r];0<=g&&this.startIndices[g]>=l;)_=this.startIndices[g],d=this.startIndicesFeature[g],p=n(d).toString(),o[p]&&(i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),a=_),g--,i=_;i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),i=a=l}},qy.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s,i,l,d,p,g,_,u;for(u=this.startIndices.length-2,l=this.startIndices[u+1],s=this.styleIndices_.length-1;0<=s;--s)for(d=this.styles_[s],this.setStrokeStyle_(e,d[0],d[1],d[2]),p=this.styleIndices_[s];0<=u&&this.startIndices[u]>=p;){if(i=this.startIndices[u],g=this.startIndicesFeature[u],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||et(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,i,l);const o=r(g);if(o)return o}u--,l=i}},qy.prototype.setStrokeStyle_=function(e,t,o,r){e.uniform4fv(this.defaultLocations_.u_color,t),e.uniform1f(this.defaultLocations_.u_lineWidth,o),e.uniform1f(this.defaultLocations_.u_miterLimit,r)},qy.prototype.setFillStrokeStyle=function(e,t){const o=t.getLineCap();this.state_.lineCap=o===void 0?Iy:o;const r=t.getLineDash();this.state_.lineDash=r?r:Ly;const i=t.getLineDashOffset();this.state_.lineDashOffset=i?i:Py;const n=t.getLineJoin();this.state_.lineJoin=n===void 0?vy:n;let a=t.getColor();a=a instanceof CanvasGradient||a instanceof CanvasPattern?Oy:$r(a).map(function(e,t){return 3==t?e:e/255})||Oy;let s=t.getWidth();s=s===void 0?wy:s;let l=t.getMiterLimit();l=l===void 0?Fy:l,this.state_.strokeColor&&A(this.state_.strokeColor,a)&&this.state_.lineWidth===s&&this.state_.miterLimit===l||(this.state_.changed=!0,this.state_.strokeColor=a,this.state_.lineWidth=s,this.state_.miterLimit=l,this.styles_.push([a,s,l]))};var Jy=qy;const Qy=new my('precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n'),$y=new fy('\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n');var em=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_color=e.getUniformLocation(t,'u_color'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.a_position=e.getAttribLocation(t,'a_position')};const tm=function(e){this.first_=void 0,this.last_=void 0,this.head_=void 0,this.circular_=!(e!==void 0)||e,this.length_=0};tm.prototype.insertItem=function(e){const t={prev:void 0,next:void 0,data:e},o=this.head_;if(!o)this.first_=t,this.last_=t,this.circular_&&(t.next=t,t.prev=t);else{const e=o.next;t.prev=o,t.next=e,o.next=t,e&&(e.prev=t),o===this.last_&&(this.last_=t)}this.head_=t,this.length_++},tm.prototype.removeItem=function(){const e=this.head_;if(e){const t=e.next,o=e.prev;t&&(t.prev=o),o&&(o.next=t),this.head_=t||o,this.first_===this.last_?(this.head_=void 0,this.first_=void 0,this.last_=void 0):this.first_===e?this.first_=this.head_:this.last_===e&&(this.last_=o?this.head_.prev:this.head_),this.length_--}},tm.prototype.firstItem=function(){return this.head_=this.first_,this.head_?this.head_.data:void 0},tm.prototype.lastItem=function(){return this.head_=this.last_,this.head_?this.head_.data:void 0},tm.prototype.nextItem=function(){return this.head_&&this.head_.next?(this.head_=this.head_.next,this.head_.data):void 0},tm.prototype.getNextItem=function(){return this.head_&&this.head_.next?this.head_.next.data:void 0},tm.prototype.prevItem=function(){return this.head_&&this.head_.prev?(this.head_=this.head_.prev,this.head_.data):void 0},tm.prototype.getPrevItem=function(){return this.head_&&this.head_.prev?this.head_.prev.data:void 0},tm.prototype.getCurrItem=function(){return this.head_?this.head_.data:void 0},tm.prototype.setFirstItem=function(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)},tm.prototype.concat=function(e){if(e.head_){if(this.head_){const t=this.head_.next;this.head_.next=e.first_,e.first_.prev=this.head_,t.prev=e.last_,e.last_.next=t,this.length_+=e.length_}else this.head_=e.head_,this.first_=e.first_,this.last_=e.last_,this.length_=e.length_;e.head_=void 0,e.first_=void 0,e.last_=void 0,e.length_=0}},tm.prototype.getLength=function(){return this.length_};var om=tm;const rm=function(e){this.rbush_=tc()(e),this.items_={}};rm.prototype.insert=function(e,t){const o={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(o),this.items_[n(t)]=o},rm.prototype.load=function(e,t){const o=Array(t.length);for(let r=0,i=t.length;r<i;r++){const i=e[r],a=t[r],s={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:a};o[r]=s,this.items_[n(a)]=s}this.rbush_.load(o)},rm.prototype.remove=function(e){const t=n(e),o=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(o)},rm.prototype.update=function(e,t){const o=this.items_[n(t)],r=[o.minX,o.minY,o.maxX,o.maxY];Ge(r,e)||(this.remove(t),this.insert(e,t))},rm.prototype.getAll=function(){const e=this.rbush_.all();return e.map(function(e){return e.value})},rm.prototype.getInExtent=function(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},o=this.rbush_.search(t);return o.map(function(e){return e.value})},rm.prototype.forEach=function(e,t){return this.forEach_(this.getAll(),e,t)},rm.prototype.forEachInExtent=function(e,t,o){return this.forEach_(this.getInExtent(e),t,o)},rm.prototype.forEach_=function(e,t,o){let r;for(let n=0,i=e.length;n<i;n++)if(r=t.call(o,e[n]),r)return r;return r},rm.prototype.isEmpty=function(){return l(this.items_)},rm.prototype.clear=function(){this.rbush_.clear(),this.items_={}},rm.prototype.getExtent=function(e){const t=this.rbush_.data;return we(t.minX,t.minY,t.maxX,t.maxY,e)},rm.prototype.concat=function(e){for(const t in this.rbush_.load(e.rbush_.all()),e.items_)this.items_[0|t]=e.items_[0|t]};var im=rm;const nm=function(e,t){Cy.call(this,e,t),this.lineStringReplay=new Jy(e,t),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={fillColor:null,changed:!1}};i(nm,Cy),nm.prototype.drawCoordinates_=function(e,t,o){const r=new om,n=new im;this.processFlatCoordinates_(e,o,r,n,!0);const a=this.getMaxCoords_(r);if(t.length){let e,i;const s=[];for(e=0,i=t.length;e<i;++e){const r={list:new om,maxCoords:void 0,rtree:new im};s.push(r),this.processFlatCoordinates_(t[e],o,r.list,r.rtree,!1),this.classifyPoints_(r.list,r.rtree,!0),r.maxCoords=this.getMaxCoords_(r.list)}for(s.sort(function(e,t){return t.maxCoords[0]===e.maxCoords[0]?e.maxCoords[1]-t.maxCoords[1]:t.maxCoords[0]-e.maxCoords[0]}),e=0;e<s.length;++e){const t=s[e].list,o=t.firstItem();let i=o,l;do{if(this.getIntersections_(i,n).length){l=!0;break}i=t.nextItem()}while(o!==i);!l&&this.bridgeHole_(t,s[e].maxCoords[0],r,a[0],n)&&(n.concat(s[e].rtree),this.classifyPoints_(r,n,!1))}}else this.classifyPoints_(r,n,!1);this.triangulate_(r,n)},nm.prototype.processFlatCoordinates_=function(e,t,o,r,a){const s=ko(e,0,e.length,t);let l=this.vertices.length/2,n,i,d,p,g;const _=[],u=[];if(a===s){for(d=this.createPoint_(e[0],e[1],l++),p=d,(n=t,i=e.length);n<i;n+=t)g=this.createPoint_(e[n],e[n+1],l++),u.push(this.insertItem_(p,g,o)),_.push([rd(p.x,g.x),rd(p.y,g.y),ld(p.x,g.x),ld(p.y,g.y)]),p=g;u.push(this.insertItem_(g,d,o)),_.push([rd(p.x,g.x),rd(p.y,g.y),ld(p.x,g.x),ld(p.y,g.y)])}else{const r=e.length-t;for(d=this.createPoint_(e[r],e[r+1],l++),p=d,(n=r-t,i=0);n>=i;n-=t)g=this.createPoint_(e[n],e[n+1],l++),u.push(this.insertItem_(p,g,o)),_.push([rd(p.x,g.x),rd(p.y,g.y),ld(p.x,g.x),ld(p.y,g.y)]),p=g;u.push(this.insertItem_(g,d,o)),_.push([rd(p.x,g.x),rd(p.y,g.y),ld(p.x,g.x),ld(p.y,g.y)])}r.load(_,u)},nm.prototype.getMaxCoords_=function(e){const t=e.firstItem();let o=t,r=[o.p0.x,o.p0.y];do o=e.nextItem(),o.p0.x>r[0]&&(r=[o.p0.x,o.p0.y]);while(o!==t);return r},nm.prototype.classifyPoints_=function(e,t,o){let r=e.firstItem(),i=r,n=e.nextItem(),a=!1;do{const s=o?Ay(n.p1.x,n.p1.y,i.p1.x,i.p1.y,i.p0.x,i.p0.y):Ay(i.p0.x,i.p0.y,i.p1.x,i.p1.y,n.p1.x,n.p1.y);s===void 0?(this.removeItem_(i,n,e,t),a=!0,n===r&&(r=e.getNextItem()),n=i,e.prevItem()):i.p1.reflex!==s&&(i.p1.reflex=s,a=!0),i=n,n=e.nextItem()}while(i!==r);return a},nm.prototype.bridgeHole_=function(e,t,o,r,n){let a=e.firstItem();for(;a.p1.x!==t;)a=e.nextItem();const s=a.p1,l={x:r,y:s.y,i:-1};let d=Infinity,p,i,g,_;const u=this.getIntersections_({p0:s,p1:l},n,!0);for(p=0,i=u.length;p<i;++p){const e=u[p],t=this.calculateIntersection_(s,l,e.p0,e.p1,!0),o=od(s.x-t[0]);o<d&&void 0!==Ay(s.x,s.y,e.p0.x,e.p0.y,e.p1.x,e.p1.y)&&(d=o,_={x:t[0],y:t[1],i:-1},a=e)}if(d===Infinity)return!1;if(g=a.p1,0<d){const e=this.getPointsInTriangle_(s,_,a.p1,n);if(e.length){let t=Infinity;for(p=0,i=e.length;p<i;++p){const o=e[p],r=Zl(s.y-o.y,l.x-o.x);(r<t||r===t&&o.x<g.x)&&(t=r,g=o)}}}for(a=o.firstItem();a.p1.x!==g.x||a.p1.y!==g.y;)a=o.nextItem();const c={x:s.x,y:s.y,i:s.i,reflex:void 0},y={x:a.p1.x,y:a.p1.y,i:a.p1.i,reflex:void 0};return e.getNextItem().p0=c,this.insertItem_(s,a.p1,e,n),this.insertItem_(y,c,e,n),a.p1=y,e.setFirstItem(),o.concat(e),!0},nm.prototype.triangulate_=function(e,t){for(let o=!1,r=this.isSimple_(e,t);3<e.getLength();)if(r){if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t,!0))break;}else if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t))if(r=this.isSimple_(e,t),!r){this.splitPolygon_(e,t);break}else o=!this.isClockwise_(e),this.classifyPoints_(e,t,o);if(3===e.getLength()){let t=this.indices.length;this.indices[t++]=e.getPrevItem().p0.i,this.indices[t++]=e.getCurrItem().p0.i,this.indices[t++]=e.getNextItem().p0.i}},nm.prototype.clipEars_=function(e,t,o,r){let i=this.indices.length,n=e.firstItem(),a=e.getPrevItem(),s=n,l=e.nextItem(),d=e.getNextItem(),p=!1,g,_,u;do{if(g=s.p0,_=s.p1,u=l.p1,!1===_.reflex){let c;c=o?0===this.getPointsInTriangle_(g,_,u,t,!0).length:r?this.diagonalIsInside_(d.p1,u,_,g,a.p0):this.diagonalIsInside_(a.p0,g,_,u,d.p1),(o||0===this.getIntersections_({p0:g,p1:u},t).length)&&c&&(o||!1===g.reflex||!1===u.reflex||ko([a.p0.x,a.p0.y,g.x,g.y,_.x,_.y,u.x,u.y,d.p1.x,d.p1.y],0,10,2)===!r)&&(this.indices[i++]=g.i,this.indices[i++]=_.i,this.indices[i++]=u.i,this.removeItem_(s,l,e,t),l===n&&(n=d),p=!0)}a=e.getPrevItem(),s=e.getCurrItem(),l=e.nextItem(),d=e.getNextItem()}while(s!==n&&3<e.getLength());return p},nm.prototype.resolveSelfIntersections_=function(e,t,o){const r=e.firstItem();e.nextItem();let i=r,n=e.nextItem(),a=!1;do{const s=this.calculateIntersection_(i.p0,i.p1,n.p0,n.p1,o);if(s){let l=!1;const d=this.vertices.length;let g=this.indices.length;const _=e.prevItem();e.removeItem(),t.remove(_),l=_===r;let u;if(o?(s[0]===i.p0.x&&s[1]===i.p0.y?(e.prevItem(),u=i.p0,n.p0=u,t.remove(i),l=l||i===r):(u=n.p1,i.p1=u,t.remove(n),l=l||n===r),e.removeItem()):(u=this.createPoint_(s[0],s[1],d/2),i.p1=u,n.p0=u,t.update([rd(i.p0.x,i.p1.x),rd(i.p0.y,i.p1.y),ld(i.p0.x,i.p1.x),ld(i.p0.y,i.p1.y)],i),t.update([rd(n.p0.x,n.p1.x),rd(n.p0.y,n.p1.y),ld(n.p0.x,n.p1.x),ld(n.p0.y,n.p1.y)],n)),this.indices[g++]=_.p0.i,this.indices[g++]=_.p1.i,this.indices[g++]=u.i,a=!0,l)break}i=e.getPrevItem(),n=e.nextItem()}while(i!==r);return a},nm.prototype.isSimple_=function(e,t){const o=e.firstItem();let r=o;do{if(this.getIntersections_(r,t).length)return!1;r=e.nextItem()}while(r!==o);return!0},nm.prototype.isClockwise_=function(e){const t=2*e.getLength(),o=Array(t),r=e.firstItem();let n=r,a=0;do o[a++]=n.p0.x,o[a++]=n.p0.y,n=e.nextItem();while(n!==r);return ko(o,0,t,2)},nm.prototype.splitPolygon_=function(e,t){const o=e.firstItem();let r=o;do{const o=this.getIntersections_(r,t);if(o.length){const i=o[0],a=this.vertices.length/2,n=this.calculateIntersection_(r.p0,r.p1,i.p0,i.p1),s=this.createPoint_(n[0],n[1],a),l=new om,d=new im;this.insertItem_(s,r.p1,l,d),r.p1=s,t.update([rd(r.p0.x,s.x),rd(r.p0.y,s.y),ld(r.p0.x,s.x),ld(r.p0.y,s.y)],r);for(let o=e.nextItem();o!==i;)this.insertItem_(o.p0,o.p1,l,d),t.remove(o),e.removeItem(),o=e.getCurrItem();this.insertItem_(i.p0,s,l,d),i.p0=s,t.update([rd(i.p1.x,s.x),rd(i.p1.y,s.y),ld(i.p1.x,s.x),ld(i.p1.y,s.y)],i),this.classifyPoints_(e,t,!1),this.triangulate_(e,t),this.classifyPoints_(l,d,!1),this.triangulate_(l,d);break}r=e.nextItem()}while(r!==o)},nm.prototype.createPoint_=function(e,t,o){let r=this.vertices.length;this.vertices[r++]=e,this.vertices[r++]=t;return{x:e,y:t,i:o,reflex:void 0}},nm.prototype.insertItem_=function(e,t,o,r){const i={p0:e,p1:t};return o.insertItem(i),r&&r.insert([rd(e.x,t.x),rd(e.y,t.y),ld(e.x,t.x),ld(e.y,t.y)],i),i},nm.prototype.removeItem_=function(e,t,o,r){o.getCurrItem()===t&&(o.removeItem(),e.p1=t.p1,r.remove(t),r.update([rd(e.p0.x,e.p1.x),rd(e.p0.y,e.p1.y),ld(e.p0.x,e.p1.x),ld(e.p0.y,e.p1.y)],e))},nm.prototype.getPointsInTriangle_=function(e,t,o,r,n){const a=[],s=r.getInExtent([rd(e.x,t.x,o.x),rd(e.y,t.y,o.y),ld(e.x,t.x,o.x),ld(e.y,t.y,o.y)]);for(let l=0,i=s.length;l<i;++l)for(const r in s[l]){const i=s[l][r];'object'==typeof i&&(!n||i.reflex)&&(i.x!==e.x||i.y!==e.y)&&(i.x!==t.x||i.y!==t.y)&&(i.x!==o.x||i.y!==o.y)&&-1===a.indexOf(i)&&Lo([e.x,e.y,t.x,t.y,o.x,o.y],0,6,2,i.x,i.y)&&a.push(i)}return a},nm.prototype.getIntersections_=function(e,t,o){const r=e.p0,n=e.p1,a=t.getInExtent([rd(r.x,n.x),rd(r.y,n.y),ld(r.x,n.x),ld(r.y,n.y)]),s=[];for(let l=0,i=a.length;l<i;++l){const t=a[l];e!==t&&(o||t.p0!==n||t.p1!==r)&&this.calculateIntersection_(r,n,t.p0,t.p1,o)&&s.push(t)}return s},nm.prototype.calculateIntersection_=function(e,t,o,r,i){const n=(r.y-o.y)*(t.x-e.x)-(r.x-o.x)*(t.y-e.y);if(0!=n){const a=((r.x-o.x)*(e.y-o.y)-(r.y-o.y)*(e.x-o.x))/n,s=((t.x-e.x)*(e.y-o.y)-(t.y-e.y)*(e.x-o.x))/n;if(!i&&a>Ny&&a<1-Ny&&s>Ny&&s<1-Ny||i&&0<=a&&1>=a&&0<=s&&1>=s)return[e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)]}},nm.prototype.diagonalIsInside_=function(e,t,o,r,i){if(t.reflex===void 0||r.reflex===void 0)return!1;const n=(o.x-r.x)*(t.y-r.y)>(o.y-r.y)*(t.x-r.x),a=(i.x-r.x)*(t.y-r.y)<(i.y-r.y)*(t.x-r.x),s=(e.x-t.x)*(r.y-t.y)>(e.y-t.y)*(r.x-t.x),l=(o.x-t.x)*(r.y-t.y)<(o.y-t.y)*(r.x-t.x),d=r.reflex?a||n:a&&n,p=t.reflex?l||s:l&&s;return d&&p},nm.prototype.drawMultiPolygon=function(e,t){const o=e.getEndss(),r=e.getStride(),n=this.indices.length,a=this.lineStringReplay.getCurrentIndex(),s=e.getFlatCoordinates();let l=0,d,i,p,g;for(d=0,i=o.length;d<i;++d){const e=o[d];if(0<e.length){const t=dt(s,l,e[0],r,-this.origin[0],-this.origin[1]);if(t.length){const o=[];let i;for(p=1,g=e.length;p<g;++p)e[p]!==e[p-1]&&(i=dt(s,e[p-1],e[p],r,-this.origin[0],-this.origin[1]),o.push(i));this.lineStringReplay.drawPolygonCoordinates(t,o,r),this.drawCoordinates_(t,o,r)}}l=e[e.length-1]}this.indices.length>n&&(this.startIndices.push(n),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(n),this.state_.changed=!1)),this.lineStringReplay.getCurrentIndex()>a&&this.lineStringReplay.setPolygonStyle(t,a)},nm.prototype.drawPolygon=function(e,t){const o=e.getEnds(),r=e.getStride();if(0<o.length){const n=e.getFlatCoordinates().map(Number),a=dt(n,0,o[0],r,-this.origin[0],-this.origin[1]);if(a.length){const e=[];let s,i,l;for(s=1,i=o.length;s<i;++s)o[s]!==o[s-1]&&(l=dt(n,o[s-1],o[s],r,-this.origin[0],-this.origin[1]),e.push(l));this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.lineStringReplay.setPolygonStyle(t),this.lineStringReplay.drawPolygonCoordinates(a,e,r),this.drawCoordinates_(a,e,r)}}},nm.prototype.finish=function(e){this.verticesBuffer=new Gy(this.vertices),this.indicesBuffer=new Gy(this.indices),this.startIndices.push(this.indices.length),this.lineStringReplay.finish(e),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},nm.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer,r=this.lineStringReplay.getDeleteResourcesFunction(e);return function(){e.deleteBuffer(t),e.deleteBuffer(o),r()}},nm.prototype.setUpProgram=function(e,t){const o=t.getProgram(Qy,$y);let r;return this.defaultLocations_?r=this.defaultLocations_:(r=new em(e,o),this.defaultLocations_=r),t.useProgram(o),e.enableVertexAttribArray(r.a_position),e.vertexAttribPointer(r.a_position,2,md,!1,8,0),r},nm.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position)},nm.prototype.drawReplay=function(e,t,o,r){const i=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK);if(r||(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.NOTEQUAL)),!l(o))this.drawReplaySkipping_(e,t,o);else{let o,r,i,n;for(i=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;0<=o;--o)r=this.styleIndices_[o],n=this.styles_[o],this.setFillStyle_(e,n),this.drawElements(e,t,r,i),i=r}r||(e.disable(e.DEPTH_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.depthMask(n),e.depthFunc(i))},nm.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s,i,l,d,p,g,_,u;for(u=this.startIndices.length-2,l=this.startIndices[u+1],s=this.styleIndices_.length-1;0<=s;--s)for(d=this.styles_[s],this.setFillStyle_(e,d),p=this.styleIndices_[s];0<=u&&this.startIndices[u]>=p;){if(i=this.startIndices[u],g=this.startIndicesFeature[u],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||et(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,i,l);const o=r(g);if(o)return o}u--,l=i}},nm.prototype.drawReplaySkipping_=function(e,t,o){let r,i,a,s,l,d,p,g,_;for(g=this.startIndices.length-2,a=i=this.startIndices[g+1],r=this.styleIndices_.length-1;0<=r;--r){for(s=this.styles_[r],this.setFillStyle_(e,s),l=this.styleIndices_[r];0<=g&&this.startIndices[g]>=l;)_=this.startIndices[g],d=this.startIndicesFeature[g],p=n(d).toString(),o[p]&&(i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),a=_),g--,i=_;i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),i=a=l}},nm.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_color,t)},nm.prototype.setFillStrokeStyle=function(e,t){let o=e?e.getColor():[0,0,0,0];if(o=o instanceof CanvasGradient||o instanceof CanvasPattern?Ry:$r(o).map(function(e,t){return 3==t?e:e/255})||Ry,this.state_.fillColor&&A(o,this.state_.fillColor)||(this.state_.fillColor=o,this.state_.changed=!0,this.styles_.push(o)),t)this.lineStringReplay.setFillStrokeStyle(null,t);else{const e=new Wc({color:[0,0,0,0],lineWidth:0});this.lineStringReplay.setFillStrokeStyle(null,e)}};const am=function(e,t){this.space_=t,this.emptyBlocks_=[{x:0,y:0,width:e,height:e}],this.entries_={},this.context_=Jo(e,e),this.canvas_=this.context_.canvas};am.prototype.get=function(e){return this.entries_[e]||null},am.prototype.add=function(e,t,o,r,n){for(let a=0,i=this.emptyBlocks_.length;a<i;++a){const i=this.emptyBlocks_[a];if(i.width>=t+this.space_&&i.height>=o+this.space_){const s={offsetX:i.x+this.space_,offsetY:i.y+this.space_,image:this.canvas_};return this.entries_[e]=s,r.call(n,this.context_,i.x+this.space_,i.y+this.space_),this.split_(a,i,t+this.space_,o+this.space_),s}}return null},am.prototype.split_=function(e,t,o,r){const i=t.width-o,n=t.height-r;let a,s;i>n?(a={x:t.x+o,y:t.y,width:t.width-o,height:t.height},s={x:t.x,y:t.y+r,width:o,height:t.height-r},this.updateBlocks_(e,a,s)):(a={x:t.x+o,y:t.y,width:t.width-o,height:r},s={x:t.x,y:t.y+r,width:t.width,height:t.height-r},this.updateBlocks_(e,a,s))},am.prototype.updateBlocks_=function(e,t,o){const r=[e,1];0<t.width&&0<t.height&&r.push(t),0<o.width&&0<o.height&&r.push(o),this.emptyBlocks_.splice.apply(this.emptyBlocks_,r)};var sm=am;const lm=-1,dm=function(e){const t=e||{};this.currentSize_=t.initialSize===void 0?256:t.initialSize,this.maxSize_=t.maxSize===void 0?Fd===void 0?2048:Fd:t.maxSize,this.space_=t.space===void 0?1:t.space,this.atlases_=[new sm(this.currentSize_,this.space_)],this.currentHitSize_=this.currentSize_,this.hitAtlases_=[new sm(this.currentHitSize_,this.space_)]};dm.prototype.getInfo=function(e){const t=this.getInfo_(this.atlases_,e);if(!t)return null;const o=this.getInfo_(this.hitAtlases_,e);return this.mergeInfos_(t,o)},dm.prototype.getInfo_=function(e,t){for(let o=0,r=e.length;o<r;++o){const r=e[o],i=r.get(t);if(i)return i}return null},dm.prototype.mergeInfos_=function(e,t){return{offsetX:e.offsetX,offsetY:e.offsetY,image:e.image,hitImage:t.image}},dm.prototype.add=function(e,t,o,r,i,n){if(t+this.space_>this.maxSize_||o+this.space_>this.maxSize_)return null;const a=this.add_(!1,e,t,o,r,n);if(!a)return null;const s=i===void 0?T:i,l=this.add_(!0,e,t,o,s,n);return this.mergeInfos_(a,l)},dm.prototype.add_=function(e,t,o,r,n,a){const s=e?this.hitAtlases_:this.atlases_;let l,d,p,i;for(p=0,i=s.length;p<i;++p){if(l=s[p],d=l.add(t,o,r,n,a),d)return d;if(!d&&p===i-1){let t;e?(t=rd(2*this.currentHitSize_,this.maxSize_),this.currentHitSize_=t):(t=rd(2*this.currentSize_,this.maxSize_),this.currentSize_=t),l=new sm(t,this.space_),s.push(l),++i}}return null};var pm=dm;const gm=function(e,t){zy.call(this,e,t),this.images_=[],this.textures_=[],this.measureCanvas_=Jo(0,0).canvas,this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_='',this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.atlases_={},this.currAtlas_=void 0,this.scale=1,this.opacity=1};i(gm,zy),gm.prototype.drawText=function(e,t){if(this.text_){let o=null;let r=2,a=2;switch(e.getType()){case $p.POINT:case $p.MULTI_POINT:o=e.getFlatCoordinates(),r=o.length,a=e.getStride();break;case $p.CIRCLE:o=e.getCenter();break;case $p.LINE_STRING:o=e.getFlatMidpoint();break;case $p.MULTI_LINE_STRING:o=e.getFlatMidpoints(),r=o.length;break;case $p.POLYGON:o=e.getFlatInteriorPoint();break;case $p.MULTI_POLYGON:o=e.getFlatInteriorPoints(),r=o.length;break;default:}this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t);const s=this.currAtlas_,l=this.text_.split('\n'),d=this.getTextSize_(l);let p,i,g,_,u,c,y,m;const h=Wl(d[0]*this.textAlign_-this.offsetX_),f=Wl(d[1]*this.textBaseline_-this.offsetY_),E=this.state_.lineWidth/2*this.state_.scale;for(p=0,i=l.length;p<i;++p)for(u=0,c=s.height*p,y=l[p].split(''),(g=0,_=y.length);g<_;++g){if(m=s.atlas.getInfo(y[g]),m){const e=m.image;if(this.anchorX=h-u,this.anchorY=f-c,this.originX=0===g?m.offsetX-E:m.offsetX,this.originY=m.offsetY,this.height=s.height,this.width=0===g||g===y.length-1?s.width[y[g]]+E:s.width[y[g]],this.imageHeight=e.height,this.imageWidth=e.width,0===this.images_.length)this.images_.push(e);else{const t=this.images_[this.images_.length-1];n(t)!=n(e)&&(this.groupIndices.push(this.indices.length),this.images_.push(e))}this.drawText_(o,0,r,a)}u+=this.width}}},gm.prototype.getTextSize_=function(e){const t=this,o=this.currAtlas_,r=e.length*o.height,i=e.map(function(e){let r=0;for(let n=0,i=e.length;n<i;++n){const i=e[n];o.width[i]||t.addCharToAtlas_(i),r+=o.width[i]?o.width[i]:0}return r}).reduce(function(e,t){return ld(e,t)});return[i,r]},gm.prototype.drawText_=function(e,t,o,r){for(let n=t;n<o;n+=r)this.drawCoordinates(e,t,o,r)},gm.prototype.addCharToAtlas_=function(e){if(1===e.length){const t=this.currAtlas_,o=this.state_,r=this.measureCanvas_.getContext('2d');r.font=o.font;const i=sd(r.measureText(e).width*o.scale),n=t.atlas.add(e,i,t.height,function(t,r,i){t.font=o.font,t.fillStyle=o.fillColor,t.strokeStyle=o.strokeColor,t.lineWidth=o.lineWidth,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.textAlign='left',t.textBaseline='top',gp&&o.lineDash&&(t.setLineDash(o.lineDash),t.lineDashOffset=o.lineDashOffset),1!==o.scale&&t.setTransform(o.scale,0,0,o.scale,0,0),o.strokeColor&&t.strokeText(e,r,i),o.fillColor&&t.fillText(e,r,i)});n&&(t.width[e]=i)}},gm.prototype.finish=function(e){const t=e.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices=this.groupIndices,this.verticesBuffer=new Gy(this.vertices),this.indicesBuffer=new Gy(this.indices);this.createTextures(this.textures_,this.images_,{},t),this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_='',this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.images_=null,this.atlases_={},this.currAtlas_=void 0,zy.prototype.finish.call(this,e)},gm.prototype.setTextStyle=function(e){const t=this.state_,o=e.getFill(),r=e.getStroke();if(!e||!e.getText()||!o&&!r)this.text_='';else{if(!o)t.fillColor=null;else{const e=o.getColor();t.fillColor=ri(e?e:Ry)}if(!r)t.strokeColor=null,t.lineWidth=0;else{const e=r.getColor();t.strokeColor=ri(e?e:Oy),t.lineWidth=r.getWidth()||wy,t.lineCap=r.getLineCap()||Iy,t.lineDashOffset=r.getLineDashOffset()||Py,t.lineJoin=r.getLineJoin()||vy,t.miterLimit=r.getMiterLimit()||Fy;const o=r.getLineDash();t.lineDash=o?o.slice():Ly}t.font=e.getFont()||'10px sans-serif',t.scale=e.getScale()||1,this.text_=e.getText();const i=_c[e.getTextAlign()],n=_c[e.getTextBaseline()];this.textAlign_=i===void 0?.5:i,this.textBaseline_=n===void 0?.5:n,this.offsetX_=e.getOffsetX()||0,this.offsetY_=e.getOffsetY()||0,this.rotateWithView=!!e.getRotateWithView(),this.rotation=e.getRotation()||0,this.currAtlas_=this.getAtlas_(t)}},gm.prototype.getAtlas_=function(e){let t=[];for(const o in e)(e[o]||0===e[o])&&(Array.isArray(e[o])?t=t.concat(e[o]):t.push(e[o]));const o=this.calculateHash_(t);if(!this.atlases_[o]){const t=this.measureCanvas_.getContext('2d');t.font=e.font;const r=sd((1.5*t.measureText('M').width+e.lineWidth/2)*e.scale);this.atlases_[o]={atlas:new pm({space:e.lineWidth+1}),width:{},height:r}}return this.atlases_[o]},gm.prototype.calculateHash_=function(e){let t='';for(let o=0,r=e.length;o<r;++o)t+=e[o];return t},gm.prototype.getTextures=function(){return this.textures_},gm.prototype.getHitDetectionTextures=function(){return this.textures_};const _m=[1,1],um={Circle:Dy,Image:Xy,LineString:Jy,Polygon:nm,Text:gm},cm=function(e,t,o){rc.call(this),this.maxExtent_=t,this.tolerance_=e,this.renderBuffer_=o,this.replaysByZIndex_={}};i(cm,rc),cm.prototype.addDeclutter=function(){},cm.prototype.getDeleteResourcesFunction=function(e){const t=[];for(var o in this.replaysByZIndex_){const r=this.replaysByZIndex_[o];for(const o in r)t.push(r[o].getDeleteResourcesFunction(e))}return function(){const e=t.length;let o;for(let r=0;r<e;r++)o=t[r].apply(this,arguments);return o}},cm.prototype.finish=function(e){for(var t in this.replaysByZIndex_){const o=this.replaysByZIndex_[t];for(const t in o)o[t].finish(e)}},cm.prototype.getReplay=function(e,t){const o=e===void 0?'0':e.toString();let r=this.replaysByZIndex_[o];r===void 0&&(r={},this.replaysByZIndex_[o]=r);let i=r[t];if(i===void 0){const e=um[t];i=new e(this.tolerance_,this.maxExtent_),r[t]=i}return i},cm.prototype.isEmpty=function(){return l(this.replaysByZIndex_)},cm.prototype.replay=function(e,t,o,r,n,a,s,l){const d=Object.keys(this.replaysByZIndex_).map(Number);d.sort(L);let p,i,g,_,u,c;for(p=0,i=d.length;p<i;++p)for(u=this.replaysByZIndex_[d[p].toString()],g=0,_=gc.length;g<_;++g)c=u[gc[g]],void 0!==c&&c.replay(e,t,o,r,n,a,s,l,void 0,!1)},cm.prototype.replayHitDetection_=function(e,t,o,r,n,a,s,l,d,p,g){const _=Object.keys(this.replaysByZIndex_).map(Number);_.sort(function(e,t){return t-e});let u,i,c,y,m,h;for(u=0,i=_.length;u<i;++u)for(y=this.replaysByZIndex_[_[u].toString()],c=gc.length-1;0<=c;--c)if(m=y[gc[c]],void 0!==m&&(h=m.replay(e,t,o,r,n,a,s,l,d,p,g),h))return h},cm.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n,a,s,l,d){const p=t.getGL();p.bindFramebuffer(p.FRAMEBUFFER,t.getHitDetectionFramebuffer());let g;return void 0!==this.renderBuffer_&&(g=Ce(Ae(e),r*this.renderBuffer_)),this.replayHitDetection_(t,e,r,i,_m,a,s,l,function(e){const t=new Uint8Array(4);if(p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,t),0<t[3]){const t=d(e);if(t)return t}},!0,g)},cm.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i,n,a,s,l){const d=t.getGL();d.bindFramebuffer(d.FRAMEBUFFER,t.getHitDetectionFramebuffer());const p=this.replayHitDetection_(t,e,r,i,_m,a,s,l,function(){const e=new Uint8Array(4);return d.readPixels(0,0,1,1,d.RGBA,d.UNSIGNED_BYTE,e),0<e[3]},!1);return p!==void 0};var ym=cm;const mm=function(e,t,o,r,i,n,a){Au.call(this),this.context_=e,this.center_=t,this.extent_=n,this.pixelRatio_=a,this.size_=i,this.rotation_=r,this.resolution_=o,this.imageStyle_=null,this.fillStyle_=null,this.strokeStyle_=null,this.textStyle_=null};i(mm,Au),mm.prototype.drawText_=function(e,t){const o=this.context_,r=e.getReplay(0,ic.TEXT);r.setTextStyle(this.textStyle_),r.drawText(t,null),r.finish(o);let i;r.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},i,!1),r.getDeleteResourcesFunction(o)()},mm.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},mm.prototype.drawGeometry=function(e){const t=e.getType();switch(t){case $p.POINT:this.drawPoint(e,null);break;case $p.LINE_STRING:this.drawLineString(e,null);break;case $p.POLYGON:this.drawPolygon(e,null);break;case $p.MULTI_POINT:this.drawMultiPoint(e,null);break;case $p.MULTI_LINE_STRING:this.drawMultiLineString(e,null);break;case $p.MULTI_POLYGON:this.drawMultiPolygon(e,null);break;case $p.GEOMETRY_COLLECTION:this.drawGeometryCollection(e,null);break;case $p.CIRCLE:this.drawCircle(e,null);break;default:}},mm.prototype.drawFeature=function(e,t){const o=t.getGeometryFunction()(e);o&&et(this.extent_,o.getExtent())&&(this.setStyle(t),this.drawGeometry(o))},mm.prototype.drawGeometryCollection=function(e){const t=e.getGeometriesArray();let o,r;for(o=0,r=t.length;o<r;++o)this.drawGeometry(t[o])},mm.prototype.drawPoint=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.IMAGE);i.setImageStyle(this.imageStyle_),i.drawPoint(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.drawMultiPoint=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.IMAGE);i.setImageStyle(this.imageStyle_),i.drawMultiPoint(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.drawLineString=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.LINE_STRING);i.setFillStrokeStyle(null,this.strokeStyle_),i.drawLineString(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.drawMultiLineString=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.LINE_STRING);i.setFillStrokeStyle(null,this.strokeStyle_),i.drawMultiLineString(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.drawPolygon=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.POLYGON);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),i.drawPolygon(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.drawMultiPolygon=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.POLYGON);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),i.drawMultiPolygon(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.drawCircle=function(e,t){const o=this.context_,r=new ym(1,this.extent_),i=r.getReplay(0,ic.CIRCLE);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),i.drawCircle(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},mm.prototype.setImageStyle=function(e){this.imageStyle_=e},mm.prototype.setFillStrokeStyle=function(e,t){this.fillStyle_=e,this.strokeStyle_=t},mm.prototype.setTextStyle=function(e){this.textStyle_=e};var hm=mm;const fm=new my('precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n'),Em=new fy('varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n');var xm=function(e,t){this.u_texCoordMatrix=e.getUniformLocation(t,'u_texCoordMatrix'),this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_texture=e.getUniformLocation(t,'u_texture'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_texCoord=e.getAttribLocation(t,'a_texCoord')};const Tm=function(e,t){Du.call(this,t),this.mapRenderer=e,this.arrayBuffer_=new Gy([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0,this.texCoordMatrix=Yt(),this.projectionMatrix=Yt(),this.tmpMat4_=bi(),this.defaultLocations_=null};i(Tm,Du),Tm.prototype.bindFramebuffer=function(e,t){const o=this.mapRenderer.getGL();if(this.framebufferDimension===void 0||this.framebufferDimension!=t){const r=function(e,t,o){e.isContextLost()||(e.deleteFramebuffer(t),e.deleteTexture(o))}.bind(null,o,this.framebuffer,this.texture);e.postRenderFunctions.push(r);const i=Di(o,t,t),n=o.createFramebuffer();o.bindFramebuffer(Id,n),o.framebufferTexture2D(Id,36064,Cd,i,0),this.texture=i,this.framebuffer=n,this.framebufferDimension=t}else o.bindFramebuffer(Id,this.framebuffer)},Tm.prototype.composeFrame=function(e,t,o){this.dispatchComposeEvent_($g.PRECOMPOSE,o,e),o.bindBuffer(_d,this.arrayBuffer_);const r=o.getGL(),i=o.getProgram(fm,Em);let n;this.defaultLocations_?n=this.defaultLocations_:(n=new xm(r,i),this.defaultLocations_=n),o.useProgram(i)&&(r.enableVertexAttribArray(n.a_position),r.vertexAttribPointer(n.a_position,2,md,!1,16,0),r.enableVertexAttribArray(n.a_texCoord),r.vertexAttribPointer(n.a_texCoord,2,md,!1,16,8),r.uniform1i(n.u_texture,0)),r.uniformMatrix4fv(n.u_texCoordMatrix,!1,Mi(this.tmpMat4_,this.getTexCoordMatrix())),r.uniformMatrix4fv(n.u_projectionMatrix,!1,Mi(this.tmpMat4_,this.getProjectionMatrix())),r.uniform1f(n.u_opacity,t.opacity),r.bindTexture(Cd,this.getTexture()),r.drawArrays(pd,0,4),this.dispatchComposeEvent_($g.POSTCOMPOSE,o,e)},Tm.prototype.dispatchComposeEvent_=function(e,t,o){const r=this.getLayer();if(r.hasListener(e)){const i=o.viewState,n=i.resolution,a=o.pixelRatio,s=o.extent,l=i.center,d=i.rotation,p=o.size,g=new hm(t,l,n,d,p,s,a),_=new su(e,g,o,null,t);r.dispatchEvent(_)}},Tm.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix},Tm.prototype.getTexture=function(){return this.texture},Tm.prototype.getProjectionMatrix=function(){return this.projectionMatrix},Tm.prototype.handleWebGLContextLost=function(){this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0},Tm.prototype.prepareFrame=function(){},Tm.prototype.forEachLayerAtPixel=function(){};var Sm=Tm;const Cm=function(e,t){Sm.call(this,e,t),this.image_=null,this.hitCanvasContext_=null,this.hitTransformationMatrix_=null};i(Cm,Sm),Cm.handles=function(e,t){return e===jg.WEBGL&&t.getType()===iu.IMAGE},Cm.create=function(e,t){return new Cm(e,t)},Cm.prototype.createTexture_=function(e){const t=e.getImage(),o=this.mapRenderer.getGL();return ki(o,t,Rd,Rd)},Cm.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){const n=this.getLayer(),a=n.getSource(),s=t.viewState.resolution,l=t.viewState.rotation,d=t.skippedFeatureUids;return a.forEachFeatureAtCoordinate(e,s,l,o,d,function(e){return r.call(i,e,n)})},Cm.prototype.prepareFrame=function(e,t){const o=this.mapRenderer.getGL(),r=e.pixelRatio,i=e.viewState,n=i.center,a=i.resolution,s=i.rotation;let l=this.image_,d=this.texture;const p=this.getLayer(),g=p.getSource(),_=e.viewHints;let u=e.extent;if(void 0!==t.extent&&(u=qe(u,t.extent)),!_[Zp.ANIMATING]&&!_[Zp.INTERACTING]&&!tt(u)){let t=i.projection;const n=g.getImage(u,a,r,t);if(n){const t=this.loadImage(n);if(t&&(l=n,d=this.createTexture_(n),this.texture)){const t=function(e,t){e.isContextLost()||e.deleteTexture(t)}.bind(null,o,this.texture);e.postRenderFunctions.push(t)}}}if(l){const e=this.mapRenderer.getContext().getCanvas();this.updateProjectionMatrix_(e.width,e.height,r,n,a,s,l.getExtent()),this.hitTransformationMatrix_=null;const t=this.texCoordMatrix;Bt(t),Kt(t,1,-1),Ht(t,0,-1),this.image_=l,this.texture=d}return!!l},Cm.prototype.updateProjectionMatrix_=function(e,t,o,r,i,n,a){const s=this.projectionMatrix;Bt(s),Kt(s,2*o/(e*i),2*o/(t*i)),Wt(s,-n),Ht(s,a[0]-r[0],a[1]-r[1]),Kt(s,(a[2]-a[0])/2,(a[3]-a[1])/2),Ht(s,1,1)},Cm.prototype.hasFeatureAtCoordinate=function(e,t){const o=this.forEachFeatureAtCoordinate(e,t,0,E,this);return o!==void 0},Cm.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.image_&&this.image_.getImage())if(this.getLayer().getSource().forEachFeatureAtCoordinate!==T){const i=Xt(t.pixelToCoordinateTransform,e.slice()),n=this.forEachFeatureAtCoordinate(i,t,0,E,this);return n?o.call(r,this.getLayer(),null):void 0}else{const i=[this.image_.getImage().width,this.image_.getImage().height];this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(t.size,i));const n=Xt(this.hitTransformationMatrix_,e.slice());if(0>n[0]||n[0]>i[0]||0>n[1]||n[1]>i[1])return;this.hitCanvasContext_||(this.hitCanvasContext_=Jo(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.image_.getImage(),n[0],n[1],1,1,0,0,1,1);const a=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<a[3]?o.call(r,this.getLayer(),a):void 0}},Cm.prototype.getHitTransformationMatrix_=function(e,t){const o=Yt();Ht(o,-1,-1),Kt(o,2/e[0],2/e[1]),Ht(o,0,e[1]),Kt(o,1,-1);const r=qt(this.projectionMatrix.slice()),i=Yt();return Ht(i,0,t[1]),Kt(i,1,-1),Kt(i,t[0]/2,t[1]/2),Ht(i,1,1),jt(i,r),jt(i,o),i};var Rm=Cm;const Im=1024,Lm=function(e,t){Ku.call(this,e,t),this.canvas_=document.createElement('CANVAS'),this.canvas_.style.width='100%',this.canvas_.style.height='100%',this.canvas_.style.display='block',this.canvas_.className=Zg,e.insertBefore(this.canvas_,e.childNodes[0]||null),this.clipTileCanvasWidth_=0,this.clipTileCanvasHeight_=0,this.clipTileContext_=Jo(),this.renderedVisible_=!0,this.gl_=r(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0}),this.context_=new jy(this.canvas_,this.gl_),c(this.canvas_,By.LOST,this.handleWebGLContextLost,this),c(this.canvas_,By.RESTORED,this.handleWebGLContextRestored,this),this.textureCache_=new du,this.focus_=null,this.tileTextureQueue_=new Vp(function(e){const t=e[1],o=e[2],r=t[0]-this.focus_[0],i=t[1]-this.focus_[1];return 65536*ad(o)+id(r*r+i*i)/o}.bind(this),function(e){return e[0].getKey()}),this.loadNextTileTexture_=function(){if(!this.tileTextureQueue_.isEmpty()){this.tileTextureQueue_.reprioritize();const e=this.tileTextureQueue_.dequeue(),t=e[0],o=e[3],r=e[4];this.bindTileTexture(t,o,r,fd,fd)}return!1}.bind(this),this.textureCacheFrameMarkerCount_=0,this.initializeGL_()};i(Lm,Ku),Lm.handles=function(e){return mp&&e===jg.WEBGL},Lm.create=function(e,t){return new Lm(e,t)},Lm.prototype.bindTileTexture=function(e,t,o,r,i){const n=this.getGL(),a=e.getKey();if(this.textureCache_.containsKey(a)){const e=this.textureCache_.get(a);n.bindTexture(Cd,e.texture),e.magFilter!=r&&(n.texParameteri(Cd,Ed,r),e.magFilter=r),e.minFilter!=i&&(n.texParameteri(Cd,xd,i),e.minFilter=i)}else{const s=n.createTexture();if(n.bindTexture(Cd,s),0<o){const r=this.clipTileContext_.canvas,i=this.clipTileContext_;this.clipTileCanvasWidth_!==t[0]||this.clipTileCanvasHeight_!==t[1]?(r.width=t[0],r.height=t[1],this.clipTileCanvasWidth_=t[0],this.clipTileCanvasHeight_=t[1]):i.clearRect(0,0,t[0],t[1]),i.drawImage(e.getImage(),o,o,t[0],t[1],0,0,t[0],t[1]),n.texImage2D(Cd,0,hd,hd,yd,r)}else n.texImage2D(Cd,0,hd,hd,yd,e.getImage());n.texParameteri(Cd,Ed,r),n.texParameteri(Cd,xd,i),n.texParameteri(Cd,Td,Rd),n.texParameteri(Cd,Sd,Rd),this.textureCache_.set(a,{texture:s,magFilter:r,minFilter:i})}},Lm.prototype.dispatchComposeEvent_=function(e,t){const o=this.getMap();if(o.hasListener(e)){const r=this.context_,i=t.extent,n=t.size,a=t.viewState,s=t.pixelRatio,l=a.resolution,d=a.center,p=a.rotation,g=new hm(r,d,l,p,n,i,s),_=new su(e,g,t,null,r);o.dispatchEvent(_)}},Lm.prototype.disposeInternal=function(){const e=this.getGL();e.isContextLost()||this.textureCache_.forEach(function(t){t&&e.deleteTexture(t.texture)}),this.context_.dispose(),Ku.prototype.disposeInternal.call(this)},Lm.prototype.expireCache_=function(e,t){const o=this.getGL();for(let r;this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>Im;){if(r=this.textureCache_.peekLast(),!!r)o.deleteTexture(r.texture);else if(+this.textureCache_.peekLastKey()==t.index)break;else--this.textureCacheFrameMarkerCount_;this.textureCache_.pop()}},Lm.prototype.getContext=function(){return this.context_},Lm.prototype.getGL=function(){return this.gl_},Lm.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_},Lm.prototype.getType=function(){return jg.WEBGL},Lm.prototype.handleWebGLContextLost=function(e){e.preventDefault(),this.textureCache_.clear(),this.textureCacheFrameMarkerCount_=0;const t=this.getLayerRenderers();for(const o in t){const e=t[o];e.handleWebGLContextLost()}},Lm.prototype.handleWebGLContextRestored=function(){this.initializeGL_(),this.getMap().render()},Lm.prototype.initializeGL_=function(){const e=this.gl_;e.activeTexture(33984),e.blendFuncSeparate(770,gd,1,gd),e.disable(2884),e.disable(2929),e.disable(3089),e.disable(2960)},Lm.prototype.isTileTextureLoaded=function(e){return this.textureCache_.containsKey(e.getKey())},Lm.prototype.renderFrame=function(e){const t=this.getContext(),o=this.getGL();if(o.isContextLost())return!1;if(!e)return this.renderedVisible_&&(this.canvas_.style.display='none',this.renderedVisible_=!1),!1;this.focus_=e.focus,this.textureCache_.set((-e.index).toString(),null),++this.textureCacheFrameMarkerCount_,this.dispatchComposeEvent_($g.PRECOMPOSE,e);const r=[],n=e.layerStatesArray;b(n,si);const a=e.viewState.resolution;let s,i,l,d;for(s=0,i=n.length;s<i;++s)d=n[s],_r(d,a)&&d.sourceState==Mg.READY&&(l=this.getLayerRenderer(d.layer),l.prepareFrame(e,d,t)&&r.push(d));const p=e.size[0]*e.pixelRatio,g=e.size[1]*e.pixelRatio;for((this.canvas_.width!=p||this.canvas_.height!=g)&&(this.canvas_.width=p,this.canvas_.height=g),o.bindFramebuffer(Id,null),o.clearColor(0,0,0,0),o.clear(dd),o.enable(cd),o.viewport(0,0,this.canvas_.width,this.canvas_.height),(s=0,i=r.length);s<i;++s)d=r[s],l=this.getLayerRenderer(d.layer),l.composeFrame(e,d,t);this.renderedVisible_||(this.canvas_.style.display='',this.renderedVisible_=!0),this.calculateMatrices2D(e),this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>Im&&e.postRenderFunctions.push(this.expireCache_.bind(this)),this.tileTextureQueue_.isEmpty()||(e.postRenderFunctions.push(this.loadNextTileTexture_),e.animate=!0),this.dispatchComposeEvent_($g.POSTCOMPOSE,e),this.scheduleRemoveUnusedLayerRenderers(e),this.scheduleExpireIconCache(e)},Lm.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,a,s){let l;if(this.getGL().isContextLost())return!1;const d=t.viewState,p=t.layerStatesArray,g=p.length;let _;for(_=g-1;0<=_;--_){const i=p[_],g=i.layer;if(_r(i,d.resolution)&&a.call(s,g)){const i=this.getLayerRenderer(g);if(l=i.forEachFeatureAtCoordinate(e,t,o,r,n),l)return l}}},Lm.prototype.hasFeatureAtCoordinate=function(e,t,o,r,n){let a=!1;if(this.getGL().isContextLost())return!1;const s=t.viewState,l=t.layerStatesArray,d=l.length;let p;for(p=d-1;0<=p;--p){const o=l[p],i=o.layer;if(_r(o,s.resolution)&&r.call(n,i)){const o=this.getLayerRenderer(i);if(a=o.hasFeatureAtCoordinate(e,t),a)return!0}}return a},Lm.prototype.forEachLayerAtPixel=function(e,t,o,r,n){if(this.getGL().isContextLost())return!1;const a=t.viewState;let s;const l=t.layerStatesArray,d=l.length;let p;for(p=d-1;0<=p;--p){const i=l[p],d=i.layer;if(_r(i,a.resolution)&&n.call(r,d)){const i=this.getLayerRenderer(d);if(s=i.forEachLayerAtPixel(e,t,o,r),s)return s}}};var Pm=Lm;const vm=new my('precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n'),Fm=new fy('varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n');var Om=function(e,t){this.u_tileOffset=e.getUniformLocation(t,'u_tileOffset'),this.u_texture=e.getUniformLocation(t,'u_texture'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_texCoord=e.getAttribLocation(t,'a_texCoord')};const wm=function(e,t){Sm.call(this,e,t),this.fragmentShader_=vm,this.vertexShader_=Fm,this.locations_=null,this.renderArrayBuffer_=new Gy([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]),this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,this.tmpSize_=[0,0]};i(wm,Sm),wm.handles=function(e,t){return e===jg.WEBGL&&t.getType()===iu.TILE},wm.create=function(e,t){return new wm(e,t)},wm.prototype.disposeInternal=function(){const e=this.mapRenderer.getContext();e.deleteBuffer(this.renderArrayBuffer_),Sm.prototype.disposeInternal.call(this)},wm.prototype.createLoadedTileFinder=function(e,t,o){const r=this.mapRenderer;return function(i,n){return e.forEachLoadedTile(t,i,n,function(e){const t=r.isTileTextureLoaded(e);return t&&(!o[i]&&(o[i]={}),o[i][e.tileCoord.toString()]=e),t})}},wm.prototype.handleWebGLContextLost=function(){Sm.prototype.handleWebGLContextLost.call(this),this.locations_=null},wm.prototype.prepareFrame=function(e,t,o){const r=this.mapRenderer,i=o.getGL(),n=e.viewState,a=n.projection,s=this.getLayer(),l=s.getSource(),d=l.getTileGridForProjection(a),p=d.getZForResolution(n.resolution),g=d.getResolution(p),_=l.getTilePixelSize(p,e.pixelRatio,a),u=_[0]/pr(d.getTileSize(p),this.tmpSize_)[0],c=g/u,y=l.getTilePixelRatio(u)*l.getGutter(a),m=n.center,h=e.extent,f=d.getTileRangeForExtentAndZ(h,p);let E;if(this.renderedTileRange_&&this.renderedTileRange_.equals(f)&&this.renderedRevision_==l.getRevision())E=this.renderedFramebufferExtent_;else{const n=f.getSize(),g=ld(n[0]*_[0],n[1]*_[1]),m=Y(g),h=c*m,T=d.getOrigin(p),S=T[0]+f.minX*_[0]*c,C=T[1]+f.minY*_[1]*c;E=[S,C,S+h,C+h],this.bindFramebuffer(e,m),i.viewport(0,0,m,m),i.clearColor(0,0,0,0),i.clear(dd),i.disable(cd);const R=o.getProgram(this.fragmentShader_,this.vertexShader_);o.useProgram(R),this.locations_||(this.locations_=new Om(i,R)),o.bindBuffer(_d,this.renderArrayBuffer_),i.enableVertexAttribArray(this.locations_.a_position),i.vertexAttribPointer(this.locations_.a_position,2,md,!1,16,0),i.enableVertexAttribArray(this.locations_.a_texCoord),i.vertexAttribPointer(this.locations_.a_texCoord,2,md,!1,16,8),i.uniform1i(this.locations_.u_texture,0);const I={};I[p]={};const P=this.createLoadedTileFinder(l,a,I),v=s.getUseInterimTilesOnError();let F=!0;const O=Oe(),w=new Ju(0,0,0,0);let N,A,b,M,G,D,x,k;for(D=f.minX;D<=f.maxX;++D)for(x=f.minY;x<=f.maxY;++x)if(M=l.getTile(p,D,x,u,a),!(void 0!==t.extent&&(k=d.getTileCoordExtent(M.tileCoord,O),!et(k,t.extent)))){if(G=M.getState(),A=G==Yp.LOADED||G==Yp.EMPTY||G==Yp.ERROR&&!v,A||(M=M.getInterimTile()),G=M.getState(),G==Yp.LOADED){if(r.isTileTextureLoaded(M)){I[p][M.tileCoord.toString()]=M;continue}}else if(G==Yp.EMPTY||G==Yp.ERROR&&!v)continue;F=!1,b=d.forEachTileCoordParentTileRange(M.tileCoord,P,null,w,O),b||(N=d.getTileCoordChildTileRange(M.tileCoord,w,O),N&&P(p+1,N))}const U=Object.keys(I).map(Number);U.sort(L);const B=new Float32Array(4);for(let e=0,t=U.length;e<t;++e){const t=I[U[e]];for(const e in t)M=t[e],k=d.getTileCoordExtent(M.tileCoord,O),B[0]=2*(k[2]-k[0])/h,B[1]=2*(k[3]-k[1])/h,B[2]=2*(k[0]-E[0])/h-1,B[3]=2*(k[1]-E[1])/h-1,i.uniform4fv(this.locations_.u_tileOffset,B),r.bindTileTexture(M,_,y*u,fd,fd),i.drawArrays(pd,0,4)}F?(this.renderedTileRange_=f,this.renderedFramebufferExtent_=E,this.renderedRevision_=l.getRevision()):(this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,e.animate=!0)}this.updateUsedTiles(e.usedTiles,l,p,f);const x=r.getTileTextureQueue();this.manageTilePyramid(e,l,d,u,a,h,p,s.getPreload(),function(e){e.getState()!=Yp.LOADED||r.isTileTextureLoaded(e)||x.isKeyQueued(e.getKey())||x.enqueue([e,d.getTileCoordCenter(e.tileCoord),d.getResolution(e.tileCoord[0]),_,y*u])},this),this.scheduleExpireCache(e,l);const T=this.texCoordMatrix;return Bt(T),Ht(T,(Wl(m[0]/g)*g-E[0])/(E[2]-E[0]),(Wl(m[1]/g)*g-E[1])/(E[3]-E[1])),0!==n.rotation&&Wt(T,n.rotation),Kt(T,e.size[0]*n.resolution/(E[2]-E[0]),e.size[1]*n.resolution/(E[3]-E[1])),Ht(T,-.5,-.5),!0},wm.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.framebuffer){const i=[e[0]/t.size[0],(t.size[1]-e[1])/t.size[1]],n=Xt(this.texCoordMatrix,i.slice()),a=[n[0]*this.framebufferDimension,n[1]*this.framebufferDimension],s=this.mapRenderer.getContext().getGL();s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffer);const l=new Uint8Array(4);return s.readPixels(a[0],a[1],1,1,s.RGBA,s.UNSIGNED_BYTE,l),0<l[3]?o.call(r,this.getLayer(),l):void 0}};var Nm=wm;const Am=function(e,t){Sm.call(this,e,t),this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Oe(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.layerState_=null};i(Am,Sm),Am.handles=function(e,t){return e===jg.WEBGL&&t.getType()===iu.VECTOR},Am.create=function(e,t){return new Am(e,t)},Am.prototype.composeFrame=function(e,t,o){this.layerState_=t;const r=e.viewState,i=this.replayGroup_,n=e.size,a=e.pixelRatio,s=this.mapRenderer.getGL();i&&!i.isEmpty()&&(s.enable(s.SCISSOR_TEST),s.scissor(0,0,n[0]*a,n[1]*a),i.replay(o,r.center,r.resolution,r.rotation,n,a,t.opacity,t.managed?e.skippedFeatureUids:{}),s.disable(s.SCISSOR_TEST))},Am.prototype.disposeInternal=function(){const e=this.replayGroup_;if(e){const t=this.mapRenderer.getContext();e.getDeleteResourcesFunction(t)(),this.replayGroup_=null}Sm.prototype.disposeInternal.call(this)},Am.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){if(!this.replayGroup_||!this.layerState_)return;else{const o=this.mapRenderer.getContext(),a=t.viewState,s=this.getLayer(),l=this.layerState_,d={};return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a.center,a.resolution,a.rotation,t.size,t.pixelRatio,l.opacity,{},function(e){const t=n(e).toString();if(!(t in d))return d[t]=!0,r.call(i,e,s)})}},Am.prototype.hasFeatureAtCoordinate=function(e,t){if(!this.replayGroup_||!this.layerState_)return!1;else{const o=this.mapRenderer.getContext(),r=t.viewState,i=this.layerState_;return this.replayGroup_.hasFeatureAtCoordinate(e,o,r.center,r.resolution,r.rotation,t.size,t.pixelRatio,i.opacity,t.skippedFeatureUids)}},Am.prototype.forEachLayerAtPixel=function(e,t,o,r){const i=Xt(t.pixelToCoordinateTransform,e.slice()),n=this.hasFeatureAtCoordinate(i,t);return n?o.call(r,this.getLayer(),null):void 0},Am.prototype.handleStyleImageChange_=function(){this.renderIfReadyAndVisible()},Am.prototype.prepareFrame=function(e,t,o){const r=this.getLayer(),i=r.getSource(),n=e.viewHints[Zp.ANIMATING],a=e.viewHints[Zp.INTERACTING],s=r.getUpdateWhileAnimating(),l=r.getUpdateWhileInteracting();if(!this.dirty_&&!s&&n||!l&&a)return!0;const d=e.extent,p=e.viewState,g=p.projection,_=p.resolution,u=e.pixelRatio,c=r.getRevision(),y=r.getRenderBuffer();let m=r.getRenderOrder();void 0===m&&(m=mi);const h=Ce(d,y*_);if(!this.dirty_&&this.renderedResolution_==_&&this.renderedRevision_==c&&this.renderedRenderOrder_==m&&Pe(this.renderedExtent_,h))return!0;this.replayGroup_&&e.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(o)),this.dirty_=!1;const f=new ym(fi(_,u),h,r.getRenderBuffer());i.loadFeatures(h,_,g);const E=function(e){let t;const o=e.getStyleFunction()||r.getStyleFunction();if(o&&(t=o(e,_)),t){const o=this.renderFeature(e,_,u,t,f);this.dirty_=this.dirty_||o}};if(m){const e=[];i.forEachFeatureInExtent(h,function(t){e.push(t)},this),e.sort(m),e.forEach(E.bind(this))}else i.forEachFeatureInExtent(h,E,this);return f.finish(o),this.renderedResolution_=_,this.renderedRevision_=c,this.renderedRenderOrder_=m,this.renderedExtent_=h,this.replayGroup_=f,!0},Am.prototype.renderFeature=function(e,t,o,r,n){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let s=r.length-1;s>=0;--s)a=Ei(n,e,r[s],hi(t,o),this.handleStyleImageChange_,this)||a;else a=Ei(n,e,r,hi(t,o),this.handleStyleImageChange_,this)||a;return a};var bm=Am;nr(Ug.MAP_RENDERER,Zu),ar(Ug.LAYER_RENDERER,[Vu,$u,Oc,Mc]),nr(Ug.MAP_RENDERER,Pm),ar(Ug.LAYER_RENDERER,[Rm,Nm,bm]);const Mm=function(e){e=Dd({},e),e.controls||(e.controls=yr()),e.interactions||(e.interactions=Wr()),Xg.call(this,e)};i(Mm,Xg);var Gm={BOTTOM_LEFT:'bottom-left',BOTTOM_CENTER:'bottom-center',BOTTOM_RIGHT:'bottom-right',CENTER_LEFT:'center-left',CENTER_CENTER:'center-center',CENTER_RIGHT:'center-right',TOP_LEFT:'top-left',TOP_CENTER:'top-center',TOP_RIGHT:'top-right'};const Dm={ELEMENT:'element',MAP:'map',OFFSET:'offset',POSITION:'position',POSITIONING:'positioning'},km=function(e){qd.call(this),this.options=e,this.id=e.id,this.insertFirst=!(e.insertFirst!==void 0)||e.insertFirst,this.stopEvent=!(e.stopEvent!==void 0)||e.stopEvent,this.element=document.createElement('DIV'),this.element.className=e.className===void 0?'ol-overlay-container '+'ol-selectable':e.className,this.element.style.position='absolute',this.autoPan=e.autoPan!==void 0&&e.autoPan,this.autoPanAnimation=e.autoPanAnimation||{},this.autoPanMargin=e.autoPanMargin===void 0?20:e.autoPanMargin,this.rendered={bottom_:'',left_:'',right_:'',top_:'',visible:!0},this.mapPostrenderListenerKey=null,c(this,C(Dm.ELEMENT),this.handleElementChanged,this),c(this,C(Dm.MAP),this.handleMapChanged,this),c(this,C(Dm.OFFSET),this.handleOffsetChanged,this),c(this,C(Dm.POSITION),this.handlePositionChanged,this),c(this,C(Dm.POSITIONING),this.handlePositioningChanged,this),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset===void 0?[0,0]:e.offset),this.setPositioning(e.positioning===void 0?Gm.TOP_LEFT:e.positioning),e.position!==void 0&&this.setPosition(e.position)};i(km,qd),km.prototype.getElement=function(){return this.get(Dm.ELEMENT)},km.prototype.getId=function(){return this.id},km.prototype.getMap=function(){return this.get(Dm.MAP)},km.prototype.getOffset=function(){return this.get(Dm.OFFSET)},km.prototype.getPosition=function(){return this.get(Dm.POSITION)},km.prototype.getPositioning=function(){return this.get(Dm.POSITIONING)},km.prototype.handleElementChanged=function(){or(this.element);const e=this.getElement();e&&this.element.appendChild(e)},km.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(tr(this.element),h(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=c(e,kp.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}},km.prototype.render=function(){this.updatePixelPosition()},km.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},km.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(Dm.POSITION)&&this.autoPan&&this.panIntoView()},km.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},km.prototype.setElement=function(e){this.set(Dm.ELEMENT,e)},km.prototype.setMap=function(e){this.set(Dm.MAP,e)},km.prototype.setOffset=function(e){this.set(Dm.OFFSET,e)},km.prototype.setPosition=function(e){this.set(Dm.POSITION,e)},km.prototype.panIntoView=function(){const e=this.getMap();if(e&&e.getTargetElement()){const t=this.getRect(e.getTargetElement(),e.getSize()),o=this.getElement(),r=this.getRect(o,[Qo(o),$o(o)]),i=this.autoPanMargin;if(!Pe(t,r)){const o=r[0]-t[0],n=t[2]-r[2],a=r[1]-t[1],s=t[3]-r[3],l=[0,0];if(0>o?l[0]=o-i:0>n&&(l[0]=od(n)+i),0>a?l[1]=a-i:0>s&&(l[1]=od(s)+i),0!==l[0]||0!==l[1]){const t=e.getView().getCenter(),o=e.getPixelFromCoordinate(t),r=[o[0]+l[0],o[1]+l[1]];e.getView().animate({center:e.getCoordinateFromPixel(r),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},km.prototype.getRect=function(e,t){const o=e.getBoundingClientRect(),r=o.left+window.pageXOffset,i=o.top+window.pageYOffset;return[r,i,r+t[0],i+t[1]]},km.prototype.setPositioning=function(e){this.set(Dm.POSITIONING,e)},km.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?'':'none',this.rendered.visible=e)},km.prototype.updatePixelPosition=function(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const o=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(o,r)},km.prototype.updateRenderedPosition=function(e,t){const o=this.element.style,r=this.getOffset(),i=this.getPositioning();this.setVisible(!0);let n=r[0],a=r[1];if(i==Gm.BOTTOM_RIGHT||i==Gm.CENTER_RIGHT||i==Gm.TOP_RIGHT){''!==this.rendered.left_&&(this.rendered.left_=o.left='');const r=Wl(t[0]-e[0]-n)+'px';this.rendered.right_!=r&&(this.rendered.right_=o.right=r)}else{''!==this.rendered.right_&&(this.rendered.right_=o.right=''),(i==Gm.BOTTOM_CENTER||i==Gm.CENTER_CENTER||i==Gm.TOP_CENTER)&&(n-=this.element.offsetWidth/2);const t=Wl(e[0]+n)+'px';this.rendered.left_!=t&&(this.rendered.left_=o.left=t)}if(i==Gm.BOTTOM_LEFT||i==Gm.BOTTOM_CENTER||i==Gm.BOTTOM_RIGHT){''!==this.rendered.top_&&(this.rendered.top_=o.top='');const r=Wl(t[1]-e[1]-a)+'px';this.rendered.bottom_!=r&&(this.rendered.bottom_=o.bottom=r)}else{''!==this.rendered.bottom_&&(this.rendered.bottom_=o.bottom=''),(i==Gm.CENTER_LEFT||i==Gm.CENTER_CENTER||i==Gm.CENTER_RIGHT)&&(a-=this.element.offsetHeight/2);const t=Wl(e[1]+a)+'px';this.rendered.top_!=t&&(this.rendered.top_=o.top=t)}},km.prototype.getOptions=function(){return this.options};var Um=km,Ym={ARRAY_BUFFER:'arraybuffer',JSON:'json',TEXT:'text',XML:'xml'};const Bm=function(e,t,o,r,i,n,a,s,l,d,p,g,_,u,y){if(py.call(this,e,t,y),this.context_={},this.loader_,this.replayState_={},this.sourceTiles_=d,this.tileKeys=[],this.sourceRevision_=o,this.wrappedTileCoord=n,this.loadListenerKeys_=[],this.sourceTileListenerKeys_=[],n){const t=l.getTileCoordExtent(n),o=l.getResolution(e[0]),y=s.getZForResolution(o);s.forEachTileCoord(t,y,function(e){let n=qe(t,s.getTileCoordExtent(e));const l=s.getExtent();if(l&&(n=qe(n,l,n)),.5<=$e(n)/o&&.5<=Ze(n)/o){const t=e.toString();let o=d[t];if(!o){const n=a(e,p,g);o=d[t]=new _(e,void 0==n?Yp.EMPTY:Yp.IDLE,void 0==n?'':n,r,i),this.sourceTileListenerKeys_.push(c(o,zd.CHANGE,u))}o.consumers++,this.tileKeys.push(t)}}.bind(this))}};i(Bm,py),Bm.prototype.disposeInternal=function(){this.state=Yp.ABORT,this.changed(),this.interimTile&&this.interimTile.dispose();for(let e=0,t=this.tileKeys.length;e<t;++e){const t=this.tileKeys[e],o=this.getTile(t);o.consumers--,0==o.consumers&&(delete this.sourceTiles_[t],o.dispose())}this.tileKeys.length=0,this.sourceTiles_=null,this.loadListenerKeys_.forEach(h),this.loadListenerKeys_.length=0,this.sourceTileListenerKeys_.forEach(h),this.sourceTileListenerKeys_.length=0,py.prototype.disposeInternal.call(this)},Bm.prototype.getContext=function(e){const t=n(e).toString();return t in this.context_||(this.context_[t]=Jo()),this.context_[t]},Bm.prototype.getImage=function(e){return-1==this.getReplayState(e).renderedTileRevision?null:this.getContext(e).canvas},Bm.prototype.getReplayState=function(e){const t=n(e).toString();return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedRevision:-1,renderedTileRevision:-1}),this.replayState_[t]},Bm.prototype.getKey=function(){return this.tileKeys.join('/')+'-'+this.sourceRevision_},Bm.prototype.getTile=function(e){return this.sourceTiles_[e]},Bm.prototype.load=function(){let e=0;const t={};this.state==Yp.IDLE&&this.setState(Yp.LOADING),this.state==Yp.LOADING&&this.tileKeys.forEach(function(o){const r=this.getTile(o);if(r.state==Yp.IDLE&&(r.setLoader(this.loader_),r.load()),r.state==Yp.LOADING){const o=c(r,zd.CHANGE,function(){const o=r.getState();if(o==Yp.LOADED||o==Yp.ERROR){const i=n(r);o==Yp.ERROR?t[i]=!0:(--e,delete t[i]),0==e-Object.keys(t).length&&this.finishLoading_()}}.bind(this));this.loadListenerKeys_.push(o),++e}}.bind(this)),0==e-Object.keys(t).length&&setTimeout(this.finishLoading_.bind(this),0)},Bm.prototype.finishLoading_=function(){let e=this.tileKeys.length,t=0;for(let o=e-1;0<=o;--o){const r=this.getTile(this.tileKeys[o]).getState();r!=Yp.LOADED&&--e,r==Yp.EMPTY&&++t}e==this.tileKeys.length?(this.loadListenerKeys_.forEach(h),this.loadListenerKeys_.length=0,this.setState(Yp.LOADED)):this.setState(t==this.tileKeys.length?Yp.EMPTY:Yp.ERROR)};const jm=function(e,t,o,r,i,n){py.call(this,e,t,n),this.consumers=0,this.extent_=null,this.format_=r,this.features_=null,this.loader_,this.projection_,this.replayGroups_={},this.tileLoadFunction_=i,this.url_=o};i(jm,py);const Vm=[0,0,4096,4096];jm.prototype.disposeInternal=function(){this.features_=null,this.replayGroups_={},this.state=Yp.ABORT,this.changed(),py.prototype.disposeInternal.call(this)},jm.prototype.getExtent=function(){return this.extent_||Vm},jm.prototype.getFormat=function(){return this.format_},jm.prototype.getFeatures=function(){return this.features_},jm.prototype.getKey=function(){return this.url_},jm.prototype.getProjection=function(){return this.projection_},jm.prototype.getReplayGroup=function(e,t){return this.replayGroups_[n(e)+','+t]},jm.prototype.load=function(){this.state==Yp.IDLE&&(this.setState(Yp.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_(null,NaN,null))},jm.prototype.onLoad=function(e,t,o){this.setProjection(t),this.setFeatures(e),this.setExtent(o)},jm.prototype.onError=function(){this.setState(Yp.ERROR)},jm.prototype.setExtent=function(e){this.extent_=e},jm.prototype.setFeatures=function(e){this.features_=e,this.setState(Yp.LOADED)},jm.prototype.setProjection=function(e){this.projection_=e},jm.prototype.setReplayGroup=function(e,t,o){this.replayGroups_[n(e)+','+t]=o},jm.prototype.setLoader=function(e){this.loader_=e};const zm=function(){let e;return function(){if(!e){const t=document.body;t.webkitRequestFullscreen?e='webkitfullscreenchange':t.mozRequestFullScreen?e='mozfullscreenchange':t.msRequestFullscreen?e='MSFullscreenChange':t.requestFullscreen&&(e='fullscreenchange')}return e}}(),Xm=function(e){const t=e?e:{};this.cssClassName_=t.className===void 0?'ol-full-screen':t.className;const o=t.label===void 0?'\u2922':t.label;this.labelNode_='string'==typeof o?document.createTextNode(o):o;const r=t.labelActive===void 0?'\xD7':t.labelActive;this.labelActiveNode_='string'==typeof r?document.createTextNode(r):r;const i=t.tipLabel?t.tipLabel:'Toggle full-screen',n=document.createElement('button');n.className=this.cssClassName_+'-'+zi(),n.setAttribute('type','button'),n.title=i,n.appendChild(this.labelNode_),c(n,zd.CLICK,this.handleClick_,this);const a=this.cssClassName_+' '+Zg+' '+qg+' '+(Vi()?'':'ol-unsupported'),s=document.createElement('div');s.className=a,s.appendChild(n),Kg.call(this,{element:s,target:t.target}),this.keys_=t.keys!==void 0&&t.keys,this.source_=t.source};i(Xm,Kg),Xm.prototype.handleClick_=function(e){e.preventDefault(),this.handleFullScreen_()},Xm.prototype.handleFullScreen_=function(){if(Vi()){const e=this.getMap();if(e)if(zi())Ki();else{let t;t=this.source_?'string'==typeof this.source_?document.getElementById(this.source_):this.source_:e.getTargetElement(),this.keys_?Wi(t):Xi(t)}}},Xm.prototype.handleFullScreenChange_=function(){const e=this.element.firstElementChild,t=this.getMap();zi()?(e.className=this.cssClassName_+'-true',er(this.labelActiveNode_,this.labelNode_)):(e.className=this.cssClassName_+'-false',er(this.labelNode_,this.labelActiveNode_)),t&&t.updateSize()},Xm.prototype.setMap=function(e){Kg.prototype.setMap.call(this,e),e&&this.listenerKeys.push(c(document,zm(),this.handleFullScreenChange_,this))};const Wm='projection',Km='coordinateFormat',Hm=function(e){const t=e?e:{},o=document.createElement('DIV');o.className=t.className===void 0?'ol-mouse-position':t.className,Kg.call(this,{element:o,render:t.render||Hi,target:t.target}),c(this,C(Wm),this.handleProjectionChanged_,this),t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat),t.projection&&this.setProjection(t.projection),this.undefinedHTML_=t.undefinedHTML===void 0?'':t.undefinedHTML,this.renderedHTML_=o.innerHTML,this.mapProjection_=null,this.transform_=null,this.lastMouseMovePixel_=null};i(Hm,Kg),Hm.prototype.handleProjectionChanged_=function(){this.transform_=null},Hm.prototype.getCoordinateFormat=function(){return this.get(Km)},Hm.prototype.getProjection=function(){return this.get(Wm)},Hm.prototype.handleMouseMove=function(e){const t=this.getMap();this.lastMouseMovePixel_=t.getEventPixel(e),this.updateHTML_(this.lastMouseMovePixel_)},Hm.prototype.handleMouseOut=function(){this.updateHTML_(null),this.lastMouseMovePixel_=null},Hm.prototype.setMap=function(e){if(Kg.prototype.setMap.call(this,e),e){const t=e.getViewport();this.listenerKeys.push(c(t,zd.MOUSEMOVE,this.handleMouseMove,this),c(t,zd.MOUSEOUT,this.handleMouseOut,this))}},Hm.prototype.setCoordinateFormat=function(e){this.set(Km,e)},Hm.prototype.setProjection=function(e){this.set(Wm,vt(e))},Hm.prototype.updateHTML_=function(e){let t=this.undefinedHTML_;if(e&&this.mapProjection_){if(!this.transform_){const e=this.getProjection();this.transform_=e?Gt(this.mapProjection_,e):It}const o=this.getMap(),r=o.getCoordinateFromPixel(e);if(r){this.transform_(r,r);const e=this.getCoordinateFormat();t=e?e(r):r.toString()}}this.renderedHTML_&&t==this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)};const Zm=.75,qm=.1,Jm=function(e){const t=e?e:{};this.collapsed_=!(t.collapsed!==void 0)||t.collapsed,this.collapsible_=!(t.collapsible!==void 0)||t.collapsible,this.collapsible_||(this.collapsed_=!1);const o=t.className===void 0?'ol-overviewmap':t.className,r=t.tipLabel===void 0?'Overview map':t.tipLabel,i=t.collapseLabel===void 0?'\xAB':t.collapseLabel;'string'==typeof i?(this.collapseLabel_=document.createElement('span'),this.collapseLabel_.textContent=i):this.collapseLabel_=i;const n=t.label===void 0?'\xBB':t.label;'string'==typeof n?(this.label_=document.createElement('span'),this.label_.textContent=n):this.label_=n;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,s=document.createElement('button');s.setAttribute('type','button'),s.title=r,s.appendChild(a),c(s,zd.CLICK,this.handleClick_,this),this.ovmapDiv_=document.createElement('DIV'),this.ovmapDiv_.className='ol-overviewmap-map',this.ovmap_=new Xg({controls:new ep,interactions:new ep,view:t.view});const l=this.ovmap_;t.layers&&t.layers.forEach(function(e){l.addLayer(e)}.bind(this));const d=document.createElement('DIV');d.className='ol-overviewmap-box',d.style.boxSizing='border-box',this.boxOverlay_=new Um({position:[0,0],positioning:Gm.BOTTOM_LEFT,element:d}),this.ovmap_.addOverlay(this.boxOverlay_);const p=o+' '+Zg+' '+qg+(this.collapsed_&&this.collapsible_?' '+Jg:'')+(this.collapsible_?'':' ol-uncollapsible'),g=document.createElement('div');g.className=p,g.appendChild(this.ovmapDiv_),g.appendChild(s),Kg.call(this,{element:g,render:t.render||Zi,target:t.target});const _=this,u=this.boxOverlay_,y=this.boxOverlay_.getElement(),m=function(e){return{clientX:e.clientX-y.offsetWidth/2,clientY:e.clientY+y.offsetHeight/2}},h=function(e){const t=l.getEventCoordinate(m(e));u.setPosition(t)},f=function(e){const t=l.getEventCoordinate(e);_.getMap().getView().setCenter(t),window.removeEventListener('mousemove',h),window.removeEventListener('mouseup',f)};y.addEventListener('mousedown',function(){window.addEventListener('mousemove',h),window.addEventListener('mouseup',f)})};i(Jm,Kg),Jm.prototype.setMap=function(e){const t=this.getMap();if(e!==t){if(t){const e=t.getView();e&&this.unbindView_(e),this.ovmap_.setTarget(null)}if(Kg.prototype.setMap.call(this,e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(c(e,Gd.PROPERTYCHANGE,this.handleMapPropertyChange_,this)),0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(e.getLayerGroup());const t=e.getView();t&&(this.bindView_(t),t.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},Jm.prototype.handleMapPropertyChange_=function(e){if(e.key===Up.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const o=this.getMap().getView();this.bindView_(o)}},Jm.prototype.bindView_=function(e){c(e,C(qp.ROTATION),this.handleRotationChanged_,this)},Jm.prototype.unbindView_=function(e){m(e,C(qp.ROTATION),this.handleRotationChanged_,this)},Jm.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},Jm.prototype.validateExtent_=function(){const e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){const o=e.getSize(),r=e.getView(),i=r.calculateExtent(o),n=t.getSize(),a=t.getView(),s=a.calculateExtent(n),l=t.getPixelFromCoordinate(Je(i)),d=t.getPixelFromCoordinate(Xe(i)),p=od(l[0]-d[0]),g=od(l[1]-d[1]),_=n[0],u=n[1];p<_*qm||g<u*qm||p>_*Zm||g>u*Zm?this.resetExtent_():!Pe(s,i)&&this.recenter_()}},Jm.prototype.resetExtent_=function(){const e=this.getMap(),t=this.ovmap_,o=e.getSize(),r=e.getView(),i=r.calculateExtent(o),n=t.getView(),a=1/(nd(2,2.0149030205422647/ed/2)*qm);rt(i,a),n.fit(i)},Jm.prototype.recenter_=function(){const e=this.getMap(),t=this.ovmap_,o=e.getView(),r=t.getView();r.setCenter(o.getCenter())},Jm.prototype.updateBox_=function(){const e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){const o=e.getSize(),r=e.getView(),i=t.getView(),n=r.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=r.calculateExtent(o),d=i.getResolution(),p=ze(l),g=Qe(l),_=this.calculateCoordinateRotate_(n,p);a.setPosition(_),s&&(s.style.width=od((p[0]-g[0])/d)+'px',s.style.height=od((g[1]-p[1])/d)+'px')}},Jm.prototype.calculateCoordinateRotate_=function(e,t){let o;const r=this.getMap(),i=r.getView(),n=i.getCenter();return n&&(o=[t[0]-n[0],t[1]-n[1]],ge(o,e),ne(o,n)),o},Jm.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},Jm.prototype.handleToggle_=function(){this.element.classList.toggle(Jg),this.collapsed_?er(this.collapseLabel_,this.label_):er(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;this.collapsed_||e.isRendered()||(e.updateSize(),this.resetExtent_(),y(e,kp.POSTRENDER,function(){this.updateBox_()},this))},Jm.prototype.getCollapsible=function(){return this.collapsible_},Jm.prototype.setCollapsible=function(e){this.collapsible_===e||(this.collapsible_=e,this.element.classList.toggle('ol-uncollapsible'),!e&&this.collapsed_&&this.handleToggle_())},Jm.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},Jm.prototype.getCollapsed=function(){return this.collapsed_},Jm.prototype.getOverviewMap=function(){return this.ovmap_};var Qm={DEGREES:'degrees',IMPERIAL:'imperial',NAUTICAL:'nautical',METRIC:'metric',US:'us'};const $m='units',eh=[1,2,5],th=function(e){const t=e?e:{},o=t.className===void 0?'ol-scale-line':t.className;this.innerElement_=document.createElement('DIV'),this.innerElement_.className=o+'-inner',this.element_=document.createElement('DIV'),this.element_.className=o+' '+Zg,this.element_.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth===void 0?64:t.minWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_='',Kg.call(this,{element:this.element_,render:t.render||qi,target:t.target}),c(this,C($m),this.handleUnitsChanged_,this),this.setUnits(t.units||Qm.METRIC)};i(th,Kg),th.prototype.getUnits=function(){return this.get($m)},th.prototype.handleUnitsChanged_=function(){this.updateElement_()},th.prototype.setUnits=function(e){this.set($m,e)},th.prototype.updateElement_=function(){const e=this.viewState_;if(!e)return void(this.renderedVisible_&&(this.element_.style.display='none',this.renderedVisible_=!1));const t=e.center,o=e.projection,r=this.getUnits(),n=r==Qm.DEGREES?ig.DEGREES:ig.METERS;let a=Ft(o,e.resolution,t,n);o.getUnits()!=ig.DEGREES&&r==Qm.METRIC&&(a*=o.getMetersPerUnit());let s=this.minWidth_*a,l='';if(r==Qm.DEGREES){const e=rg[ig.DEGREES];o.getUnits()==ig.DEGREES?s*=e:a/=e,s<e/60?(l='\u2033',a*=3600):s<e?(l='\u2032',a*=60):l='\xB0'}else r==Qm.IMPERIAL?.9144>s?(l='in',a/=.0254):1609.344>s?(l='ft',a/=.3048):(l='mi',a/=1609.344):r==Qm.NAUTICAL?(a/=1852,l='nm'):r==Qm.METRIC?.001>s?(l='\u03BCm',a*=1e6):1>s?(l='mm',a*=1e3):1e3>s?l='m':(l='km',a/=1e3):r==Qm.US?.9144>s?(l='in',a*=39.37):1609.344>s?(l='ft',a/=.30480061):(l='mi',a/=1609.3472):k(!1,33);let d=3*Ql(ad(this.minWidth_*a)/2.302585092994046),i,p;for(;;){if(i=eh[(d%3+3)%3]*nd(10,Ql(d/3)),p=Wl(i/a),isNaN(p))return this.element_.style.display='none',void(this.renderedVisible_=!1);if(p>=this.minWidth_)break;++d}const g=i+' '+l;this.renderedHTML_!=g&&(this.innerElement_.innerHTML=g,this.renderedHTML_=g),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+'px',this.renderedWidth_=p),this.renderedVisible_||(this.element_.style.display='',this.renderedVisible_=!0)};const oh={VERTICAL:0,HORIZONTAL:1},rh=function(e){const t=e?e:{};this.currentResolution_=void 0,this.direction_=oh.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.previousX_,this.previousY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=t.duration===void 0?200:t.duration;const o=t.className===void 0?'ol-zoomslider':t.className,r=document.createElement('button');r.setAttribute('type','button'),r.className=o+'-thumb '+Zg;const i=document.createElement('div');i.className=o+' '+Zg+' '+qg,i.appendChild(r),this.dragger_=new Gp(i),c(this.dragger_,xp.POINTERDOWN,this.handleDraggerStart_,this),c(this.dragger_,xp.POINTERMOVE,this.handleDraggerDrag_,this),c(this.dragger_,xp.POINTERUP,this.handleDraggerEnd_,this),c(i,zd.CLICK,this.handleContainerClick_,this),c(r,zd.CLICK,S),Kg.call(this,{element:i,render:t.render||Ji})};i(rh,Kg),rh.prototype.disposeInternal=function(){this.dragger_.dispose(),Kg.prototype.disposeInternal.call(this)},rh.prototype.setMap=function(e){Kg.prototype.setMap.call(this,e),e&&e.render()},rh.prototype.initSlider_=function(){const e=this.element,t={width:e.offsetWidth,height:e.offsetHeight},o=e.firstElementChild,r=getComputedStyle(o),i=o.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),n=o.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);this.thumbSize_=[i,n],t.width>t.height?(this.direction_=oh.HORIZONTAL,this.widthLimit_=t.width-i):(this.direction_=oh.VERTICAL,this.heightLimit_=t.height-n),this.sliderInitialized_=!0},rh.prototype.handleContainerClick_=function(e){const t=this.getMap().getView(),o=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(o);t.animate({resolution:t.constrainResolution(r),duration:this.duration_,easing:fe})},rh.prototype.handleDraggerStart_=function(e){this.dragging_||e.originalEvent.target!==this.element.firstElementChild||(this.getMap().getView().setHint(Zp.INTERACTING,1),this.previousX_=e.clientX,this.previousY_=e.clientY,this.dragging_=!0)},rh.prototype.handleDraggerDrag_=function(e){if(this.dragging_){const t=this.element.firstElementChild,o=e.clientX-this.previousX_+parseInt(t.style.left,10),r=e.clientY-this.previousY_+parseInt(t.style.top,10),i=this.getRelativePosition_(o,r);this.currentResolution_=this.getResolutionForPosition_(i),this.getMap().getView().setResolution(this.currentResolution_),this.setThumbPosition_(this.currentResolution_),this.previousX_=e.clientX,this.previousY_=e.clientY}},rh.prototype.handleDraggerEnd_=function(){if(this.dragging_){const e=this.getMap().getView();e.setHint(Zp.INTERACTING,-1),e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:fe}),this.dragging_=!1,this.previousX_=void 0,this.previousY_=void 0}},rh.prototype.setThumbPosition_=function(e){const t=this.getPositionForResolution_(e),o=this.element.firstElementChild;this.direction_==oh.HORIZONTAL?o.style.left=this.widthLimit_*t+'px':o.style.top=this.heightLimit_*t+'px'},rh.prototype.getRelativePosition_=function(e,t){let o;return o=this.direction_===oh.HORIZONTAL?e/this.widthLimit_:t/this.heightLimit_,U(o,0,1)},rh.prototype.getResolutionForPosition_=function(e){const t=this.getMap().getView().getResolutionForValueFunction();return t(1-e)},rh.prototype.getPositionForResolution_=function(e){const t=this.getMap().getView().getValueForResolutionFunction();return 1-t(e)};const ih=function(e){const t=e?e:{};this.extent=t.extent?t.extent:null;const o=t.className===void 0?'ol-zoom-extent':t.className,r=t.label===void 0?'E':t.label,i=t.tipLabel===void 0?'Fit to extent':t.tipLabel,n=document.createElement('button');n.setAttribute('type','button'),n.title=i,n.appendChild('string'==typeof r?document.createTextNode(r):r),c(n,zd.CLICK,this.handleClick_,this);const a=document.createElement('div');a.className=o+' '+Zg+' '+qg,a.appendChild(n),Kg.call(this,{element:a,target:t.target})};i(ih,Kg),ih.prototype.handleClick_=function(e){e.preventDefault(),this.handleZoomToExtent()},ih.prototype.handleZoomToExtent=function(){const e=this.getMap(),t=e.getView(),o=this.extent?this.extent:t.getProjection().getExtent();t.fit(o)};const nh=function(){this.defaultDataProjection=null,this.defaultFeatureProjection=null};nh.prototype.getReadOptions=function(e,t){let o;return t&&(o={dataProjection:t.dataProjection?t.dataProjection:this.readProjection(e),featureProjection:t.featureProjection}),this.adaptOptions(o)},nh.prototype.adaptOptions=function(e){return Dd({dataProjection:this.defaultDataProjection,featureProjection:this.defaultFeatureProjection},e)},nh.prototype.getLastExtent=function(){return null},nh.prototype.getType=function(){},nh.prototype.readFeature=function(){},nh.prototype.readFeatures=function(){},nh.prototype.readGeometry=function(){},nh.prototype.readProjection=function(){},nh.prototype.writeFeature=function(){},nh.prototype.writeFeatures=function(){},nh.prototype.writeGeometry=function(){};var ah=nh;const sh=function(){ah.call(this)};i(sh,ah),sh.prototype.getType=function(){return Ym.JSON},sh.prototype.readFeature=function(e,t){return this.readFeatureFromObject($i(e),this.getReadOptions(e,t))},sh.prototype.readFeatures=function(e,t){return this.readFeaturesFromObject($i(e),this.getReadOptions(e,t))},sh.prototype.readFeatureFromObject=function(){},sh.prototype.readFeaturesFromObject=function(){},sh.prototype.readGeometry=function(e,t){return this.readGeometryFromObject($i(e),this.getReadOptions(e,t))},sh.prototype.readGeometryFromObject=function(){},sh.prototype.readProjection=function(e){return this.readProjectionFromObject($i(e))},sh.prototype.readProjectionFromObject=function(){},sh.prototype.writeFeature=function(e,t){return JSON.stringify(this.writeFeatureObject(e,t))},sh.prototype.writeFeatureObject=function(){},sh.prototype.writeFeatures=function(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))},sh.prototype.writeFeaturesObject=function(){},sh.prototype.writeGeometry=function(e,t){return JSON.stringify(this.writeGeometryObject(e,t))},sh.prototype.writeGeometryObject=function(){};var lh=sh;const dh=function(e,t){Sg.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(e,t)};i(dh,Sg),dh.prototype.appendLineString=function(e){this.flatCoordinates?O(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},dh.prototype.clone=function(){const e=new dh(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),e},dh.prototype.closestPointXY=function(e,t,o,r){return r<Ie(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=id(ao(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),po(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,o,r))},dh.prototype.getCoordinateAtM=function(e,t,o){if(this.layout!=eg.XYM&&this.layout!=eg.XYZM||0===this.flatCoordinates.length)return null;return Fi(this.flatCoordinates,0,this.ends_,this.stride,e,t!==void 0&&t,o!==void 0&&o)},dh.prototype.getCoordinates=function(){return ho(this.flatCoordinates,0,this.ends_,this.stride)},dh.prototype.getEnds=function(){return this.ends_},dh.prototype.getLineString=function(e){if(0>e||this.ends_.length<=e)return null;const t=new ty(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e])),t},dh.prototype.getLineStrings=function(){const e=this.flatCoordinates,t=this.ends_,o=this.layout,r=[];let n=0;for(let a=0,i=t.length;a<i;++a){const i=t[a],s=new ty(null);s.setFlatCoordinates(o,e.slice(n,i)),r.push(s),n=i}return r},dh.prototype.getFlatMidpoints=function(){const e=[],t=this.flatCoordinates;let o=0;const r=this.ends_,n=this.stride;for(let a=0,i=r.length;a<i;++a){const i=r[a],s=Pi(t,o,i,n,.5);O(e,s),o=i}return e},dh.prototype.getSimplifiedGeometryInternal=function(e){const t=[],o=[];t.length=xo(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,o);const r=new dh(null);return r.setFlatCoordinates(eg.XY,t,o),r},dh.prototype.getType=function(){return $p.MULTI_LINE_STRING},dh.prototype.intersectsExtent=function(e){return Ao(this.flatCoordinates,0,this.ends_,this.stride,e)},dh.prototype.setCoordinates=function(e,t){if(!e)this.setFlatCoordinates(eg.XY,null,this.ends_);else{this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const o=co(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===o.length?0:o[o.length-1],this.changed()}},dh.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t),this.ends_=o,this.changed()},dh.prototype.setLineStrings=function(e){let t=this.getLayout();const o=[],r=[];for(let n=0,i=e.length;n<i;++n){const i=e[n];0===n&&(t=i.getLayout()),O(o,i.getFlatCoordinates()),r.push(o.length)}this.setFlatCoordinates(t,o,r)};var ph=dh;const gh=function(e,t){Sg.call(this),this.setCoordinates(e,t)};i(gh,Sg),gh.prototype.appendPoint=function(e){this.flatCoordinates?O(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()},gh.prototype.clone=function(){const e=new gh(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},gh.prototype.closestPointXY=function(e,t,o,r){if(r<Ie(this.getExtent(),e,t))return r;const n=this.flatCoordinates,a=this.stride;for(let s=0,i=n.length;s<i;s+=a){const i=j(e,t,n[s],n[s+1]);if(i<r){r=i;for(let e=0;e<a;++e)o[e]=n[s+e];o.length=a}}return r},gh.prototype.getCoordinates=function(){return mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},gh.prototype.getPoint=function(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;if(0>e||t<=e)return null;const o=new Lg(null);return o.setFlatCoordinates(this.layout,this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride)),o},gh.prototype.getPoints=function(){const e=this.flatCoordinates,t=this.layout,o=this.stride,r=[];for(let n=0,i=e.length;n<i;n+=o){const i=new Lg(null);i.setFlatCoordinates(t,e.slice(n,n+o)),r.push(i)}return r},gh.prototype.getType=function(){return $p.MULTI_POINT},gh.prototype.intersectsExtent=function(e){const t=this.flatCoordinates,o=this.stride;for(let r=0,i=t.length;r<i;r+=o){const o=t[r],i=t[r+1];if(ve(e,o,i))return!0}return!1},gh.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=uo(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(eg.XY,null)},gh.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var _h=gh;const uh=function(e,t){Sg.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(e,t)};i(uh,Sg),uh.prototype.appendPolygon=function(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const o=this.flatCoordinates.length;O(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let e=0,r=t.length;e<r;++e)t[e]+=o}this.endss_.push(t),this.changed()},uh.prototype.clone=function(){const e=new uh(null),t=this.endss_.length,o=Array(t);for(let e=0;e<t;++e)o[e]=this.endss_[e].slice();return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),o),e},uh.prototype.closestPointXY=function(e,t,o,r){return r<Ie(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=id(so(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),go(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,o,r))},uh.prototype.containsXY=function(e,t){return vo(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)},uh.prototype.getArea=function(){return ro(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},uh.prototype.getCoordinates=function(e){let t;return void 0===e?t=this.flatCoordinates:(t=this.getOrientedFlatCoordinates().slice(),jo(t,0,this.endss_,this.stride,e)),fo(t,0,this.endss_,this.stride)},uh.prototype.getEndss=function(){return this.endss_},uh.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=en(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Oo(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},uh.prototype.getInteriorPoints=function(){const e=new _h(null);return e.setFlatCoordinates(eg.XYM,this.getFlatInteriorPoints().slice()),e},uh.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Yo(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=jo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},uh.prototype.getSimplifiedGeometryInternal=function(e){const t=[],o=[];t.length=Ro(this.flatCoordinates,0,this.endss_,this.stride,id(e),t,0,o);const r=new uh(null);return r.setFlatCoordinates(eg.XY,t,o),r},uh.prototype.getPolygon=function(e){if(0>e||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const o=this.endss_[e-1];t=o[o.length-1]}const o=this.endss_[e].slice(),r=o[o.length-1];if(0!==t)for(let e=0,r=o.length;e<r;++e)o[e]-=t;const i=new vg(null);return i.setFlatCoordinates(this.layout,this.flatCoordinates.slice(t,r),o),i},uh.prototype.getPolygons=function(){const e=this.layout,t=this.flatCoordinates,o=this.endss_,r=[];let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a].slice(),s=i[i.length-1];if(0!==n)for(let e=0,t=i.length;e<t;++e)i[e]-=n;const l=new vg(null);l.setFlatCoordinates(e,t.slice(n,s),i),r.push(l),n=s}return r},uh.prototype.getType=function(){return $p.MULTI_POLYGON},uh.prototype.intersectsExtent=function(e){return Go(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)},uh.prototype.setCoordinates=function(e,t){if(!e)this.setFlatCoordinates(eg.XY,null,this.endss_);else{this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const o=yo(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===o.length)this.flatCoordinates.length=0;else{const e=o[o.length-1];this.flatCoordinates.length=0===e.length?0:e[e.length-1]}this.changed()}},uh.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t),this.endss_=o,this.changed()},uh.prototype.setPolygons=function(e){let t=this.getLayout();const o=[],r=[];for(let n=0,i=e.length;n<i;++n){const i=e[n];0===n&&(t=i.getLayout());const a=o.length,s=i.getEnds();for(let e=0,t=s.length;e<t;++e)s[e]+=a;O(o,i.getFlatCoordinates()),r.push(s)}this.setFlatCoordinates(t,o,r)};var ch=uh;const yh={};yh[$p.POINT]=function(e){let t;return t=void 0!==e.m&&void 0!==e.z?new Lg([e.x,e.y,e.z,e.m],eg.XYZM):void 0===e.z?void 0===e.m?new Lg([e.x,e.y]):new Lg([e.x,e.y,e.m],eg.XYM):new Lg([e.x,e.y,e.z],eg.XYZ),t},yh[$p.LINE_STRING]=function(e){const t=rn(e);return new ty(e.paths[0],t)},yh[$p.POLYGON]=function(e){const t=rn(e);return new vg(e.rings,t)},yh[$p.MULTI_POINT]=function(e){const t=rn(e);return new _h(e.points,t)},yh[$p.MULTI_LINE_STRING]=function(e){const t=rn(e);return new ph(e.paths,t)},yh[$p.MULTI_POLYGON]=function(e){const t=rn(e);return new ch(e.rings,t)};const mh={};mh[$p.POINT]=function(e){const t=e.getCoordinates();let o;const r=e.getLayout();return r===eg.XYZ?o={x:t[0],y:t[1],z:t[2]}:r===eg.XYM?o={x:t[0],y:t[1],m:t[2]}:r===eg.XYZM?o={x:t[0],y:t[1],z:t[2],m:t[3]}:r===eg.XY?o={x:t[0],y:t[1]}:k(!1,34),o},mh[$p.LINE_STRING]=function(e){const t=nn(e);return{hasZ:t.hasZ,hasM:t.hasM,paths:[e.getCoordinates()]}},mh[$p.POLYGON]=function(e){const t=nn(e);return{hasZ:t.hasZ,hasM:t.hasM,rings:e.getCoordinates(!1)}},mh[$p.MULTI_POINT]=function(e){const t=nn(e);return{hasZ:t.hasZ,hasM:t.hasM,points:e.getCoordinates()}},mh[$p.MULTI_LINE_STRING]=function(e){const t=nn(e);return{hasZ:t.hasZ,hasM:t.hasM,paths:e.getCoordinates()}},mh[$p.MULTI_POLYGON]=function(e){const t=nn(e),o=e.getCoordinates(!1),r=[];for(let t=0;t<o.length;t++)for(let e=o[t].length-1;0<=e;e--)r.push(o[t][e]);return{hasZ:t.hasZ,hasM:t.hasM,rings:r}};const hh=function(e){const t=e?e:{};lh.call(this),this.geometryName_=t.geometryName};i(hh,lh),hh.prototype.readFeature,hh.prototype.readFeatures,hh.prototype.readFeatureFromObject=function(e,t){const o=e,r=tn(o.geometry,t),i=new Jc;return this.geometryName_&&i.setGeometryName(this.geometryName_),i.setGeometry(r),t&&t.idField&&o.attributes[t.idField]&&i.setId(o.attributes[t.idField]),o.attributes&&i.setProperties(o.attributes),i},hh.prototype.readFeaturesFromObject=function(e,t){const o=t?t:{};if(e.features){const t=[],r=e.features;o.idField=e.objectIdFieldName;for(let e=0,i=r.length;e<i;++e)t.push(this.readFeatureFromObject(r[e],o));return t}return[this.readFeatureFromObject(e,o)]},hh.prototype.readGeometry,hh.prototype.readGeometryFromObject=function(e,t){return tn(e,t)},hh.prototype.readProjection,hh.prototype.readProjectionFromObject=function(e){const t=e;if(t.spatialReference&&t.spatialReference.wkid){const e=t.spatialReference.wkid;return vt('EPSG:'+e)}return null},hh.prototype.writeGeometry,hh.prototype.writeGeometryObject=function(e,t){return an(e,this.adaptOptions(t))},hh.prototype.writeFeature,hh.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);const o={},r=e.getGeometry();r&&(o.geometry=an(r,t),t&&t.featureProjection&&(o.geometry.spatialReference={wkid:vt(t.featureProjection).getCode().split(':').pop()}));const i=e.getProperties();return delete i[e.getGeometryName()],o.attributes=l(i)?{}:i,o},hh.prototype.writeFeatures,hh.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);const o=[];for(let r=0,i=e.length;r<i;++r)o.push(this.writeFeatureObject(e[r],t));return{features:o}};const fh=document.implementation.createDocument('','',null),Eh='http://www.w3.org/2001/XMLSchema-instance',xh=Tn(),Th=function(){this.xmlSerializer_=new XMLSerializer,ah.call(this)};i(Th,ah),Th.prototype.getType=function(){return Ym.XML},Th.prototype.readFeature=function(e,t){if(pn(e))return this.readFeatureFromDocument(e,t);if(gn(e))return this.readFeatureFromNode(e,t);if('string'==typeof e){const o=un(e);return this.readFeatureFromDocument(o,t)}return null},Th.prototype.readFeatureFromDocument=function(e,t){const o=this.readFeaturesFromDocument(e,t);return 0<o.length?o[0]:null},Th.prototype.readFeatureFromNode=function(){return null},Th.prototype.readFeatures=function(e,t){if(pn(e))return this.readFeaturesFromDocument(e,t);if(gn(e))return this.readFeaturesFromNode(e,t);if('string'==typeof e){const o=un(e);return this.readFeaturesFromDocument(o,t)}return[]},Th.prototype.readFeaturesFromDocument=function(e,t){const o=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&O(o,this.readFeaturesFromNode(r,t));return o},Th.prototype.readFeaturesFromNode=function(){},Th.prototype.readGeometry=function(e,t){if(pn(e))return this.readGeometryFromDocument(e,t);if(gn(e))return this.readGeometryFromNode(e,t);if('string'==typeof e){const o=un(e);return this.readGeometryFromDocument(o,t)}return null},Th.prototype.readGeometryFromDocument=function(){return null},Th.prototype.readGeometryFromNode=function(){return null},Th.prototype.readProjection=function(e){if(pn(e))return this.readProjectionFromDocument(e);if(gn(e))return this.readProjectionFromNode(e);if('string'==typeof e){const t=un(e);return this.readProjectionFromDocument(t)}return null},Th.prototype.readProjectionFromDocument=function(){return this.defaultDataProjection},Th.prototype.readProjectionFromNode=function(){return this.defaultDataProjection},Th.prototype.writeFeature=function(e,t){const o=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(o)},Th.prototype.writeFeatureNode=function(){return null},Th.prototype.writeFeatures=function(e,t){const o=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(o)},Th.prototype.writeFeaturesNode=function(){return null},Th.prototype.writeGeometry=function(e,t){const o=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(o)},Th.prototype.writeGeometryNode=function(){return null};var Sh=Th;const Ch='http://www.opengis.net/gml',Rh=function(e){const t=e?e:{};this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation='',this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[Ch]={featureMember:mn(Rh.prototype.readFeaturesInternal),featureMembers:mn(Rh.prototype.readFeaturesInternal)},Sh.call(this)};i(Rh,Sh);const Ih=/^[\s\xa0]*$/;Rh.prototype.readFeaturesInternal=function(e,t){const o=e.localName;let r=null;if('FeatureCollection'==o)r='http://www.opengis.net/wfs'===e.namespaceURI?In([],this.FEATURE_COLLECTION_PARSERS,e,t,this):In(null,this.FEATURE_COLLECTION_PARSERS,e,t,this);else if('featureMembers'==o||'featureMember'==o){const i=t[0];let n=i.featureType,a=i.featureNS;const s='p0';if(!n&&e.childNodes){n=[],a={};for(let t=0,o=e.childNodes.length;t<o;++t){const o=e.childNodes[t];if(1===o.nodeType){const e=o.nodeName.split(':').pop();if(-1===n.indexOf(e)){let t='',r=0;const i=o.namespaceURI;for(const e in a){if(a[e]===i){t=e;break}++r}t||(t='p'+r,a[t]=i),n.push(t+':'+e)}}}'featureMember'!=o&&(i.featureType=n,i.featureNS=a)}if('string'==typeof a){const e=a;a={},a[s]=e}const l={},d=Array.isArray(n)?n:[n];for(const e in a){const t={};for(let r=0,i=d.length;r<i;++r){const i=-1===d[r].indexOf(':')?s:d[r].split(':')[0];i===e&&(t[d[r].split(':').pop()]='featureMembers'==o?yn(this.readFeatureElement,this):mn(this.readFeatureElement,this))}l[a[e]]=t}r='featureMember'==o?In(void 0,l,e,t):In([],l,e,t)}return null===r&&(r=[]),r},Rh.prototype.readGeometryElement=function(e,t){const o=t[0];o.srsName=e.firstElementChild.getAttribute('srsName'),o.srsDimension=e.firstElementChild.getAttribute('srsDimension');const r=In(null,this.GEOMETRY_PARSERS_,e,t,this);return r?Qi(r,!1,o):void 0},Rh.prototype.readFeatureElement=function(e,t){let o;const r=e.getAttribute('fid')||_n(e,Ch,'id'),i={};let n;for(o=e.firstElementChild;o;o=o.nextElementSibling){const e=o.localName;if(0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)){let t=ln(o,!1);Ih.test(t)&&(t=void 0),i[e]=t}else'boundedBy'!==e&&(n=e),i[e]=this.readGeometryElement(o,t)}const a=new Jc(i);return n&&a.setGeometryName(n),r&&a.setId(r),a},Rh.prototype.readPoint=function(e,t){const o=this.readFlatCoordinatesFromNode_(e,t);if(o){const e=new Lg(null);return e.setFlatCoordinates(eg.XYZ,o),e}},Rh.prototype.readMultiPoint=function(e,t){const o=In([],this.MULTIPOINT_PARSERS_,e,t,this);return o?new _h(o):void 0},Rh.prototype.readMultiLineString=function(e,t){const o=In([],this.MULTILINESTRING_PARSERS_,e,t,this);if(o){const e=new ph(null);return e.setLineStrings(o),e}},Rh.prototype.readMultiPolygon=function(e,t){const o=In([],this.MULTIPOLYGON_PARSERS_,e,t,this);if(o){const e=new ch(null);return e.setPolygons(o),e}},Rh.prototype.pointMemberParser_=function(e,t){Rn(this.POINTMEMBER_PARSERS_,e,t,this)},Rh.prototype.lineStringMemberParser_=function(e,t){Rn(this.LINESTRINGMEMBER_PARSERS_,e,t,this)},Rh.prototype.polygonMemberParser_=function(e,t){Rn(this.POLYGONMEMBER_PARSERS_,e,t,this)},Rh.prototype.readLineString=function(e,t){const o=this.readFlatCoordinatesFromNode_(e,t);if(o){const e=new ty(null);return e.setFlatCoordinates(eg.XYZ,o),e}},Rh.prototype.readFlatLinearRing_=function(e,t){const o=In(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this);return o?o:void 0},Rh.prototype.readLinearRing=function(e,t){const o=this.readFlatCoordinatesFromNode_(e,t);if(o){const e=new Rg(null);return e.setFlatCoordinates(eg.XYZ,o),e}},Rh.prototype.readPolygon=function(e,t){const o=In([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this);if(o&&o[0]){const e=new vg(null),t=o[0],r=[t.length];let n,i;for(n=1,i=o.length;n<i;++n)O(t,o[n]),r.push(t.length);return e.setFlatCoordinates(eg.XYZ,t,r),e}},Rh.prototype.readFlatCoordinatesFromNode_=function(e,t){return In(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)},Rh.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:yn(Rh.prototype.pointMemberParser_),pointMembers:yn(Rh.prototype.pointMemberParser_)}},Rh.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:yn(Rh.prototype.lineStringMemberParser_),lineStringMembers:yn(Rh.prototype.lineStringMemberParser_)}},Rh.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:yn(Rh.prototype.polygonMemberParser_),polygonMembers:yn(Rh.prototype.polygonMemberParser_)}},Rh.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:yn(Rh.prototype.readFlatCoordinatesFromNode_)}},Rh.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:yn(Rh.prototype.readLineString)}},Rh.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:yn(Rh.prototype.readPolygon)}},Rh.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:mn(Rh.prototype.readFlatLinearRing_)}},Rh.prototype.readGeometryFromNode=function(e,t){const o=this.readGeometryElement(e,[this.getReadOptions(e,t?t:{})]);return o?o:null},Rh.prototype.readFeatures,Rh.prototype.readFeaturesFromNode=function(e,t){const o={featureType:this.featureType,featureNS:this.featureNS};t&&Dd(o,this.getReadOptions(e,t));const r=this.readFeaturesInternal(e,[o]);return r||[]},Rh.prototype.readProjectionFromNode=function(e){return vt(this.srsName?this.srsName:e.firstElementChild.getAttribute('srsName'))};var Lh=Rh;const Ph=function(e){const t=e?e:{};Lh.call(this,t),this.surface_=t.surface!==void 0&&t.surface,this.curve_=t.curve!==void 0&&t.curve,this.multiCurve_=!(t.multiCurve!==void 0)||t.multiCurve,this.multiSurface_=!(t.multiSurface!==void 0)||t.multiSurface,this.schemaLocation=t.schemaLocation?t.schemaLocation:Ch+' http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd',this.hasZ=t.hasZ!==void 0&&t.hasZ};i(Ph,Lh),Ph.prototype.readMultiCurve_=function(e,t){const o=In([],this.MULTICURVE_PARSERS_,e,t,this);if(o){const e=new ph(null);return e.setLineStrings(o),e}},Ph.prototype.readMultiSurface_=function(e,t){const o=In([],this.MULTISURFACE_PARSERS_,e,t,this);if(o){const e=new ch(null);return e.setPolygons(o),e}},Ph.prototype.curveMemberParser_=function(e,t){Rn(this.CURVEMEMBER_PARSERS_,e,t,this)},Ph.prototype.surfaceMemberParser_=function(e,t){Rn(this.SURFACEMEMBER_PARSERS_,e,t,this)},Ph.prototype.readPatch_=function(e,t){return In([null],this.PATCHES_PARSERS_,e,t,this)},Ph.prototype.readSegment_=function(e,t){return In([null],this.SEGMENTS_PARSERS_,e,t,this)},Ph.prototype.readPolygonPatch_=function(e,t){return In([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this)},Ph.prototype.readLineStringSegment_=function(e,t){return In([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)},Ph.prototype.interiorParser_=function(e,t){const o=In(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e.push(o)}},Ph.prototype.exteriorParser_=function(e,t){const o=In(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e[0]=o}},Ph.prototype.readSurface_=function(e,t){const o=In([null],this.SURFACE_PARSERS_,e,t,this);if(o&&o[0]){const e=new vg(null),t=o[0],r=[t.length];let n,i;for(n=1,i=o.length;n<i;++n)O(t,o[n]),r.push(t.length);return e.setFlatCoordinates(eg.XYZ,t,r),e}},Ph.prototype.readCurve_=function(e,t){const o=In([null],this.CURVE_PARSERS_,e,t,this);if(o){const e=new ty(null);return e.setFlatCoordinates(eg.XYZ,o),e}},Ph.prototype.readEnvelope_=function(e,t){const o=In([null],this.ENVELOPE_PARSERS_,e,t,this);return we(o[1][0],o[1][1],o[2][0],o[2][1])},Ph.prototype.readFlatPos_=function(e,t){let o=ln(e,!1);const r=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];for(let i;i=r.exec(o);)n.push(parseFloat(i[1])),o=o.substr(i[0].length);if(''!==o)return;const i=t[0],a=i.srsName;let s='enu';if(a){const e=vt(a);s=e.getAxisOrientation()}if('neu'===s){let e,t;for(e=0,t=n.length;e<t;e+=3){const t=n[e],o=n[e+1];n[e]=o,n[e+1]=t}}const l=n.length;return 2==l&&n.push(0),0===l?void 0:n},Ph.prototype.readFlatPosList_=function(e,t){const o=ln(e,!1).replace(/^\s*|\s*$/g,''),r=t[0],i=r.srsName,n=r.srsDimension;let a='enu';if(i){const e=vt(i);a=e.getAxisOrientation()}const s=o.split(/\s+/);let l=2;e.getAttribute('srsDimension')?l=bn(e.getAttribute('srsDimension')):e.getAttribute('dimension')?l=bn(e.getAttribute('dimension')):e.parentNode.getAttribute('srsDimension')?l=bn(e.parentNode.getAttribute('srsDimension')):n&&(l=bn(n));let d,p,g;const _=[];for(let o=0,r=s.length;o<r;o+=l)d=parseFloat(s[o]),p=parseFloat(s[o+1]),g=3===l?parseFloat(s[o+2]):0,'en'===a.substr(0,2)?_.push(d,p,g):_.push(p,d,g);return _},Ph.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{pos:mn(Ph.prototype.readFlatPos_),posList:mn(Ph.prototype.readFlatPosList_)}},Ph.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{interior:Ph.prototype.interiorParser_,exterior:Ph.prototype.exteriorParser_}},Ph.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:mn(Lh.prototype.readPoint),MultiPoint:mn(Lh.prototype.readMultiPoint),LineString:mn(Lh.prototype.readLineString),MultiLineString:mn(Lh.prototype.readMultiLineString),LinearRing:mn(Lh.prototype.readLinearRing),Polygon:mn(Lh.prototype.readPolygon),MultiPolygon:mn(Lh.prototype.readMultiPolygon),Surface:mn(Ph.prototype.readSurface_),MultiSurface:mn(Ph.prototype.readMultiSurface_),Curve:mn(Ph.prototype.readCurve_),MultiCurve:mn(Ph.prototype.readMultiCurve_),Envelope:mn(Ph.prototype.readEnvelope_)}},Ph.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:yn(Ph.prototype.curveMemberParser_),curveMembers:yn(Ph.prototype.curveMemberParser_)}},Ph.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:yn(Ph.prototype.surfaceMemberParser_),surfaceMembers:yn(Ph.prototype.surfaceMemberParser_)}},Ph.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:yn(Lh.prototype.readLineString),Curve:yn(Ph.prototype.readCurve_)}},Ph.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:yn(Lh.prototype.readPolygon),Surface:yn(Ph.prototype.readSurface_)}},Ph.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:mn(Ph.prototype.readPatch_)}},Ph.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:mn(Ph.prototype.readSegment_)}},Ph.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:yn(Ph.prototype.readFlatPosList_),upperCorner:yn(Ph.prototype.readFlatPosList_)}},Ph.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:mn(Ph.prototype.readPolygonPatch_)}},Ph.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:mn(Ph.prototype.readLineStringSegment_)}},Ph.prototype.writePos_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=i?3:2;e.setAttribute('srsDimension',n);const a=r.srsName;let s='enu';a&&(s=vt(a).getAxisOrientation());const l=t.getCoordinates();let d;if(d='en'===s.substr(0,2)?l[0]+' '+l[1]:l[1]+' '+l[0],i){const e=l[2]||0;d+=' '+e}Yn(e,d)},Ph.prototype.getCoords_=function(e,t,o){let r='enu';t&&(r=vt(t).getAxisOrientation());let i='en'===r.substr(0,2)?e[0]+' '+e[1]:e[1]+' '+e[0];if(o){const t=e[2]||0;i+=' '+t}return i},Ph.prototype.writePosList_=function(e,t,o){const r=o[o.length-1],n=r.hasZ,i=n?3:2;e.setAttribute('srsDimension',i);const a=r.srsName,s=t.getCoordinates(),l=s.length,d=Array(l);let p;for(let r=0;r<l;++r)p=s[r],d[r]=this.getCoords_(p,a,n);Yn(e,d.join(' '))},Ph.prototype.writePoint_=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=sn(e.namespaceURI,'pos');e.appendChild(n),this.writePos_(n,t,o)},Ph.prototype.writeEnvelope=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=[t[0]+' '+t[1],t[2]+' '+t[3]];Pn({node:e},this.ENVELOPE_SERIALIZERS_,xh,n,o,['lowerCorner','upperCorner'],this)},Ph.prototype.writeLinearRing_=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=sn(e.namespaceURI,'posList');e.appendChild(n),this.writePosList_(n,t,o)},Ph.prototype.RING_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.node,i=o.exteriorWritten;return void 0===i&&(o.exteriorWritten=!0),sn(r.namespaceURI,void 0===i?'exterior':'interior')},Ph.prototype.writeSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;if('PolygonPatch'!==e.nodeName&&n&&e.setAttribute('srsName',n),'Polygon'===e.nodeName||'PolygonPatch'===e.nodeName){const r=t.getLinearRings();Pn({node:e,hasZ:i,srsName:n},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,r,o,void 0,this)}else if('Surface'===e.nodeName){const r=sn(e.namespaceURI,'patches');e.appendChild(r),this.writeSurfacePatches_(r,t,o)}},Ph.prototype.writeCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.srsName;if('LineStringSegment'!==e.nodeName&&i&&e.setAttribute('srsName',i),'LineString'===e.nodeName||'LineStringSegment'===e.nodeName){const r=sn(e.namespaceURI,'posList');e.appendChild(r),this.writePosList_(r,t,o)}else if('Curve'===e.nodeName){const r=sn(e.namespaceURI,'segments');e.appendChild(r),this.writeCurveSegments_(r,t,o)}},Ph.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.surface;n&&e.setAttribute('srsName',n);const s=t.getPolygons();Pn({node:e,hasZ:i,srsName:n,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},Ph.prototype.writeMultiPoint_=function(e,t,o){const r=o[o.length-1],i=r.srsName,n=r.hasZ;i&&e.setAttribute('srsName',i);const a=t.getPoints();Pn({node:e,hasZ:n,srsName:i},this.POINTMEMBER_SERIALIZERS_,Tn('pointMember'),a,o,void 0,this)},Ph.prototype.writeMultiCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.curve;n&&e.setAttribute('srsName',n);const s=t.getLineStrings();Pn({node:e,hasZ:i,srsName:n,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},Ph.prototype.writeRing_=function(e,t,o){const r=sn(e.namespaceURI,'LinearRing');e.appendChild(r),this.writeLinearRing_(r,t,o)},Ph.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o))},Ph.prototype.writePointMember_=function(e,t,o){const r=sn(e.namespaceURI,'Point');e.appendChild(r),this.writePoint_(r,t,o)},Ph.prototype.writeLineStringOrCurveMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeCurveOrLineString_(r,t,o))},Ph.prototype.writeSurfacePatches_=function(e,t,o){const r=sn(e.namespaceURI,'PolygonPatch');e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o)},Ph.prototype.writeCurveSegments_=function(e,t,o){const r=sn(e.namespaceURI,'LineStringSegment');e.appendChild(r),this.writeCurveOrLineString_(r,t,o)},Ph.prototype.writeGeometryElement=function(e,t,o){const r=o[o.length-1],i=Dd({},r);i.node=e;let n;n=Array.isArray(t)?r.dataProjection?Ut(t,r.featureProjection,r.dataProjection):t:Qi(t,!0,r),Pn(i,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],o,void 0,this)},Ph.prototype.writeFeatureElement=function(e,t,o){const r=t.getId();r&&e.setAttribute('fid',r);const i=o[o.length-1],n=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[n]={});const s=t.getProperties(),l=[],d=[];for(const r in s){const e=s[r];null!==e&&(l.push(r),d.push(e),r==a||e instanceof xg?!(r in i.serializers[n])&&(i.serializers[n][r]=En(this.writeGeometryElement,this)):!(r in i.serializers[n])&&(i.serializers[n][r]=En(Yn)))}const p=Dd({},i);p.node=e,Pn(p,i.serializers,Tn(void 0,n),d,o,l)},Ph.prototype.writeFeatureMembers_=function(e,t,o){const r=o[o.length-1],i=r.featureType,n=r.featureNS,a={};a[n]={},a[n][i]=En(this.writeFeatureElement,this);const s=Dd({},r);s.node=e,Pn(s,a,Tn(i,n),t,o)};const vh={MultiLineString:'lineStringMember',MultiCurve:'curveMember',MultiPolygon:'polygonMember',MultiSurface:'surfaceMember'};Ph.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t){const o=t[t.length-1].node;return sn('http://www.opengis.net/gml',vh[o.nodeName])},Ph.prototype.GEOMETRY_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.multiSurface,i=o.surface,n=o.curve,a=o.multiCurve;let s;return Array.isArray(e)?s='Envelope':(s=e.getType(),'MultiPolygon'===s&&!0===r?s='MultiSurface':'Polygon'===s&&!0===i?s='Surface':'LineString'===s&&!0===n?s='Curve':'MultiLineString'===s&&!0===a&&(s='MultiCurve')),sn('http://www.opengis.net/gml',s)},Ph.prototype.writeGeometryNode=function(e,t){t=this.adaptOptions(t);const o=sn('http://www.opengis.net/gml','geom'),r={node:o,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Dd(r,t),this.writeGeometryElement(o,e,[r]),o},Ph.prototype.writeFeatures,Ph.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const o=sn('http://www.opengis.net/gml','featureMembers');o.setAttributeNS(Eh,'xsi:schemaLocation',this.schemaLocation);const r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Dd(r,t),this.writeFeatureMembers_(o,e,[r]),o},Ph.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:En(Ph.prototype.writeRing_),interior:En(Ph.prototype.writeRing_)}},Ph.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:En(Yn),upperCorner:En(Yn)}},Ph.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:En(Ph.prototype.writeSurfaceOrPolygonMember_),polygonMember:En(Ph.prototype.writeSurfaceOrPolygonMember_)}},Ph.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:En(Ph.prototype.writePointMember_)}},Ph.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:En(Ph.prototype.writeLineStringOrCurveMember_),curveMember:En(Ph.prototype.writeLineStringOrCurveMember_)}},Ph.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:En(Ph.prototype.writeCurveOrLineString_),MultiCurve:En(Ph.prototype.writeMultiCurveOrLineString_),Point:En(Ph.prototype.writePoint_),MultiPoint:En(Ph.prototype.writeMultiPoint_),LineString:En(Ph.prototype.writeCurveOrLineString_),MultiLineString:En(Ph.prototype.writeMultiCurveOrLineString_),LinearRing:En(Ph.prototype.writeLinearRing_),Polygon:En(Ph.prototype.writeSurfaceOrPolygon_),MultiPolygon:En(Ph.prototype.writeMultiSurfaceOrPolygon_),Surface:En(Ph.prototype.writeSurfaceOrPolygon_),MultiSurface:En(Ph.prototype.writeMultiSurfaceOrPolygon_),Envelope:En(Ph.prototype.writeEnvelope)}};var Fh=Ph;const Oh=Fh;Oh.prototype.writeFeatures,Oh.prototype.writeFeaturesNode;const wh=function(e){const t=e?e:{};Lh.call(this,t),this.FEATURE_COLLECTION_PARSERS[Ch].featureMember=yn(Lh.prototype.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:Ch+' http://schemas.opengis.net/gml/2.1.2/feature.xsd'};i(wh,Lh),wh.prototype.readFlatCoordinates_=function(e,t){const o=ln(e,!1).replace(/^\s*|\s*$/g,''),r=t[0],i=r.srsName;let n='enu';if(i){const e=vt(i);e&&(n=e.getAxisOrientation())}const a=o.trim().split(/\s+/),s=[];for(let o=0,r=a.length;o<r;o++){const e=a[o].split(/,+/),t=parseFloat(e[0]),r=parseFloat(e[1]),i=3===e.length?parseFloat(e[2]):0;'en'===n.substr(0,2)?s.push(t,r,i):s.push(r,t,i)}return s},wh.prototype.readBox_=function(e,t){const o=In([null],this.BOX_PARSERS_,e,t,this);return we(o[1][0],o[1][1],o[1][3],o[1][4])},wh.prototype.innerBoundaryIsParser_=function(e,t){const o=In(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e.push(o)}},wh.prototype.outerBoundaryIsParser_=function(e,t){const o=In(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e[0]=o}},wh.prototype.GEOMETRY_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.multiSurface,i=o.surface,n=o.multiCurve;let a;return Array.isArray(e)?a='Envelope':(a=e.getType(),'MultiPolygon'===a&&!0===r?a='MultiSurface':'Polygon'===a&&!0===i?a='Surface':'MultiLineString'===a&&!0===n&&(a='MultiCurve')),sn('http://www.opengis.net/gml',a)},wh.prototype.writeFeatureElement=function(e,t,o){const r=t.getId();r&&e.setAttribute('fid',r);const i=o[o.length-1],n=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[n]={});const s=t.getProperties(),l=[],d=[];for(const r in s){const e=s[r];null!==e&&(l.push(r),d.push(e),r==a||e instanceof xg?!(r in i.serializers[n])&&(i.serializers[n][r]=En(this.writeGeometryElement,this)):!(r in i.serializers[n])&&(i.serializers[n][r]=En(Yn)))}const p=Dd({},i);p.node=e,Pn(p,i.serializers,Tn(void 0,n),d,o,l)},wh.prototype.writeCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.srsName;if('LineStringSegment'!==e.nodeName&&i&&e.setAttribute('srsName',i),'LineString'===e.nodeName||'LineStringSegment'===e.nodeName){const r=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(r),this.writeCoordinates_(r,t,o)}else if('Curve'===e.nodeName){const r=sn(e.namespaceURI,'segments');e.appendChild(r),this.writeCurveSegments_(r,t,o)}},wh.prototype.writeLineStringOrCurveMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeCurveOrLineString_(r,t,o))},wh.prototype.writeMultiCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.curve;n&&e.setAttribute('srsName',n);const s=t.getLineStrings();Pn({node:e,hasZ:i,srsName:n,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},wh.prototype.writeGeometryElement=function(e,t,o){const r=o[o.length-1],i=Dd({},r);i.node=e;let n;n=Array.isArray(t)?r.dataProjection?Ut(t,r.featureProjection,r.dataProjection):t:Qi(t,!0,r),Pn(i,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],o,void 0,this)},wh.prototype.createCoordinatesNode_=function(e){const t=sn(e,'coordinates');return t.setAttribute('decimal','.'),t.setAttribute('cs',','),t.setAttribute('ts',' '),t},wh.prototype.writeCoordinates_=function(e,t,o){const r=o[o.length-1],n=r.hasZ,a=r.srsName,s=t.getCoordinates(),l=s.length,d=Array(l);for(let r=0;r<l;++r){const e=s[r];d[r]=this.getCoords_(e,a,n)}Yn(e,d.join(' '))},wh.prototype.writeCurveSegments_=function(e,t,o){const r=sn(e.namespaceURI,'LineStringSegment');e.appendChild(r),this.writeCurveOrLineString_(r,t,o)},wh.prototype.writeSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;if('PolygonPatch'!==e.nodeName&&n&&e.setAttribute('srsName',n),'Polygon'===e.nodeName||'PolygonPatch'===e.nodeName){const r=t.getLinearRings();Pn({node:e,hasZ:i,srsName:n},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,r,o,void 0,this)}else if('Surface'===e.nodeName){const r=sn(e.namespaceURI,'patches');e.appendChild(r),this.writeSurfacePatches_(r,t,o)}},wh.prototype.RING_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.node,i=o.exteriorWritten;return void 0===i&&(o.exteriorWritten=!0),sn(r.namespaceURI,void 0===i?'outerBoundaryIs':'innerBoundaryIs')},wh.prototype.writeSurfacePatches_=function(e,t,o){const r=sn(e.namespaceURI,'PolygonPatch');e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o)},wh.prototype.writeRing_=function(e,t,o){const r=sn(e.namespaceURI,'LinearRing');e.appendChild(r),this.writeLinearRing_(r,t,o)},wh.prototype.getCoords_=function(e,t,o){let r='enu';t&&(r=vt(t).getAxisOrientation());let i='en'===r.substr(0,2)?e[0]+','+e[1]:e[1]+','+e[0];if(o){const t=e[2]||0;i+=','+t}return i},wh.prototype.writePoint_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;n&&e.setAttribute('srsName',n);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const s=t.getCoordinates(),l=this.getCoords_(s,n,i);Yn(a,l)},wh.prototype.writeMultiPoint_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;n&&e.setAttribute('srsName',n);const a=t.getPoints();Pn({node:e,hasZ:i,srsName:n},this.POINTMEMBER_SERIALIZERS_,Tn('pointMember'),a,o,void 0,this)},wh.prototype.writePointMember_=function(e,t,o){const r=sn(e.namespaceURI,'Point');e.appendChild(r),this.writePoint_(r,t,o)},wh.prototype.writeLinearRing_=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(n),this.writeCoordinates_(n,t,o)},wh.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.surface;n&&e.setAttribute('srsName',n);const s=t.getPolygons();Pn({node:e,hasZ:i,srsName:n,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},wh.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o))},wh.prototype.writeEnvelope=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=[t[0]+' '+t[1],t[2]+' '+t[3]];Pn({node:e},this.ENVELOPE_SERIALIZERS_,xh,n,o,['lowerCorner','upperCorner'],this)};const Nh={MultiLineString:'lineStringMember',MultiCurve:'curveMember',MultiPolygon:'polygonMember',MultiSurface:'surfaceMember'};wh.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t){const o=t[t.length-1].node;return sn('http://www.opengis.net/gml',Nh[o.nodeName])},wh.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{coordinates:mn(wh.prototype.readFlatCoordinates_)}},wh.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{innerBoundaryIs:wh.prototype.innerBoundaryIsParser_,outerBoundaryIs:wh.prototype.outerBoundaryIsParser_}},wh.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:yn(wh.prototype.readFlatCoordinates_)}},wh.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:mn(Lh.prototype.readPoint),MultiPoint:mn(Lh.prototype.readMultiPoint),LineString:mn(Lh.prototype.readLineString),MultiLineString:mn(Lh.prototype.readMultiLineString),LinearRing:mn(Lh.prototype.readLinearRing),Polygon:mn(Lh.prototype.readPolygon),MultiPolygon:mn(Lh.prototype.readMultiPolygon),Box:mn(wh.prototype.readBox_)}},wh.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:En(wh.prototype.writeCurveOrLineString_),MultiCurve:En(wh.prototype.writeMultiCurveOrLineString_),Point:En(wh.prototype.writePoint_),MultiPoint:En(wh.prototype.writeMultiPoint_),LineString:En(wh.prototype.writeCurveOrLineString_),MultiLineString:En(wh.prototype.writeMultiCurveOrLineString_),LinearRing:En(wh.prototype.writeLinearRing_),Polygon:En(wh.prototype.writeSurfaceOrPolygon_),MultiPolygon:En(wh.prototype.writeMultiSurfaceOrPolygon_),Surface:En(wh.prototype.writeSurfaceOrPolygon_),MultiSurface:En(wh.prototype.writeMultiSurfaceOrPolygon_),Envelope:En(wh.prototype.writeEnvelope)}},wh.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:En(wh.prototype.writeLineStringOrCurveMember_),curveMember:En(wh.prototype.writeLineStringOrCurveMember_)}},wh.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:En(wh.prototype.writeRing_),innerBoundaryIs:En(wh.prototype.writeRing_)}},wh.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:En(wh.prototype.writePointMember_)}},wh.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:En(wh.prototype.writeSurfaceOrPolygonMember_),polygonMember:En(wh.prototype.writeSurfaceOrPolygonMember_)}},wh.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:En(Yn),upperCorner:En(Yn)}};var Ah=wh;const bh=function(e){const t=e?e:{};Sh.call(this),this.defaultDataProjection=vt('EPSG:4326'),this.readExtensions_=t.readExtensions};i(bh,Sh);const Mh=[null,'http://www.topografix.com/GPX/1/0','http://www.topografix.com/GPX/1/1'],Gh={rte:Wn,trk:Kn,wpt:Hn},Dh=Cn(Mh,{rte:yn(Wn),trk:yn(Kn),wpt:yn(Hn)}),kh=Cn(Mh,{text:fn(Mn,'linkText'),type:fn(Mn,'linkType')}),Uh=Cn(Mh,{name:fn(Mn),cmt:fn(Mn),desc:fn(Mn),src:fn(Mn),link:zn,number:fn(An),extensions:Xn,type:fn(Mn),rtept:function(e,t){const o=In({},Yh,e,t);if(o){const r=t[t.length-1],i=r.flatCoordinates,n=r.layoutOptions;jn(i,n,e,o)}}}),Yh=Cn(Mh,{ele:fn(wn),time:fn(On)}),Bh=Cn(Mh,{name:fn(Mn),cmt:fn(Mn),desc:fn(Mn),src:fn(Mn),link:zn,number:fn(An),type:fn(Mn),extensions:Xn,trkseg:function(e,t){const o=t[t.length-1];Rn(jh,e,t);const r=o.flatCoordinates,i=o.ends;i.push(r.length)}}),jh=Cn(Mh,{trkpt:function(e,t){const o=In({},Vh,e,t);if(o){const r=t[t.length-1],i=r.flatCoordinates,n=r.layoutOptions;jn(i,n,e,o)}}}),Vh=Cn(Mh,{ele:fn(wn),time:fn(On)}),zh=Cn(Mh,{ele:fn(wn),time:fn(On),magvar:fn(wn),geoidheight:fn(wn),name:fn(Mn),cmt:fn(Mn),desc:fn(Mn),src:fn(Mn),link:zn,sym:fn(Mn),type:fn(Mn),fix:fn(Mn),sat:fn(An),hdop:fn(wn),vdop:fn(wn),pdop:fn(wn),ageofdgpsdata:fn(wn),dgpsid:fn(An),extensions:Xn}),Xh=['text','type'],Wh=Cn(Mh,{text:En(Yn),type:En(Yn)}),Kh=Cn(Mh,['name','cmt','desc','src','link','number','type','rtept']),Hh=Cn(Mh,{name:En(Yn),cmt:En(Yn),desc:En(Yn),src:En(Yn),link:En(Zn),number:En(Un),type:En(Yn),rtept:xn(En(qn))}),Zh=Cn(Mh,['ele','time']),qh=Cn(Mh,['name','cmt','desc','src','link','number','type','trkseg']),Jh=Cn(Mh,{name:En(Yn),cmt:En(Yn),desc:En(Yn),src:En(Yn),link:En(Zn),number:En(Un),type:En(Yn),trkseg:xn(En(function(e,t,o){const r={node:e,geometryLayout:t.getLayout(),properties:{}};Pn(r,$h,Qh,t.getCoordinates(),o)}))}),Qh=Tn('trkpt'),$h=Cn(Mh,{trkpt:En(qn)}),ef=Cn(Mh,['ele','time','magvar','geoidheight','name','cmt','desc','src','link','sym','type','fix','sat','hdop','vdop','pdop','ageofdgpsdata','dgpsid']),tf=Cn(Mh,{ele:En(kn),time:En(function(e,t){const o=new Date(1e3*t),r=o.getUTCFullYear()+'-'+re(o.getUTCMonth()+1,2)+'-'+re(o.getUTCDate(),2)+'T'+re(o.getUTCHours(),2)+':'+re(o.getUTCMinutes(),2)+':'+re(o.getUTCSeconds(),2)+'Z';e.appendChild(fh.createTextNode(r))}),magvar:En(kn),geoidheight:En(kn),name:En(Yn),cmt:En(Yn),desc:En(Yn),src:En(Yn),link:En(Zn),sym:En(Yn),type:En(Yn),fix:En(Yn),sat:En(Un),hdop:En(kn),vdop:En(kn),pdop:En(kn),ageofdgpsdata:En(kn),dgpsid:En(Un)}),of={Point:'wpt',LineString:'rte',MultiLineString:'trk'},rf=Cn(Mh,{rte:En(function(e,t,o){const r=o[0],i=t.getProperties(),n={node:e,properties:i};let a=t.getGeometry();a&&(a=Qi(a,!0,r),n.geometryLayout=a.getLayout(),i.rtept=a.getCoordinates());const s=o[o.length-1].node,l=Kh[s.namespaceURI],d=Sn(i,l);Pn(n,Hh,xh,d,o,l)}),trk:En(function(e,t,o){const r=o[0],i=t.getProperties();let n=t.getGeometry();n&&(n=Qi(n,!0,r),i.trkseg=n.getLineStrings());const a=o[o.length-1].node,s=qh[a.namespaceURI],l=Sn(i,s);Pn({node:e,properties:i},Jh,xh,l,o,s)}),wpt:En(function(e,t,o){const r=o[0],i=o[o.length-1];i.properties=t.getProperties();let n=t.getGeometry();n&&(n=Qi(n,!0,r),i.geometryLayout=n.getLayout(),qn(e,n.getCoordinates(),o))})});bh.prototype.handleReadExtensions_=function(e){e||(e=[]);for(let t=0,o=e.length;t<o;++t){const o=e[t];if(this.readExtensions_){const e=o.get('extensionsNode_')||null;this.readExtensions_(o,e)}o.set('extensionsNode_',void 0)}},bh.prototype.readFeature,bh.prototype.readFeatureFromNode=function(e,t){if(!P(Mh,e.namespaceURI))return null;const o=Gh[e.localName];if(!o)return null;const r=o(e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_([r]),r):null},bh.prototype.readFeatures,bh.prototype.readFeaturesFromNode=function(e,t){if(!P(Mh,e.namespaceURI))return[];if('gpx'==e.localName){const o=In([],Dh,e,[this.getReadOptions(e,t)]);return o?(this.handleReadExtensions_(o),o):[]}return[]},bh.prototype.readProjection,bh.prototype.writeFeatures,bh.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const o=sn('http://www.topografix.com/GPX/1/1','gpx');return o.setAttributeNS('http://www.w3.org/2000/xmlns/','xmlns:xsi',Eh),o.setAttributeNS(Eh,'xsi:schemaLocation','http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd'),o.setAttribute('version','1.1'),o.setAttribute('creator','OpenLayers'),Pn({node:o},rf,Bn,e,[t]),o};const nf=function(e){xg.call(this),this.geometries_=e?e:null,this.listenGeometriesChange_()};i(nf,xg),nf.prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)m(this.geometries_[e],zd.CHANGE,this.changed,this)},nf.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)c(this.geometries_[e],zd.CHANGE,this.changed,this)},nf.prototype.clone=function(){const e=new nf(null);return e.setGeometries(this.geometries_),e},nf.prototype.closestPointXY=function(e,t,o,r){if(r<Ie(this.getExtent(),e,t))return r;const n=this.geometries_;for(let a=0,i=n.length;a<i;++a)r=n[a].closestPointXY(e,t,o,r);return r},nf.prototype.containsXY=function(e,t){const o=this.geometries_;for(let r=0,i=o.length;r<i;++r)if(o[r].containsXY(e,t))return!0;return!1},nf.prototype.computeExtent=function(e){Ne(e);const t=this.geometries_;for(let o=0,r=t.length;o<r;++o)De(e,t[o].getExtent());return e},nf.prototype.getGeometries=function(){return Jn(this.geometries_)},nf.prototype.getGeometriesArray=function(){return this.geometries_},nf.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!=this.getRevision()&&(a(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),0>e||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];else{const o=[],r=this.geometries_;let n=!1;for(let t=0,i=r.length;t<i;++t){const i=r[t],a=i.getSimplifiedGeometry(e);o.push(a),a!==i&&(n=!0)}if(n){const e=new nf(null);return e.setGeometriesArray(o),this.simplifiedGeometryCache[t]=e,e}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}},nf.prototype.getType=function(){return $p.GEOMETRY_COLLECTION},nf.prototype.intersectsExtent=function(e){const t=this.geometries_;for(let o=0,r=t.length;o<r;++o)if(t[o].intersectsExtent(e))return!0;return!1},nf.prototype.isEmpty=function(){return 0===this.geometries_.length},nf.prototype.rotate=function(e,t){const o=this.geometries_;for(let r=0,i=o.length;r<i;++r)o[r].rotate(e,t);this.changed()},nf.prototype.scale=function(e,t,o){let r=o;r||(r=We(this.getExtent()));const n=this.geometries_;for(let a=0,i=n.length;a<i;++a)n[a].scale(e,t,r);this.changed()},nf.prototype.setGeometries=function(e){this.setGeometriesArray(Jn(e))},nf.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()},nf.prototype.applyTransform=function(e){const t=this.geometries_;for(let o=0,r=t.length;o<r;++o)t[o].applyTransform(e);this.changed()},nf.prototype.translate=function(e,t){const o=this.geometries_;for(let r=0,i=o.length;r<i;++r)o[r].translate(e,t);this.changed()},nf.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),xg.prototype.disposeInternal.call(this)};var af=nf;const sf=function(e){const t=e?e:{};lh.call(this),this.defaultDataProjection=vt(t.defaultDataProjection?t.defaultDataProjection:'EPSG:4326'),t.featureProjection&&(this.defaultFeatureProjection=vt(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName};i(sf,lh);const lf={Point:function(e){return new Lg(e.coordinates)},LineString:function(e){return new ty(e.coordinates)},Polygon:function(e){return new vg(e.coordinates)},MultiPoint:function(e){return new _h(e.coordinates)},MultiLineString:function(e){return new ph(e.coordinates)},MultiPolygon:function(e){return new ch(e.coordinates)},GeometryCollection:function(e,t){const o=e.geometries.map(function(e){return Qn(e,t)});return new af(o)}},df={Point:function(e){return{type:'Point',coordinates:e.getCoordinates()}},LineString:function(e){return{type:'LineString',coordinates:e.getCoordinates()}},Polygon:function(e,t){let o;return t&&(o=t.rightHanded),{type:'Polygon',coordinates:e.getCoordinates(o)}},MultiPoint:function(e){return{type:'MultiPoint',coordinates:e.getCoordinates()}},MultiLineString:function(e){return{type:'MultiLineString',coordinates:e.getCoordinates()}},MultiPolygon:function(e,t){let o;return t&&(o=t.rightHanded),{type:'MultiPolygon',coordinates:e.getCoordinates(o)}},GeometryCollection:function(e,t){const o=e.getGeometriesArray().map(function(e){const o=Dd({},t);return delete o.featureProjection,$n(e,o)});return{type:'GeometryCollection',geometries:o}},Circle:function(){return{type:'GeometryCollection',geometries:[]}}};sf.prototype.readFeature,sf.prototype.readFeatures,sf.prototype.readFeatureFromObject=function(e,t){let o=null;o='Feature'===e.type?e:{type:'Feature',geometry:e};const r=Qn(o.geometry,t),i=new Jc;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&void 0!==o.geometry_name&&i.setGeometryName(o.geometry_name),i.setGeometry(r),void 0!==o.id&&i.setId(o.id),o.properties&&i.setProperties(o.properties),i},sf.prototype.readFeaturesFromObject=function(e,t){let o=null;if('FeatureCollection'===e.type){o=[];const r=e.features;for(let e=0,i=r.length;e<i;++e)o.push(this.readFeatureFromObject(r[e],t))}else o=[this.readFeatureFromObject(e,t)];return o},sf.prototype.readGeometry,sf.prototype.readGeometryFromObject=function(e,t){return Qn(e,t)},sf.prototype.readProjection,sf.prototype.readProjectionFromObject=function(e){const t=e.crs;let o;return t?'name'==t.type?o=vt(t.properties.name):k(!1,36):o=this.defaultDataProjection,o},sf.prototype.writeFeature,sf.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);const o={type:'Feature'},r=e.getId();void 0!==r&&(o.id=r);const i=e.getGeometry();o.geometry=i?$n(i,t):null;const n=e.getProperties();return delete n[e.getGeometryName()],o.properties=l(n)?null:n,o},sf.prototype.writeFeatures,sf.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);const o=[];for(let r=0,i=e.length;r<i;++r)o.push(this.writeFeatureObject(e[r],t));return{type:'FeatureCollection',features:o}},sf.prototype.writeGeometry,sf.prototype.writeGeometryObject=function(e,t){return $n(e,this.adaptOptions(t))};const pf=function(){ah.call(this)};i(pf,ah),pf.prototype.getType=function(){return Ym.TEXT},pf.prototype.readFeature=function(e,t){return this.readFeatureFromText(ea(e),this.adaptOptions(t))},pf.prototype.readFeatureFromText=function(){},pf.prototype.readFeatures=function(e,t){return this.readFeaturesFromText(ea(e),this.adaptOptions(t))},pf.prototype.readFeaturesFromText=function(){},pf.prototype.readGeometry=function(e,t){return this.readGeometryFromText(ea(e),this.adaptOptions(t))},pf.prototype.readGeometryFromText=function(){},pf.prototype.readProjection=function(e){return this.readProjectionFromText(ea(e))},pf.prototype.readProjectionFromText=function(){return this.defaultDataProjection},pf.prototype.writeFeature=function(e,t){return this.writeFeatureText(e,this.adaptOptions(t))},pf.prototype.writeFeatureText=function(){},pf.prototype.writeFeatures=function(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))},pf.prototype.writeFeaturesText=function(){},pf.prototype.writeGeometry=function(e,t){return this.writeGeometryText(e,this.adaptOptions(t))},pf.prototype.writeGeometryText=function(){};var gf=pf;const _f={BAROMETRIC:'barometric',GPS:'gps',NONE:'none'},uf=function(e){const t=e?e:{};gf.call(this),this.defaultDataProjection=vt('EPSG:4326'),this.altitudeMode_=t.altitudeMode?t.altitudeMode:_f.NONE};i(uf,gf);const cf=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,yf=/^H.([A-Z]{3}).*?:(.*)/,mf=/^HFDTE(\d{2})(\d{2})(\d{2})/,hf=/\r\n|\r|\n/;uf.prototype.readFeature,uf.prototype.readFeatureFromText=function(e,t){const o=this.altitudeMode_,r=e.split(hf),n={},a=[];let s=2e3,l=0,d=1,p=-1,g,i;for(g=0,i=r.length;g<i;++g){const e=r[g];let t;if('B'!=e.charAt(0))'H'==e.charAt(0)&&(t=mf.exec(e),t?(d=parseInt(t[1],10),l=parseInt(t[2],10)-1,s=2e3+parseInt(t[3],10)):(t=yf.exec(e),t&&(n[t[1]]=t[2].trim())));else if(t=cf.exec(e),t){const e=parseInt(t[1],10),r=parseInt(t[2],10),i=parseInt(t[3],10);let n=parseInt(t[4],10)+parseInt(t[5],10)/6e4;'S'==t[6]&&(n=-n);let g=parseInt(t[7],10)+parseInt(t[8],10)/6e4;if('W'==t[9]&&(g=-g),a.push(g,n),o!=_f.NONE){let e;e=o==_f.GPS?parseInt(t[11],10):o==_f.BAROMETRIC?parseInt(t[12],10):0,a.push(e)}let _=Date.UTC(s,l,d,e,r,i);_<p&&(_=Date.UTC(s,l,d+1,e,r,i)),a.push(_/1e3),p=_}}if(0===a.length)return null;const _=new ty(null),u=o==_f.NONE?eg.XYM:eg.XYZM;_.setFlatCoordinates(u,a);const c=new Jc(Qi(_,!1,t));return c.setProperties(n),c},uf.prototype.readFeatures,uf.prototype.readFeaturesFromText=function(e,t){const o=this.readFeatureFromText(e,t);return o?[o]:[]},uf.prototype.readProjection,uf.prototype.writeFeatureText=function(){},uf.prototype.writeFeaturesText=function(){},uf.prototype.writeGeometryText=function(){},uf.prototype.readGeometryFromText=function(){};var ff={FRACTION:'fraction',PIXELS:'pixels'};const Ef=function(e,t,o,r,i,n){Vd.call(this),this.hitDetectionImage_=null,this.image_=e?e:new Image,null!==r&&(this.image_.crossOrigin=r),this.canvas_=n?document.createElement('CANVAS'):null,this.color_=n,this.imageListenerKeys_=null,this.imageState_=i,this.size_=o,this.src_=t,this.tainting_=!1,this.imageState_==tu.LOADED&&this.determineTainting_()};i(Ef,Vd),Ef.prototype.determineTainting_=function(){const e=Jo(1,1);try{e.drawImage(this.image_,0,0),e.getImageData(0,0,1,1)}catch(t){this.tainting_=!0}},Ef.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(zd.CHANGE)},Ef.prototype.handleImageError_=function(){this.imageState_=tu.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},Ef.prototype.handleImageLoad_=function(){this.imageState_=tu.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.determineTainting_(),this.replaceColor_(),this.dispatchChangeEvent_()},Ef.prototype.getImage=function(){return this.canvas_?this.canvas_:this.image_},Ef.prototype.getImageState=function(){return this.imageState_},Ef.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.tainting_){const e=this.size_[0],t=this.size_[1],o=Jo(e,t);o.fillRect(0,0,e,t),this.hitDetectionImage_=o.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},Ef.prototype.getSize=function(){return this.size_},Ef.prototype.getSrc=function(){return this.src_},Ef.prototype.load=function(){if(this.imageState_==tu.IDLE){this.imageState_=tu.LOADING,this.imageListenerKeys_=[y(this.image_,zd.ERROR,this.handleImageError_,this),y(this.image_,zd.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}},Ef.prototype.replaceColor_=function(){if(!(this.tainting_||null===this.color_)){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;const e=this.canvas_.getContext('2d');e.drawImage(this.image_,0,0);const t=e.getImageData(0,0,this.image_.width,this.image_.height),o=t.data,n=this.color_[0]/255,r=this.color_[1]/255,a=this.color_[2]/255;for(let e=0,t=o.length;e<t;e+=4)o[e]*=n,o[e+1]*=r,o[e+2]*=a;e.putImageData(t,0,0)}},Ef.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(h),this.imageListenerKeys_=null};var xf={BOTTOM_LEFT:'bottom-left',BOTTOM_RIGHT:'bottom-right',TOP_LEFT:'top-left',TOP_RIGHT:'top-right'};const Tf=function(e){const t=e||{};this.anchor_=t.anchor===void 0?[.5,.5]:t.anchor,this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin===void 0?xf.TOP_LEFT:t.anchorOrigin,this.anchorXUnits_=t.anchorXUnits===void 0?ff.FRACTION:t.anchorXUnits,this.anchorYUnits_=t.anchorYUnits===void 0?ff.FRACTION:t.anchorYUnits,this.crossOrigin_=t.crossOrigin===void 0?null:t.crossOrigin;const o=t.img===void 0?null:t.img,r=t.imgSize===void 0?null:t.imgSize;let i=t.src;k(!(i!==void 0&&o),4),k(!o||o&&r,5),(i===void 0||0===i.length)&&o&&(i=o.src||n(o).toString()),k(i!==void 0&&0<i.length,6);const a=t.src===void 0?tu.LOADED:tu.IDLE;this.color_=t.color===void 0?null:$r(t.color),this.iconImage_=ta(o,i,r,this.crossOrigin_,a,this.color_),this.offset_=t.offset===void 0?[0,0]:t.offset,this.offsetOrigin_=t.offsetOrigin===void 0?xf.TOP_LEFT:t.offsetOrigin,this.origin_=null,this.size_=t.size===void 0?null:t.size;const s=t.opacity===void 0?1:t.opacity,l=t.rotateWithView!==void 0&&t.rotateWithView,d=t.rotation===void 0?0:t.rotation,p=t.scale===void 0?1:t.scale,g=!(t.snapToPixel!==void 0)||t.snapToPixel;kc.call(this,{opacity:s,rotation:d,scale:p,snapToPixel:g,rotateWithView:l})};i(Tf,kc),Tf.prototype.clone=function(){return new Tf({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null===this.size_?void 0:this.size_.slice(),opacity:this.getOpacity(),scale:this.getScale(),snapToPixel:this.getSnapToPixel(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},Tf.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;let e=this.anchor_;const t=this.getSize();if(this.anchorXUnits_==ff.FRACTION||this.anchorYUnits_==ff.FRACTION){if(!t)return null;e=this.anchor_.slice(),this.anchorXUnits_==ff.FRACTION&&(e[0]*=t[0]),this.anchorYUnits_==ff.FRACTION&&(e[1]*=t[1])}if(this.anchorOrigin_!=xf.TOP_LEFT){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_==xf.TOP_RIGHT||this.anchorOrigin_==xf.BOTTOM_RIGHT)&&(e[0]=-e[0]+t[0]),(this.anchorOrigin_==xf.BOTTOM_LEFT||this.anchorOrigin_==xf.BOTTOM_RIGHT)&&(e[1]=-e[1]+t[1])}return this.normalizedAnchor_=e,this.normalizedAnchor_},Tf.prototype.getColor=function(){return this.color_},Tf.prototype.getImage=function(e){return this.iconImage_.getImage(e)},Tf.prototype.getImageSize=function(){return this.iconImage_.getSize()},Tf.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},Tf.prototype.getImageState=function(){return this.iconImage_.getImageState()},Tf.prototype.getHitDetectionImage=function(e){return this.iconImage_.getHitDetectionImage(e)},Tf.prototype.getOrigin=function(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!=xf.TOP_LEFT){const t=this.getSize(),o=this.iconImage_.getSize();if(!t||!o)return null;e=e.slice(),(this.offsetOrigin_==xf.TOP_RIGHT||this.offsetOrigin_==xf.BOTTOM_RIGHT)&&(e[0]=o[0]-t[0]-e[0]),(this.offsetOrigin_==xf.BOTTOM_LEFT||this.offsetOrigin_==xf.BOTTOM_RIGHT)&&(e[1]=o[1]-t[1]-e[1])}return this.origin_=e,this.origin_},Tf.prototype.getSrc=function(){return this.iconImage_.getSrc()},Tf.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},Tf.prototype.listenImageChange=function(e,t){return c(this.iconImage_,zd.CHANGE,e,t)},Tf.prototype.load=function(){this.iconImage_.load()},Tf.prototype.unlistenImageChange=function(e,t){m(this.iconImage_,zd.CHANGE,e,t)};var Sf=Tf;let Cf=null,Rf=null,If=null,Lf=null,Pf=null,vf=null,Ff,Of,wf,Nf,Af,bf,Mf,Gf,Df;const kf=function(e){const t=e?e:{};Sh.call(this),vf||oa(),this.defaultDataProjection=vt('EPSG:4326'),this.defaultStyle_=t.defaultStyle?t.defaultStyle:vf,this.extractStyles_=!(t.extractStyles!==void 0)||t.extractStyles,this.writeStyles_=!(t.writeStyles!==void 0)||t.writeStyles,this.sharedStyles_={},this.showPointNames_=!(t.showPointNames!==void 0)||t.showPointNames};i(kf,Sh);const Uf=['http://www.google.com/kml/ext/2.2'],Yf=[null,'http://earth.google.com/kml/2.0','http://earth.google.com/kml/2.1','http://earth.google.com/kml/2.2','http://www.opengis.net/kml/2.2'],Bf={fraction:ff.FRACTION,pixels:ff.PIXELS,insetPixels:ff.PIXELS},jf=Cn(Yf,{Pair:function(e,t){const o=In({},nE,e,t);if(o){const e=o.key;if(e&&'normal'==e){const e=o.styleUrl;e&&(t[t.length-1]=e);const r=o.Style;r&&(t[t.length-1]=r)}}}}),Vf=Cn(Yf,{Icon:fn(function(e,t){const o=In({},qf,e,t);return o?o:null}),heading:fn(wn),hotSpot:fn(function(e){const t=e.getAttribute('xunits'),o=e.getAttribute('yunits');let r;return r='insetPixels'===t?'insetPixels'===o?xf.TOP_RIGHT:xf.BOTTOM_RIGHT:'insetPixels'===o?xf.TOP_LEFT:xf.BOTTOM_LEFT,{x:parseFloat(e.getAttribute('x')),xunits:Bf[t],y:parseFloat(e.getAttribute('y')),yunits:Bf[o],origin:r}}),scale:fn(da)}),zf=Cn(Yf,{color:fn(aa),scale:fn(da)}),Xf=Cn(Yf,{color:fn(aa),width:fn(wn)}),Wf=Cn(Yf,{color:fn(aa),fill:fn(vn),outline:fn(vn)}),Kf=Cn(Yf,{coordinates:mn(sa)}),Hf=Cn(Uf,{Track:yn(ma)}),Zf=Cn(Yf,{when:function(e,t){const o=t[t.length-1],r=o.whens,i=ln(e,!1),n=Date.parse(i);r.push(isNaN(n)?0:n)}},Cn(Uf,{coord:function(e,t){const o=t[t.length-1],r=o.flatCoordinates,i=ln(e,!1),n=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i,a=n.exec(i);if(a){const e=parseFloat(a[1]),t=parseFloat(a[2]),o=parseFloat(a[3]);r.push(e,t,o,0)}else r.push(0,0,0,0)}})),qf=Cn(Yf,{href:fn(la)},Cn(Uf,{x:fn(wn),y:fn(wn),w:fn(wn),h:fn(wn)})),Jf=Cn(Yf,{coordinates:mn(sa)}),Qf=Cn(Yf,{extrude:fn(vn),tessellate:fn(vn),altitudeMode:fn(Mn)}),$f=Cn(Yf,{LineString:yn(fa),LinearRing:yn(Ea),MultiGeometry:yn(xa),Point:yn(Ta),Polygon:yn(Sa)}),eE=Cn(Yf,{innerBoundaryIs:function(e,t){const o=In(void 0,dE,e,t);if(o){const e=t[t.length-1];e.push(o)}},outerBoundaryIs:function(e,t){const o=In(void 0,pE,e,t);if(o){const e=t[t.length-1];e[0]=o}}}),tE=Cn(Yf,{IconStyle:ga,LabelStyle:_a,LineStyle:ua,PolyStyle:ca}),oE=Cn(Yf,{displayName:fn(Mn),value:fn(Mn)}),rE=Cn(Yf,{Data:function(e,t){const o=e.getAttribute('name');Rn(oE,e,t);const r=t[t.length-1];null===o?null!==r.displayName&&(r[r.displayName]=r.value):r[o]=r.value,delete r.value},SchemaData:function(e,t){Rn(aE,e,t)}}),iE=Cn(Yf,{LatLonAltBox:function(e,t){const o=In({},sE,e,t);if(o){const e=t[t.length-1],r=[parseFloat(o.west),parseFloat(o.south),parseFloat(o.east),parseFloat(o.north)];e.extent=r,e.altitudeMode=o.altitudeMode,e.minAltitude=parseFloat(o.minAltitude),e.maxAltitude=parseFloat(o.maxAltitude)}},Lod:function(e,t){const o=In({},lE,e,t);if(o){const e=t[t.length-1];e.minLodPixels=parseFloat(o.minLodPixels),e.maxLodPixels=parseFloat(o.maxLodPixels),e.minFadeExtent=parseFloat(o.minFadeExtent),e.maxFadeExtent=parseFloat(o.maxFadeExtent)}}}),nE=Cn(Yf,{Style:fn(Ca),key:fn(Mn),styleUrl:fn(la)}),aE=Cn(Yf,{SimpleData:function(e,t){const o=e.getAttribute('name');if(null!==o){const r=Mn(e),i=t[t.length-1];i[o]=r}}}),sE=Cn(Yf,{altitudeMode:fn(Mn),minAltitude:fn(wn),maxAltitude:fn(wn),north:fn(wn),south:fn(wn),east:fn(wn),west:fn(wn)}),lE=Cn(Yf,{minLodPixels:fn(wn),maxLodPixels:fn(wn),minFadeExtent:fn(wn),maxFadeExtent:fn(wn)}),dE=Cn(Yf,{LinearRing:mn(ya)}),pE=Cn(Yf,{LinearRing:mn(ya)}),gE=Cn(Yf,{ExtendedData:Ia,Region:La,Link:function(e,t){Rn(_E,e,t)},address:fn(Mn),description:fn(Mn),name:fn(Mn),open:fn(vn),phoneNumber:fn(Mn),visibility:fn(vn)}),_E=Cn(Yf,{href:fn(la)}),uE=Cn(Yf,{ExtendedData:Ia,Region:La,MultiGeometry:fn(xa,'geometry'),LineString:fn(fa,'geometry'),LinearRing:fn(Ea,'geometry'),Point:fn(Ta,'geometry'),Polygon:fn(Sa,'geometry'),Style:fn(Ca),StyleMap:function(e,t){const o=pa(e,t);if(o){const e=t[t.length-1];Array.isArray(o)?e.Style=o:'string'==typeof o?e.styleUrl=o:k(!1,38)}},address:fn(Mn),description:fn(Mn),name:fn(Mn),open:fn(vn),phoneNumber:fn(Mn),styleUrl:fn(la),visibility:fn(vn)},Cn(Uf,{MultiTrack:fn(function(e,t){const o=In([],Hf,e,t);if(o){const e=new ph(null);return e.setLineStrings(o),e}},'geometry'),Track:fn(ma,'geometry')}));kf.prototype.readDocumentOrFolder_=function(e,t){const o=Cn(Yf,{Document:cn(this.readDocumentOrFolder_,this),Folder:cn(this.readDocumentOrFolder_,this),Placemark:yn(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=In([],o,e,t,this);return r?r:void 0},kf.prototype.readPlacemark_=function(e,t){const o=In({geometry:null},uE,e,t);if(o){const r=new Jc,i=e.getAttribute('id');null!==i&&r.setId(i);const n=t[0],a=o.geometry;if(a&&Qi(a,!1,n),r.setGeometry(a),delete o.geometry,this.extractStyles_){const e=o.Style,t=o.styleUrl,i=ia(e,t,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(i)}return delete o.Style,r.setProperties(o),r}},kf.prototype.readSharedStyle_=function(e,t){const o=e.getAttribute('id');if(null!==o){const r=Ca(e,t);if(r){let t=e.baseURI,i;if(t&&'about:blank'!=t||(t=window.location.href),t){const e=new URL('#'+o,t);i=e.href}else i='#'+o;this.sharedStyles_[i]=r}}},kf.prototype.readSharedStyleMap_=function(e,t){const o=e.getAttribute('id');if(null===o)return;const r=pa(e,t);if(!r)return;let i=e.baseURI,n;if(i&&'about:blank'!=i||(i=window.location.href),i){const e=new URL('#'+o,i);n=e.href}else n='#'+o;this.sharedStyles_[n]=r},kf.prototype.readFeature,kf.prototype.readFeatureFromNode=function(e,t){if(!P(Yf,e.namespaceURI))return null;const o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?o:null},kf.prototype.readFeatures,kf.prototype.readFeaturesFromNode=function(e,t){if(!P(Yf,e.namespaceURI))return[];let o;const r=e.localName;if('Document'==r||'Folder'==r)return o=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),o?o:[];if('Placemark'==r){const o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?[o]:[]}if('kml'==r){o=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=this.readFeaturesFromNode(r,t);e&&O(o,e)}return o}return[]},kf.prototype.readName=function(e){if(pn(e))return this.readNameFromDocument(e);if(gn(e))return this.readNameFromNode(e);if('string'==typeof e){const t=un(e);return this.readNameFromDocument(t)}},kf.prototype.readNameFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const e=this.readNameFromNode(t);if(e)return e}},kf.prototype.readNameFromNode=function(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(P(Yf,t.namespaceURI)&&'name'==t.localName)return Mn(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const e=t.localName;if(P(Yf,t.namespaceURI)&&('Document'==e||'Folder'==e||'Placemark'==e||'kml'==e)){const e=this.readNameFromNode(t);if(e)return e}}},kf.prototype.readNetworkLinks=function(e){const t=[];if(pn(e))O(t,this.readNetworkLinksFromDocument(e));else if(gn(e))O(t,this.readNetworkLinksFromNode(e));else if('string'==typeof e){const o=un(e);O(t,this.readNetworkLinksFromDocument(o))}return t},kf.prototype.readNetworkLinksFromDocument=function(e){const t=[];for(let o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&O(t,this.readNetworkLinksFromNode(o));return t},kf.prototype.readNetworkLinksFromNode=function(e){const t=[];for(let o=e.firstElementChild;o;o=o.nextElementSibling)if(P(Yf,o.namespaceURI)&&'NetworkLink'==o.localName){const e=In({},gE,o,[]);t.push(e)}for(let o=e.firstElementChild;o;o=o.nextElementSibling){const e=o.localName;P(Yf,o.namespaceURI)&&('Document'==e||'Folder'==e||'kml'==e)&&O(t,this.readNetworkLinksFromNode(o))}return t},kf.prototype.readRegion=function(e){const t=[];if(pn(e))O(t,this.readRegionFromDocument(e));else if(gn(e))O(t,this.readRegionFromNode(e));else if('string'==typeof e){const o=un(e);O(t,this.readRegionFromDocument(o))}return t},kf.prototype.readRegionFromDocument=function(e){const t=[];for(let o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&O(t,this.readRegionFromNode(o));return t},kf.prototype.readRegionFromNode=function(e){const t=[];for(let o=e.firstElementChild;o;o=o.nextElementSibling)if(P(Yf,o.namespaceURI)&&'Region'==o.localName){const e=In({},iE,o,[]);t.push(e)}for(let o=e.firstElementChild;o;o=o.nextElementSibling){const e=o.localName;P(Yf,o.namespaceURI)&&('Document'==e||'Folder'==e||'kml'==e)&&O(t,this.readRegionFromNode(o))}return t},kf.prototype.readProjection;const cE=Cn(Yf,{Data:En(function(e,t,o){e.setAttribute('name',t.name);const r={node:e},i=t.value;'object'==typeof i?(null!==i&&i.displayName&&Pn(r,cE,xh,[i.displayName],o,['displayName']),null!==i&&i.value&&Pn(r,cE,xh,[i.value],o,['value'])):Pn(r,cE,xh,[i],o,['value'])}),value:En(function(e,t){Yn(e,t)}),displayName:En(function(e,t){Dn(e,t)})}),yE=Cn(Yf,{Placemark:En(Oa)}),mE=function(e,t){const o=t[t.length-1].node;return sn(o.namespaceURI,'Placemark')},hE=Tn('Data'),fE=Cn(Yf,['href'],Cn(Uf,['x','y','w','h'])),EE=Cn(Yf,{href:En(Yn)},Cn(Uf,{x:En(kn),y:En(kn),w:En(kn),h:En(kn)})),xE=function(e,t,o){return sn(Uf[0],'gx:'+o)},TE=Cn(Yf,['scale','heading','Icon','hotSpot']),SE=Cn(Yf,{Icon:En(function(e,t,o){const r={node:e},i=o[o.length-1].node;let n=fE[i.namespaceURI],a=Sn(t,n);Pn(r,EE,xh,a,o,n),n=fE[Uf[0]],a=Sn(t,n),Pn(r,EE,xE,a,o,n)}),heading:En(kn),hotSpot:En(function(e,t){e.setAttribute('x',t.x),e.setAttribute('y',t.y),e.setAttribute('xunits',t.xunits),e.setAttribute('yunits',t.yunits)}),scale:En(Aa)}),CE=Cn(Yf,['color','scale']),RE=Cn(Yf,{color:En(Pa),scale:En(Aa)}),IE=Cn(Yf,['color','width']),LE=Cn(Yf,{color:En(Pa),width:En(kn)}),PE={Point:'Point',LineString:'LineString',LinearRing:'LinearRing',Polygon:'Polygon',MultiPoint:'MultiGeometry',MultiLineString:'MultiGeometry',MultiPolygon:'MultiGeometry',GeometryCollection:'MultiGeometry'},vE=function(e,t){if(e){const o=t[t.length-1].node;return sn(o.namespaceURI,PE[e.getType()])}},FE=Tn('Point'),OE=Tn('LineString'),wE=Tn('LinearRing'),NE=Tn('Polygon'),AE=Cn(Yf,{LineString:En(wa),Point:En(wa),Polygon:En(Na),GeometryCollection:En(va)}),bE=Cn(Yf,{LinearRing:En(wa)}),ME=Cn(Yf,{ExtendedData:En(function(e,t,o){const r={node:e},n=t.names,a=t.values,s=n.length;for(let l=0;l<s;l++)Pn(r,cE,hE,[{name:n[l],value:a[l]}],o)}),MultiGeometry:En(va),LineString:En(wa),LinearRing:En(wa),Point:En(wa),Polygon:En(Na),Style:En(function(e,t,o){const r={},i=t.getFill(),n=t.getStroke(),a=t.getImage(),s=t.getText();a instanceof Sf&&(r.IconStyle=a),s&&(r.LabelStyle=s),n&&(r.LineStyle=n),i&&(r.PolyStyle=i);const l=o[o.length-1].node,d=XE[l.namespaceURI],p=Sn(r,d);Pn({node:e},WE,xh,p,o,d)}),address:En(Yn),description:En(Yn),name:En(Yn),open:En(Gn),phoneNumber:En(Yn),styleUrl:En(Yn),visibility:En(Gn)}),GE=Cn(Yf,['name','open','visibility','address','phoneNumber','description','styleUrl','Style']),DE=Tn('ExtendedData'),kE=Cn(Yf,['extrude','tessellate','altitudeMode','coordinates']),UE=Cn(Yf,{extrude:En(Gn),tessellate:En(Gn),altitudeMode:En(Yn),coordinates:En(function(e,t,o){const r=o[o.length-1],i=r.layout,n=r.stride;let a;i==eg.XY||i==eg.XYM?a=2:i==eg.XYZ||i==eg.XYZM?a=3:k(!1,34);const s=t.length;let l='';if(0<s){l+=t[0];for(let e=1;e<a;++e)l+=','+t[e];for(let e=n;e<s;e+=n){l+=' '+t[e];for(let o=1;o<a;++o)l+=','+t[e+o]}}Yn(e,l)})}),YE=Cn(Yf,{outerBoundaryIs:En(Fa),innerBoundaryIs:En(Fa)}),BE=Tn('innerBoundaryIs'),jE=Tn('outerBoundaryIs'),VE=Cn(Yf,{color:En(Pa)}),zE=Tn('color'),XE=Cn(Yf,['IconStyle','LabelStyle','LineStyle','PolyStyle']),WE=Cn(Yf,{IconStyle:En(function(e,t,o){const r={},i=t.getSrc(),n=t.getSize(),a=t.getImageSize(),s={href:i};if(n){s.w=n[0],s.h=n[1];const e=t.getAnchor(),o=t.getOrigin();if(o&&a&&0!==o[0]&&o[1]!==n[1]&&(s.x=o[0],s.y=a[1]-(o[1]+n[1])),e&&(e[0]!==n[0]/2||e[1]!==n[1]/2)){const t={x:e[0],xunits:ff.PIXELS,y:n[1]-e[1],yunits:ff.PIXELS};r.hotSpot=t}}r.Icon=s;const l=t.getScale();1!==l&&(r.scale=l);const d=t.getRotation();0!==d&&(r.heading=d);const p=o[o.length-1].node,g=TE[p.namespaceURI],_=Sn(r,g);Pn({node:e},SE,xh,_,o,g)}),LabelStyle:En(function(e,t,o){const r={},i=t.getFill();i&&(r.color=i.getColor());const n=t.getScale();n&&1!==n&&(r.scale=n);const a=o[o.length-1].node,s=CE[a.namespaceURI],l=Sn(r,s);Pn({node:e},RE,xh,l,o,s)}),LineStyle:En(function(e,t,o){const r={color:t.getColor(),width:t.getWidth()},i=o[o.length-1].node,n=IE[i.namespaceURI],a=Sn(r,n);Pn({node:e},LE,xh,a,o,n)}),PolyStyle:En(function(e,t,o){Pn({node:e},VE,zE,[t.getColor()],o)})}),KE=Cn(Yf,['Document','Placemark']),HE=Cn(Yf,{Document:En(function(e,t,o){Pn({node:e},yE,mE,t,o,void 0,this)}),Placemark:En(Oa)});kf.prototype.writeFeatures,kf.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const o=sn(Yf[4],'kml'),r='http://www.w3.org/2000/xmlns/';o.setAttributeNS(r,'xmlns:gx',Uf[0]),o.setAttributeNS(r,'xmlns:xsi',Eh),o.setAttributeNS(Eh,'xsi:schemaLocation','http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd');const i={};1<e.length?i.Document=e:1==e.length&&(i.Placemark=e[0]);const n=KE[o.namespaceURI],a=Sn(i,n);return Pn({node:o},HE,xh,a,[t],n,this),o};var ZE=o(3),qE=o.n(ZE);const JE=function(e,t,o,r,i){this.extent_,this.id_=i,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=o,this.properties_=r},QE=Yt();JE.prototype.get=function(e){return this.properties_[e]},JE.prototype.getEnds=JE.prototype.getEndss=function(){return this.ends_},JE.prototype.getExtent=function(){return this.extent_||(this.extent_=this.type_===$p.POINT?Ae(this.flatCoordinates_):Me(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},JE.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){const e=We(this.getExtent());this.flatInteriorPoints_=Fo(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_},JE.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){const e=en(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Oo(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_},JE.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=Pi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},JE.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const o=this.ends_;for(let r=0,i=o.length;r<i;++r){const i=o[r],n=Pi(e,t,i,2,.5);O(this.flatMidpoints_,n),t=i}}return this.flatMidpoints_},JE.prototype.getId=function(){return this.id_},JE.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},JE.prototype.getFlatCoordinates=JE.prototype.getOrientedFlatCoordinates,JE.prototype.getGeometry=function(){return this},JE.prototype.getProperties=function(){return this.properties_},JE.prototype.getSimplifiedGeometry=JE.prototype.getGeometry,JE.prototype.getStride=function(){return 2},JE.prototype.getStyleFunction=T,JE.prototype.getType=function(){return this.type_},JE.prototype.transform=function(e){const t=e.getExtent(),o=e.getWorldExtent(),r=Ze(o)/Ze(t);Zt(QE,o[0],o[3],r,-r,0,0,0),at(this.flatCoordinates_,0,this.flatCoordinates_.length,2,QE,this.flatCoordinates_)};var $E=JE;const ex=function(e){ah.call(this);const t=e?e:{};this.defaultDataProjection=new ag({code:'',units:ig.TILE_PIXELS}),this.featureClass_=t.featureClass?t.featureClass:$E,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:'layer',this.layers_=t.layers?t.layers:null,this.extent_=null};i(ex,ah),ex.prototype.readRawGeometry_=function(e,t,o,r){e.pos=t.geometry;const i=e.readVarint()+e.pos;let n=1,a=0,s=0,l=0,d=0,p=0;for(;e.pos<i;){if(!a){const t=e.readVarint();n=7&t,a=t>>3}a--,1==n||2==n?(s+=e.readSVarint(),l+=e.readSVarint(),1==n&&d>p&&(r.push(d),p=d),o.push(s,l),d+=2):7==n?d>p&&(o.push(o[p],o[p+1]),d+=2):k(!1,59)}d>p&&(r.push(d),p=d)},ex.prototype.createFeature_=function(e,t,o){const r=t.type;if(0===r)return null;let i;const n=t.id,a=t.properties;a[this.layerName_]=t.layer.name;const s=[];let l=[];this.readRawGeometry_(e,t,s,l);const d=ka(r,l.length);if(this.featureClass_===$E)i=new this.featureClass_(d,s,l,a,n);else{let e;if(d==$p.POLYGON){const t=[];let o=0,r=0;for(let e=0,i=l.length;e<i;++e){const i=l[e];ko(s,o,i,2)||(t.push(l.slice(r,e)),r=e),o=i}1<t.length?(l=t,e=new ch(null)):e=new vg(null)}else e=d===$p.POINT?new Lg(null):d===$p.LINE_STRING?new ty(null):d===$p.POLYGON?new vg(null):d===$p.MULTI_POINT?new _h(null):d===$p.MULTI_LINE_STRING?new ph(null):null;e.setFlatCoordinates(eg.XY,s,l),i=new this.featureClass_,this.geometryName_&&i.setGeometryName(this.geometryName_);const t=Qi(e,!1,this.adaptOptions(o));i.setGeometry(t),i.setId(n),i.setProperties(a)}return i},ex.prototype.getLastExtent=function(){return this.extent_},ex.prototype.getType=function(){return Ym.ARRAY_BUFFER},ex.prototype.readFeatures=function(e){const t=this.layers_,o=new qE.a(e),r=o.readFields(ba,{}),n=[];for(const i in r){if(t&&-1==t.indexOf(i))continue;const e=r[i];for(let t=0,r=e.length;t<r;++t){const r=Da(o,e,t);n.push(this.createFeature_(o,r))}this.extent_=e?[0,0,e.extent,e.extent]:null}return n},ex.prototype.readProjection=function(){return this.defaultDataProjection},ex.prototype.setLayers=function(e){this.layers_=e},ex.prototype.readFeature=function(){},ex.prototype.readGeometry=function(){},ex.prototype.writeFeature=function(){},ex.prototype.writeGeometry=function(){},ex.prototype.writeFeatures=function(){};const tx=function(){Sh.call(this),this.defaultDataProjection=vt('EPSG:4326')};i(tx,Sh);const ox=[null],rx=Cn(ox,{nd:function(e,t){const o=t[t.length-1];o.ndrefs.push(e.getAttribute('ref'))},tag:Ua}),ix=Cn(ox,{node:function(e,t){const o=t[0],r=t[t.length-1],i=e.getAttribute('id'),n=[parseFloat(e.getAttribute('lon')),parseFloat(e.getAttribute('lat'))];r.nodes[i]=n;const a=In({tags:{}},nx,e,t);if(!l(a.tags)){const e=new Lg(n);Qi(e,!1,o);const t=new Jc(e);t.setId(i),t.setProperties(a.tags),r.features.push(t)}},way:function(e,t){const o=e.getAttribute('id'),r=In({id:o,ndrefs:[],tags:{}},rx,e,t),i=t[t.length-1];i.ways.push(r)}}),nx=Cn(ox,{tag:Ua});tx.prototype.readFeatures,tx.prototype.readFeaturesFromNode=function(e,t){const o=this.getReadOptions(e,t);if('osm'==e.localName){const t=In({nodes:{},ways:[],features:[]},ix,e,[o]);for(let e=0;e<t.ways.length;e++){const r=t.ways[e],n=[];for(let e=0,o=r.ndrefs.length;e<o;e++){const o=t.nodes[r.ndrefs[e]];O(n,o)}let i;r.ndrefs[0]==r.ndrefs[r.ndrefs.length-1]?(i=new vg(null),i.setFlatCoordinates(eg.XY,n,[n.length])):(i=new ty(null),i.setFlatCoordinates(eg.XY,n)),Qi(i,!1,o);const a=new Jc(i);a.setId(r.id),a.setProperties(r.tags),t.features.push(a)}if(t.features)return t.features}return[]},tx.prototype.readProjection,tx.prototype.writeFeatureNode=function(){},tx.prototype.writeFeaturesNode=function(){},tx.prototype.writeGeometryNode=function(){};const ax=function(e){const t=e?e:{};gf.call(this),this.defaultDataProjection=vt('EPSG:4326'),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:eg.XY};i(ax,gf),ax.prototype.readFeature,ax.prototype.readFeatureFromText=function(e,t){const o=this.readGeometryFromText(e,t);return new Jc(o)},ax.prototype.readFeatures,ax.prototype.readFeaturesFromText=function(e,t){const o=this.readFeatureFromText(e,t);return[o]},ax.prototype.readGeometry,ax.prototype.readGeometryFromText=function(e,t){const o=$t(this.geometryLayout_),r=ja(e,o,this.factor_);Ya(r,0,r.length,o,r);const i=mo(r,0,r.length,o);return Qi(new ty(i,this.geometryLayout_),!1,this.adaptOptions(t))},ax.prototype.readProjection,ax.prototype.writeFeatureText=function(e,t){const o=e.getGeometry();return o?this.writeGeometryText(o,t):(k(!1,40),'')},ax.prototype.writeFeaturesText=function(e,t){return this.writeFeatureText(e[0],t)},ax.prototype.writeGeometry,ax.prototype.writeGeometryText=function(e,t){e=Qi(e,!0,this.adaptOptions(t));const o=e.getFlatCoordinates(),r=e.getStride();return Ya(o,0,o.length,r,o),Ba(o,r,this.factor_)};const sx=function(e){const t=e?e:{};lh.call(this),this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.defaultDataProjection=vt(t.defaultDataProjection?t.defaultDataProjection:'EPSG:4326')};i(sx,lh);const lx={Point:function(e,t,o){const r=e.coordinates;return t&&o&&ts(r,t,o),new Lg(r)},LineString:function(e,t){const o=qa(e.arcs,t);return new ty(o)},Polygon:function(e,t){const o=[];for(let r=0,i=e.arcs.length;r<i;++r)o[r]=qa(e.arcs[r],t);return new vg(o)},MultiPoint:function(e,t,o){const r=e.coordinates;if(t&&o)for(let e=0,i=r.length;e<i;++e)ts(r[e],t,o);return new _h(r)},MultiLineString:function(e,t){const o=[];for(let r=0,i=e.arcs.length;r<i;++r)o[r]=qa(e.arcs[r],t);return new ph(o)},MultiPolygon:function(e,t){const o=[];for(let r=0,i=e.arcs.length;r<i;++r){const i=e.arcs[r],n=[];for(let e=0,o=i.length;e<o;++e)n[e]=qa(i[e],t);o[r]=n}return new ch(o)}};sx.prototype.readFeatures,sx.prototype.readFeaturesFromObject=function(e,t){if('Topology'==e.type){const o=e;let r=null,i=null,n;o.transform&&(n=o.transform,r=n.scale,i=n.translate);const a=o.arcs;n&&$a(a,r,i);const s=[],l=o.objects,d=this.layerName_;let p;for(const e in l)this.layers_&&-1==this.layers_.indexOf(e)||('GeometryCollection'===l[e].type?(p=l[e],s.push.apply(s,Ja(p,a,r,i,d,e,t))):(p=l[e],s.push(Qa(p,a,r,i,d,e,t))));return s}return[]},sx.prototype.readProjection,sx.prototype.readProjectionFromObject=function(){return this.defaultDataProjection},sx.prototype.writeFeatureObject=function(){},sx.prototype.writeFeaturesObject=function(){},sx.prototype.writeGeometryObject=function(){},sx.prototype.readGeometryFromObject=function(){},sx.prototype.readFeatureFromObject=function(){};const dx=function(e){this.tagName_=e};dx.prototype.getTagName=function(){return this.tagName_};var px=dx;const gx=function(e){px.call(this,e),this.conditions=Array.prototype.slice.call(arguments,1),k(2<=this.conditions.length,57)};i(gx,px);var _x=gx;const ux=function(){const e=['And'].concat(Array.prototype.slice.call(arguments));_x.apply(this,e)};i(ux,_x);var cx=ux;const yx=function(e,t,o){px.call(this,'BBOX'),this.geometryName=e,this.extent=t,this.srsName=o};i(yx,px);var mx=yx;const hx=function(e,t,o,r){px.call(this,e),this.geometryName=t||'the_geom',this.geometry=o,this.srsName=r};i(hx,px);var fx=hx;const Ex=function(e,t,o){fx.call(this,'Contains',e,t,o)};i(Ex,fx);var xx=Ex;const Tx=function(e,t){px.call(this,e),this.propertyName=t};i(Tx,px);var Sx=Tx;const Cx=function(e,t,o){Sx.call(this,'During',e),this.begin=t,this.end=o};i(Cx,Sx);var Rx=Cx;const Ix=function(e,t,o,r){Sx.call(this,e,t),this.expression=o,this.matchCase=r};i(Ix,Sx);var Lx=Ix;const Px=function(e,t,o){Lx.call(this,'PropertyIsEqualTo',e,t,o)};i(Px,Lx);var vx=Px;const Fx=function(e,t){Lx.call(this,'PropertyIsGreaterThan',e,t)};i(Fx,Lx);var Ox=Fx;const wx=function(e,t){Lx.call(this,'PropertyIsGreaterThanOrEqualTo',e,t)};i(wx,Lx);var Nx=wx;const Ax=function(e,t,o){fx.call(this,'Intersects',e,t,o)};i(Ax,fx);var bx=Ax;const Mx=function(e,t,o){Sx.call(this,'PropertyIsBetween',e),this.lowerBoundary=t,this.upperBoundary=o};i(Mx,Sx);var Gx=Mx;const Dx=function(e,t,o,r,i,n){Sx.call(this,'PropertyIsLike',e),this.pattern=t,this.wildCard=o===void 0?'*':o,this.singleChar=r===void 0?'.':r,this.escapeChar=i===void 0?'!':i,this.matchCase=n};i(Dx,Sx);var kx=Dx;const Ux=function(e){Sx.call(this,'PropertyIsNull',e)};i(Ux,Sx);var Yx=Ux;const Bx=function(e,t){Lx.call(this,'PropertyIsLessThan',e,t)};i(Bx,Lx);var jx=Bx;const Vx=function(e,t){Lx.call(this,'PropertyIsLessThanOrEqualTo',e,t)};i(Vx,Lx);var zx=Vx;const Xx=function(e){px.call(this,'Not'),this.condition=e};i(Xx,px);var Wx=Xx;const Kx=function(e,t,o){Lx.call(this,'PropertyIsNotEqualTo',e,t,o)};i(Kx,Lx);var Hx=Kx;const Zx=function(){const e=['Or'].concat(Array.prototype.slice.call(arguments));_x.apply(this,e)};i(Zx,_x);var Or=Zx;const qx=function(e,t,o){fx.call(this,'Within',e,t,o)};i(qx,fx);var Jx=qx;const Qx='feature',$x='http://www.w3.org/2000/xmlns/',eT='http://www.opengis.net/ogc',tT='http://www.opengis.net/wfs',oT={"1.1.0":'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd',"1.0.0":'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd'},rT='1.1.0',iT=function(e){const t=e?e:{};this.featureType_=t.featureType,this.featureNS_=t.featureNS,this.gmlFormat_=t.gmlFormat?t.gmlFormat:new Fh,this.schemaLocation_=t.schemaLocation?t.schemaLocation:oT[rT],Sh.call(this)};i(iT,Sh),iT.prototype.getFeatureType=function(){return this.featureType_},iT.prototype.setFeatureType=function(e){this.featureType_=e},iT.prototype.readFeatures,iT.prototype.readFeaturesFromNode=function(e,t){const o={featureType:this.featureType_,featureNS:this.featureNS_};Dd(o,this.getReadOptions(e,t?t:{}));this.gmlFormat_.FEATURE_COLLECTION_PARSERS[Ch].featureMember=yn(Lh.prototype.readFeaturesInternal);let r=In([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[o],this.gmlFormat_);return r||(r=[]),r},iT.prototype.readTransactionResponse=function(e){if(pn(e))return this.readTransactionResponseFromDocument(e);if(gn(e))return this.readTransactionResponseFromNode(e);if('string'==typeof e){const t=un(e);return this.readTransactionResponseFromDocument(t)}},iT.prototype.readFeatureCollectionMetadata=function(e){if(pn(e))return this.readFeatureCollectionMetadataFromDocument(e);if(gn(e))return this.readFeatureCollectionMetadataFromNode(e);if('string'==typeof e){const t=un(e);return this.readFeatureCollectionMetadataFromDocument(t)}},iT.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)};const nT={"http://www.opengis.net/gml":{boundedBy:fn(Lh.prototype.readGeometryElement,'bounds')}};iT.prototype.readFeatureCollectionMetadataFromNode=function(e){const t={},o=bn(e.getAttribute('numberOfFeatures'));return t.numberOfFeatures=o,In(t,nT,e,[],this.gmlFormat_)};const aT={"http://www.opengis.net/wfs":{totalInserted:fn(An),totalUpdated:fn(An),totalDeleted:fn(An)}},sT={"http://www.opengis.net/ogc":{FeatureId:yn(function(e){return e.getAttribute('fid')})}},lT={"http://www.opengis.net/wfs":{Feature:function(e,t){Rn(sT,e,t)}}},dT={"http://www.opengis.net/wfs":{TransactionSummary:fn(function(e,t){return In({},aT,e,t)},'transactionSummary'),InsertResults:fn(function(e,t){return In([],lT,e,t)},'insertIds')}};iT.prototype.readTransactionResponseFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)},iT.prototype.readTransactionResponseFromNode=function(e){return In({},dT,e,[])};const pT={"http://www.opengis.net/wfs":{PropertyName:En(Yn)}},gT={"http://www.opengis.net/wfs":{Insert:En(function(e,t,o){const r=o[o.length-1],i=r.featureType,n=r.featureNS,a=r.gmlVersion,s=sn(n,i);e.appendChild(s),2===a?Ah.prototype.writeFeatureElement(s,t,o):Fh.prototype.writeFeatureElement(s,t,o)}),Update:En(function(e,t,o){const r=o[o.length-1];k(t.getId()!==void 0,27);const i=r.featureType,n=r.featurePrefix,a=r.featureNS,s=ns(n,i),l=t.getGeometryName();e.setAttribute('typeName',s),e.setAttributeNS($x,'xmlns:'+n,a);const d=t.getId();if(d!==void 0){const n=t.getKeys(),a=[];for(let e=0,o=n.length;e<o;e++){const o=t.get(n[e]);if(o!==void 0){let t=n[e];o instanceof xg&&(t=l),a.push({name:t,value:o})}}Pn({gmlVersion:r.gmlVersion,node:e,hasZ:r.hasZ,srsName:r.srsName},gT,Tn('Property'),a,o),is(e,d,o)}}),Delete:En(function(e,t,o){const r=o[o.length-1];k(t.getId()!==void 0,26);const i=r.featureType,n=r.featurePrefix,a=r.featureNS,s=ns(n,i);e.setAttribute('typeName',s),e.setAttributeNS($x,'xmlns:'+n,a);const l=t.getId();l!==void 0&&is(e,l,o)}),Property:En(function(e,t,o){const r=sn(tT,'Name'),i=o[o.length-1],n=i.gmlVersion;if(e.appendChild(r),Yn(r,t.name),void 0!==t.value&&null!==t.value){const r=sn(tT,'Value');e.appendChild(r),t.value instanceof xg?2===n?Ah.prototype.writeGeometryElement(r,t.value,o):Fh.prototype.writeGeometryElement(r,t.value,o):Yn(r,t.value)}}),Native:En(function(e,t){t.vendorId&&e.setAttribute('vendorId',t.vendorId),t.safeToIgnore!==void 0&&e.setAttribute('safeToIgnore',t.safeToIgnore),t.value!==void 0&&Yn(e,t.value)})}},_T={"http://www.opengis.net/wfs":{Query:En(function(e,t,o){const r=o[o.length-1],i=r.featurePrefix,n=r.featureNS,a=r.propertyNames,s=r.srsName;let l;l=i?ns(i,t):t,e.setAttribute('typeName',l),s&&e.setAttribute('srsName',s),n&&e.setAttributeNS($x,'xmlns:'+i,n);const d=Dd({},r);d.node=e,Pn(d,pT,Tn('PropertyName'),a,o);const p=r.filter;if(p){const t=sn(eT,'Filter');e.appendChild(t),as(t,p,o)}})},"http://www.opengis.net/ogc":{During:En(function(e,t){const o=sn('http://www.opengis.net/fes','ValueReference');Yn(o,t.propertyName),e.appendChild(o);const r=sn(Ch,'TimePeriod');e.appendChild(r);const i=sn(Ch,'begin');r.appendChild(i),_s(i,t.begin);const n=sn(Ch,'end');r.appendChild(n),_s(n,t.end)}),And:En(ss),Or:En(ss),Not:En(function(e,t,o){const r=t.condition;Pn({node:e},_T,Tn(r.getTagName()),[r],o)}),BBOX:En(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,ps(e,t.geometryName),Fh.prototype.writeGeometryElement(e,t.extent,o)}),Contains:En(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,ps(e,t.geometryName),Fh.prototype.writeGeometryElement(e,t.geometry,o)}),Intersects:En(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,ps(e,t.geometryName),Fh.prototype.writeGeometryElement(e,t.geometry,o)}),Within:En(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,ps(e,t.geometryName),Fh.prototype.writeGeometryElement(e,t.geometry,o)}),PropertyIsEqualTo:En(ls),PropertyIsNotEqualTo:En(ls),PropertyIsLessThan:En(ls),PropertyIsLessThanOrEqualTo:En(ls),PropertyIsGreaterThan:En(ls),PropertyIsGreaterThanOrEqualTo:En(ls),PropertyIsNull:En(function(e,t){ps(e,t.propertyName)}),PropertyIsBetween:En(function(e,t){ps(e,t.propertyName);const o=sn(eT,'LowerBoundary');e.appendChild(o),gs(o,''+t.lowerBoundary);const r=sn(eT,'UpperBoundary');e.appendChild(r),gs(r,''+t.upperBoundary)}),PropertyIsLike:En(function(e,t){e.setAttribute('wildCard',t.wildCard),e.setAttribute('singleChar',t.singleChar),e.setAttribute('escapeChar',t.escapeChar),t.matchCase!==void 0&&e.setAttribute('matchCase',t.matchCase.toString()),ps(e,t.propertyName),gs(e,''+t.pattern)})}};iT.prototype.writeGetFeature=function(e){const t=sn(tT,'GetFeature');t.setAttribute('service','WFS'),t.setAttribute('version','1.1.0');let o;if(e&&(e.handle&&t.setAttribute('handle',e.handle),e.outputFormat&&t.setAttribute('outputFormat',e.outputFormat),void 0!==e.maxFeatures&&t.setAttribute('maxFeatures',e.maxFeatures),e.resultType&&t.setAttribute('resultType',e.resultType),void 0!==e.startIndex&&t.setAttribute('startIndex',e.startIndex),void 0!==e.count&&t.setAttribute('count',e.count),o=e.filter,e.bbox)){k(e.geometryName,12);const t=rs(e.geometryName,e.bbox,e.srsName);o=o?os(o,t):t}t.setAttributeNS(Eh,'xsi:schemaLocation',this.schemaLocation_);const r={node:t,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,geometryName:e.geometryName,filter:o,propertyNames:e.propertyNames?e.propertyNames:[]};return k(Array.isArray(e.featureTypes),11),us(t,e.featureTypes,[r]),t},iT.prototype.writeTransaction=function(e,t,o,r){const i=[],n=sn(tT,'Transaction'),a=r.version?r.version:rT,s='1.0.0'===a?2:3;n.setAttribute('service','WFS'),n.setAttribute('version',a);let l,d;r&&(l=r.gmlOptions?r.gmlOptions:{},r.handle&&n.setAttribute('handle',r.handle));const p=oT[a];n.setAttributeNS(Eh,'xsi:schemaLocation',p);const g=r.featurePrefix?r.featurePrefix:Qx;return e&&(d={node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},Dd(d,l),Pn(d,gT,Tn('Insert'),e,i)),t&&(d={node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},Dd(d,l),Pn(d,gT,Tn('Update'),t,i)),o&&Pn({node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,srsName:r.srsName},gT,Tn('Delete'),o,i),r.nativeElements&&Pn({node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,srsName:r.srsName},gT,Tn('Native'),r.nativeElements,i),n},iT.prototype.readProjection,iT.prototype.readProjectionFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null},iT.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){const e=[{}];return this.gmlFormat_.readGeometryElement(t,e),vt(e.pop().srsName)}}return null};const uT='EMPTY',cT='Z',Z='M',M={TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},yT=function(e){this.wkt=e,this.index_=-1};yT.prototype.isAlpha_=function(e){return'a'<=e&&'z'>=e||'A'<=e&&'Z'>=e},yT.prototype.isNumeric_=function(e,t){return'0'<=e&&'9'>=e||'.'==e&&!(t!==void 0&&t)},yT.prototype.isWhiteSpace_=function(e){return' '==e||'\t'==e||'\r'==e||'\n'==e},yT.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},yT.prototype.nextToken=function(){const e=this.nextChar_(),t={position:this.index_,value:e};if('('==e)t.type=M.LEFT_PAREN;else if(','==e)t.type=M.COMMA;else if(')'==e)t.type=M.RIGHT_PAREN;else if(this.isNumeric_(e)||'-'==e)t.type=M.NUMBER,t.value=this.readNumber_();else if(this.isAlpha_(e))t.type=M.TEXT,t.value=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(''===e)t.type=M.EOF;else throw new Error('Unexpected character: '+e)}return t},yT.prototype.readNumber_=function(){let e;const t=this.index_;let o=!1,r=!1;do'.'==e?o=!0:('e'==e||'E'==e)&&(r=!0),e=this.nextChar_();while(this.isNumeric_(e,o)||!r&&('e'==e||'E'==e)||r&&('-'==e||'+'==e));return parseFloat(this.wkt.substring(t,this.index_--))},yT.prototype.readText_=function(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()};const mT=function(e){this.lexer_=e,this.token_,this.layout_=eg.XY};mT.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},mT.prototype.isTokenType=function(e){const t=this.token_.type==e;return t},mT.prototype.match=function(e){const t=this.isTokenType(e);return t&&this.consume_(),t},mT.prototype.parse=function(){this.consume_();const e=this.parseGeometry_();return e},mT.prototype.parseGeometryLayout_=function(){let e=eg.XY;const t=this.token_;if(this.isTokenType(M.TEXT)){const o=t.value;o===cT?e=eg.XYZ:o===Z?e=eg.XYM:o==='ZM'&&(e=eg.XYZM),e!==eg.XY&&this.consume_()}return e},mT.prototype.parseGeometryCollectionText_=function(){if(this.match(M.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(M.COMMA));if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},mT.prototype.parsePointText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())},mT.prototype.parseLineStringText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},mT.prototype.parsePolygonText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},mT.prototype.parseMultiPointText_=function(){if(this.match(M.LEFT_PAREN)){let e;if(e=this.token_.type==M.LEFT_PAREN?this.parsePointTextList_():this.parsePointList_(),this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},mT.prototype.parseMultiLineStringText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},mT.prototype.parseMultiPolygonText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},mT.prototype.parsePoint_=function(){const e=[],t=this.layout_.length;for(let o=0;o<t;++o){const t=this.token_;if(this.match(M.NUMBER))e.push(t.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())},mT.prototype.parsePointList_=function(){const e=[this.parsePoint_()];for(;this.match(M.COMMA);)e.push(this.parsePoint_());return e},mT.prototype.parsePointTextList_=function(){const e=[this.parsePointText_()];for(;this.match(M.COMMA);)e.push(this.parsePointText_());return e},mT.prototype.parseLineStringTextList_=function(){const e=[this.parseLineStringText_()];for(;this.match(M.COMMA);)e.push(this.parseLineStringText_());return e},mT.prototype.parsePolygonTextList_=function(){const e=[this.parsePolygonText_()];for(;this.match(M.COMMA);)e.push(this.parsePolygonText_());return e},mT.prototype.isEmptyGeometry_=function(){const e=this.isTokenType(M.TEXT)&&this.token_.value==uT;return e&&this.consume_(),e},mT.prototype.formatErrorMessage_=function(){return'Unexpected `'+this.token_.value+'` at position '+this.token_.position+' in `'+this.lexer_.wkt+'`'};const hT=function(e){const t=e?e:{};gf.call(this),this.splitCollection_=t.splitCollection!==void 0&&t.splitCollection};i(hT,gf);const fT={Point:cs,LineString:ys,Polygon:ms,MultiPoint:function(e){const t=[],o=e.getPoints();for(let r=0,i=o.length;r<i;++r)t.push('('+cs(o[r])+')');return t.join(',')},MultiLineString:function(e){const t=[],o=e.getLineStrings();for(let r=0,i=o.length;r<i;++r)t.push('('+ys(o[r])+')');return t.join(',')},MultiPolygon:function(e){const t=[],o=e.getPolygons();for(let r=0,i=o.length;r<i;++r)t.push('('+ms(o[r])+')');return t.join(',')},GeometryCollection:function(e){const t=[],o=e.getGeometries();for(let r=0,i=o.length;r<i;++r)t.push(fs(o[r]));return t.join(',')}};hT.prototype.parse_=function(e){const t=new yT(e),o=new mT(t);return o.parse()},hT.prototype.readFeature,hT.prototype.readFeatureFromText=function(e,t){const o=this.readGeometryFromText(e,t);if(o){const e=new Jc;return e.setGeometry(o),e}return null},hT.prototype.readFeatures,hT.prototype.readFeaturesFromText=function(e,t){let o=[];const r=this.readGeometryFromText(e,t);o=this.splitCollection_&&r.getType()==$p.GEOMETRY_COLLECTION?r.getGeometriesArray():[r];const n=[];for(let r=0,i=o.length;r<i;++r){const e=new Jc;e.setGeometry(o[r]),n.push(e)}return n},hT.prototype.readGeometry,hT.prototype.readGeometryFromText=function(e,t){const o=this.parse_(e);return o?Qi(o,!1,t):null};const ET={POINT:Lg,LINESTRING:ty,POLYGON:vg,MULTIPOINT:_h,MULTILINESTRING:ph,MULTIPOLYGON:ch},xT={POINT:mT.prototype.parsePointText_,LINESTRING:mT.prototype.parseLineStringText_,POLYGON:mT.prototype.parsePolygonText_,MULTIPOINT:mT.prototype.parseMultiPointText_,MULTILINESTRING:mT.prototype.parseMultiLineStringText_,MULTIPOLYGON:mT.prototype.parseMultiPolygonText_};mT.prototype.parseGeometry_=function(){const e=this.token_;if(this.match(M.TEXT)){const t=e.value;if(this.layout_=this.parseGeometryLayout_(),t==$p.GEOMETRY_COLLECTION.toUpperCase()){const e=this.parseGeometryCollectionText_();return new af(e)}else{const e=xT[t],o=ET[t];if(!e||!o)throw new Error('Invalid geometry type: '+t);const r=e.call(this);return new o(r,this.layout_)}}throw new Error(this.formatErrorMessage_())},hT.prototype.writeFeature,hT.prototype.writeFeatureText=function(e,t){const o=e.getGeometry();return o?this.writeGeometryText(o,t):''},hT.prototype.writeFeatures,hT.prototype.writeFeaturesText=function(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);const o=[];for(let r=0,i=e.length;r<i;++r)o.push(e[r].getGeometry());const r=new af(o);return this.writeGeometryText(r,t)},hT.prototype.writeGeometry,hT.prototype.writeGeometryText=function(e,t){return fs(Qi(e,!0,t))};const TT='http://www.w3.org/1999/xlink',ST=function(){};ST.prototype.read=function(e){if(pn(e))return this.readFromDocument(e);if(gn(e))return this.readFromNode(e);if('string'==typeof e){const t=un(e);return this.readFromDocument(t)}return null},ST.prototype.readFromDocument=function(){},ST.prototype.readFromNode=function(){};var CT=ST;const RT=function(){CT.call(this),this.version=void 0};i(RT,CT);const IT=[null,'http://www.opengis.net/wms'],LT=Cn(IT,{Service:fn(function(e,t){return In({},vT,e,t)}),Capability:fn(function(e,t){return In({},PT,e,t)})}),PT=Cn(IT,{Request:fn(function(e,t){return In({},GT,e,t)}),Exception:fn(function(e,t){return In([],NT,e,t)}),Layer:fn(function(e,t){return In({},AT,e,t)})}),vT=Cn(IT,{Name:fn(Mn),Title:fn(Mn),Abstract:fn(Mn),KeywordList:fn(Cs),OnlineResource:fn(Es),ContactInformation:fn(function(e,t){return In({},FT,e,t)}),Fees:fn(Mn),AccessConstraints:fn(Mn),LayerLimit:fn(An),MaxWidth:fn(An),MaxHeight:fn(An)}),FT=Cn(IT,{ContactPersonPrimary:fn(function(e,t){return In({},OT,e,t)}),ContactPosition:fn(Mn),ContactAddress:fn(function(e,t){return In({},wT,e,t)}),ContactVoiceTelephone:fn(Mn),ContactFacsimileTelephone:fn(Mn),ContactElectronicMailAddress:fn(Mn)}),OT=Cn(IT,{ContactPerson:fn(Mn),ContactOrganization:fn(Mn)}),wT=Cn(IT,{AddressType:fn(Mn),Address:fn(Mn),City:fn(Mn),StateOrProvince:fn(Mn),PostCode:fn(Mn),Country:fn(Mn)}),NT=Cn(IT,{Format:yn(Mn)}),AT=Cn(IT,{Name:fn(Mn),Title:fn(Mn),Abstract:fn(Mn),KeywordList:fn(Cs),CRS:hn(Mn),EX_GeographicBoundingBox:fn(function(e,t){const o=In({},MT,e,t);if(o){const e=o.westBoundLongitude,t=o.southBoundLatitude,r=o.eastBoundLongitude,i=o.northBoundLatitude;return void 0===e||void 0===t||void 0===r||void 0===i?void 0:[e,t,r,i]}}),BoundingBox:hn(function(e){const t=[Nn(e.getAttribute('minx')),Nn(e.getAttribute('miny')),Nn(e.getAttribute('maxx')),Nn(e.getAttribute('maxy'))],o=[Nn(e.getAttribute('resx')),Nn(e.getAttribute('resy'))];return{crs:e.getAttribute('CRS'),extent:t,res:o}}),Dimension:hn(function(e){const t={name:e.getAttribute('name'),units:e.getAttribute('units'),unitSymbol:e.getAttribute('unitSymbol'),default:e.getAttribute('default'),multipleValues:Fn(e.getAttribute('multipleValues')),nearestValue:Fn(e.getAttribute('nearestValue')),current:Fn(e.getAttribute('current')),values:Mn(e)};return t}),Attribution:fn(function(e,t){return In({},bT,e,t)}),AuthorityURL:hn(function(e,t){const o=xs(e,t);return o?(o.name=e.getAttribute('name'),o):void 0}),Identifier:hn(Mn),MetadataURL:hn(function(e,t){const o=xs(e,t);return o?(o.type=e.getAttribute('type'),o):void 0}),DataURL:hn(xs),FeatureListURL:hn(xs),Style:hn(function(e,t){return In({},YT,e,t)}),MinScaleDenominator:fn(wn),MaxScaleDenominator:fn(wn),Layer:hn(function(e,t){const o=t[t.length-1],r=In({},AT,e,t);if(!r)return;let i=Fn(e.getAttribute('queryable'));void 0===i&&(i=o.queryable),r.queryable=void 0!==i&&i;let n=bn(e.getAttribute('cascaded'));void 0===n&&(n=o.cascaded),r.cascaded=n;let a=Fn(e.getAttribute('opaque'));void 0===a&&(a=o.opaque),r.opaque=void 0!==a&&a;let s=Fn(e.getAttribute('noSubsets'));void 0===s&&(s=o.noSubsets),r.noSubsets=void 0!==s&&s;let l=Nn(e.getAttribute('fixedWidth'));l||(l=o.fixedWidth),r.fixedWidth=l;let d=Nn(e.getAttribute('fixedHeight'));d||(d=o.fixedHeight),r.fixedHeight=d;['Style','CRS','AuthorityURL'].forEach(function(e){if(e in o){const t=r[e]||[];r[e]=t.concat(o[e])}});return['EX_GeographicBoundingBox','BoundingBox','Dimension','Attribution','MinScaleDenominator','MaxScaleDenominator'].forEach(function(e){if(!(e in r)){const t=o[e];r[e]=t}}),r})}),bT=Cn(IT,{Title:fn(Mn),OnlineResource:fn(Es),LogoURL:fn(Ss)}),MT=Cn(IT,{westBoundLongitude:fn(wn),eastBoundLongitude:fn(wn),southBoundLatitude:fn(wn),northBoundLatitude:fn(wn)}),GT=Cn(IT,{GetCapabilities:fn(Ts),GetMap:fn(Ts),GetFeatureInfo:fn(Ts)}),DT=Cn(IT,{Format:hn(Mn),DCPType:hn(function(e,t){return In({},kT,e,t)})}),kT=Cn(IT,{HTTP:fn(function(e,t){return In({},UT,e,t)})}),UT=Cn(IT,{Get:fn(xs),Post:fn(xs)}),YT=Cn(IT,{Name:fn(Mn),Title:fn(Mn),Abstract:fn(Mn),LegendURL:hn(Ss),StyleSheetURL:fn(xs),StyleURL:fn(xs)}),BT=Cn(IT,{Format:fn(Mn),OnlineResource:fn(Es)}),jT=Cn(IT,{Keyword:yn(Mn)});RT.prototype.read,RT.prototype.readFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},RT.prototype.readFromNode=function(e){this.version=e.getAttribute('version').trim();const t=In({version:this.version},LT,e,[]);return t?t:null};const VT=function(e){const t=e?e:{};this.featureNS_='http://mapserver.gis.umn.edu/mapserver',this.gmlFormat_=new Ah,this.layers_=t.layers?t.layers:null,Sh.call(this)};i(VT,Sh);VT.prototype.getLayers=function(){return this.layers_},VT.prototype.setLayers=function(e){this.layers_=e},VT.prototype.readFeatures_=function(e,t){e.setAttribute('namespaceURI',this.featureNS_);const o=e.localName;let r=[];if(0===e.childNodes.length)return r;if('msGMLOutput'==o)for(let o=0,i=e.childNodes.length;o<i;o++){const i=e.childNodes[o];if(i.nodeType!==Node.ELEMENT_NODE)continue;const n=t[0],a=i.localName.replace('_layer','');if(this.layers_&&!P(this.layers_,a))continue;const s=a+'_feature';n.featureType=s,n.featureNS=this.featureNS_;const l={};l[s]=yn(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const d=Cn([n.featureNS,null],l);i.setAttribute('namespaceURI',this.featureNS_);const p=In([],d,i,t,this.gmlFormat_);p&&O(r,p)}if('FeatureCollection'==o){const t=In([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);t&&(r=t)}return r},VT.prototype.readFeatures,VT.prototype.readFeaturesFromNode=function(e,t){const o={};return t&&Dd(o,this.getReadOptions(e,t)),this.readFeatures_(e,[o])},VT.prototype.writeFeatureNode=function(){},VT.prototype.writeFeaturesNode=function(){},VT.prototype.writeGeometryNode=function(){};const zT=function(){CT.call(this)};i(zT,CT);const XT=[null,'http://www.opengis.net/ows/1.1'],WT=Cn(XT,{ServiceIdentification:fn(function(e,t){return In({},iS,e,t)}),ServiceProvider:fn(function(e,t){return In({},nS,e,t)}),OperationsMetadata:fn(function(e,t){return In({},eS,e,t)})}),KT=Cn(XT,{DeliveryPoint:fn(Mn),City:fn(Mn),AdministrativeArea:fn(Mn),PostalCode:fn(Mn),Country:fn(Mn),ElectronicMailAddress:fn(Mn)}),HT=Cn(XT,{Value:hn(function(e){return Mn(e)})}),ZT=Cn(XT,{AllowedValues:fn(function(e,t){return In({},HT,e,t)})}),qT=Cn(XT,{Phone:fn(function(e,t){return In({},tS,e,t)}),Address:fn(function(e,t){return In({},KT,e,t)})}),JT=Cn(XT,{HTTP:fn(function(e,t){return In({},QT,e,t)})}),QT=Cn(XT,{Get:hn(function(e,t){const o=Es(e);return o?In({href:o},oS,e,t):void 0}),Post:void 0}),$T=Cn(XT,{DCP:fn(function(e,t){return In({},JT,e,t)})}),eS=Cn(XT,{Operation:function(e,t){const o=e.getAttribute('name'),r=In({},$T,e,t);if(r){const e=t[t.length-1];e[o]=r}}}),tS=Cn(XT,{Voice:fn(Mn),Facsimile:fn(Mn)}),oS=Cn(XT,{Constraint:hn(function(e,t){const o=e.getAttribute('name');return o?In({name:o},ZT,e,t):void 0})}),rS=Cn(XT,{IndividualName:fn(Mn),PositionName:fn(Mn),ContactInfo:fn(function(e,t){return In({},qT,e,t)})}),iS=Cn(XT,{Abstract:fn(Mn),AccessConstraints:fn(Mn),Fees:fn(Mn),Title:fn(Mn),ServiceTypeVersion:fn(Mn),ServiceType:fn(Mn)}),nS=Cn(XT,{ProviderName:fn(Mn),ProviderSite:fn(Es),ServiceContact:fn(function(e,t){return In({},rS,e,t)})});zT.prototype.readFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},zT.prototype.readFromNode=function(e){const t=In({},WT,e,[]);return t?t:null};const aS=function(){CT.call(this),this.owsParser_=new zT};i(aS,CT);const sS=[null,'http://www.opengis.net/wmts/1.0'],lS=[null,'http://www.opengis.net/ows/1.1'],dS=Cn(sS,{Contents:fn(function(e,t){return In({},pS,e,t)})}),pS=Cn(sS,{Layer:hn(function(e,t){return In({},gS,e,t)}),TileMatrixSet:hn(function(e,t){return In({},fS,e,t)})}),gS=Cn(sS,{Style:hn(function(e,t){const o=In({},_S,e,t);if(o){const t='true'===e.getAttribute('isDefault');return o.isDefault=t,o}}),Format:hn(Mn),TileMatrixSetLink:hn(function(e,t){return In({},uS,e,t)}),Dimension:hn(function(e,t){return In({},mS,e,t)}),ResourceURL:hn(function(e){const t=e.getAttribute('format'),o=e.getAttribute('template'),r=e.getAttribute('resourceType'),i={};return t&&(i.format=t),o&&(i.template=o),r&&(i.resourceType=r),i})},Cn(lS,{Title:fn(Mn),Abstract:fn(Mn),WGS84BoundingBox:fn(function(e,t){const o=In([],hS,e,t);return 2==o.length?Te(o):void 0}),Identifier:fn(Mn)})),_S=Cn(sS,{LegendURL:hn(function(e){const t={format:e.getAttribute('format'),href:Es(e)};return t})},Cn(lS,{Title:fn(Mn),Identifier:fn(Mn)})),uS=Cn(sS,{TileMatrixSet:fn(Mn),TileMatrixSetLimits:fn(function(e,t){return In([],cS,e,t)})}),cS=Cn(sS,{TileMatrixLimits:yn(function(e,t){return In({},yS,e,t)})}),yS=Cn(sS,{TileMatrix:fn(Mn),MinTileRow:fn(An),MaxTileRow:fn(An),MinTileCol:fn(An),MaxTileCol:fn(An)}),mS=Cn(sS,{Default:fn(Mn),Value:hn(Mn)},Cn(lS,{Identifier:fn(Mn)})),hS=Cn(lS,{LowerCorner:yn(Rs),UpperCorner:yn(Rs)}),fS=Cn(sS,{WellKnownScaleSet:fn(Mn),TileMatrix:hn(function(e,t){return In({},ES,e,t)})},Cn(lS,{SupportedCRS:fn(Mn),Identifier:fn(Mn)})),ES=Cn(sS,{TopLeftCorner:fn(Rs),ScaleDenominator:fn(wn),TileWidth:fn(An),TileHeight:fn(An),MatrixWidth:fn(An),MatrixHeight:fn(An)},Cn(lS,{Identifier:fn(Mn)}));aS.prototype.read,aS.prototype.readFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},aS.prototype.readFromNode=function(e){const t=e.getAttribute('version').trim();let o=this.owsParser_.readFromNode(e);return o?(o.version=t,o=In(o,dS,e,[]),o?o:null):null};const xS=function(e,t,o){Sg.call(this);const r=t?t:0;this.setCenterAndRadius(e,r,o)};i(xS,Sg),xS.prototype.clone=function(){const e=new xS(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},xS.prototype.closestPointXY=function(e,t,o,r){const n=this.flatCoordinates,i=e-n[0],a=t-n[1],s=i*i+a*a;if(s<r){if(0==s)for(let e=0;e<this.stride;++e)o[e]=n[e];else{const e=this.getRadius()/id(s);o[0]=n[0]+e*i,o[1]=n[1]+e*a;for(let e=2;e<this.stride;++e)o[e]=n[e]}return o.length=this.stride,s}return r},xS.prototype.containsXY=function(e,t){const o=this.flatCoordinates,r=e-o[0],i=t-o[1];return r*r+i*i<=this.getRadiusSquared_()},xS.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},xS.prototype.computeExtent=function(e){const t=this.flatCoordinates,o=t[this.stride]-t[0];return we(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)},xS.prototype.getRadius=function(){return id(this.getRadiusSquared_())},xS.prototype.getRadiusSquared_=function(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t},xS.prototype.getType=function(){return $p.CIRCLE},xS.prototype.intersectsExtent=function(e){const t=this.getExtent();if(et(e,t)){const t=this.getCenter();return!!(e[0]<=t[0]&&e[2]>=t[0])||!!(e[1]<=t[1]&&e[3]>=t[1])||je(e,this.intersectsCoordinate,this)}return!1},xS.prototype.setCenter=function(e){const t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+o;for(let o=1;o<t;++o)r[t+o]=e[o];this.setFlatCoordinates(this.layout,r)},xS.prototype.setCenterAndRadius=function(e,t,o){if(!e)this.setFlatCoordinates(eg.XY,null);else{this.setLayout(o,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let n=_o(r,0,e,this.stride);r[n++]=r[0]+t;for(let e=1,t=this.stride;e<t;++e)r[n++]=r[e];r.length=n,this.changed()}},xS.prototype.getCoordinates=function(){},xS.prototype.setCoordinates=function(){},xS.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()},xS.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()},xS.prototype.transform;var TS=xS;const SS={ADD_FEATURES:'addfeatures'},CS=function(e,t,o,r){Bd.call(this,e),this.features=o,this.file=t,this.projection=r};i(CS,Bd);const RS=function(e){const t=e?e:{};__.call(this,{handleEvent:E}),this.formatConstructors_=t.formatConstructors?t.formatConstructors:[],this.projection_=t.projection?vt(t.projection):null,this.dropListenKeys_=null,this.source_=t.source||null,this.target=t.target?t.target:null};i(RS,__),RS.prototype.handleResult_=function(e,t){const o=t.target.result,r=this.getMap();let n=this.projection_;if(!n){const e=r.getView();n=e.getProjection()}const a=this.formatConstructors_;let s=[];for(let r=0,i=a.length;r<i;++r){const e=a[r],t=new e;if(s=this.tryReadFeatures_(t,o,{featureProjection:n}),s&&0<s.length)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(s)),this.dispatchEvent(new CS(SS.ADD_FEATURES,e,s,n))},RS.prototype.registerListeners_=function(){const e=this.getMap();if(e){const t=this.target?this.target:e.getViewport();this.dropListenKeys_=[c(t,zd.DROP,Is,this),c(t,zd.DRAGENTER,Ls,this),c(t,zd.DRAGOVER,Ls,this),c(t,zd.DROP,Ls,this)]}},RS.prototype.setActive=function(e){__.prototype.setActive.call(this,e),e?this.registerListeners_():this.unregisterListeners_()},RS.prototype.setMap=function(e){this.unregisterListeners_(),__.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},RS.prototype.tryReadFeatures_=function(e,t,o){try{return e.readFeatures(t,o)}catch(t){return null}},RS.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(h),this.dropListenKeys_=null)};const IS=function(e){const t=e?e:{};v_.call(this,{handleDownEvent:Fs,handleDragEvent:Ps,handleUpEvent:vs}),this.condition_=t.condition?t.condition:C_,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=t.duration===void 0?400:t.duration};i(IS,v_);const LS={RENDER_ORDER:'renderOrder'},PS=function(e){const t=e?e:{},o=Dd({},t);delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,t_.call(this,o),this.declutter_=t.declutter!==void 0&&t.declutter,this.renderBuffer_=t.renderBuffer===void 0?100:t.renderBuffer,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0&&t.updateWhileAnimating,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0&&t.updateWhileInteracting,this.renderMode_=t.renderMode||nu.VECTOR,this.type=iu.VECTOR};i(PS,t_),PS.prototype.getDeclutter=function(){return this.declutter_},PS.prototype.setDeclutter=function(e){this.declutter_=e},PS.prototype.getRenderBuffer=function(){return this.renderBuffer_},PS.prototype.getRenderOrder=function(){return this.get(LS.RENDER_ORDER)},PS.prototype.getSource,PS.prototype.getStyle=function(){return this.style_},PS.prototype.getStyleFunction=function(){return this.styleFunction_},PS.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},PS.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},PS.prototype.setRenderOrder=function(e){this.set(LS.RENDER_ORDER,e)},PS.prototype.setStyle=function(e){this.style_=e===void 0?Ci:e,this.styleFunction_=null===e?void 0:Si(this.style_),this.changed()},PS.prototype.getRenderMode=function(){return this.renderMode_};var vS=PS;const FS=function(e){qd.call(this),this.projection_=vt(e.projection),this.attributions_=this.adaptAttributions_(e.attributions),this.state_=e.state===void 0?Mg.READY:e.state,this.wrapX_=e.wrapX!==void 0&&e.wrapX};i(FS,qd),FS.prototype.adaptAttributions_=function(e){return e?Array.isArray(e)?function(){return e}:'function'==typeof e?e:function(){return[e]}:null},FS.prototype.forEachFeatureAtCoordinate=T,FS.prototype.getAttributions=function(){return this.attributions_},FS.prototype.getProjection=function(){return this.projection_},FS.prototype.getResolutions=function(){},FS.prototype.getState=function(){return this.state_},FS.prototype.getWrapX=function(){return this.wrapX_},FS.prototype.refresh=function(){this.changed()},FS.prototype.setAttributions=function(e){this.attributions_=this.adaptAttributions_(e),this.changed()},FS.prototype.setState=function(e){this.state_=e,this.changed()};var OS=FS,wS={ADDFEATURE:'addfeature',CHANGEFEATURE:'changefeature',CLEAR:'clear',REMOVEFEATURE:'removefeature'};const NS=function(e,t){Bd.call(this,e),this.feature=t};i(NS,Bd);const AS=function(e){const t=e||{};OS.call(this,{attributions:t.attributions,projection:void 0,state:Mg.READY,wrapX:!(t.wrapX!==void 0)||t.wrapX}),this.loader_=T,this.format_=t.format,this.overlaps_=!(t.overlaps!=void 0)||t.overlaps,this.url_=t.url,t.loader===void 0?this.url_!==void 0&&(k(this.format_,7),this.loader_=Bi(this.url_,this.format_)):this.loader_=t.loader,this.strategy_=t.strategy===void 0?Os:t.strategy;const o=!(t.useSpatialIndex!==void 0)||t.useSpatialIndex;this.featuresRtree_=o?new im:null,this.loadedExtentsRtree_=new im,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,i;t.features instanceof ep?(r=t.features,i=r.getArray()):Array.isArray(t.features)&&(i=t.features),o||r!==void 0||(r=new ep(i)),i!==void 0&&this.addFeaturesInternal(i),r!==void 0&&this.bindFeaturesCollection_(r)};i(AS,OS),AS.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},AS.prototype.addFeatureInternal=function(e){const t=n(e).toString();if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);const o=e.getGeometry();if(o){const t=o.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(t,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new NS(wS.ADDFEATURE,e))}},AS.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[c(t,zd.CHANGE,this.handleFeatureChange_,this),c(t,Gd.PROPERTYCHANGE,this.handleFeatureChange_,this)]},AS.prototype.addToIndex_=function(e,t){let o=!0;const r=t.getId();return void 0===r?(k(!(e in this.undefIdIndex_),30),this.undefIdIndex_[e]=t):r.toString()in this.idIndex_?o=!1:this.idIndex_[r.toString()]=t,o},AS.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},AS.prototype.addFeaturesInternal=function(e){const t=[],o=[],r=[];for(let t=0,r=e.length;t<r;t++){const r=e[t],i=n(r).toString();this.addToIndex_(i,r)&&o.push(r)}for(let a=0,i=o.length;a<i;a++){const e=o[a],i=n(e).toString();this.setupChangeEvents_(i,e);const s=e.getGeometry();if(s){const o=s.getExtent();t.push(o),r.push(e)}else this.nullGeometryFeatures_[i]=e}this.featuresRtree_&&this.featuresRtree_.load(t,r);for(let t=0,r=o.length;t<r;t++)this.dispatchEvent(new NS(wS.ADDFEATURE,o[t]))},AS.prototype.bindFeaturesCollection_=function(e){let t=!1;c(this,wS.ADDFEATURE,function(o){t||(t=!0,e.push(o.feature),t=!1)}),c(this,wS.REMOVEFEATURE,function(o){t||(t=!0,e.remove(o.feature),t=!1)}),c(e,Md.ADD,function(e){t||(t=!0,this.addFeature(e.element),t=!1)},this),c(e,Md.REMOVE,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)},this),this.featuresCollection_=e},AS.prototype.clear=function(e){if(e){for(const e in this.featureChangeKeys_){const t=this.featureChangeKeys_[e];t.forEach(h)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(const e in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};const t=new NS(wS.CLEAR);this.dispatchEvent(t),this.changed()},AS.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);return this.featuresCollection_?this.featuresCollection_.forEach(e):void 0},AS.prototype.forEachFeatureAtCoordinateDirect=function(e,t){const o=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(o,function(o){const r=o.getGeometry();return r.intersectsCoordinate(e)?t(o):void 0})},AS.prototype.forEachFeatureInExtent=function(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);return this.featuresCollection_?this.featuresCollection_.forEach(t):void 0},AS.prototype.forEachFeatureIntersectingExtent=function(e,t){return this.forEachFeatureInExtent(e,function(o){const r=o.getGeometry();if(r.intersectsExtent(e)){const e=t(o);if(e)return e}})},AS.prototype.getFeaturesCollection=function(){return this.featuresCollection_},AS.prototype.getFeatures=function(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray():this.featuresRtree_&&(e=this.featuresRtree_.getAll(),!l(this.nullGeometryFeatures_)&&O(e,s(this.nullGeometryFeatures_))),e},AS.prototype.getFeaturesAtCoordinate=function(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)}),t},AS.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_.getInExtent(e)},AS.prototype.getClosestFeatureToCoordinate=function(e,t){const o=e[0],r=e[1];let i=null;const n=[NaN,NaN];let a=Infinity;const s=[-Infinity,-Infinity,Infinity,Infinity],l=t?t:E;return this.featuresRtree_.forEachInExtent(s,function(e){if(l(e)){const t=e.getGeometry(),l=a;if(a=t.closestPointXY(o,r,n,a),a<l){i=e;const t=id(a);s[0]=o-t,s[1]=r-t,s[2]=o+t,s[3]=r+t}}}),i},AS.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},AS.prototype.getFeatureById=function(e){const t=this.idIndex_[e.toString()];return t===void 0?null:t},AS.prototype.getFormat=function(){return this.format_},AS.prototype.getOverlaps=function(){return this.overlaps_},AS.prototype.getResolutions=function(){},AS.prototype.getUrl=function(){return this.url_},AS.prototype.handleFeatureChange_=function(e){const t=e.target,o=n(t).toString(),r=t.getGeometry();if(!r)o in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[o]=t);else{const e=r.getExtent();o in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[o],this.featuresRtree_&&this.featuresRtree_.insert(e,t)):this.featuresRtree_&&this.featuresRtree_.update(e,t)}const i=t.getId();if(i!==void 0){const e=i.toString();o in this.undefIdIndex_?(delete this.undefIdIndex_[o],this.idIndex_[e]=t):this.idIndex_[e]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[e]=t)}else o in this.undefIdIndex_||(this.removeFromIdIndex_(t),this.undefIdIndex_[o]=t);this.changed(),this.dispatchEvent(new NS(wS.CHANGEFEATURE,t))},AS.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&l(this.nullGeometryFeatures_)},AS.prototype.loadFeatures=function(e,t,o){const r=this.loadedExtentsRtree_,n=this.strategy_(e,t);for(let a=0,i=n.length;a<i;++a){const e=n[a],i=r.forEachInExtent(e,function(t){return Pe(t.extent,e)});i||(this.loader_.call(this,e,t,o),r.insert(e,{extent:e.slice()}))}},AS.prototype.removeLoadedExtent=function(e){const t=this.loadedExtentsRtree_;let o;t.forEachInExtent(e,function(t){if(Ge(t.extent,e))return o=t,!0}),o&&t.remove(o)},AS.prototype.removeFeature=function(e){const t=n(e).toString();t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e),this.changed()},AS.prototype.removeFeatureInternal=function(e){const t=n(e).toString();this.featureChangeKeys_[t].forEach(h),delete this.featureChangeKeys_[t];const o=e.getId();o===void 0?delete this.undefIdIndex_[t]:delete this.idIndex_[o.toString()],this.dispatchEvent(new NS(wS.REMOVEFEATURE,e))},AS.prototype.removeFromIdIndex_=function(e){let t=!1;for(const o in this.idIndex_)if(this.idIndex_[o]===e){delete this.idIndex_[o],t=!0;break}return t},AS.prototype.setLoader=function(e){this.loader_=e};var bS=AS;const MS={POINT:'Point',LINE_STRING:'LineString',POLYGON:'Polygon',CIRCLE:'Circle'},GS={DRAWSTART:'drawstart',DRAWEND:'drawend'},DS=function(e,t){Bd.call(this,e),this.feature=t};i(DS,Bd);const kS=function(e){v_.call(this,{handleDownEvent:As,handleEvent:Ns,handleUpEvent:bs}),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Ms(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_===MS.POLYGON?3:2,this.maxPoints_=e.maxPoints?e.maxPoints:Infinity,this.finishCondition_=e.finishCondition?e.finishCondition:E;let t=e.geometryFunction;if(!t)if(this.type_===$p.CIRCLE)t=function(e,t){const o=t?t:new TS([NaN,NaN]),r=ue(e[0],e[1]);return o.setCenterAndRadius(e[0],id(r)),o};else{let e;const o=this.mode_;o===MS.POINT?e=Lg:o===MS.LINE_STRING?e=ty:o===MS.POLYGON&&(e=vg),t=function(t,r){let i=r;return i?o===MS.POLYGON?t[0].length?i.setCoordinates([t[0].concat([t[0][0]])]):i.setCoordinates([]):i.setCoordinates(t):i=new e(t),i}}this.geometryFunction_=t,this.dragVertexDelay_=e.dragVertexDelay===void 0?500:e.dragVertexDelay,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new vS({source:new bS({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:ws(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:S_,this.freehandCondition_,this.freehandCondition_=e.freehand?h_:e.freehandCondition?e.freehandCondition:C_,c(this,C(p_.ACTIVE),this.updateState_,this)};i(kS,v_),kS.prototype.setMap=function(e){v_.prototype.setMap.call(this,e),this.updateState_()},kS.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,o=e.pixel,r=t[0]-o[0],i=t[1]-o[1],n=r*r+i*i;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e),!0},kS.prototype.atFinish_=function(e){let t=!1;if(this.sketchFeature_){let o=!1,r=[this.finishCoordinate_];if(this.mode_===MS.LINE_STRING?o=this.sketchCoords_.length>this.minPoints_:this.mode_===MS.POLYGON&&(o=this.sketchCoords_[0].length>this.minPoints_,r=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]),o){const o=e.map;for(let n=0,i=r.length;n<i;n++){const i=r[n],a=o.getPixelFromCoordinate(i),s=e.pixel,l=s[0]-a[0],d=s[1]-a[1],p=this.freehand_?1:this.snapTolerance_;if(t=id(l*l+d*d)<=p,t){this.finishCoordinate_=i;break}}}}return t},kS.prototype.createOrUpdateSketchPoint_=function(e){const t=e.coordinate.slice();if(!this.sketchPoint_)this.sketchPoint_=new Jc(new Lg(t)),this.updateSketchFeatures_();else{const e=this.sketchPoint_.getGeometry();e.setCoordinates(t)}},kS.prototype.startDrawing_=function(e){const t=e.coordinate;this.finishCoordinate_=t,this.mode_===MS.POINT?this.sketchCoords_=t.slice():this.mode_===MS.POLYGON?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Jc(new ty(this.sketchLineCoords_)));const o=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Jc,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new DS(GS.DRAWSTART,this.sketchFeature_))},kS.prototype.modifyDrawing_=function(e){let t=e.coordinate;const o=this.sketchFeature_.getGeometry();let r,i;if(this.mode_===MS.POINT?i=this.sketchCoords_:this.mode_===MS.POLYGON?(r=this.sketchCoords_[0],i=r[r.length-1],this.atFinish_(e)&&(t=this.finishCoordinate_.slice())):(r=this.sketchCoords_,i=r[r.length-1]),i[0]=t[0],i[1]=t[1],this.geometryFunction_(this.sketchCoords_,o),this.sketchPoint_){const e=this.sketchPoint_.getGeometry();e.setCoordinates(t)}let n;if(o instanceof vg&&this.mode_!==MS.POLYGON){this.sketchLine_||(this.sketchLine_=new Jc(new ty(null)));const e=o.getLinearRing(0);n=this.sketchLine_.getGeometry(),n.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates())}else this.sketchLineCoords_&&(n=this.sketchLine_.getGeometry(),n.setCoordinates(this.sketchLineCoords_));this.updateSketchFeatures_()},kS.prototype.addToDrawing_=function(e){const t=e.coordinate,o=this.sketchFeature_.getGeometry();let r,i;this.mode_===MS.LINE_STRING?(this.finishCoordinate_=t.slice(),i=this.sketchCoords_,i.length>=this.maxPoints_&&(this.freehand_?i.pop():r=!0),i.push(t.slice()),this.geometryFunction_(i,o)):this.mode_===MS.POLYGON&&(i=this.sketchCoords_[0],i.length>=this.maxPoints_&&(this.freehand_?i.pop():r=!0),i.push(t.slice()),r&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,o)),this.updateSketchFeatures_(),r&&this.finishDrawing()},kS.prototype.removeLastPoint=function(){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry();let t,o;this.mode_===MS.LINE_STRING?(t=this.sketchCoords_,t.splice(-2,1),this.geometryFunction_(t,e),2<=t.length&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===MS.POLYGON&&(t=this.sketchCoords_[0],t.splice(-2,1),o=this.sketchLine_.getGeometry(),o.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e)),0===t.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()},kS.prototype.finishDrawing=function(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const o=e.getGeometry();this.mode_===MS.LINE_STRING?(t.pop(),this.geometryFunction_(t,o)):this.mode_===MS.POLYGON&&(t[0].pop(),this.geometryFunction_(t,o),t=o.getCoordinates()),this.type_===$p.MULTI_POINT?e.setGeometry(new _h([t])):this.type_===$p.MULTI_LINE_STRING?e.setGeometry(new ph([t])):this.type_===$p.MULTI_POLYGON&&e.setGeometry(new ch([t])),this.dispatchEvent(new DS(GS.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)},kS.prototype.abortDrawing_=function(){this.finishCoordinate_=null;const e=this.sketchFeature_;return e&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),e},kS.prototype.extend=function(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new DS(GS.DRAWSTART,this.sketchFeature_))},kS.prototype.shouldStopEvent=x,kS.prototype.updateSketchFeatures_=function(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},kS.prototype.updateState_=function(){const e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing_(),this.overlay_.setMap(t?e:null)};const US={EXTENTCHANGED:'extentchanged'},YS=function(e){Bd.call(this,US.EXTENTCHANGED),this.extent=e};i(YS,Bd);const BS=function(e){const t=e||{};this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=t.pixelTolerance===void 0?10:t.pixelTolerance,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),v_.call(this,{handleDownEvent:Ds,handleDragEvent:ks,handleEvent:Gs,handleUpEvent:Us}),this.extentOverlay_=new vS({source:new bS({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:Ys(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new vS({source:new bS({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:Bs(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)};i(BS,v_),BS.prototype.snapToVertex_=function(e,t){const o=t.getCoordinateFromPixel(e),r=function(e,t){return ye(o,e)-ye(o,t)},i=this.getExtent();if(i){const n=zs(i);n.sort(r);const a=n[0];let s=se(o,a);const l=t.getPixelFromCoordinate(s);if(ce(e,l)<=this.pixelTolerance_){const e=t.getPixelFromCoordinate(a[0]),o=t.getPixelFromCoordinate(a[1]),r=ue(l,e),i=ue(l,o),n=id(rd(r,i));return this.snappedToVertex_=n<=this.pixelTolerance_,this.snappedToVertex_&&(s=r>i?a[1]:a[0]),s}}return null},BS.prototype.handlePointerMove_=function(e){const t=e.pixel,o=e.map;let r=this.snapToVertex_(t,o);r||(r=o.getCoordinateFromPixel(t)),this.createOrUpdatePointerFeature_(r)},BS.prototype.createOrUpdateExtentFeature_=function(e){let t=this.extentFeature_;return t?e?t.setGeometry(zo(e)):t.setGeometry(void 0):(t=e?new Jc(zo(e)):new Jc({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t},BS.prototype.createOrUpdatePointerFeature_=function(e){let t=this.vertexFeature_;if(!t)t=new Jc(new Lg(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t);else{const o=t.getGeometry();o.setCoordinates(e)}return t},BS.prototype.setMap=function(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),v_.prototype.setMap.call(this,e)},BS.prototype.getExtent=function(){return this.extent_},BS.prototype.setExtent=function(e){this.extent_=e?e:null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new YS(this.extent_))};const jS={MODIFYSTART:'modifystart',MODIFYEND:'modifyend'},VS=function(e,t,o){Bd.call(this,e),this.features=t,this.mapBrowserEvent=o};i(VS,Bd);const zS=function(e){v_.call(this,{handleDownEvent:Ws,handleDragEvent:Ks,handleEvent:Zs,handleUpEvent:Hs}),this.condition_=e.condition?e.condition:L_,this.defaultDeleteCondition_=function(e){return y_(e)&&T_(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:h_,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new im,this.pixelTolerance_=void 0===e.pixelTolerance?10:e.pixelTolerance,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new vS({source:new bS({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Qs(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null;let t;if(e.source?(this.source_=e.source,t=new ep(this.source_.getFeatures()),c(this.source_,wS.ADDFEATURE,this.handleSourceAdd_,this),c(this.source_,wS.REMOVEFEATURE,this.handleSourceRemove_,this)):t=e.features,!t)throw new Error('The modify interaction requires features or a source');this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),c(this.features_,Md.ADD,this.handleFeatureAdd_,this),c(this.features_,Md.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null};i(zS,v_);const XS=0,WS=1;zS.prototype.addFeature_=function(e){const t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);const o=this.getMap();o&&o.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,o),c(e,zd.CHANGE,this.handleFeatureChange_,this)},zS.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new VS(jS.MODIFYSTART,this.features_,e)))},zS.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),m(e,zd.CHANGE,this.handleFeatureChange_,this)},zS.prototype.removeFeatureSegmentData_=function(e){const t=this.rBush_,o=[];t.forEach(function(t){e===t.feature&&o.push(t)});for(let r=o.length-1;0<=r;--r)t.remove(o[r])},zS.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),v_.prototype.setActive.call(this,e)},zS.prototype.setMap=function(e){this.overlay_.setMap(e),v_.prototype.setMap.call(this,e)},zS.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},zS.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},zS.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},zS.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}},zS.prototype.handleFeatureRemove_=function(e){const t=e.element;this.removeFeature_(t)},zS.prototype.writePointGeometry_=function(e,t){const o=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,geometry:t,segment:[o,o]})},zS.prototype.writeMultiPointGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,n=o.length;r<n;++r){const n=o[r],a={feature:e,geometry:t,depth:[r],index:r,segment:[n,n]};this.rBush_.insert(t.getExtent(),a)}},zS.prototype.writeLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,n=o.length-1;r<n;++r){const n=o.slice(r,r+2),a={feature:e,geometry:t,index:r,segment:n};this.rBush_.insert(Te(n),a)}},zS.prototype.writeMultiLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const n=o[r];for(let o=0,a=n.length-1;o<a;++o){const a=n.slice(o,o+2),s={feature:e,geometry:t,depth:[r],index:o,segment:a};this.rBush_.insert(Te(a),s)}}},zS.prototype.writePolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const n=o[r];for(let o=0,a=n.length-1;o<a;++o){const a=n.slice(o,o+2),s={feature:e,geometry:t,depth:[r],index:o,segment:a};this.rBush_.insert(Te(a),s)}}},zS.prototype.writeMultiPolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const i=o[r];for(let o=0,n=i.length;o<n;++o){const n=i[o];for(let a=0,s=n.length-1;a<s;++a){const s=n.slice(a,a+2),l={feature:e,geometry:t,depth:[o,r],index:a,segment:s};this.rBush_.insert(Te(s),l)}}}},zS.prototype.writeCircleGeometry_=function(e,t){const o=t.getCenter(),r={feature:e,geometry:t,index:XS,segment:[o,o]},i={feature:e,geometry:t,index:WS,segment:[o,o]};r.featureSegments=i.featureSegments=[r,i],this.rBush_.insert(Ae(o),r),this.rBush_.insert(t.getExtent(),i)},zS.prototype.writeGeometryCollectionGeometry_=function(e,t){const o=t.getGeometriesArray();for(let r=0;r<o.length;++r)this.SEGMENT_WRITERS_[o[r].getType()].call(this,e,o[r])},zS.prototype.createOrUpdateVertexFeature_=function(e){let t=this.vertexFeature_;if(!t)t=new Jc(new Lg(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t);else{const o=t.getGeometry();o.setCoordinates(e)}return t},zS.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},zS.prototype.handlePointerAtPixel_=function(e,t){const o=t.getCoordinateFromPixel(e),r=function(e,t){return qs(o,e)-qs(o,t)},i=Ce(Ae(o),t.getView().getResolution()*this.pixelTolerance_),a=this.rBush_,s=a.getInExtent(i);if(0<s.length){s.sort(r);const i=s[0],a=i.segment;let l=Js(o,i);const d=t.getPixelFromCoordinate(l);let p=ce(e,d);if(p<=this.pixelTolerance_){const e={};if(i.geometry.getType()===$p.CIRCLE&&i.index===WS)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l);else{const o=t.getPixelFromCoordinate(a[0]),r=t.getPixelFromCoordinate(a[1]),i=ue(d,o),g=ue(d,r);p=id(rd(i,g)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(l=i>g?a[1]:a[0]),this.createOrUpdateVertexFeature_(l);for(let t=1,o=s.length;t<o;++t){const o=s[t].segment;if(pe(a[0],o[0])&&pe(a[1],o[1])||pe(a[0],o[1])&&pe(a[1],o[0]))e[n(o)]=!0;else break}}return e[n(a)]=!0,void(this.vertexSegments_=e)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},zS.prototype.insertVertex_=function(e,t){const o=e.segment,r=e.feature,i=e.geometry,n=e.depth,a=e.index;let s;for(;t.length<i.getStride();)t.push(0);switch(i.getType()){case $p.MULTI_LINE_STRING:s=i.getCoordinates(),s[n[0]].splice(a+1,0,t);break;case $p.POLYGON:s=i.getCoordinates(),s[n[0]].splice(a+1,0,t);break;case $p.MULTI_POLYGON:s=i.getCoordinates(),s[n[1]][n[0]].splice(a+1,0,t);break;case $p.LINE_STRING:s=i.getCoordinates(),s.splice(a+1,0,t);break;default:return;}this.setGeometryCoordinates_(i,s);const l=this.rBush_;l.remove(e),this.updateSegmentIndices_(i,a,n,1);const d={segment:[o[0],t],feature:r,geometry:i,depth:n,index:a};l.insert(Te(d.segment),d),this.dragSegments_.push([d,1]);const p={segment:[t,o[1]],feature:r,geometry:i,depth:n,index:a+1};l.insert(Te(p.segment),p),this.dragSegments_.push([p,0]),this.ignoreNextSingleClick_=!0},zS.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=hp.POINTERDRAG){const e=this.lastPointerEvent_;return this.willModifyFeatures_(e),this.removeVertex_(),this.dispatchEvent(new VS(jS.MODIFYEND,this.features_,e)),this.modified_=!1,!0}return!1},zS.prototype.removeVertex_=function(){const e=this.dragSegments_,t={};let o=!1,r,a,s,l,d,i,p,g,_,u,c;for(d=e.length-1;0<=d;--d)s=e[d],u=s[0],c=n(u.feature),u.depth&&(c+='-'+u.depth.join('-')),c in t||(t[c]={}),0===s[1]?(t[c].right=u,t[c].index=u.index):1==s[1]&&(t[c].left=u,t[c].index=u.index+1);for(c in t){switch(_=t[c].right,p=t[c].left,i=t[c].index,g=i-1,u=void 0===p?_:p,0>g&&(g=0),l=u.geometry,a=l.getCoordinates(),r=a,o=!1,l.getType()){case $p.MULTI_LINE_STRING:2<a[u.depth[0]].length&&(a[u.depth[0]].splice(i,1),o=!0);break;case $p.LINE_STRING:2<a.length&&(a.splice(i,1),o=!0);break;case $p.MULTI_POLYGON:r=r[u.depth[1]];case $p.POLYGON:r=r[u.depth[0]],4<r.length&&(i==r.length-1&&(i=0),r.splice(i,1),o=!0,0===i&&(r.pop(),r.push(r[0]),g=r.length-1));break;default:}if(o){this.setGeometryCoordinates_(l,a);const t=[];if(void 0!==p&&(this.rBush_.remove(p),t.push(p.segment[0])),void 0!==_&&(this.rBush_.remove(_),t.push(_.segment[1])),void 0!==p&&void 0!==_){const e={depth:u.depth,feature:u.feature,geometry:u.geometry,index:g,segment:t};this.rBush_.insert(Te(e.segment),e)}this.updateSegmentIndices_(l,i,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return o},zS.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},zS.prototype.updateSegmentIndices_=function(e,t,o,r){this.rBush_.forEachInExtent(e.getExtent(),function(i){i.geometry===e&&(o===void 0||i.depth===void 0||A(i.depth,o))&&i.index>t&&(i.index+=r)})};const KS={SELECT:'select'},HS=function(e,t,o,r){Bd.call(this,e),this.selected=t,this.deselected=o,this.mapBrowserEvent=r};i(HS,Bd);const ZS=function(e){__.call(this,{handleEvent:$s});const t=e?e:{};this.condition_=t.condition?t.condition:T_,this.addCondition_=t.addCondition?t.addCondition:E_,this.removeCondition_=t.removeCondition?t.removeCondition:E_,this.toggleCondition_=t.toggleCondition?t.toggleCondition:C_,this.multi_=!!t.multi&&t.multi,this.filter_=t.filter?t.filter:E,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0;const o=new vS({source:new bS({useSpatialIndex:!1,features:t.features,wrapX:t.wrapX}),style:t.style?t.style:el(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.featureOverlay_=o;let r;if(!t.layers)r=E;else if('function'==typeof t.layers)r=t.layers;else{const e=t.layers;r=function(t){return P(e,t)}}this.layerFilter_=r,this.featureLayerAssociation_={};const i=this.featureOverlay_.getSource().getFeaturesCollection();c(i,Md.ADD,this.addFeature_,this),c(i,Md.REMOVE,this.removeFeature_,this)};i(ZS,__),ZS.prototype.addFeatureLayerAssociation_=function(e,t){const o=n(e);this.featureLayerAssociation_[o]=t},ZS.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},ZS.prototype.getHitTolerance=function(){return this.hitTolerance_},ZS.prototype.getLayer=function(e){const t=n(e);return this.featureLayerAssociation_[t]},ZS.prototype.setHitTolerance=function(e){this.hitTolerance_=e},ZS.prototype.setMap=function(e){const t=this.getMap(),o=this.featureOverlay_.getSource().getFeaturesCollection();t&&o.forEach(t.unskipFeature.bind(t)),__.prototype.setMap.call(this,e),this.featureOverlay_.setMap(e),e&&o.forEach(e.skipFeature.bind(e))},ZS.prototype.addFeature_=function(e){const t=this.getMap();t&&t.skipFeature(e.element)},ZS.prototype.removeFeature_=function(e){const t=this.getMap();t&&t.unskipFeature(e.element)},ZS.prototype.removeFeatureLayerAssociation_=function(e){const t=n(e);delete this.featureLayerAssociation_[t]};const qS=function(e){v_.call(this,{handleEvent:tl,handleDownEvent:E,handleUpEvent:rl});const t=e?e:{};this.source_=t.source?t.source:null,this.vertex_=!(t.vertex!==void 0)||t.vertex,this.edge_=!(t.edge!==void 0)||t.edge,this.features_=t.features?t.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=t.pixelTolerance===void 0?10:t.pixelTolerance,this.sortByDistance_=il.bind(this),this.rBush_=new im,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}};i(qS,v_),qS.prototype.addFeature=function(e,t){const o=n(e),r=e.getGeometry();if(r){const t=this.SEGMENT_WRITERS_[r.getType()];t&&(this.indexedFeaturesExtents_[o]=r.getExtent(Oe()),t.call(this,e,r))}(!(t!==void 0)||t)&&(this.featureChangeListenerKeys_[o]=c(e,zd.CHANGE,this.handleFeatureChange_,this))},qS.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},qS.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},qS.prototype.getFeatures_=function(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},qS.prototype.handleFeatureAdd_=function(e){let t;e instanceof NS?t=e.feature:e instanceof Qd&&(t=e.element),this.addFeature(t)},qS.prototype.handleFeatureRemove_=function(e){let t;e instanceof NS?t=e.feature:e instanceof Qd&&(t=e.element),this.removeFeature(t)},qS.prototype.handleFeatureChange_=function(e){const t=e.target;if(this.handlingDownUpSequence){const e=n(t);e in this.pendingFeatures_||(this.pendingFeatures_[e]=t)}else this.updateFeature_(t)},qS.prototype.removeFeature=function(e,t){const o=n(e),r=this.indexedFeaturesExtents_[o];if(r){const t=this.rBush_,o=[];t.forEachInExtent(r,function(t){e===t.feature&&o.push(t)});for(let e=o.length-1;0<=e;--e)t.remove(o[e])}(!(t!==void 0)||t)&&(h(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},qS.prototype.setMap=function(e){const t=this.getMap(),o=this.featuresListenerKeys_,r=this.getFeatures_();t&&(o.forEach(h),o.length=0,r.forEach(this.forEachFeatureRemove_.bind(this))),v_.prototype.setMap.call(this,e),e&&(this.features_?o.push(c(this.features_,Md.ADD,this.handleFeatureAdd_,this),c(this.features_,Md.REMOVE,this.handleFeatureRemove_,this)):this.source_&&o.push(c(this.source_,wS.ADDFEATURE,this.handleFeatureAdd_,this),c(this.source_,wS.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(this.forEachFeatureAdd_.bind(this)))},qS.prototype.shouldStopEvent=x,qS.prototype.snapTo=function(e,t,o){const r=o.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i=o.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),n=Te([r,i]);let a=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(a=a.filter(function(e){return e.feature.getGeometry().getType()!==$p.CIRCLE}));let s=!1,l=!1,d=null,p=null,g,_,u,c,y;if(0<a.length){this.pixelCoordinate_=t,a.sort(this.sortByDistance_);const r=a[0].segment,i=a[0].feature.getGeometry().getType()===$p.CIRCLE;this.vertex_&&!this.edge_?(_=o.getPixelFromCoordinate(r[0]),u=o.getPixelFromCoordinate(r[1]),c=ue(e,_),y=ue(e,u),g=id(rd(c,y)),s=g<=this.pixelTolerance_,s&&(l=!0,d=c>y?r[1]:r[0],p=o.getPixelFromCoordinate(d))):this.edge_&&(d=i?ae(t,a[0].feature.getGeometry()):se(t,r),p=o.getPixelFromCoordinate(d),ce(e,p)<=this.pixelTolerance_&&(l=!0,this.vertex_&&!i&&(_=o.getPixelFromCoordinate(r[0]),u=o.getPixelFromCoordinate(r[1]),c=ue(p,_),y=ue(p,u),g=id(rd(c,y)),s=g<=this.pixelTolerance_,s&&(d=c>y?r[1]:r[0],p=o.getPixelFromCoordinate(d))))),l&&(p=[Wl(p[0]),Wl(p[1])])}return{snapped:l,vertex:d,vertexPixel:p}},qS.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},qS.prototype.writeCircleGeometry_=function(e,t){const o=Xo(t),r=o.getCoordinates()[0];for(let o=0,i=r.length-1;o<i;++o){const t=r.slice(o,o+2);this.rBush_.insert(Te(t),{feature:e,segment:t})}},qS.prototype.writeGeometryCollectionGeometry_=function(e,t){const o=t.getGeometriesArray();for(let r=0;r<o.length;++r){const t=this.SEGMENT_WRITERS_[o[r].getType()];t&&t.call(this,e,o[r])}},qS.prototype.writeLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length-1;r<i;++r){const t=o.slice(r,r+2);this.rBush_.insert(Te(t),{feature:e,segment:t})}},qS.prototype.writeMultiLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const t=o[r];for(let o=0,r=t.length-1;o<r;++o){const r=t.slice(o,o+2);this.rBush_.insert(Te(r),{feature:e,segment:r})}}},qS.prototype.writeMultiPointGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const i=o[r];this.rBush_.insert(t.getExtent(),{feature:e,segment:[i,i]})}},qS.prototype.writeMultiPolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const t=o[r];for(let o=0,r=t.length;o<r;++o){const r=t[o];for(let t=0,o=r.length-1;t<o;++t){const o=r.slice(t,t+2);this.rBush_.insert(Te(o),{feature:e,segment:o})}}}},qS.prototype.writePointGeometry_=function(e,t){const o=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,segment:[o,o]})},qS.prototype.writePolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const t=o[r];for(let o=0,r=t.length-1;o<r;++o){const r=t.slice(o,o+2);this.rBush_.insert(Te(r),{feature:e,segment:r})}}};const JS={TRANSLATESTART:'translatestart',TRANSLATING:'translating',TRANSLATEEND:'translateend'},QS=function(e,t,o){Bd.call(this,e),this.features=t,this.coordinate=o};i(QS,Bd);const $S=function(e){v_.call(this,{handleDownEvent:nl,handleDragEvent:sl,handleMoveEvent:ll,handleUpEvent:al});const t=e?e:{};this.lastCoordinate_=null,this.features_=t.features===void 0?null:t.features;let o;if(!t.layers)o=E;else if('function'==typeof t.layers)o=t.layers;else{const e=t.layers;o=function(t){return P(e,t)}}this.layerFilter_=o,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.lastFeature_=null,c(this,C(p_.ACTIVE),this.handleActiveChanged_,this)};i($S,v_),$S.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||P(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},$S.prototype.getHitTolerance=function(){return this.hitTolerance_},$S.prototype.setHitTolerance=function(e){this.hitTolerance_=e},$S.prototype.setMap=function(e){const t=this.getMap();v_.prototype.setMap.call(this,e),this.updateState_(t)},$S.prototype.handleActiveChanged_=function(){this.updateState_(null)},$S.prototype.updateState_=function(e){let t=this.getMap();const o=this.getActive();if((!t||!o)&&(t=t||e,t)){const e=t.getViewport();e.classList.remove('ol-grab','ol-grabbing')}};const eC={BLUR:'blur',GRADIENT:'gradient',RADIUS:'radius'},tC=['#00f','#0ff','#0f0','#ff0','#f00'],oC=function(e){const t=e?e:{},o=Dd({},t);delete o.gradient,delete o.radius,delete o.blur,delete o.shadow,delete o.weight,vS.call(this,o),this.gradient_=null,this.shadow_=t.shadow===void 0?250:t.shadow,this.circleImage_=void 0,this.styleCache_=null,c(this,C(eC.GRADIENT),this.handleGradientChanged_,this),this.setGradient(t.gradient?t.gradient:tC),this.setBlur(t.blur===void 0?15:t.blur),this.setRadius(t.radius===void 0?8:t.radius),c(this,C(eC.BLUR),this.handleStyleChanged_,this),c(this,C(eC.RADIUS),this.handleStyleChanged_,this),this.handleStyleChanged_();const r=t.weight?t.weight:'weight';let i;i='string'==typeof r?function(e){return e.get(r)}:r,this.setStyle(function(e){const t=i(e),o=void 0===t?1:U(t,0,1),r=0|255*o;let n=this.styleCache_[r];return n||(n=[new Zc({image:new Sf({opacity:o,src:this.circleImage_})})],this.styleCache_[r]=n),n}.bind(this)),this.setRenderOrder(null),c(this,$g.RENDER,this.handleRender_,this)};i(oC,vS);const rC=function(e){const t=1,o=256,r=Jo(t,o),n=r.createLinearGradient(0,0,t,o),a=1/(e.length-1);for(let t=0,o=e.length;t<o;++t)n.addColorStop(t*a,e[t]);return r.fillStyle=n,r.fillRect(0,0,t,o),r.getImageData(0,0,t,o).data};oC.prototype.createCircle_=function(){const e=this.getRadius(),t=this.getBlur(),o=e+t+1,r=2*o,i=Jo(r,r);i.shadowOffsetX=i.shadowOffsetY=this.shadow_,i.shadowBlur=t,i.shadowColor='#000',i.beginPath();const n=o-this.shadow_;return i.arc(n,n,e,0,2*$l,!0),i.fill(),i.canvas.toDataURL()},oC.prototype.getBlur=function(){return this.get(eC.BLUR)},oC.prototype.getGradient=function(){return this.get(eC.GRADIENT)},oC.prototype.getRadius=function(){return this.get(eC.RADIUS)},oC.prototype.handleGradientChanged_=function(){this.gradient_=rC(this.getGradient())},oC.prototype.handleStyleChanged_=function(){this.circleImage_=this.createCircle_(),this.styleCache_=Array(256),this.changed()},oC.prototype.handleRender_=function(e){const t=e.context,o=t.canvas,r=t.getImageData(0,0,o.width,o.height),n=r.data;for(let t=0,o=n.length;t<o;t+=4){const e=4*n[t+3];e&&(n[t]=this.gradient_[e],n[t+1]=this.gradient_[e+1],n[t+2]=this.gradient_[e+2])}t.putImageData(r,0,0)},oC.prototype.setBlur=function(e){this.set(eC.BLUR,e)},oC.prototype.setGradient=function(e){this.set(eC.GRADIENT,e)},oC.prototype.setRadius=function(e){this.set(eC.RADIUS,e)};const iC=function(e){const t=e?e:{};t_.call(this,t),this.type=iu.IMAGE};i(iC,t_),iC.prototype.getSource;var nC=iC,aC={PRELOAD:'preload',USE_INTERIM_TILES_ON_ERROR:'useInterimTilesOnError'};const sC=function(e){const t=e?e:{},o=Dd({},t);delete o.preload,delete o.useInterimTilesOnError,t_.call(this,o),this.setPreload(t.preload===void 0?0:t.preload),this.setUseInterimTilesOnError(!(t.useInterimTilesOnError!==void 0)||t.useInterimTilesOnError),this.type=iu.TILE};i(sC,t_),sC.prototype.getPreload=function(){return this.get(aC.PRELOAD)},sC.prototype.getSource,sC.prototype.setPreload=function(e){this.set(aC.PRELOAD,e)},sC.prototype.getUseInterimTilesOnError=function(){return this.get(aC.USE_INTERIM_TILES_ON_ERROR)},sC.prototype.setUseInterimTilesOnError=function(e){this.set(aC.USE_INTERIM_TILES_ON_ERROR,e)};var lC=sC;const dC=function(e){const t=e?e:{};let o=t.renderMode||wc.HYBRID;k(o==void 0||o==wc.IMAGE||o==wc.HYBRID||o==wc.VECTOR,28),t.declutter&&o==wc.IMAGE&&(o=wc.HYBRID),t.renderMode=o;const r=Dd({},t);delete r.preload,delete r.useInterimTilesOnError,vS.call(this,r),this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(!(t.useInterimTilesOnError!==void 0)||t.useInterimTilesOnError),this.type=iu.VECTOR_TILE};i(dC,vS),dC.prototype.getPreload=function(){return this.get(aC.PRELOAD)},dC.prototype.getUseInterimTilesOnError=function(){return this.get(aC.USE_INTERIM_TILES_ON_ERROR)},dC.prototype.setPreload=function(e){this.set(aC.PRELOAD,e)},dC.prototype.setUseInterimTilesOnError=function(e){this.set(aC.USE_INTERIM_TILES_ON_ERROR,e)},dC.prototype.getSource;const pC=.25,gC=function(e,t,o,r,i){this.sourceProj_=e,this.targetProj_=t;let n={};const a=Dt(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+'/'+e[1];return n[t]||(n[t]=a(e)),n[t]},this.maxSourceExtent_=r,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&$e(r)==$e(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?$e(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?$e(this.targetProj_.getExtent()):null;const s=Je(o),l=Qe(o),d=Xe(o),p=ze(o),g=this.transformInv_(s),_=this.transformInv_(l),u=this.transformInv_(d),c=this.transformInv_(p);if(this.addQuad_(s,l,d,p,g,_,u,c,10),this.wrapsXInSource_){let e=Infinity;this.triangles_.forEach(function(t){e=rd(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(ld(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const o=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];o[0][0]-e>this.sourceWorldWidth_/2&&(o[0][0]-=this.sourceWorldWidth_),o[1][0]-e>this.sourceWorldWidth_/2&&(o[1][0]-=this.sourceWorldWidth_),o[2][0]-e>this.sourceWorldWidth_/2&&(o[2][0]-=this.sourceWorldWidth_);const r=rd(o[0][0],o[1][0],o[2][0]),i=ld(o[0][0],o[1][0],o[2][0]);i-r<this.sourceWorldWidth_/2&&(t.source=o)}}.bind(this))}n={}};gC.prototype.addTriangle_=function(e,t,o,r,i,n){this.triangles_.push({source:[r,i,n],target:[e,t,o]})},gC.prototype.addQuad_=function(e,t,o,r,i,n,a,s,l){const d=Te([i,n,a,s]),p=this.sourceWorldWidth_?$e(d)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&.5<p&&1>p;let u=!1;if(0<l){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const i=Te([e,t,o,r]),n=$e(i)/this.targetWorldWidth_;u|=n>pC}!_&&this.sourceProj_.isGlobal()&&p&&(u|=p>pC)}if(u||!this.maxSourceExtent_||et(d,this.maxSourceExtent_)){if(!u&&(!isFinite(i[0])||!isFinite(i[1])||!isFinite(n[0])||!isFinite(n[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])))if(0<l)u=!0;else return;if(0<l){if(!u){const t=[(e[0]+o[0])/2,(e[1]+o[1])/2],r=this.transformInv_(t);let n;if(_){const e=(W(i[0],g)+W(a[0],g))/2;n=e-W(r[0],g)}else n=(i[0]+a[0])/2-r[0];const s=(i[1]+a[1])/2-r[1],l=n*n+s*s;u=l>this.errorThresholdSquared_}if(u){if(od(e[0]-o[0])<=od(e[1]-o[1])){const d=[(t[0]+o[0])/2,(t[1]+o[1])/2],p=this.transformInv_(d),g=[(r[0]+e[0])/2,(r[1]+e[1])/2],_=this.transformInv_(g);this.addQuad_(e,t,d,g,i,n,p,_,l-1),this.addQuad_(g,d,o,r,_,p,a,s,l-1)}else{const d=[(e[0]+t[0])/2,(e[1]+t[1])/2],p=this.transformInv_(d),g=[(o[0]+r[0])/2,(o[1]+r[1])/2],_=this.transformInv_(g);this.addQuad_(e,d,g,r,i,p,_,s,l-1),this.addQuad_(d,t,o,g,p,n,a,_,l-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(e,o,r,i,a,s),this.addTriangle_(e,t,o,i,n,a)}},gC.prototype.calculateSourceExtent=function(){const e=Oe();return this.triangles_.forEach(function(t){const o=t.source;ke(e,o[0]),ke(e,o[1]),ke(e,o[2])}),e},gC.prototype.getTriangles=function(){return this.triangles_};var _C=gC;const uC=function(e,t,o,r,i,n,a,s,l,d,p){py.call(this,i,Yp.IDLE),this.renderEdges_=void 0!==p&&p,this.pixelRatio_=a,this.gutter_=s,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=n?n:i,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let u=this.sourceTileGrid_.getExtent();const c=_?qe(g,_):g;if(0===Ve(c))return void(this.state=Yp.EMPTY);const y=e.getExtent();y&&(u?u=qe(u,y):u=y);const m=r.getResolution(this.wrappedTileCoord_[0]),h=We(c),f=dl(e,o,h,m);if(!isFinite(f)||0>=f)return void(this.state=Yp.EMPTY);const E=void 0===d?Q_:d;if(this.triangulation_=new _C(e,o,c,u,f*E),0===this.triangulation_.getTriangles().length)return void(this.state=Yp.EMPTY);this.sourceZ_=t.getZForResolution(f);let x=this.triangulation_.calculateSourceExtent();if(u&&(e.canWrapX()?(x[1]=U(x[1],u[1],u[3]),x[3]=U(x[3],u[1],u[3])):x=qe(x,u)),!Ve(x))this.state=Yp.EMPTY;else{const e=t.getTileRangeForExtentAndZ(x,this.sourceZ_);for(let t=e.minX;t<=e.maxX;t++)for(let o=e.minY;o<=e.maxY;o++){const e=l(this.sourceZ_,t,o,a);e&&this.sourceTiles_.push(e)}0===this.sourceTiles_.length&&(this.state=Yp.EMPTY)}};i(uC,py),uC.prototype.disposeInternal=function(){this.state==Yp.LOADING&&this.unlistenSources_(),py.prototype.disposeInternal.call(this)},uC.prototype.getImage=function(){return this.canvas_},uC.prototype.reproject_=function(){const e=[];if(this.sourceTiles_.forEach(function(t){t&&t.getState()==Yp.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=Yp.ERROR;else{const t=this.wrappedTileCoord_[0],o=this.targetTileGrid_.getTileSize(t),r='number'==typeof o?o:o[0],i='number'==typeof o?o:o[1],n=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=gl(r,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),n,s,this.triangulation_,e,this.gutter_,this.renderEdges_),this.state=Yp.LOADED}this.changed()},uC.prototype.load=function(){if(this.state==Yp.IDLE){this.state=Yp.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t){const o=t.getState();if(o==Yp.IDLE||o==Yp.LOADING){e++;const o=c(t,zd.CHANGE,function(){const r=t.getState();(r==Yp.LOADED||r==Yp.ERROR||r==Yp.EMPTY)&&(h(o),e--,0==e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),this.sourceTiles_.forEach(function(e){const t=e.getState();t==Yp.IDLE&&e.load()}),0==e&&setTimeout(this.reproject_.bind(this),0)}},uC.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(h),this.sourcesListenerKeys_=null};const cC=function(e){du.call(this,e)};i(cC,du),cC.prototype.expireCache=function(e){for(;this.canExpireCache();){const t=this.peekLast(),o=t.tileCoord[0].toString();if(o in e&&e[o].contains(t.tileCoord))break;else this.pop().dispose()}},cC.prototype.pruneExceptNewestZ=function(){if(0===this.getCount())return;const e=this.peekFirstKey(),t=yl(e),o=t[0];this.forEach(function(e){e.tileCoord[0]!==o&&(this.remove(cl(e.tileCoord)),e.dispose())},this)};var yC=cC;const mC=function(e){this.minZoom=e.minZoom===void 0?0:e.minZoom,this.resolutions_=e.resolutions,k(D(this.resolutions_,function(e,t){return t-e},!0),17);let t;if(!e.origins)for(let e=0,o=this.resolutions_.length-1;e<o;++e)if(!t)t=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin===void 0?null:e.origin,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,k(this.origins_.length==this.resolutions_.length,20));const o=e.extent;o===void 0||this.origin_||this.origins_||(this.origin_=Je(o)),k(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,k(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize===void 0?this.tileSizes_?null:Kp:e.tileSize,k(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=o===void 0?null:o,this.fullTileRanges_=null,this.tmpSize_=[0,0],e.sizes===void 0?o&&this.calculateTileRanges_(o):this.fullTileRanges_=e.sizes.map(function(e){const t=new Ju(rd(0,e[0]),ld(e[0]-1,-1),rd(0,e[1]),ld(e[1]-1,-1));return t},this)},hC=[0,0,0];mC.prototype.forEachTileCoord=function(e,t,o){const r=this.getTileRangeForExtentAndZ(e,t);for(let n=r.minX,i=r.maxX;n<=i;++n)for(let e=r.minY,i=r.maxY;e<=i;++e)o([t,n,e])},mC.prototype.forEachTileCoordParentTileRange=function(e,t,o,r,i){let n=null,a=e[0]-1,s,l,d;for(2===this.zoomFactor_?(l=e[1],d=e[2]):n=this.getTileCoordExtent(e,i);a>=this.minZoom;){if(2===this.zoomFactor_?(l=Ql(l/2),d=Ql(d/2),s=li(l,l,d,d,r)):s=this.getTileRangeForExtentAndZ(n,a,r),t.call(o,a,s))return!0;--a}return!1},mC.prototype.getExtent=function(){return this.extent_},mC.prototype.getMaxZoom=function(){return this.maxZoom},mC.prototype.getMinZoom=function(){return this.minZoom},mC.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]},mC.prototype.getResolution=function(e){return this.resolutions_[e]},mC.prototype.getResolutions=function(){return this.resolutions_},mC.prototype.getTileCoordChildTileRange=function(e,t,o){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){const o=2*e[1],r=2*e[2];return li(o,o+1,r,r+1,t)}const r=this.getTileCoordExtent(e,o);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null},mC.prototype.getTileRangeExtent=function(e,t,o){const r=this.getOrigin(e),i=this.getResolution(e),n=pr(this.getTileSize(e),this.tmpSize_),a=r[0]+t.minX*n[0]*i,s=r[0]+(t.maxX+1)*n[0]*i,l=r[1]+t.minY*n[1]*i,d=r[1]+(t.maxY+1)*n[1]*i;return we(a,l,s,d,o)},mC.prototype.getTileRangeForExtentAndZ=function(e,t,o){const r=hC;this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r);const i=r[1],n=r[2];return this.getTileCoordForXYAndZ_(e[2],e[3],t,!0,r),li(i,r[1],n,r[2],o)},mC.prototype.getTileCoordCenter=function(e){const t=this.getOrigin(e[0]),o=this.getResolution(e[0]),r=pr(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*o,t[1]+(e[2]+.5)*r[1]*o]},mC.prototype.getTileCoordExtent=function(e,t){const o=this.getOrigin(e[0]),r=this.getResolution(e[0]),i=pr(this.getTileSize(e[0]),this.tmpSize_),n=o[0]+e[1]*i[0]*r,a=o[1]+e[2]*i[1]*r,s=n+i[0]*r,l=a+i[1]*r;return we(n,a,s,l,t)},mC.prototype.getTileCoordForCoordAndResolution=function(e,t,o){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,o)},mC.prototype.getTileCoordForXYAndResolution_=function(e,t,o,r,i){const n=this.getZForResolution(o),a=o/this.getResolution(n),s=this.getOrigin(n),l=pr(this.getTileSize(n),this.tmpSize_),d=r?.5:0,p=r?0:.5,g=Ql((e-s[0])/o+d),_=Ql((t-s[1])/o+p);let u=a*g/l[0],c=a*_/l[1];return r?(u=sd(u)-1,c=sd(c)-1):(u=Ql(u),c=Ql(c)),_l(n,u,c,i)},mC.prototype.getTileCoordForXYAndZ_=function(e,t,o,r,i){const n=this.getOrigin(o),a=this.getResolution(o),s=pr(this.getTileSize(o),this.tmpSize_),l=r?.5:0,d=r?0:.5,p=Ql((e-n[0])/a+l),g=Ql((t-n[1])/a+d);let _=p/s[0],u=g/s[1];return r?(_=sd(_)-1,u=sd(u)-1):(_=Ql(_),u=Ql(u)),_l(o,_,u,i)},mC.prototype.getTileCoordForCoordAndZ=function(e,t,o){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,o)},mC.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]},mC.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]},mC.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:null},mC.prototype.getZForResolution=function(e,t){const o=v(this.resolutions_,e,t||0);return U(o,this.minZoom,this.maxZoom)},mC.prototype.calculateTileRanges_=function(e){const t=this.resolutions_.length,o=Array(t);for(let r=this.minZoom;r<t;++r)o[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=o};var fC=mC;const EC=function(e){OS.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,state:e.state,wrapX:e.wrapX}),this.opaque_=e.opaque!==void 0&&e.opaque,this.tilePixelRatio_=e.tilePixelRatio===void 0?1:e.tilePixelRatio,this.tileGrid=e.tileGrid===void 0?null:e.tileGrid,this.tileCache=new yC(e.cacheSize),this.tmpSize=[0,0],this.key_='',this.tileOptions={transition:e.transition}};i(EC,OS),EC.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},EC.prototype.expireCache=function(e,t){const o=this.getTileCacheForProjection(e);o&&o.expireCache(t)},EC.prototype.forEachLoadedTile=function(e,t,o,r){const i=this.getTileCacheForProjection(e);if(!i)return!1;let n=!0,a,s,l;for(let d=o.minX;d<=o.maxX;++d)for(let e=o.minY;e<=o.maxY;++e)s=ul(t,d,e),l=!1,i.containsKey(s)&&(a=i.get(s),l=a.getState()===Yp.LOADED,l&&(l=!1!==r(a))),l||(n=!1);return n},EC.prototype.getGutter=function(){return 0},EC.prototype.getKey=function(){return this.key_},EC.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},EC.prototype.getOpaque=function(){return this.opaque_},EC.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},EC.prototype.getTile=function(){},EC.prototype.getTileGrid=function(){return this.tileGrid},EC.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:Il(e)},EC.prototype.getTileCacheForProjection=function(e){const t=this.getProjection();return t&&!Mt(t,e)?null:this.tileCache},EC.prototype.getTilePixelRatio=function(){return this.tilePixelRatio_},EC.prototype.getTilePixelSize=function(e,t,o){const r=this.getTileGridForProjection(o),i=this.getTilePixelRatio(t),n=pr(r.getTileSize(e),this.tmpSize);return 1==i?n:dr(n,i,this.tmpSize)},EC.prototype.getTileCoordForTileUrlFunction=function(e,t){const o=void 0===t?this.getProjection():t,r=this.getTileGridForProjection(o);return this.getWrapX()&&o.isGlobal()&&(e=Ll(r,e,o)),fl(e,r)?e:null},EC.prototype.refresh=function(){this.tileCache.clear(),this.changed()},EC.prototype.useTile=T;const xC=function(e,t){Bd.call(this,e),this.tile=t};i(xC,Bd);var TC=EC,SC={TILELOADSTART:'tileloadstart',TILELOADEND:'tileloadend',TILELOADERROR:'tileloaderror'};const CC=function(e){TC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition}),this.tileLoadFunction=e.tileLoadFunction,this.tileUrlFunction=this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):Sl,this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction),this.tileLoadingKeys_={}};i(CC,TC),CC.prototype.fixedTileUrlFunction,CC.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},CC.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},CC.prototype.getUrls=function(){return this.urls},CC.prototype.handleTileChange=function(e){const t=e.target,o=n(t),r=t.getState();let i;r==Yp.LOADING?(this.tileLoadingKeys_[o]=!0,i=SC.TILELOADSTART):o in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[o],i=r==Yp.ERROR?SC.TILELOADERROR:r==Yp.LOADED||r==Yp.ABORT?SC.TILELOADEND:void 0),i!=void 0&&this.dispatchEvent(new xC(i,t))},CC.prototype.setTileLoadFunction=function(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()},CC.prototype.setTileUrlFunction=function(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),'undefined'==typeof t?this.changed():this.setKey(t)},CC.prototype.setUrl=function(e){const t=this.urls=Cl(e);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):xl(t,this.tileGrid),e)},CC.prototype.setUrls=function(e){this.urls=e;const t=e.join('\n');this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):xl(e,this.tileGrid),t)},CC.prototype.useTile=function(e,t,o){const r=ul(e,t,o);this.tileCache.containsKey(r)&&this.tileCache.get(r)};var RC=CC;const IC=function(e){RC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Nl,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition}),this.crossOrigin=e.crossOrigin===void 0?null:e.crossOrigin,this.tileClass=e.tileClass===void 0?_y:e.tileClass,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1};i(IC,RC),IC.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1},IC.prototype.expireCache=function(e,t){const o=this.getTileCacheForProjection(e);for(const r in this.tileCache.expireCache(this.tileCache==o?t:{}),this.tileCacheForProjection){const e=this.tileCacheForProjection[r];e.expireCache(e==o?t:{})}},IC.prototype.getGutter=function(e){return this.getProjection()&&e&&!Mt(this.getProjection(),e)?0:this.getGutterInternal()},IC.prototype.getGutterInternal=function(){return 0},IC.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!Mt(this.getProjection(),e))&&RC.prototype.getOpaque.call(this,e)},IC.prototype.getTileGridForProjection=function(e){const t=this.getProjection();if(this.tileGrid&&(!t||Mt(t,e)))return this.tileGrid;else{const t=n(e).toString();return t in this.tileGridForProjection||(this.tileGridForProjection[t]=Il(e)),this.tileGridForProjection[t]}},IC.prototype.getTileCacheForProjection=function(e){const t=this.getProjection();if(!t||Mt(t,e))return this.tileCache;else{const t=n(e).toString();return t in this.tileCacheForProjection||(this.tileCacheForProjection[t]=new yC(this.tileCache.highWaterMark)),this.tileCacheForProjection[t]}},IC.prototype.createTile_=function(e,t,o,r,i,n){const a=[e,t,o],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,r,i):void 0,d=new this.tileClass(a,void 0===l?Yp.EMPTY:Yp.IDLE,void 0===l?'':l,this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=n,c(d,zd.CHANGE,this.handleTileChange,this),d},IC.prototype.getTile=function(e,t,o,r,i){const n=this.getProjection();if(!n||!i||Mt(n,i))return this.getTileInternal(e,t,o,r,n||i);else{const a=this.getTileCacheForProjection(i),s=[e,t,o];let l;const d=cl(s);a.containsKey(d)&&(l=a.get(d));const p=this.getKey();if(l&&l.key==p)return l;else{const e=this.getTileGridForProjection(n),t=this.getTileGridForProjection(i),o=this.getTileCoordForTileUrlFunction(s,i),g=new uC(n,e,i,t,s,o,this.getTilePixelRatio(r),this.getGutterInternal(),function(e,t,o,r){return this.getTileInternal(e,t,o,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return g.key=p,l?(g.interimTile=l,g.refreshInterimChain(),a.replace(d,g)):a.set(d,g),g}}},IC.prototype.getTileInternal=function(e,t,o,r,i){let n=null;const a=ul(e,t,o),s=this.getKey();if(!this.tileCache.containsKey(a))n=this.createTile_(e,t,o,r,i,s),this.tileCache.set(a,n);else if(n=this.tileCache.get(a),n.key!=s){const l=n;n=this.createTile_(e,t,o,r,i,s),n.interimTile=l.getState()==Yp.IDLE?l.interimTile:l,n.refreshInterimChain(),this.tileCache.replace(a,n)}return n},IC.prototype.setRenderReprojectionEdges=function(e){if(this.renderReprojectionEdges_!=e){for(const t in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}},IC.prototype.setTileGridForProjection=function(e,t){{const o=vt(e);if(o){const e=n(o).toString();e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}};var LC=IC;const PC=function(e){this.hidpi_=e.hidpi!==void 0&&e.hidpi,LC.call(this,{cacheSize:e.cacheSize,crossOrigin:'anonymous',opaque:!0,projection:vt('EPSG:3857'),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:Mg.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:this.hidpi_?2:1,wrapX:!(e.wrapX!==void 0)||e.wrapX,transition:e.transition}),this.culture_=e.culture===void 0?'en-us':e.culture,this.maxZoom_=e.maxZoom===void 0?-1:e.maxZoom,this.apiKey_=e.key,this.imagerySet_=e.imagerySet;const t='https://dev.virtualearth.net/REST/v1/Imagery/Metadata/'+this.imagerySet_+'?uriScheme=https&include=ImageryProviders&key='+this.apiKey_+'&c='+this.culture_;Rl(t,this.handleImageryMetadataResponse.bind(this),void 0,'jsonp')};i(PC,LC);PC.prototype.getApiKey=function(){return this.apiKey_},PC.prototype.getImagerySet=function(){return this.imagerySet_},PC.prototype.handleImageryMetadataResponse=function(e){if(200!=e.statusCode||'OK'!=e.statusDescription||'ValidCredentials'!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)return void this.setState(Mg.ERROR);const t=e.resourceSets[0].resources[0],o=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,r=this.getProjection(),i=wl(r),n=t.imageWidth==t.imageHeight?t.imageWidth:[t.imageWidth,t.imageHeight],a=vl({extent:i,minZoom:t.zoomMin,maxZoom:o,tileSize:n/(this.hidpi_?2:1)});this.tileGrid=a;const s=this.culture_,l=this.hidpi_;if(this.tileUrlFunction=Tl(t.imageUrlSubdomains.map(function(e){const o=[0,0,0],r=t.imageUrl.replace('{subdomain}',e).replace('{culture}',s);return function(e){if(!e)return;else{_l(e[0],e[1],-e[2]-1,o);let t=r;return l&&(t+='&dpi=d1&device=mobile'),t.replace('{quadkey}',hl(o))}}})),t.imageryProviders){const e=Gt(vt('EPSG:4326'),this.getProjection());this.setAttributions(function(o){const r=[],n=o.viewState.zoom;return t.imageryProviders.map(function(t){let i=!1;const a=t.coverageAreas;for(let r=0,s=a.length;r<s;++r){const t=a[r];if(n>=t.zoomMin&&n<=t.zoomMax){const r=t.bbox,n=[r[1],r[0],r[3],r[2]],a=nt(n,e);if(et(a,o.extent)){i=!0;break}}}i&&r.push(t.attribution)}),r.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>'),r})}this.setState(Mg.READY)};const vC=function(e){const t=e||{},o=t.projection===void 0?'EPSG:3857':t.projection,r=t.tileGrid===void 0?vl({extent:wl(o),maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize}):t.tileGrid;LC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:t.opaque,projection:o,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:!(t.wrapX!==void 0)||t.wrapX,transition:t.transition})};i(vC,LC);var FC=vC;const OC=function(e){this.account_=e.account,this.mapId_=e.map||'',this.config_=e.config||{},this.templateCache_={},FC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom===void 0?18:e.maxZoom,minZoom:e.minZoom,projection:e.projection,state:Mg.LOADING,wrapX:e.wrapX}),this.initializeMap_()};i(OC,FC),OC.prototype.getConfig=function(){return this.config_},OC.prototype.updateConfig=function(e){Dd(this.config_,e),this.initializeMap_()},OC.prototype.setConfig=function(e){this.config_=e||{},this.initializeMap_()},OC.prototype.initializeMap_=function(){const e=JSON.stringify(this.config_);if(this.templateCache_[e])return void this.applyTemplate_(this.templateCache_[e]);let t='https://'+this.account_+'.carto.com/api/v1/map';this.mapId_&&(t+='/named/'+this.mapId_);const o=new XMLHttpRequest;o.addEventListener('load',this.handleInitResponse_.bind(this,e)),o.addEventListener('error',this.handleInitError_.bind(this)),o.open('POST',t),o.setRequestHeader('Content-type','application/json'),o.send(JSON.stringify(this.config_))},OC.prototype.handleInitResponse_=function(e,t){const o=t.target;if(!o.status||200<=o.status&&300>o.status){let t;try{t=JSON.parse(o.responseText)}catch(e){return void this.setState(Mg.ERROR)}this.applyTemplate_(t),this.templateCache_[e]=t,this.setState(Mg.READY)}else this.setState(Mg.ERROR)},OC.prototype.handleInitError_=function(){this.setState(Mg.ERROR)},OC.prototype.applyTemplate_=function(e){const t='https://'+e.cdn_url.https+'/'+this.account_+'/api/v1/map/'+e.layergroupid+'/{z}/{x}/{y}.png';this.setUrl(t)};const wC=function(e){bS.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance===void 0?20:e.distance,this.features=[],this.geometryFunction=e.geometryFunction||function(e){const t=e.getGeometry();return k(t instanceof Lg,10),t},this.source=e.source,c(this.source,zd.CHANGE,this.refresh,this)};i(wC,bS),wC.prototype.getDistance=function(){return this.distance},wC.prototype.getSource=function(){return this.source},wC.prototype.loadFeatures=function(e,t,o){this.source.loadFeatures(e,t,o),t!==this.resolution&&(this.clear(),this.resolution=t,this.cluster(),this.addFeatures(this.features))},wC.prototype.setDistance=function(e){this.distance=e,this.refresh()},wC.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features),bS.prototype.refresh.call(this)},wC.prototype.cluster=function(){if(void 0===this.resolution)return;this.features.length=0;const e=Oe(),t=this.distance*this.resolution,o=this.source.getFeatures(),r={};for(let a=0,i=o.length;a<i;a++){const i=o[a];if(!(n(i).toString()in r)){const o=this.geometryFunction(i);if(o){const i=o.getCoordinates();Ae(i,e),Ce(e,t,e);let a=this.source.getFeaturesInExtent(e);a=a.filter(function(e){const t=n(e).toString();return!(t in r)&&(r[t]=!0,!0)}),this.features.push(this.createCluster(a))}}}},wC.prototype.createCluster=function(e){const t=[0,0];for(let o=e.length-1;0<=o;--o){const r=this.geometryFunction(e[o]);r?ne(t,r.getCoordinates()):e.splice(o,1)}_e(t,1/e.length);const o=new Jc(new Lg(t));return o.set('features',e),o};const NC=function(e,t,o,r,i,n){this.targetProj_=t,this.maxSourceExtent_=e.getExtent();const a=t.getExtent(),s=a?qe(o,a):o,l=We(s),d=dl(e,t,l,r);this.triangulation_=new _C(e,t,s,this.maxSourceExtent_,d*Q_),this.targetResolution_=r,this.targetExtent_=o;const p=this.triangulation_.calculateSourceExtent();this.sourceImage_=n(p,d,i),this.sourcePixelRatio_=this.sourceImage_?this.sourceImage_.getPixelRatio():1,this.canvas_=null,this.sourceListenerKey_=null;let g=tu.LOADED;this.sourceImage_&&(g=tu.IDLE),eu.call(this,o,r,this.sourcePixelRatio_,g)};i(NC,eu),NC.prototype.disposeInternal=function(){this.state==tu.LOADING&&this.unlistenSource_(),eu.prototype.disposeInternal.call(this)},NC.prototype.getImage=function(){return this.canvas_},NC.prototype.getProjection=function(){return this.targetProj_},NC.prototype.reproject_=function(){const e=this.sourceImage_.getState();if(e==tu.LOADED){const e=$e(this.targetExtent_)/this.targetResolution_,t=Ze(this.targetExtent_)/this.targetResolution_;this.canvas_=gl(e,t,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=e,this.changed()},NC.prototype.load=function(){if(this.state==tu.IDLE){this.state=tu.LOADING,this.changed();const e=this.sourceImage_.getState();e==tu.LOADED||e==tu.ERROR?this.reproject_():(this.sourceListenerKey_=c(this.sourceImage_,zd.CHANGE,function(){const e=this.sourceImage_.getState();(e==tu.LOADED||e==tu.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},NC.prototype.unlistenSource_=function(){h(this.sourceListenerKey_),this.sourceListenerKey_=null};const AC={IMAGELOADSTART:'imageloadstart',IMAGELOADEND:'imageloadend',IMAGELOADERROR:'imageloaderror'},bC=function(e,t){Bd.call(this,e),this.image=t};i(bC,Bd);const MC=function(e){OS.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,state:e.state}),this.resolutions_=e.resolutions===void 0?null:e.resolutions,this.reprojectedImage_=null,this.reprojectedRevision_=0};i(MC,OS),MC.prototype.getResolutions=function(){return this.resolutions_},MC.prototype.findNearestResolution=function(e){if(this.resolutions_){const t=v(this.resolutions_,e,0);e=this.resolutions_[t]}return e},MC.prototype.getImage=function(e,t,o,r){const i=this.getProjection();if(!i||!r||Mt(i,r))return i&&(r=i),this.getImageInternal(e,t,o,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Mt(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&Ge(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new NC(i,r,e,t,o,function(e,t,o){return this.getImageInternal(e,t,o,i)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_},MC.prototype.getImageInternal=function(){},MC.prototype.handleImageChange=function(e){const t=e.target;switch(t.getState()){case tu.LOADING:this.dispatchEvent(new bC(AC.IMAGELOADSTART,t));break;case tu.LOADED:this.dispatchEvent(new bC(AC.IMAGELOADEND,t));break;case tu.ERROR:this.dispatchEvent(new bC(AC.IMAGELOADERROR,t));break;default:}};var GC=MC;const DC=function(e){const t=e||{};GC.call(this,{attributions:t.attributions,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin===void 0?null:t.crossOrigin,this.hidpi_=!(t.hidpi!==void 0)||t.hidpi,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction===void 0?Al:t.imageLoadFunction,this.params_=t.params||{},this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio===void 0?1.5:t.ratio};i(DC,GC),DC.prototype.getParams=function(){return this.params_},DC.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t),o=this.hidpi_?o:1;const i=this.image_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&Pe(i.getExtent(),e))return i;const n={F:'image',FORMAT:'PNG32',TRANSPARENT:!0};Dd(n,this.params_),e=e.slice();const a=(e[0]+e[2])/2,s=(e[1]+e[3])/2;if(1!=this.ratio_){const t=this.ratio_*$e(e)/2,o=this.ratio_*Ze(e)/2;e[0]=a-t,e[1]=s-o,e[2]=a+t,e[3]=s+o}const l=t/o,d=sd($e(e)/l),p=sd(Ze(e)/l);e[0]=a-l*d/2,e[2]=a+l*d/2,e[1]=s-l*p/2,e[3]=s+l*p/2,this.imageSize_[0]=d,this.imageSize_[1]=p;const g=this.getRequestUrl_(e,this.imageSize_,o,r,n);return this.image_=new ly(e,t,o,g,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),c(this.image_,zd.CHANGE,this.handleImageChange,this),this.image_},DC.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},DC.prototype.getRequestUrl_=function(e,t,o,r,i){const n=r.getCode().split(':').pop();i.SIZE=t[0]+','+t[1],i.BBOX=e.join(','),i.BBOXSR=n,i.IMAGESR=n,i.DPI=Wl(90*o);const a=this.url_,s=a.replace(/MapServer\/?$/,'MapServer/export').replace(/ImageServer\/?$/,'ImageServer/exportImage');return s==a&&k(!1,50),bl(s,i)},DC.prototype.getUrl=function(){return this.url_},DC.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},DC.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},DC.prototype.updateParams=function(e){Dd(this.params_,e),this.image_=null,this.changed()};const kC=function(e){GC.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio===void 0?1.5:e.ratio};i(kC,GC),kC.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t);let i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&Pe(i.getExtent(),e))return i;e=e.slice(),rt(e,this.ratio_);const n=$e(e)/t,a=Ze(e)/t,s=this.canvasFunction_(e,t,o,[n*o,a*o],r);return s&&(i=new ru(e,t,o,s)),this.canvas_=i,this.renderedRevision_=this.getRevision(),i};const UC=function(e){GC.call(this,{projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin===void 0?null:e.crossOrigin,this.displayDpi_=e.displayDpi===void 0?96:e.displayDpi,this.params_=e.params||{},this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction===void 0?Al:e.imageLoadFunction,this.hidpi_=!(e.hidpi!==void 0)||e.hidpi,this.metersPerUnit_=e.metersPerUnit===void 0?1:e.metersPerUnit,this.ratio_=e.ratio===void 0?1:e.ratio,this.useOverlay_=e.useOverlay!==void 0&&e.useOverlay,this.image_=null,this.renderedRevision_=0};i(UC,GC),UC.prototype.getParams=function(){return this.params_},UC.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t),o=this.hidpi_?o:1;let i=this.image_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&Pe(i.getExtent(),e))return i;1!=this.ratio_&&(e=e.slice(),rt(e,this.ratio_));const n=$e(e)/t,a=Ze(e)/t,s=[n*o,a*o];if(void 0!==this.url_){const n=this.getUrl(this.url_,this.params_,e,s,r);i=new ly(e,t,o,n,this.crossOrigin_,this.imageLoadFunction_),c(i,zd.CHANGE,this.handleImageChange,this)}else i=null;return this.image_=i,this.renderedRevision_=this.getRevision(),i},UC.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},UC.prototype.updateParams=function(e){Dd(this.params_,e),this.changed()},UC.prototype.getUrl=function(e,t,o,r){const i=Ml(o,r,this.metersPerUnit_,this.displayDpi_),n=We(o),a={OPERATION:this.useOverlay_?'GETDYNAMICMAPOVERLAYIMAGE':'GETMAPIMAGE',VERSION:'2.0.0',LOCALE:'en',CLIENTAGENT:'ol.source.ImageMapGuide source',CLIP:'1',SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Wl(r[0]),SETDISPLAYHEIGHT:Wl(r[1]),SETVIEWSCALE:i,SETVIEWCENTERX:n[0],SETVIEWCENTERY:n[1]};return Dd(a,t),bl(e,a)},UC.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()};const YC=function(e){const t=e.imageExtent,o=e.crossOrigin===void 0?null:e.crossOrigin,r=e.imageLoadFunction===void 0?Al:e.imageLoadFunction;GC.call(this,{attributions:e.attributions,projection:vt(e.projection)}),this.image_=new ly(t,void 0,1,e.url,o,r),this.imageSize_=e.imageSize?e.imageSize:null,c(this.image_,zd.CHANGE,this.handleImageChange,this)};i(YC,GC),YC.prototype.getImageInternal=function(e){return et(e,this.image_.getExtent())?this.image_:null},YC.prototype.handleImageChange=function(e){if(this.image_.getState()==tu.LOADED){const e=this.image_.getExtent(),t=this.image_.getImage();let o,r;this.imageSize_?(o=this.imageSize_[0],r=this.imageSize_[1]):(o=t.width,r=t.height);const i=Ze(e)/r,n=sd($e(e)/i);if(n!=o){const e=Jo(n,r),i=e.canvas;e.drawImage(t,0,0,o,r,0,0,i.width,i.height),this.image_.setImage(i)}}GC.prototype.handleImageChange.call(this,e)};const BC='1.3.0';var jC={CARMENTA_SERVER:'carmentaserver',GEOSERVER:'geoserver',MAPSERVER:'mapserver',QGIS:'qgis'};const VC=function(e){const t=e||{};GC.call(this,{attributions:t.attributions,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin===void 0?null:t.crossOrigin,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction===void 0?Al:t.imageLoadFunction,this.params_=t.params||{},this.v13_=!0,this.updateV13_(),this.serverType_=t.serverType,this.hidpi_=!(t.hidpi!==void 0)||t.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio===void 0?1.5:t.ratio};i(VC,GC);const zC=[101,101];VC.prototype.getGetFeatureInfoUrl=function(e,t,o,r){if(void 0!==this.url_){const i=vt(o),n=this.getProjection();n&&n!==i&&(t=dl(n,i,e,t),e=kt(e,i,n));const a=He(e,t,0,zC),s={SERVICE:'WMS',VERSION:BC,REQUEST:'GetFeatureInfo',FORMAT:'image/png',TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Dd(s,this.params_,r);const l=Ql((e[0]-a[0])/t),d=Ql((a[3]-e[1])/t);return s[this.v13_?'I':'X']=l,s[this.v13_?'J':'Y']=d,this.getRequestUrl_(a,zC,1,n||i,s)}},VC.prototype.getParams=function(){return this.params_},VC.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t),1==o||this.hidpi_&&void 0!==this.serverType_||(o=1);const i=t/o,n=We(e),a=sd($e(e)/i),s=sd(Ze(e)/i),l=He(n,i,0,[a,s]),d=sd(this.ratio_*$e(e)/i),p=sd(this.ratio_*Ze(e)/i),g=He(n,i,0,[d,p]),_=this.image_;if(_&&this.renderedRevision_==this.getRevision()&&_.getResolution()==t&&_.getPixelRatio()==o&&Pe(_.getExtent(),l))return _;const u={SERVICE:'WMS',VERSION:BC,REQUEST:'GetMap',FORMAT:'image/png',TRANSPARENT:!0};Dd(u,this.params_),this.imageSize_[0]=Wl($e(g)/i),this.imageSize_[1]=Wl(Ze(g)/i);const y=this.getRequestUrl_(g,this.imageSize_,o,r,u);return this.image_=new ly(g,t,o,y,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),c(this.image_,zd.CHANGE,this.handleImageChange,this),this.image_},VC.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},VC.prototype.getRequestUrl_=function(e,t,o,r,i){if(k(void 0!==this.url_,9),i[this.v13_?'CRS':'SRS']=r.getCode(),'STYLES'in this.params_||(i.STYLES=''),1!=o)switch(this.serverType_){case jC.GEOSERVER:const e=0|90*o+.5;'FORMAT_OPTIONS'in i?i.FORMAT_OPTIONS+=';dpi:'+e:i.FORMAT_OPTIONS='dpi:'+e;break;case jC.MAPSERVER:i.MAP_RESOLUTION=90*o;break;case jC.CARMENTA_SERVER:case jC.QGIS:i.DPI=90*o;break;default:k(!1,8);}i.WIDTH=t[0],i.HEIGHT=t[1];const n=r.getAxisOrientation();let a;return a=this.v13_&&'ne'==n.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,i.BBOX=a.join(','),bl(this.url_,i)},VC.prototype.getUrl=function(){return this.url_},VC.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},VC.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},VC.prototype.updateParams=function(e){Dd(this.params_,e),this.updateV13_(),this.image_=null,this.changed()},VC.prototype.updateV13_=function(){const e=this.params_.VERSION||BC;this.v13_=0<=ie(e,'1.3')};const XC='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',WC=function(e){const t=e||{};let o=void 0===t.attributions?[XC]:t.attributions;const r=t.crossOrigin===void 0?'anonymous':t.crossOrigin,i=t.url===void 0?'https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png':t.url;FC.call(this,{attributions:o,cacheSize:t.cacheSize,crossOrigin:r,opaque:!(t.opaque!==void 0)||t.opaque,maxZoom:t.maxZoom===void 0?19:t.maxZoom,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:i,wrapX:t.wrapX})};i(WC,FC);var KC=o(5),HC=o.n(KC),ZC={PIXEL:'pixel',IMAGE:'image'};const qC={BEFOREOPERATIONS:'beforeoperations',AFTEROPERATIONS:'afteroperations'},JC=function(e,t,o){Bd.call(this,e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=o};i(JC,Bd);const QC=function(e){this.worker_=null,this.operationType_=e.operationType===void 0?ZC.PIXEL:e.operationType,this.threads_=e.threads===void 0?1:e.threads,this.renderers_=kl(e.sources);for(let t=0,o=this.renderers_.length;t<o;++t)c(this.renderers_[t],zd.CHANGE,this.changed,this);this.tileQueue_=new Xp(function(){return 1},this.changed.bind(this));const t=Dl(this.renderers_),o={};for(let r=0,i=t.length;r<i;++r)o[n(t[r].layer)]=t[r];this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Yt(),extent:null,focus:null,index:0,layerStates:o,layerStatesArray:t,pixelRatio:1,pixelToCoordinateTransform:Yt(),postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}},GC.call(this,{}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)};i(QC,GC),QC.prototype.setOperation=function(e,t){this.worker_=new KC.Processor({operation:e,imageOps:this.operationType_===ZC.IMAGE,queue:1,lib:t,threads:this.threads_}),this.changed()},QC.prototype.updateFrameState_=function(e,t,o){const r=Dd({},this.frameState_);r.viewState=Dd({},r.viewState);const i=We(e);r.extent=e.slice(),r.focus=i,r.size[0]=Wl($e(e)/t),r.size[1]=Wl(Ze(e)/t),r.time=Date.now(),r.animate=!1;const n=r.viewState;return n.center=i,n.projection=o,n.resolution=t,r},QC.prototype.allSourcesReady_=function(){let e=!0,t;for(let o=0,r=this.renderers_.length;o<r;++o)if(t=this.renderers_[o].getLayer().getSource(),t.getState()!==Mg.READY){e=!1;break}return e},QC.prototype.getImage=function(e,t,o,r){if(!this.allSourcesReady_())return null;const i=this.updateFrameState_(e,t,r);if(this.requestedFrameState_=i,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),r=this.renderedImageCanvas_.getExtent();t===o&&Ge(e,r)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),i.tileQueue.loadMoreTiles(16,16),i.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_},QC.prototype.processSources_=function(){const e=this.requestedFrameState_,t=this.renderers_.length,o=Array(t);for(let r=0;r<t;++r){const t=Gl(this.renderers_[r],e,e.layerStatesArray[r]);if(t)o[r]=t;else return}const r={};this.dispatchEvent(new JC(qC.BEFOREOPERATIONS,e,r)),this.worker_.process(o,r,this.onWorkerComplete_.bind(this,e))},QC.prototype.onWorkerComplete_=function(e,t,o,r){if(t||!o)return;const i=e.extent,n=e.viewState.resolution;if(n!==this.requestedFrameState_.viewState.resolution||!Ge(i,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext('2d');else{const e=Wl($e(i)/n),t=Wl(Ze(i)/n);a=Jo(e,t),this.renderedImageCanvas_=new ru(i,n,1,a.canvas)}a.putImageData(o,0,0),this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new JC(qC.AFTEROPERATIONS,e,r))};let $C=null;QC.prototype.getImageInternal=function(){return null};const eR=['Map tiles by <a href="https://stamen.com/">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.',XC],tR={terrain:{extension:'jpg',opaque:!0},"terrain-background":{extension:'jpg',opaque:!0},"terrain-labels":{extension:'png',opaque:!1},"terrain-lines":{extension:'png',opaque:!1},"toner-background":{extension:'png',opaque:!0},toner:{extension:'png',opaque:!0},"toner-hybrid":{extension:'png',opaque:!1},"toner-labels":{extension:'png',opaque:!1},"toner-lines":{extension:'png',opaque:!1},"toner-lite":{extension:'png',opaque:!0},watercolor:{extension:'jpg',opaque:!0}},oR={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:1,maxZoom:16}},rR=function(e){const t=e.layer.indexOf('-'),o=-1==t?e.layer:e.layer.slice(0,t),r=oR[o],i=tR[e.layer],n=e.url===void 0?'https://stamen-tiles-{a-d}.a.ssl.fastly.net/'+e.layer+'/{z}/{x}/{y}.'+i.extension:e.url;FC.call(this,{attributions:eR,cacheSize:e.cacheSize,crossOrigin:'anonymous',maxZoom:e.maxZoom==void 0?r.maxZoom:e.maxZoom,minZoom:e.minZoom==void 0?r.minZoom:e.minZoom,opaque:i.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:n,wrapX:e.wrapX})};i(rR,FC);const iR=function(e){const t=e||{};LC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:!(t.wrapX!==void 0)||t.wrapX,transition:t.transition}),this.params_=t.params||{},this.tmpExtent_=Oe(),this.setKey(this.getKeyForParams_())};i(iR,LC),iR.prototype.getKeyForParams_=function(){let e=0;const t=[];for(const o in this.params_)t[e++]=o+'-'+this.params_[o];return t.join('/')},iR.prototype.getParams=function(){return this.params_},iR.prototype.getRequestUrl_=function(e,t,o,r,i,n){const a=this.urls;if(!a)return;const s=i.getCode().split(':').pop();n.SIZE=t[0]+','+t[1],n.BBOX=o.join(','),n.BBOXSR=s,n.IMAGESR=s,n.DPI=Wl(n.DPI?n.DPI*r:90*r);let l;if(1==a.length)l=a[0];else{const t=W(ml(e),a.length);l=a[t]}const d=l.replace(/MapServer\/?$/,'MapServer/export').replace(/ImageServer\/?$/,'ImageServer/exportImage');return bl(d,n)},iR.prototype.getTilePixelRatio=function(e){return e},iR.prototype.fixedTileUrlFunction=function(e,t,o){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(o)),r.getResolutions().length<=e[0])return;const i=r.getTileCoordExtent(e,this.tmpExtent_);let n=pr(r.getTileSize(e[0]),this.tmpSize);1!=t&&(n=dr(n,t,this.tmpSize));const a={F:'image',FORMAT:'PNG32',TRANSPARENT:!0};return Dd(a,this.params_),this.getRequestUrl_(e,n,i,t,o,a)},iR.prototype.updateParams=function(e){Dd(this.params_,e),this.setKey(this.getKeyForParams_())};const nR=function(e,t,o){py.call(this,e,Yp.LOADED),this.tileSize_=t,this.text_=o,this.canvas_=null};i(nR,py),nR.prototype.getImage=function(){if(this.canvas_)return this.canvas_;else{const e=this.tileSize_,t=Jo(e[0],e[1]);return t.strokeStyle='black',t.strokeRect(.5,.5,e[0]+.5,e[1]+.5),t.fillStyle='black',t.textAlign='center',t.textBaseline='middle',t.font='24px sans-serif',t.fillText(this.text_,e[0]/2,e[1]/2),this.canvas_=t.canvas,t.canvas}},nR.prototype.load=function(){};const aR=function(e){TC.call(this,{opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:!(e.wrapX!==void 0)||e.wrapX})};i(aR,TC),aR.prototype.getTile=function(e,t,o){const r=ul(e,t,o);if(this.tileCache.containsKey(r))return this.tileCache.get(r);else{const i=pr(this.tileGrid.getTileSize(e)),n=[e,t,o],a=this.getTileCoordForTileUrlFunction(n),s=a?this.getTileCoordForTileUrlFunction(a).toString():'',l=new nR(n,i,s);return this.tileCache.set(r,l),l}};const sR=function(e){if(this.tileJSON_=null,LC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:vt('EPSG:3857'),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:Mg.LOADING,tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition}),!e.url)e.tileJSON?this.handleTileJSONResponse(e.tileJSON):k(!1,51);else if(e.jsonp)Rl(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener('load',this.onXHRLoad_.bind(this)),t.addEventListener('error',this.onXHRError_.bind(this)),t.open('GET',e.url),t.send()}};i(sR,LC),sR.prototype.onXHRLoad_=function(e){const t=e.target;if(!t.status||200<=t.status&&300>t.status){let e;try{e=JSON.parse(t.responseText)}catch(e){return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()},sR.prototype.onXHRError_=function(){this.handleTileJSONError()},sR.prototype.getTileJSON=function(){return this.tileJSON_},sR.prototype.handleTileJSONResponse=function(e){const t=vt('EPSG:4326'),o=this.getProjection();let r;if(void 0!==e.bounds){const i=Gt(t,o);r=nt(e.bounds,i)}const i=e.minzoom||0,n=e.maxzoom||22,a=vl({extent:wl(o),maxZoom:n,minZoom:i});if(this.tileGrid=a,this.tileUrlFunction=xl(e.tiles,a),void 0!==e.attribution&&!this.getAttributions()){const o=void 0===r?t.getExtent():r;this.setAttributions(function(t){return et(o,t.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState(Mg.READY)},sR.prototype.handleTileJSONError=function(){this.setState(Mg.ERROR)};const lR=function(e,t,o,r,i,n){py.call(this,e,t),this.src_=o,this.extent_=r,this.preemptive_=i,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=n};i(lR,py),lR.prototype.getImage=function(){return null},lR.prototype.getData=function(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),o=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Ql((1-o)*this.grid_.length)];if('string'!=typeof r)return null;let i=r.charCodeAt(Ql(t*r.length));93<=i&&i--,35<=i&&i--,i-=32;let n=null;if(i in this.keys_){const e=this.keys_[i];n=this.data_&&e in this.data_?this.data_[e]:e}return n},lR.prototype.forDataAtCoordinate=function(e,t,o,r){this.state==Yp.IDLE&&!0===r?(y(this,zd.CHANGE,function(){t.call(o,this.getData(e))},this),this.loadInternal_()):!0===r?setTimeout(function(){t.call(o,this.getData(e))}.bind(this),0):t.call(o,this.getData(e))},lR.prototype.getKey=function(){return this.src_},lR.prototype.handleError_=function(){this.state=Yp.ERROR,this.changed()},lR.prototype.handleLoad_=function(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=Yp.EMPTY,this.changed()},lR.prototype.loadInternal_=function(){if(this.state==Yp.IDLE)if(this.state=Yp.LOADING,this.jsonp_)Rl(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener('load',this.onXHRLoad_.bind(this)),e.addEventListener('error',this.onXHRError_.bind(this)),e.open('GET',this.src_),e.send()}},lR.prototype.onXHRLoad_=function(e){const t=e.target;if(!t.status||200<=t.status&&300>t.status){let e;try{e=JSON.parse(t.responseText)}catch(e){return void this.handleError_()}this.handleLoad_(e)}else this.handleError_()},lR.prototype.onXHRError_=function(){this.handleError_()},lR.prototype.load=function(){this.preemptive_&&this.loadInternal_()};const dR=function(e){if(TC.call(this,{projection:vt('EPSG:3857'),state:Mg.LOADING}),this.preemptive_=void 0===e.preemptive||e.preemptive,this.tileUrlFunction_=Sl,this.template_=void 0,this.jsonp_=e.jsonp||!1,!e.url)e.tileJSON?this.handleTileJSONResponse(e.tileJSON):k(!1,51);else if(this.jsonp_)Rl(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener('load',this.onXHRLoad_.bind(this)),t.addEventListener('error',this.onXHRError_.bind(this)),t.open('GET',e.url),t.send()}};i(dR,TC),dR.prototype.onXHRLoad_=function(e){const t=e.target;if(!t.status||200<=t.status&&300>t.status){let e;try{e=JSON.parse(t.responseText)}catch(e){return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()},dR.prototype.onXHRError_=function(){this.handleTileJSONError()},dR.prototype.getTemplate=function(){return this.template_},dR.prototype.forDataAtCoordinateAndResolution=function(e,t,o,r){if(this.tileGrid){const i=this.tileGrid.getTileCoordForCoordAndResolution(e,t),n=this.getTile(i[0],i[1],i[2],1,this.getProjection());n.forDataAtCoordinate(e,o,null,r)}else!0===r?setTimeout(function(){o(null)},0):o(null)},dR.prototype.handleTileJSONError=function(){this.setState(Mg.ERROR)},dR.prototype.handleTileJSONResponse=function(e){const t=vt('EPSG:4326'),o=this.getProjection();let r;if(void 0!==e.bounds){const i=Gt(t,o);r=nt(e.bounds,i)}const i=e.minzoom||0,n=e.maxzoom||22,a=vl({extent:wl(o),maxZoom:n,minZoom:i});this.tileGrid=a,this.template_=e.template;const s=e.grids;if(!s)return void this.setState(Mg.ERROR);if(this.tileUrlFunction_=xl(s,a),void 0!==e.attribution){const o=void 0===r?t.getExtent():r;this.setAttributions(function(t){return et(o,t.extent)?[e.attribution]:null})}this.setState(Mg.READY)},dR.prototype.getTile=function(e,t,o,r,i){const n=ul(e,t,o);if(this.tileCache.containsKey(n))return this.tileCache.get(n);else{const a=[e,t,o],s=this.getTileCoordForTileUrlFunction(a,i),l=this.tileUrlFunction_(s,r,i),d=new lR(a,void 0===l?Yp.EMPTY:Yp.IDLE,void 0===l?'':l,this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(n,d),d}},dR.prototype.useTile=function(e,t,o){const r=ul(e,t,o);this.tileCache.containsKey(r)&&this.tileCache.get(r)};const pR=function(e){const t=e||{},o=t.params||{},r=!('TRANSPARENT'in o)||o.TRANSPARENT;LC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:!r,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:!(t.wrapX!==void 0)||t.wrapX,transition:t.transition}),this.gutter_=t.gutter===void 0?0:t.gutter,this.params_=o,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=!(t.hidpi!==void 0)||t.hidpi,this.tmpExtent_=Oe(),this.updateV13_(),this.setKey(this.getKeyForParams_())};i(pR,LC),pR.prototype.getGetFeatureInfoUrl=function(e,t,o,r){const i=vt(o),n=this.getProjection();let a=this.getTileGrid();a||(a=this.getTileGridForProjection(i));const s=a.getTileCoordForCoordAndResolution(e,t);if(a.getResolutions().length<=s[0])return;let l=a.getResolution(s[0]),d=a.getTileCoordExtent(s,this.tmpExtent_),p=pr(a.getTileSize(s[0]),this.tmpSize);const g=this.gutter_;0!==g&&(p=sr(p,g,this.tmpSize),d=Ce(d,l*g,d)),n&&n!==i&&(l=dl(n,i,e,l),d=Ut(d,i,n),e=kt(e,i,n));const _={SERVICE:'WMS',VERSION:BC,REQUEST:'GetFeatureInfo',FORMAT:'image/png',TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Dd(_,this.params_,r);const u=Ql((e[0]-d[0])/l),c=Ql((d[3]-e[1])/l);return _[this.v13_?'I':'X']=u,_[this.v13_?'J':'Y']=c,this.getRequestUrl_(s,p,d,1,n||i,_)},pR.prototype.getGutterInternal=function(){return this.gutter_},pR.prototype.getParams=function(){return this.params_},pR.prototype.getRequestUrl_=function(e,t,o,r,i,n){const a=this.urls;if(!a)return;if(n.WIDTH=t[0],n.HEIGHT=t[1],n[this.v13_?'CRS':'SRS']=i.getCode(),'STYLES'in this.params_||(n.STYLES=''),1!=r)switch(this.serverType_){case jC.GEOSERVER:const e=0|90*r+.5;'FORMAT_OPTIONS'in n?n.FORMAT_OPTIONS+=';dpi:'+e:n.FORMAT_OPTIONS='dpi:'+e;break;case jC.MAPSERVER:n.MAP_RESOLUTION=90*r;break;case jC.CARMENTA_SERVER:case jC.QGIS:n.DPI=90*r;break;default:k(!1,52);}const s=i.getAxisOrientation(),l=o;if(this.v13_&&'ne'==s.substr(0,2)){let e;e=o[0],l[0]=o[1],l[1]=e,e=o[2],l[2]=o[3],l[3]=e}n.BBOX=l.join(',');let d;if(1==a.length)d=a[0];else{const t=W(ml(e),a.length);d=a[t]}return bl(d,n)},pR.prototype.getTilePixelRatio=function(e){return this.hidpi_&&this.serverType_!==void 0?e:1},pR.prototype.getKeyForParams_=function(){let e=0;const t=[];for(const o in this.params_)t[e++]=o+'-'+this.params_[o];return t.join('/')},pR.prototype.fixedTileUrlFunction=function(e,t,o){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(o)),r.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const i=r.getResolution(e[0]);let n=r.getTileCoordExtent(e,this.tmpExtent_),a=pr(r.getTileSize(e[0]),this.tmpSize);const s=this.gutter_;0!==s&&(a=sr(a,s,this.tmpSize),n=Ce(n,i*s,n)),1!=t&&(a=dr(a,t,this.tmpSize));const l={SERVICE:'WMS',VERSION:BC,REQUEST:'GetMap',FORMAT:'image/png',TRANSPARENT:!0};return Dd(l,this.params_),this.getRequestUrl_(e,a,n,t,o,l)},pR.prototype.updateParams=function(e){Dd(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())},pR.prototype.updateV13_=function(){const e=this.params_.VERSION||BC;this.v13_=0<=ie(e,'1.3')};const gR=function(e){const t=e.projection||'EPSG:3857',o=e.extent||wl(t),r=e.tileGrid||vl({extent:o,maxZoom:e.maxZoom||22,minZoom:e.minZoom,tileSize:e.tileSize||512});RC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize===void 0?128:e.cacheSize,extent:o,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ji,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:!(e.wrapX!==void 0)||e.wrapX,transition:e.transition}),this.format_=e.format?e.format:null,this.sourceTiles_={},this.overlaps_=!(e.overlaps!=void 0)||e.overlaps,this.tileClass=e.tileClass?e.tileClass:jm,this.tileGrids_={}};i(gR,RC),gR.prototype.getOverlaps=function(){return this.overlaps_},gR.prototype.clear=function(){this.tileCache.clear(),this.sourceTiles_={}},gR.prototype.getTile=function(e,t,o,r,i){const n=ul(e,t,o);if(this.tileCache.containsKey(n))return this.tileCache.get(n);else{const a=[e,t,o],s=this.getTileCoordForTileUrlFunction(a,i),l=new Bm(a,null===s?Yp.EMPTY:Yp.IDLE,this.getRevision(),this.format_,this.tileLoadFunction,s,this.tileUrlFunction,this.tileGrid,this.getTileGridForProjection(i),this.sourceTiles_,r,i,this.tileClass,this.handleTileChange.bind(this),this.tileOptions);return this.tileCache.set(n,l),l}},gR.prototype.getTileGridForProjection=function(e){const t=e.getCode();let o=this.tileGrids_[t];if(!o){const r=this.tileGrid;o=this.tileGrids_[t]=Ol(e,void 0,r?r.getTileSize(r.getMinZoom()):void 0)}return o},gR.prototype.getTilePixelRatio=function(e){return e},gR.prototype.getTilePixelSize=function(e,t,o){const r=this.getTileGridForProjection(o),i=pr(r.getTileSize(e),this.tmpSize);return[Wl(i[0]*t),Wl(i[1]*t)]};var _R={KVP:'KVP',REST:'REST'};const uR=function(e){this.matrixIds_=e.matrixIds,fC.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})};i(uR,fC),uR.prototype.getMatrixId=function(e){return this.matrixIds_[e]},uR.prototype.getMatrixIds=function(){return this.matrixIds_};const cR=function(e){this.version_=e.version===void 0?'1.0.0':e.version,this.format_=e.format===void 0?'image/jpeg':e.format,this.dimensions_=e.dimensions===void 0?{}:e.dimensions,this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style;let t=e.urls;t===void 0&&e.url!==void 0&&(t=Cl(e.url)),this.requestEncoding_=e.requestEncoding===void 0?_R.KVP:e.requestEncoding;const o=this.requestEncoding_,r=e.tileGrid,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};o==_R.KVP&&Dd(i,{Service:'WMTS',Request:'GetTile',Version:this.version_,Format:this.format_});const n=this.dimensions_;this.createFromWMTSTemplate_=function(e){return e=o==_R.KVP?bl(e,i):e.replace(/\{(\w+?)\}/g,function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e}),function(t){if(!t)return;else{const i={TileMatrix:r.getMatrixId(t[0]),TileCol:t[1],TileRow:-t[2]-1};Dd(i,n);let a=e;return a=o==_R.KVP?bl(a,i):a.replace(/\{(\w+?)\}/g,function(e,t){return i[t]}),a}}};const a=t&&0<t.length?Tl(t.map(this.createFromWMTSTemplate_)):Sl;LC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:a,urls:t,wrapX:e.wrapX!==void 0&&e.wrapX,transition:e.transition}),this.setKey(this.getKeyForDimensions_())};i(cR,LC),cR.prototype.setUrls=function(e){this.urls=e;const t=e.join('\n');this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):Tl(e.map(this.createFromWMTSTemplate_.bind(this))),t)},cR.prototype.getDimensions=function(){return this.dimensions_},cR.prototype.getFormat=function(){return this.format_},cR.prototype.getLayer=function(){return this.layer_},cR.prototype.getMatrixSet=function(){return this.matrixSet_},cR.prototype.getRequestEncoding=function(){return this.requestEncoding_},cR.prototype.getStyle=function(){return this.style_},cR.prototype.getVersion=function(){return this.version_},cR.prototype.getKeyForDimensions_=function(){let e=0;const t=[];for(const o in this.dimensions_)t[e++]=o+'-'+this.dimensions_[o];return t.join('/')},cR.prototype.updateDimensions=function(e){Dd(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())};const yR={DEFAULT:'default',TRUNCATED:'truncated'},mR=function(e,t,o,r,i,n,a){_y.call(this,t,o,r,i,n,a),this.zoomifyImage_=null,this.tileSize_=pr(e.getTileSize(t[0]))};i(mR,_y),mR.prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=_y.prototype.getImage.call(this);if(this.state==Yp.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;else{const o=Jo(t[0],t[1]);return o.drawImage(e,0,0),this.zoomifyImage_=o.canvas,o.canvas}}else return e};const hR=function(e){const t=e||{},o=t.size,r=t.tierSizeCalculation===void 0?yR.DEFAULT:t.tierSizeCalculation,i=o[0],n=o[1],a=t.extent||[0,-o[1],o[0],0],s=[],l=t.tileSize||Kp;let d=l;switch(r){case yR.DEFAULT:for(;i>d||n>d;)s.push([sd(i/d),sd(n/d)]),d+=d;break;case yR.TRUNCATED:for(let e=i,t=n;e>d||t>d;)s.push([sd(e/d),sd(t/d)]),e>>=1,t>>=1;break;default:k(!1,53);}s.push([1,1]),s.reverse();const p=[1],g=[0];for(let t=1,o=s.length;t<o;t++)p.push(1<<t),g.push(s[t-1][0]*s[t-1][1]+g[t-1]);p.reverse();const _=new fC({tileSize:l,extent:a,origin:Je(a),resolutions:p});let u=t.url;u&&-1==u.indexOf('{TileGroup}')&&-1==u.indexOf('{tileIndex}')&&(u+='{TileGroup}/{z}-{x}-{y}.jpg');const c=Cl(u),y=Tl(c.map(function(e){return function(t){if(!t)return;else{const o=t[0],r=t[1],i=-t[2]-1,n=r+i*s[o][0],a=_.getTileSize(o),l=0|(n+g[o])/a,d={z:o,x:r,y:i,tileIndex:n,TileGroup:'TileGroup'+l};return e.replace(/\{(\w+?)\}/g,function(e,t){return d[t]})}}})),m=mR.bind(null,_);LC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:m,tileGrid:_,tileUrlFunction:y,transition:t.transition})};i(hR,LC);const fR=window.ol={};fR.color={},fR.colorlike={},fR.control={},fR.coordinate={},fR.easing={},fR.events={},fR.events.condition={},fR.extent={},fR.featureloader={},fR.format={},fR.format.filter={},fR.geom={},fR.has={},fR.interaction={},fR.layer={},fR.loadingstrategy={},fR.proj={},fR.proj.Units={},fR.proj.proj4={},fR.render={},fR.render.canvas={},fR.renderer={},fR.renderer.canvas={},fR.renderer.webgl={},fR.size={},fR.source={},fR.sphere={},fR.style={},fR.tilegrid={},fR.xml={},fR.CanvasMap=Gc,fR.Collection=ep,fR.Feature=Jc,fR.Geolocation=$c,fR.Graticule=ay,fR.Kinetic=d_,fR.Map=Mm,fR.Object=qd,fR.Observable=Wd,fR.Observable.unByKey=function(e){if(Array.isArray(e))for(let t=0,o=e.length;t<o;++t)h(e[t]);else h(e)},fR.Overlay=Um,fR.PluggableMap=Xg,fR.View=wg,fR.color.asArray=$r,fR.color.asString=Jr,fR.colorlike.asColorLike=ri,fR.control.Attribution=r_,fR.control.Attribution.render=ur,fR.control.Control=Kg,fR.control.FullScreen=Xm,fR.control.MousePosition=Hm,fR.control.MousePosition.render=Hi,fR.control.OverviewMap=Jm,fR.control.OverviewMap.render=Zi,fR.control.Rotate=n_,fR.control.Rotate.render=cr,fR.control.ScaleLine=th,fR.control.ScaleLine.render=qi,fR.control.Zoom=s_,fR.control.ZoomSlider=rh,fR.control.ZoomSlider.render=Ji,fR.control.ZoomToExtent=ih,fR.control.defaults=yr,fR.coordinate.add=ne,fR.coordinate.createStringXY=function(e){return function(t){return me(t,e)}},fR.coordinate.format=de,fR.coordinate.rotate=ge,fR.coordinate.toStringHDMS=function(e,t){return e?le('NS',e[1],t)+' '+le('EW',e[0],t):''},fR.coordinate.toStringXY=me,fR.easing.easeIn=he,fR.easing.easeOut=fe,fR.easing.inAndOut=Ee,fR.easing.linear=xe,fR.easing.upAndDown=function(e){return .5>e?Ee(2*e):1-Ee(2*(e-.5))},fR.events.condition.altKeyOnly=y_,fR.events.condition.altShiftKeysOnly=m_,fR.events.condition.always=h_,fR.events.condition.click=function(e){return e.type==hp.CLICK},fR.events.condition.doubleClick=function(e){return e.type==hp.DBLCLICK},fR.events.condition.focus=function(e){return e.target.getTargetElement()===document.activeElement},fR.events.condition.mouseOnly=I_,fR.events.condition.never=E_,fR.events.condition.noModifierKeys=S_,fR.events.condition.platformModifierKeyOnly=function(e){const t=e.originalEvent;return!t.altKey&&(dp?t.metaKey:t.ctrlKey)&&!t.shiftKey},fR.events.condition.pointerMove=x_,fR.events.condition.primaryAction=L_,fR.events.condition.shiftKeyOnly=C_,fR.events.condition.singleClick=T_,fR.events.condition.targetNotEditable=R_,fR.extent.applyTransform=nt,fR.extent.boundingExtent=Te,fR.extent.buffer=Ce,fR.extent.containsCoordinate=Le,fR.extent.containsExtent=Pe,fR.extent.containsXY=ve,fR.extent.createEmpty=Oe,fR.extent.equals=Ge,fR.extent.extend=De,fR.extent.getArea=Ve,fR.extent.getBottomLeft=ze,fR.extent.getBottomRight=Xe,fR.extent.getCenter=We,fR.extent.getHeight=Ze,fR.extent.getIntersection=qe,fR.extent.getSize=function(e){return[e[2]-e[0],e[3]-e[1]]},fR.extent.getTopLeft=Je,fR.extent.getTopRight=Qe,fR.extent.getWidth=$e,fR.extent.intersects=et,fR.extent.isEmpty=tt,fR.featureloader.xhr=Bi,fR.format.EsriJSON=hh,fR.format.Feature=ah,fR.format.GML=Oh,fR.format.GML2=Ah,fR.format.GML3=Fh,fR.format.GPX=bh,fR.format.GeoJSON=sf,fR.format.IGC=uf,fR.format.KML=kf,fR.format.MVT=ex,fR.format.OSMXML=tx,fR.format.Polyline=ax,fR.format.Polyline.decodeDeltas=ja,fR.format.Polyline.decodeFloats=za,fR.format.Polyline.encodeDeltas=Ba,fR.format.Polyline.encodeFloats=Va,fR.format.TopoJSON=sx,fR.format.WFS=iT,fR.format.WFS.writeFilter=function(e){const t=sn(eT,'Filter');return as(t,e,[]),t},fR.format.WKT=hT,fR.format.WMSCapabilities=RT,fR.format.WMSGetFeatureInfo=VT,fR.format.WMTSCapabilities=aS,fR.format.filter.Bbox=mx,fR.format.filter.Contains=xx,fR.format.filter.During=Rx,fR.format.filter.EqualTo=vx,fR.format.filter.GreaterThan=Ox,fR.format.filter.GreaterThanOrEqualTo=Nx,fR.format.filter.Intersects=bx,fR.format.filter.IsBetween=Gx,fR.format.filter.IsLike=kx,fR.format.filter.IsNull=Yx,fR.format.filter.LessThan=jx,fR.format.filter.LessThanOrEqualTo=zx,fR.format.filter.Not=Wx,fR.format.filter.NotEqualTo=Hx,fR.format.filter.Or=Or,fR.format.filter.Within=Jx,fR.format.filter.and=os,fR.format.filter.bbox=rs,fR.format.filter.between=function(e,t,o){return new Gx(e,t,o)},fR.format.filter.contains=function(e,t,o){return new xx(e,t,o)},fR.format.filter.during=function(e,t,o){return new Rx(e,t,o)},fR.format.filter.equalTo=function(e,t,o){return new vx(e,t,o)},fR.format.filter.greaterThan=function(e,t){return new Ox(e,t)},fR.format.filter.greaterThanOrEqualTo=function(e,t){return new Nx(e,t)},fR.format.filter.intersects=function(e,t,o){return new bx(e,t,o)},fR.format.filter.isNull=function(e){return new Yx(e)},fR.format.filter.lessThan=function(e,t){return new jx(e,t)},fR.format.filter.lessThanOrEqualTo=function(e,t){return new zx(e,t)},fR.format.filter.like=function(e,t,o,r,i,n){return new kx(e,t,o,r,i,n)},fR.format.filter.not=function(e){return new Wx(e)},fR.format.filter.notEqualTo=function(e,t,o){return new Hx(e,t,o)},fR.format.filter.or=function(){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Or,e))},fR.format.filter.within=function(e,t,o){return new Jx(e,t,o)},fR.geom.Circle=TS,fR.geom.Geometry=xg,fR.geom.GeometryCollection=af,fR.geom.LineString=ty,fR.geom.LinearRing=Rg,fR.geom.MultiLineString=ph,fR.geom.MultiPoint=_h,fR.geom.MultiPolygon=ch,fR.geom.Point=Lg,fR.geom.Polygon=vg,fR.geom.Polygon.circular=Vo,fR.geom.Polygon.fromCircle=Xo,fR.geom.Polygon.fromExtent=zo,fR.geom.SimpleGeometry=Sg,fR.has.DEVICE_PIXEL_RATIO=pp,fR.has.GEOLOCATION=_p,fR.has.TOUCH=up,fR.has.WEBGL=mp,fR.inherits=i,fR.interaction.DoubleClickZoom=c_,fR.interaction.DragAndDrop=RS,fR.interaction.DragBox=D_,fR.interaction.DragPan=O_,fR.interaction.DragRotate=N_,fR.interaction.DragRotateAndZoom=IS,fR.interaction.DragZoom=U_,fR.interaction.Draw=kS,fR.interaction.Draw.createBox=function(){return function(e,t){const o=Te(e),r=t||new vg(null);return r.setCoordinates([[ze(o),Xe(o),Qe(o),Je(o),ze(o)]]),r}},fR.interaction.Draw.createRegularPolygon=function(e,t){return function(o,r){const i=o[0],n=o[1],a=id(ue(i,n)),s=r?r:Xo(new TS(i),e),l=t?t:Kl((n[1]-i[1])/(n[0]-i[0]));return Wo(s,i,a,l),s}},fR.interaction.Draw.handleEvent=Ns,fR.interaction.Extent=BS,fR.interaction.Interaction=__,fR.interaction.KeyboardPan=j_,fR.interaction.KeyboardZoom=z_,fR.interaction.Modify=zS,fR.interaction.MouseWheelZoom=K_,fR.interaction.PinchRotate=Z_,fR.interaction.PinchZoom=J_,fR.interaction.Pointer=v_,fR.interaction.Pointer.handleEvent=Ir,fR.interaction.Select=ZS,fR.interaction.Snap=qS,fR.interaction.Translate=$S,fR.interaction.defaults=Wr,fR.layer.Base=bg,fR.layer.Group=kg,fR.layer.Heatmap=oC,fR.layer.Image=nC,fR.layer.Layer=t_,fR.layer.Tile=lC,fR.layer.Vector=vS,fR.layer.VectorTile=dC,fR.loadingstrategy.all=Os,fR.loadingstrategy.bbox=function(e){return[e]},fR.loadingstrategy.tile=function(e){return function(t,o){const r=e.getZForResolution(o),i=e.getTileRangeForExtentAndZ(t,r),n=[],a=[r,0,0];for(a[1]=i.minX;a[1]<=i.maxX;++a[1])for(a[2]=i.minY;a[2]<=i.maxY;++a[2])n.push(e.getTileCoordExtent(a));return n}},fR.proj.Projection=ag,fR.proj.Units.METERS_PER_UNIT=rg,fR.proj.addCoordinateTransforms=bt,fR.proj.addEquivalentProjections=Ot,fR.proj.addProjection=Lt,fR.proj.equivalent=Mt,fR.proj.fromLonLat=function(e,t){return kt(e,'EPSG:4326',t===void 0?'EPSG:3857':t)},fR.proj.get=vt,fR.proj.getPointResolution=Ft,fR.proj.getTransform=Dt,fR.proj.proj4.register=function(e){const t=Object.keys(e.defs),o=t.length;let r,i;for(r=0;r<o;++r){const o=t[r];if(!vt(o)){const t=e.defs(o);Lt(new ag({code:o,axisOrientation:t.axis,metersPerUnit:t.to_meter,units:t.units}))}}for(r=0;r<o;++r){const n=t[r],a=vt(n);for(i=0;i<o;++i){const o=t[i],r=vt(o);if(!Ct(n,o))if(e.defs[n]===e.defs[o])Ot([a,r]);else{const t=e(n,o);bt(a,r,t.forward,t.inverse)}}}},fR.proj.toLonLat=function(e,t){const o=kt(e,void 0===t?'EPSG:3857':t,'EPSG:4326'),r=o[0];return(-180>r||180<r)&&(o[0]=W(r+180,360)-180),o},fR.proj.transform=kt,fR.proj.transformExtent=Ut,fR.render.VectorContext=Au,fR.render.canvas.labelCache=Su,fR.render.toContext=function(e,t){const o=e.canvas,r=t?t:{},i=r.pixelRatio||pp,n=r.size;n&&(o.width=n[0]*i,o.height=n[1]*i,o.style.width=n[0]+'px',o.style.height=n[1]+'px');const a=[0,0,o.width,o.height],s=Kt(Yt(),i,i);return new Mu(e,i,a,s,0)},fR.renderer.canvas.ImageLayer=Vu,fR.renderer.canvas.Map=Zu,fR.renderer.canvas.TileLayer=$u,fR.renderer.canvas.VectorLayer=Oc,fR.renderer.canvas.VectorTileLayer=Mc,fR.renderer.webgl.ImageLayer=Rm,fR.renderer.webgl.Map=Pm,fR.renderer.webgl.TileLayer=Nm,fR.renderer.webgl.VectorLayer=bm,fR.size.toSize=pr,fR.source.BingMaps=PC,fR.source.CartoDB=OC,fR.source.Cluster=wC,fR.source.Image=GC,fR.source.ImageArcGISRest=DC,fR.source.ImageCanvas=kC,fR.source.ImageMapGuide=UC,fR.source.ImageStatic=YC,fR.source.ImageWMS=VC,fR.source.OSM=WC,fR.source.OSM.ATTRIBUTION=XC,fR.source.Raster=QC,fR.source.Source=OS,fR.source.Stamen=rR,fR.source.Tile=TC,fR.source.TileArcGISRest=iR,fR.source.TileDebug=aR,fR.source.TileImage=LC,fR.source.TileJSON=sR,fR.source.TileUTFGrid=dR,fR.source.TileWMS=pR,fR.source.Vector=bS,fR.source.VectorTile=gR,fR.source.WMTS=cR,fR.source.WMTS.optionsFromCapabilities=Vl,fR.source.XYZ=FC,fR.source.Zoomify=hR,fR.sphere.getArea=ct,fR.sphere.getDistance=pt,fR.sphere.getLength=_t,fR.style.AtlasManager=pm,fR.style.Circle=jc,fR.style.Fill=zc,fR.style.Icon=Sf,fR.style.Image=kc,fR.style.RegularShape=Yc,fR.style.Stroke=Wc,fR.style.Style=Zc,fR.style.Text=ry,fR.style.iconImageCache=Xu,fR.tilegrid.TileGrid=fC,fR.tilegrid.WMTS=uR,fR.tilegrid.WMTS.createFromCapabilitiesMatrixSet=jl,fR.tilegrid.createXYZ=vl,fR.xml.getAllTextContent=ln,fR.xml.parse=un},function(e){var t=Math.floor;(function(t,o){e.exports=o()})(this,function(){'use strict';function e(r,a,l,d,p){for(;d>l;){if(600<d-l){var g=d-l+1,n=a-l+1,_=Math.log(g),u=.5*Math.exp(2*_/3),s=.5*Math.sqrt(_*u*(g-u)/g)*(0>n-g/2?-1:1),c=Math.max(l,t(a-n*u/g+s)),y=Math.min(d,t(a+(g-n)*u/g+s));e(r,a,c,y,p)}var m=r[a],h=l,i=d;for(o(r,l,a),0<p(r[d],m)&&o(r,l,d);h<i;){for(o(r,h,i),h++,i--;0>p(r[h],m);)h++;for(;0<p(r[i],m);)i--}0===p(r[l],m)?o(r,l,i):(i++,o(r,i,d)),i<=a&&(l=i+1),a<=i&&(d=i-1)}}function o(e,t,o){var r=e[t];e[t]=e[o],e[o]=r}function r(e,t){return e<t?-1:e>t?1:0}return function(t,o,i,n,a){e(t,o,i||0,n||t.length-1,a||r)}})},function(e,t,o){'use strict';function r(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}function i(e,t,o){var r=o.buf,i,n;if(n=r[o.pos++],i=(112&n)>>4,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<3,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<10,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<17,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<24,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(1&n)<<31,128>n)return a(e,i,t);throw new Error('Expected varint not more than 10 bytes')}function n(e){return e.type===r.Bytes?e.readVarint()+e.pos:e.pos+1}function a(e,t,o){return o?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function s(e,t){var o,r;if(0<=e?(o=0|e%4294967296,r=0|e/4294967296):(o=~(-e%4294967296),r=~(-e/4294967296),4294967295^o?o=0|o+1:(o=0,r=0|r+1)),0x10000000000000000<=e||-0x10000000000000000>e)throw new Error('Given varint doesn\'t fit into 10 bytes');t.realloc(10),l(o,r,t),d(r,t)}function l(e,t,o){o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos]=127&e}function d(e,t){var o=(7&e)<<4;(t.buf[t.pos++]|=o|((e>>>=3)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e))}function p(e,t,o){var r=16383>=t?1:2097151>=t?2:268435455>=t?3:Math.ceil(Math.log(t)/(7*Math.LN2));o.realloc(r);for(var n=o.pos-1;n>=e;n--)o.buf[n+r]=o.buf[n]}function g(e,t){for(var o=0;o<e.length;o++)t.writeVarint(e[o])}function _(e,t){for(var o=0;o<e.length;o++)t.writeSVarint(e[o])}function u(e,t){for(var o=0;o<e.length;o++)t.writeFloat(e[o])}function c(e,t){for(var o=0;o<e.length;o++)t.writeDouble(e[o])}function y(e,t){for(var o=0;o<e.length;o++)t.writeBoolean(e[o])}function m(e,t){for(var o=0;o<e.length;o++)t.writeFixed32(e[o])}function h(e,t){for(var o=0;o<e.length;o++)t.writeSFixed32(e[o])}function f(e,t){for(var o=0;o<e.length;o++)t.writeFixed64(e[o])}function E(e,t){for(var o=0;o<e.length;o++)t.writeSFixed64(e[o])}function x(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function T(e,t,o){e[o]=t,e[o+1]=t>>>8,e[o+2]=t>>>16,e[o+3]=t>>>24}function S(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function C(e,t,o){for(var r='',n=t;n<o;){var i=e[n],a=null,s=239<i?4:223<i?3:191<i?2:1;if(n+s>o)break;var l,d,p;1==s?128>i&&(a=i):2==s?(l=e[n+1],128==(192&l)&&(a=(31&i)<<6|63&l,127>=a&&(a=null))):3==s?(l=e[n+1],d=e[n+2],128==(192&l)&&128==(192&d)&&(a=(15&i)<<12|(63&l)<<6|63&d,(2047>=a||55296<=a&&57343>=a)&&(a=null))):4==s&&(l=e[n+1],d=e[n+2],p=e[n+3],128==(192&l)&&128==(192&d)&&128==(192&p)&&(a=(15&i)<<18|(63&l)<<12|(63&d)<<6|63&p,(65535>=a||1114112<=a)&&(a=null))),null===a?(a=65533,s=1):65535<a&&(a-=65536,r+=I(55296|1023&a>>>10),a=56320|1023&a),r+=I(a),n+=s}return r}function R(e,t,o){for(var r=0,i,n;r<t.length;r++){if(i=t.charCodeAt(r),!(55295<i&&57344>i))n&&(e[o++]=239,e[o++]=191,e[o++]=189,n=null);else if(!n){56319<i||r+1===t.length?(e[o++]=239,e[o++]=191,e[o++]=189):n=i;continue}else if(56320>i){e[o++]=239,e[o++]=191,e[o++]=189,n=i;continue}else i=65536|(n-55296<<10|i-56320),n=null;128>i?e[o++]=i:(2048>i?e[o++]=192|i>>6:(65536>i?e[o++]=224|i>>12:(e[o++]=240|i>>18,e[o++]=128|63&i>>12),e[o++]=128|63&i>>6),e[o++]=128|63&i)}return o}var I=String.fromCharCode,L=Math.floor;e.exports=r;var P=o(4);r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var v=4294967296,F=1/v;r.prototype={destroy:function(){this.buf=null},readFields:function(e,t,o){for(o=o||this.length;this.pos<o;){var r=this.readVarint(),i=this.pos;this.type=7&r,e(r>>3,t,this),this.pos===i&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=x(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=S(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=x(this.buf,this.pos)+x(this.buf,this.pos+4)*v;return this.pos+=8,e},readSFixed64:function(){var e=x(this.buf,this.pos)+S(this.buf,this.pos+4)*v;return this.pos+=8,e},readFloat:function(){var e=P.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=P.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,o,r;return(r=t[this.pos++],o=127&r,128>r)?o:(r=t[this.pos++],o|=(127&r)<<7,128>r)?o:(r=t[this.pos++],o|=(127&r)<<14,128>r)?o:(r=t[this.pos++],o|=(127&r)<<21,128>r)?o:(r=t[this.pos],o|=(15&r)<<28,i(o,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return 1==e%2?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=C(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var o=n(this);for(e=e||[];this.pos<o;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===r.Varint)for(;127<this.buf[this.pos++];);else if(t===r.Bytes)this.pos=this.readVarint()+this.pos;else if(t===r.Fixed32)this.pos+=4;else if(t===r.Fixed64)this.pos+=8;else throw new Error('Unimplemented type: '+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),T(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),T(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),T(this.buf,-1&e,this.pos),T(this.buf,L(e*F),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),T(this.buf,-1&e,this.pos),T(this.buf,L(e*F),this.pos+4),this.pos+=8},writeVarint:function(e){return(e=+e||0,268435455<e||0>e)?void s(e,this):void((this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),!(127>=e))&&(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),!(127>=e))&&(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),127>=e||(this.buf[this.pos++]=127&e>>>7)))},writeSVarint:function(e){this.writeVarint(0>e?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=e+'',this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=R(this.buf,e,this.pos);var o=this.pos-t;128<=o&&p(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(e){this.realloc(4),P.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),P.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=e[o]},writeRawMessage:function(e,t){this.pos++;var o=this.pos;e(t,this);var r=this.pos-o;128<=r&&p(o,r,this),this.pos=o-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,o){this.writeTag(e,r.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(e,t){this.writeMessage(e,g,t)},writePackedSVarint:function(e,t){this.writeMessage(e,_,t)},writePackedBoolean:function(e,t){this.writeMessage(e,y,t)},writePackedFloat:function(e,t){this.writeMessage(e,u,t)},writePackedDouble:function(e,t){this.writeMessage(e,c,t)},writePackedFixed32:function(e,t){this.writeMessage(e,m,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,h,t)},writePackedFixed64:function(e,t){this.writeMessage(e,f,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,E,t)},writeBytesField:function(e,t){this.writeTag(e,r.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,r.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,r.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,r.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}}},function(e,t){var o=Math.pow;t.read=function(t,r,n,a,l){var p=8*l-a-1,g=(1<<p)-1,_=g>>1,u=-7,c=n?l-1:0,i=n?-1:1,d=t[r+c],s,e;for(c+=i,s=d&(1<<-u)-1,d>>=-u,u+=p;0<u;s=256*s+t[r+c],c+=i,u-=8);for(e=s&(1<<-u)-1,s>>=-u,u+=a;0<u;e=256*e+t[r+c],c+=i,u-=8);if(0===s)s=1-_;else{if(s===g)return e?NaN:(d?-1:1)*Infinity;e+=o(2,a),s-=_}return(d?-1:1)*e*o(2,s-a)},t.write=function(t,r,n,a,l,p){var g=8*p-l-1,_=(1<<g)-1,u=_>>1,y=23===l?5.960464477539063e-8-6.617444900424222e-24:0,h=a?0:p-1,i=a?1:-1,d=0>r||0===r&&0>1/r?1:0,s,f,m;for(r=Math.abs(r),isNaN(r)||r===Infinity?(f=isNaN(r)?1:0,s=_):(s=Math.floor(Math.log(r)/Math.LN2),1>r*(m=o(2,-s))&&(s--,m*=2),r+=1<=s+u?y/m:y*o(2,1-u),2<=r*m&&(s++,m/=2),s+u>=_?(f=0,s=_):1<=s+u?(f=(r*m-1)*o(2,l),s+=u):(f=r*o(2,u-1)*o(2,l),s=0));8<=l;t[n+h]=255&f,h+=i,f/=256,l-=8);for(s=s<<l|f,g+=l;0<g;t[n+h]=255&s,h+=i,s/=256,g-=8);t[n+h-i]|=128*d}},function(e,t,o){var r=o(6);t.Processor=r},function(e,t,o){function r(e){function t(e,t,r){return o?new ImageData(e,t,r):{data:e,width:t,height:r}}var o=!0;try{new ImageData(10,10)}catch(e){o=!1}return function(o){var r=o.buffers,n=o.meta,a=o.imageOps,s=o.width,l=o.height,d=r.length,p=r[0].byteLength,g,_;if(a){var u=Array(d);for(_=0;_<d;++_)u[_]=t(new Uint8ClampedArray(r[_]),s,l);g=e(u,n).data}else{g=new Uint8ClampedArray(p);var c=Array(d),y=Array(d);for(_=0;_<d;++_)c[_]=new Uint8ClampedArray(r[_]),y[_]=[0,0,0,0];for(var m=0;m<p;m+=4){for(var i=0,h;i<d;++i)h=c[i],y[i][0]=h[m],y[i][1]=h[m+1],y[i][2]=h[m+2],y[i][3]=h[m+3];var f=e(y,n);g[m]=f[0],g[m+1]=f[1],g[m+2]=f[2],g[m+3]=f[3]}}return g.buffer}}function n(e,t){var o=Object.keys(e.lib||{}).map(function(t){return'var '+t+' = '+e.lib[t].toString()+';'}),i=o.concat(['var __minion__ = ('+r.toString()+')(',e.operation.toString(),');','self.addEventListener("message", function(event) {','  var buffer = __minion__(event.data);','  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);','});']),n=new Blob(i,{type:'text/javascript'}),a=URL.createObjectURL(n),s=new Worker(a);return s.addEventListener('message',t),s}function a(e,t){var o=r(e.operation);return{postMessage:function(e){setTimeout(function(){t({data:{buffer:o(e),meta:e.meta}})},0)}}}function i(e){this._imageOps=!!e.imageOps;var t=0===e.threads?0:this._imageOps?1:e.threads||1;var o=[];if(t)for(var r=0;r<t;++r)o[r]=n(e,this._onWorkerMessage.bind(this,r));else o[0]=a(e,this._onWorkerMessage.bind(this,0));this._workers=o,this._queue=[],this._maxQueueLength=e.queue||Infinity,this._running=0,this._dataLookup={},this._job=null}var s=Math.ceil,l=o(7).newImageData;i.prototype.process=function(e,t,o){this._enqueue({inputs:e,meta:t,callback:o}),this._dispatch()},i.prototype.destroy=function(){for(var e in this)this[e]=null;this._destroyed=!0},i.prototype._enqueue=function(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)},i.prototype._dispatch=function(){if(0===this._running&&0<this._queue.length){var e=this._job=this._queue.shift(),t=e.inputs[0].width,o=e.inputs[0].height,r=e.inputs.map(function(e){return e.data.buffer}),n=this._workers.length;if(this._running=n,1===n)this._workers[0].postMessage({buffers:r,meta:e.meta,imageOps:this._imageOps,width:t,height:o},r);else for(var a=e.inputs[0].data.length,l=4*s(a/4/n),d=0;d<n;++d){for(var i=d*l,p=[],g=0,_=r.length;g<_;++g)p.push(r[d].slice(i,i+l));this._workers[d].postMessage({buffers:p,meta:e.meta,imageOps:this._imageOps,width:t,height:o},p)}}},i.prototype._onWorkerMessage=function(e,t){this._destroyed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())},i.prototype._resolveJob=function(){var e=this._job,t=this._workers.length,o,r;if(1===t)o=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{var n=e.inputs[0].data.length;o=new Uint8ClampedArray(n),r=Array(n);for(var a=4*s(n/4/t),d=0;d<t;++d){var i=this._dataLookup[d].buffer,p=d*a;o.set(new Uint8ClampedArray(i),p),r[d]=this._dataLookup[d].meta}}this._job=null,this._dataLookup={},e.callback(null,l(o,e.inputs[0].width,e.inputs[0].height),r),this._dispatch()},e.exports=i},function(e,t){function o(e,t,o){if(r)return new ImageData(e,t,o);var n=i.createImageData(t,o);return n.data.set(e),n}var r=!0;try{new ImageData(10,10)}catch(e){r=!1}var i=document.createElement('canvas').getContext('2d');t.newImageData=o}]);
//# sourceMappingURL=ol.js.map