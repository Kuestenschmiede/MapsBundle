{"version":3,"sources":["webpack://olcs/webpack/universalModuleDefinition","webpack://olcs/webpack/bootstrap","webpack://olcs/./src/goog/asserts.js","webpack://olcs/./src/index.library.js","webpack://olcs/./src/olcs/AbstractSynchronizer.js","webpack://olcs/./src/olcs/AutoRenderLoop.js","webpack://olcs/./src/olcs/Camera.js","webpack://olcs/./src/olcs/FeatureConverter.js","webpack://olcs/./src/olcs/OLCesium.js","webpack://olcs/./src/olcs/OverlaySynchronizer.js","webpack://olcs/./src/olcs/RasterSynchronizer.js","webpack://olcs/./src/olcs/SynchronizedOverlay.js","webpack://olcs/./src/olcs/VectorSynchronizer.js","webpack://olcs/./src/olcs/core.js","webpack://olcs/./src/olcs/core/OLImageryProvider.js","webpack://olcs/./src/olcs/core/VectorLayerCounterpart.js","webpack://olcs/./src/olcs/util.js","webpack://olcs/external \"ol/Observable.js\"","webpack://olcs/external \"ol/Overlay.js\"","webpack://olcs/external \"ol/array.js\"","webpack://olcs/external \"ol/dom.js\"","webpack://olcs/external \"ol/easing.js\"","webpack://olcs/external \"ol/events.js\"","webpack://olcs/external \"ol/extent.js\"","webpack://olcs/external \"ol/geom/Geometry.js\"","webpack://olcs/external \"ol/geom/Point.js\"","webpack://olcs/external \"ol/geom/SimpleGeometry.js\"","webpack://olcs/external \"ol/index.js\"","webpack://olcs/external \"ol/layer/Group.js\"","webpack://olcs/external \"ol/layer/Image.js\"","webpack://olcs/external \"ol/layer/Layer.js\"","webpack://olcs/external \"ol/layer/Tile.js\"","webpack://olcs/external \"ol/layer/Vector.js\"","webpack://olcs/external \"ol/math.js\"","webpack://olcs/external \"ol/proj.js\"","webpack://olcs/external \"ol/source/Cluster.js\"","webpack://olcs/external \"ol/source/Image.js\"","webpack://olcs/external \"ol/source/ImageWMS.js\"","webpack://olcs/external \"ol/source/TileImage.js\"","webpack://olcs/external \"ol/source/TileWMS.js\"","webpack://olcs/external \"ol/source/Vector.js\"","webpack://olcs/external \"ol/style/Icon.js\""],"names":["exports","map","scene","view","getView","olLayers","getLayerGroup","getLayers","mapLayerGroup","layerMap","olLayerListenKeys","olGroupListenKeys_","prototype","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","layer","parents","olLayerWithParents","splice","olLayer","olLayerId","toString","googAsserts","assert","cesiumObjects","listenForGroupChanges_","createSingleLayerCounterparts","forEach","l","newOlLayerWithParents","concat","push","layerId","layerWithParents","onLayerChange","e","cesiumObjs","un","addCesiumObjects_","length","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","keys","key","olObservableUnByKey","removeLayer_","done","uuid","undefined","listenKeyArray","contentKeys","listenAddRemove","collection","on","event","element","bind","el","i","indexOf","removeAllCesiumObjects","objKey","object","destroy","ol3d","scene_","getCesiumScene","canvas_","canvas","_boundNotifyRepaintRequired","notifyRepaintRequired","repaintEventNames_","enable","requestRenderMode","repaintKey","addEventListener","window","getOlMap","disable","removeEventListener","restartRenderLoop","requestRender","cam_","camera","map_","view_","viewListenKey_","toLonLat_","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","input","opt_output","opt_dimension","dim","toLonLat","getProjection","fromLonLat","handleViewEvent_","readFromView","setHeading","heading","setRotation","getHeading","rotation","getRotation","setTilt","tilt","updateCamera_","getTilt","setDistance","distance","updateView","getDistance","setCenter","center","getCenter","setPosition","position","ll","carto","Cesium","Cartographic","getAltitude","setView","destination","Ellipsoid","WGS84","cartographicToCartesian","getPosition","cartesianToCartographic","pos","longitude","latitude","setAltitude","altitude","height","globe","getHeight","orientation","pitch","Math","PI_OVER_TWO","roll","moveBackward","checkCameraChange","resolution","getResolution","calcDistanceForResolution","ellipsoid","target","olcsCore","pickCenterPoint","bestTarget","positionCartographic","clone","Cartesian3","bestTargetCartographic","setResolution","calcResolutionForDistance","targetNormal","geocentricSurfaceNormal","targetToCamera","subtract","normalize","up","right","normal","y","x","angleBetween","cross","z","tiltAngle","acos","dot","isNaN","PI","opt_dontSync","old","current","viewMatrix","Matrix4","equalsEpsilon","fovy","frustum","metersPerUnit","getMetersPerUnit","visibleMapUnits","clientHeight","relativeCircumference","cos","abs","visibleMeters","requiredDistance","tan","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","evt","source","assertInstanceof","cancellers","olcsUtil","obj","feature","id","canceller","hasOwnProperty","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","geometry","color","opt_lineWidth","createInstance","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","options","flat","renderState","depthTest","enabled","lineWidth","instances","heightReference","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","constructor","GroundPrimitive","geometryInstances","appearance","PerInstanceColorAppearance","Primitive","extractColorFromOlStyle","style","outline","fillColor","getFill","getColor","strokeColor","getStroke","olColor","convertColorToCesium","extractLineWidthFromOlStyle","width","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","primitives","PrimitiveCollection","p1","add","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","billboards","bbOptions","bb","olCircleGeometryToCesium","projection","olGeometryCloneTo4326","getType","point","slice","getRadius","ol4326CoordinateToCesiumCartesian","radius","CircleGeometry","CircleOutlineGeometry","extrudedHeight","createStackedGroundCorridors","positions","previousDistance","max","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","ol4326CoordinateArrayToCsCartesians","getCoordinates","outlinePrimitive","PolylineMaterialAppearance","material","olStyleToCesium","PolylineGeometry","olPolygonGeometryToCesium","getGeometry","get","coordinates","extent","rectangle","Rectangle","fromDegrees","maxHeight","c","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","olPos","holes","PolygonGeometry","perPositionHeight","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","load","image","getImage","isImageLoaded","src","naturalHeight","naturalWidth","complete","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","opacity","getOpacity","Color","scale","getScale","verticalOrigin","VerticalOrigin","BOTTOM","cancelled","getSource","fuid","listener","isDestroyed","olEvents","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","Object","assign","cesiumOptions","model","Model","fromGltf","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","accumulate","geometries","functor","subgeos","getPoints","result","getLineStrings","getPolygons","fail","labels","LabelCollection","extentCenter","getExtent","first","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","Cartesian2","pixelOffset","font","getFont","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","horizontalOrigin","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","TOP","fill","stroke","getLineDash","Material","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getStyleFunction","call","Array","isArray","getGeometryFromFeature","opt_geom","geom3d","geomFuncRes","getGeometryFunction","olFeatureToCesium","context","geom","proj","newBillboardAddedCallback","featureBb","featureToCesiumMap","getGeometries","prims","bbs","result2","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","features","getFeatures","layerStyle","styles","prim","getRootPrimitive","convert","autoRenderLoop_","time_","time","JulianDate","now","to4326Transform_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","fillArea","container_","document","createElement","containerAttribute","createAttribute","value","setAttributeNode","targetElement","getElementById","appendChild","oc","getViewport","querySelector","parentNode","insertBefore","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","stopPropagation","canvasAttribute","supportsImageRenderingPixelated","imageRenderingValue","oncontextmenu","onselectstart","enabled_","pausedInteractions_","hiddenRootGroup_","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","UNIT_Z","camera_","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","SingleTileImageryProvider","url","imageryLayers","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers","createSynchronizers","handleResize_","credits","nextElementSibling","display","lastFrameTime_","renderId_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","BoundingSphere","eventHelper","EventHelper","postRender","updateTrackedEntity_","Camera","enableSuspendTerrainAdjustment","defineProperties","enableTilt","defaultDataSource","entities","remove","lookAtTransform","IDENTITY","to4326Transform","toCesiumPosition","coo","coo4326","CallbackProperty","TRANSPARENT","render_","cancelAnimationFrame","requestAnimationFrame","onAnimationFrame_","frameTime","interval","delta","julianDate","initializeFrame","update","trackedEntity","trackedState","getBoundingSphere","BoundingSphereState","DONE","render","state","PENDING","bs","FAILED","EntityView","mapProjection","clientWidth","resolutionScale","devicePixelRatio","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","visibility","interactions","throwOnUnitializedMap_","getInteractions","arr","clear","rootGroup","getVisible","setVisible","getOverlayContainer","classList","getOverlayContainerStopEvent","interaction","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","synchronizer","parent","overlayId","removedOverlay","removeOverlay","csOverlay","cesiumLayers_","ourLayers_","ImageryLayerCollection","olcsAbstractSynchronizer","removeAll","convertLayerToCesiumImageries","viewProj","tileLayerToImageryLayer","olLayerItem","updateCesiumLayerProperties","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","olArray","layer1","layer2","raiseToTop","scenePostRenderListenerRemover_","synchronizer_","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent_","olOverlay","getOptions","setProperties","getProperties","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","set","getScene","olDom","updatePixelPosition","container","stopEvent","insertFirst","handlePositionChanged","sourceProjection","getMap","cloneNode","Node","TEXT_NODE","dispatchEvent","MouseEvent","nodes","getElement","clonedNode","cartesian","fromDegreesArray","fromDegreesArrayHeights","ellipsoidBoundingSphere","occluder","Occluder","isPointVisible","cullingVolume","computeCullingVolume","direction","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","pixel","mapSize","updateRenderedPosition","removeNode","opt_converter","converter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","visible","layerVisible","show","csPrimitives","olListenKeys","onAddFeature","onRemoveFeature","Billboard","computePixelSizeAtCoordinate","magnitude","pixelSize","getPixelDimensions","computeBoundingBoxAtTarget","amount","transform","Transforms","eastNorthUpToFixedFrame","bottomLeft","multiplyByPoint","topRight","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","applyTransform","output","stride","createMatrixAtCoordinates","translation","ZERO","rawMatrix","quaternion","Quaternion","fromAxisAngle","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","angle","axis","opt_options","clamp","defaultValue","duration","easing","callback","lastProgress","oldTransform","start","Date","step","timestamp","timeDifference","progress","stepAngle","rotate","setHeadingUsingBottomCenter","bottomCenter","angleToZenith","computeAngleToZenith","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","fromTranslation","pickOnTerrainOrEllipsoid","ray","getPickRay","pick","pickEllipsoid","pickBottomPoint","bottom","computeSignedTiltAngleOnGlobe","Ray","IntersectionTests","rayEllipsoid","getPoint","signedAngleBetween","convertLongitudeRange","bottomFovRay","fovy2","matrix","second","a","b","cosine","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","provider","getUrl","getImageLoadFunction","sourceProps","attributions","getAttributions","params","getParams","getSourceProjection","isCesiumProjection","layerOptions","forcedExtent","cesiumLayer","ImageryLayer","csLayer","layerOpacity","alpha","coordinate","toCartesian","cartesians","proj4326","properties","byteToFloat","fromCssColorString","convertUrlToCesium","subdomains","re","match","exec","replace","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","resetToNorthZenith","Promise","resolve","reject","currentHeading","normalizeView","rotateAroundBottomCenter","constrainResolution","is3857","is4326","opt_fallbackProj","source_","projection_","fallbackProj_","ready_","credit_","tilingScheme_","rectangle_","proxy","proxy_","DefaultProxy","errorEvent_","Event","emptyCanvas_","handleSourceChanged_","tg","getTileGrid","getTileSize","getMaxZoom","getState","GeographicTilingScheme","WebMercatorTilingScheme","createCreditForSource","htmlOrAttr","html","getHTML","Credit","getTileCredits","level","requestImage","tileUrlFunction","getTileUrlFunction","z_","y_","getURL","ImageryProvider","loadImage","layerProjection","BillboardCollection","rootCollection_","param","supportsImageRenderingPixelatedResult_","imageRenderingValueResult_","setAttribute","tmp"],"mappings":"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","file":"olcesium.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"ol/Observable.js\"), require(\"ol/Overlay.js\"), require(\"ol/array.js\"), require(\"ol/dom.js\"), require(\"ol/easing.js\"), require(\"ol/events.js\"), require(\"ol/extent.js\"), require(\"ol/geom/Geometry.js\"), require(\"ol/geom/Point.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/index.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/Image.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/math.js\"), require(\"ol/proj.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/source/Image.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/Vector.js\"), require(\"ol/style/Icon.js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"ol/Observable.js\", \"ol/Overlay.js\", \"ol/array.js\", \"ol/dom.js\", \"ol/easing.js\", \"ol/events.js\", \"ol/extent.js\", \"ol/geom/Geometry.js\", \"ol/geom/Point.js\", \"ol/geom/SimpleGeometry.js\", \"ol/index.js\", \"ol/layer/Group.js\", \"ol/layer/Image.js\", \"ol/layer/Layer.js\", \"ol/layer/Tile.js\", \"ol/layer/Vector.js\", \"ol/math.js\", \"ol/proj.js\", \"ol/source/Cluster.js\", \"ol/source/Image.js\", \"ol/source/ImageWMS.js\", \"ol/source/TileImage.js\", \"ol/source/TileWMS.js\", \"ol/source/Vector.js\", \"ol/style/Icon.js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"olcs\"] = factory(require(\"ol/Observable.js\"), require(\"ol/Overlay.js\"), require(\"ol/array.js\"), require(\"ol/dom.js\"), require(\"ol/easing.js\"), require(\"ol/events.js\"), require(\"ol/extent.js\"), require(\"ol/geom/Geometry.js\"), require(\"ol/geom/Point.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/index.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/Image.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/math.js\"), require(\"ol/proj.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/source/Image.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/Vector.js\"), require(\"ol/style/Icon.js\"));\n\telse\n\t\troot[\"olcs\"] = factory(root[\"ol/Observable.js\"], root[\"ol/Overlay.js\"], root[\"ol/array.js\"], root[\"ol/dom.js\"], root[\"ol/easing.js\"], root[\"ol/events.js\"], root[\"ol/extent.js\"], root[\"ol/geom/Geometry.js\"], root[\"ol/geom/Point.js\"], root[\"ol/geom/SimpleGeometry.js\"], root[\"ol/index.js\"], root[\"ol/layer/Group.js\"], root[\"ol/layer/Image.js\"], root[\"ol/layer/Layer.js\"], root[\"ol/layer/Tile.js\"], root[\"ol/layer/Vector.js\"], root[\"ol/math.js\"], root[\"ol/proj.js\"], root[\"ol/source/Cluster.js\"], root[\"ol/source/Image.js\"], root[\"ol/source/ImageWMS.js\"], root[\"ol/source/TileImage.js\"], root[\"ol/source/TileWMS.js\"], root[\"ol/source/Vector.js\"], root[\"ol/style/Icon.js\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE_ol_Observable_js__, __WEBPACK_EXTERNAL_MODULE_ol_Overlay_js__, __WEBPACK_EXTERNAL_MODULE_ol_array_js__, __WEBPACK_EXTERNAL_MODULE_ol_dom_js__, __WEBPACK_EXTERNAL_MODULE_ol_easing_js__, __WEBPACK_EXTERNAL_MODULE_ol_events_js__, __WEBPACK_EXTERNAL_MODULE_ol_extent_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_Geometry_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_Point_js__, __WEBPACK_EXTERNAL_MODULE_ol_geom_SimpleGeometry_js__, __WEBPACK_EXTERNAL_MODULE_ol_index_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Group_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Image_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Layer_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Tile_js__, __WEBPACK_EXTERNAL_MODULE_ol_layer_Vector_js__, __WEBPACK_EXTERNAL_MODULE_ol_math_js__, __WEBPACK_EXTERNAL_MODULE_ol_proj_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_Cluster_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_Image_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_ImageWMS_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_TileImage_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_TileWMS_js__, __WEBPACK_EXTERNAL_MODULE_ol_source_Vector_js__, __WEBPACK_EXTERNAL_MODULE_ol_style_Icon_js__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.library.js\");\n","export default {\n  assert(condition) {\n    console.assert(condition);\n  },\n  assertInstanceof(object, type) {\n    console.assert(object instanceof type);\n  },\n  fail() {\n    console.fail();\n  },\n  assertNumber(number) {\n    console.assert(typeof number === 'number');\n  }\n};\n","import OLCesium from './olcs/OLCesium.js';\nexport default OLCesium;\n","/**\n * @module olcs.AbstractSynchronizer\n */\nimport googAsserts from 'goog/asserts.js';\nimport * as olBase from 'ol/index.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport * as olEvents from 'ol/events.js';\nimport olLayerGroup from 'ol/layer/Group.js';\n\n/**\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @constructor\n * @template T\n * @struct\n * @abstract\n * @api\n */\nconst exports = function(map, scene) {\n  /**\n   * @type {!ol.Map}\n   * @protected\n   */\n  this.map = map;\n\n  /**\n   * @type {ol.View}\n   * @protected\n   */\n  this.view = map.getView();\n\n  /**\n   * @type {!Cesium.Scene}\n   * @protected\n   */\n  this.scene = scene;\n\n  /**\n   * @type {ol.Collection.<ol.layer.Base>}\n   * @protected\n   */\n  this.olLayers = map.getLayerGroup().getLayers();\n\n  /**\n   * @type {ol.layer.Group}\n   */\n  this.mapLayerGroup = map.getLayerGroup();\n\n  /**\n   * Map of OpenLayers layer ids (from ol.getUid) to the Cesium ImageryLayers.\n   * Null value means, that we are unable to create equivalent layers.\n   * @type {Object.<string, ?Array.<T>>}\n   * @protected\n   */\n  this.layerMap = {};\n\n  /**\n   * Map of listen keys for OpenLayers layer layers ids (from ol.getUid).\n   * @type {!Object.<string, Array<ol.EventsKey>>}\n   * @protected\n   */\n  this.olLayerListenKeys = {};\n\n  /**\n   * Map of listen keys for OpenLayers layer groups ids (from ol.getUid).\n   * @type {!Object.<string, !Array.<ol.EventsKey>>}\n   * @private\n   */\n  this.olGroupListenKeys_ = {};\n};\n\n\n/**\n * Destroy all and perform complete synchronization of the layers.\n * @api\n */\nexports.prototype.synchronize = function() {\n  this.destroyAll();\n  this.addLayers_(this.mapLayerGroup);\n};\n\n\n/**\n * Order counterparts using the same algorithm as the Openlayers renderer:\n * z-index then original sequence order.\n * @protected\n */\nexports.prototype.orderLayers = function() {\n  // Ordering logics is handled in subclasses.\n};\n\n\n/**\n * Add a layer hierarchy.\n * @param {ol.layer.Base} root\n * @private\n */\nexports.prototype.addLayers_ = function(root) {\n  /** @type {Array<olcsx.LayerWithParents>} */\n  const fifo = [{\n    layer: root,\n    parents: []\n  }];\n  while (fifo.length > 0) {\n    const olLayerWithParents = fifo.splice(0, 1)[0];\n    const olLayer = olLayerWithParents.layer;\n    const olLayerId = olBase.getUid(olLayer).toString();\n    this.olLayerListenKeys[olLayerId] = [];\n    googAsserts.assert(!this.layerMap[olLayerId]);\n\n    let cesiumObjects = null;\n    if (olLayer instanceof olLayerGroup) {\n      this.listenForGroupChanges_(olLayer);\n      if (olLayer !== this.mapLayerGroup) {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n      }\n      if (!cesiumObjects) {\n        olLayer.getLayers().forEach((l) => {\n          if (l) {\n            const newOlLayerWithParents = {\n              layer: l,\n              parents: olLayer === this.mapLayerGroup ?\n                [] :\n                [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n            };\n            fifo.push(newOlLayerWithParents);\n          }\n        });\n      }\n    } else {\n      cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n      if (!cesiumObjects) {\n        // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n        // for example when a source is set after the layer is added to the map\n        const layerId = olLayerId;\n        const layerWithParents = olLayerWithParents;\n        const onLayerChange = (e) => {\n          const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n          if (cesiumObjs) {\n            // unsubscribe event listener\n            layerWithParents.layer.un('change', onLayerChange, this);\n            this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n            this.orderLayers();\n          }\n        };\n        this.olLayerListenKeys[olLayerId].push(olEvents.listen(layerWithParents.layer, 'change', onLayerChange, this));\n      }\n    }\n    // add Cesium layers\n    if (cesiumObjects) {\n      this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n    }\n  }\n\n  this.orderLayers();\n};\n\n/**\n * Add Cesium objects.\n * @param {Array.<T>} cesiumObjects\n * @param {string} layerId\n * @param {ol.layer.Base} layer\n * @private\n */\nexports.prototype.addCesiumObjects_ = function(cesiumObjects, layerId, layer) {\n  this.layerMap[layerId] = cesiumObjects;\n  this.olLayerListenKeys[layerId].push(olEvents.listen(layer, 'change:zIndex', this.orderLayers, this));\n  cesiumObjects.forEach((cesiumObject) => {\n    this.addCesiumObject(cesiumObject);\n  });\n};\n\n\n/**\n * Remove and destroy a single layer.\n * @param {ol.layer.Layer} layer\n * @return {boolean} counterpart destroyed\n * @private\n */\nexports.prototype.removeAndDestroySingleLayer_ = function(layer) {\n  const uid = olBase.getUid(layer).toString();\n  const counterparts = this.layerMap[uid];\n  if (!!counterparts) {\n    counterparts.forEach((counterpart) => {\n      this.removeSingleCesiumObject(counterpart, false);\n      this.destroyCesiumObject(counterpart);\n    });\n    this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n    delete this.olLayerListenKeys[uid];\n  }\n  delete this.layerMap[uid];\n  return !!counterparts;\n};\n\n\n/**\n * Unlisten a single layer group.\n * @param {ol.layer.Group} group\n * @private\n */\nexports.prototype.unlistenSingleGroup_ = function(group) {\n  if (group === this.mapLayerGroup) {\n    return;\n  }\n  const uid = olBase.getUid(group).toString();\n  const keys = this.olGroupListenKeys_[uid];\n  keys.forEach((key) => {\n    olObservableUnByKey(key);\n  });\n  delete this.olGroupListenKeys_[uid];\n  delete this.layerMap[uid];\n};\n\n\n/**\n * Remove layer hierarchy.\n * @param {ol.layer.Base} root\n * @private\n */\nexports.prototype.removeLayer_ = function(root) {\n  if (!!root) {\n    const fifo = [root];\n    while (fifo.length > 0) {\n      const olLayer = fifo.splice(0, 1)[0];\n      const done = this.removeAndDestroySingleLayer_(olLayer);\n      if (olLayer instanceof olLayerGroup) {\n        this.unlistenSingleGroup_(olLayer);\n        if (!done) {\n          // No counterpart for the group itself so removing\n          // each of the child layers.\n          olLayer.getLayers().forEach((l) => {\n            fifo.push(l);\n          });\n        }\n      }\n    }\n  }\n};\n\n\n/**\n * Register listeners for single layer group change.\n * @param {ol.layer.Group} group\n * @private\n */\nexports.prototype.listenForGroupChanges_ = function(group) {\n  const uuid = olBase.getUid(group).toString();\n\n  googAsserts.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n  const listenKeyArray = [];\n  this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n  // only the keys that need to be relistened when collection changes\n  let contentKeys = [];\n  const listenAddRemove = (function() {\n    const collection = group.getLayers();\n    if (collection) {\n      contentKeys = [\n        collection.on('add', (event) => {\n          this.addLayers_(event.element);\n        }),\n        collection.on('remove', (event) => {\n          this.removeLayer_(event.element);\n        })\n      ];\n      listenKeyArray.push(...contentKeys);\n    }\n  }).bind(this);\n\n  listenAddRemove();\n\n  listenKeyArray.push(group.on('change:layers', (e) => {\n    contentKeys.forEach((el) => {\n      const i = listenKeyArray.indexOf(el);\n      if (i >= 0) {\n        listenKeyArray.splice(i, 1);\n      }\n      olObservableUnByKey(el);\n    });\n    listenAddRemove();\n  }));\n};\n\n\n/**\n * Destroys all the created Cesium objects.\n * @protected\n */\nexports.prototype.destroyAll = function() {\n  this.removeAllCesiumObjects(true); // destroy\n  let objKey;\n  for (objKey in this.olGroupListenKeys_) {\n    const keys = this.olGroupListenKeys_[objKey];\n    keys.forEach(olObservableUnByKey);\n  }\n  for (objKey in this.olLayerListenKeys) {\n    this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n  }\n  this.olGroupListenKeys_ = {};\n  this.olLayerListenKeys = {};\n  this.layerMap = {};\n};\n\n\n/**\n * Adds a single Cesium object to the collection.\n * @param {!T} object\n * @abstract\n * @protected\n */\nexports.prototype.addCesiumObject = function(object) {};\n\n\n/**\n * @param {!T} object\n * @abstract\n * @protected\n */\nexports.prototype.destroyCesiumObject = function(object) {};\n\n\n/**\n * Remove single Cesium object from the collection.\n * @param {!T} object\n * @param {boolean} destroy\n * @abstract\n * @protected\n */\nexports.prototype.removeSingleCesiumObject = function(object, destroy) {};\n\n\n/**\n * Remove all Cesium objects from the collection.\n * @param {boolean} destroy\n * @abstract\n * @protected\n */\nexports.prototype.removeAllCesiumObjects = function(destroy) {};\n\n\n/**\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @return {?Array.<T>}\n * @abstract\n * @protected\n */\nexports.prototype.createSingleLayerCounterparts = function(olLayerWithParents) {};\n\n\nexport default exports;\n","/**\n * @module olcs.AutoRenderLoop\n */\n/**\n * @constructor\n * @param {olcs.OLCesium} ol3d\n * @struct\n */\nconst exports = function(ol3d) {\n  this.ol3d = ol3d;\n  this.scene_ = ol3d.getCesiumScene();\n  this.canvas_ = this.scene_.canvas;\n  this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n  this.repaintEventNames_ = [\n    'mousemove', 'mousedown', 'mouseup',\n    'touchstart', 'touchend', 'touchmove',\n    'pointerdown', 'pointerup', 'pointermove',\n    'wheel'\n  ];\n\n  this.enable();\n};\n\n\n/**\n * Enable.\n */\nexports.prototype.enable = function() {\n  this.scene_.requestRenderMode = true;\n  for (const repaintKey of this.repaintEventNames_) {\n    this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n  }\n\n  window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n  // Listen for changes on the layer group\n  this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n};\n\n\n/**\n * Disable.\n */\nexports.prototype.disable = function() {\n  for (const repaintKey of this.repaintEventNames_) {\n    this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n  }\n\n  window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n  this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n  this.scene_.requestRenderMode = false;\n};\n\n\n\n/**\n * Restart render loop.\n * Force a restart of the render loop.\n * @api\n */\nexports.prototype.restartRenderLoop = function() {\n  this.notifyRepaintRequired();\n};\n\n\nexports.prototype.notifyRepaintRequired = function() {\n  this.scene_.requestRender();\n};\n\n\nexport default exports;\n","/**\n * @module olcs.Camera\n */\nimport googAsserts from 'goog/asserts.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport * as olEvents from 'ol/events.js';\nimport * as olMath from 'ol/math.js';\nimport * as olProj from 'ol/proj.js';\nimport olcsCore from './core.js';\n\n/**\n * This object takes care of additional 3d-specific properties of the view and\n * ensures proper synchronization with the underlying raw Cesium.Camera object.\n * @param {!Cesium.Scene} scene\n * @param {!ol.Map} map\n * @constructor\n * @api\n * @struct\n */\nconst exports = function(scene, map) {\n  /**\n   * @type {!Cesium.Scene}\n   * @private\n   */\n  this.scene_ = scene;\n\n  /**\n   * @type {!Cesium.Camera}\n   * @private\n   */\n  this.cam_ = scene.camera;\n\n  /**\n   * @type {!ol.Map}\n   * @private\n   */\n  this.map_ = map;\n\n  /**\n   * @type {?ol.View}\n   * @private\n   */\n  this.view_ = null;\n\n  /**\n   * @type {?ol.EventsKey}\n   * @private\n   */\n  this.viewListenKey_ = null;\n\n  /**\n   * @type {!ol.TransformFunction}\n   * @private\n   */\n  this.toLonLat_ = exports.identityProjection;\n\n  /**\n   * @type {!ol.TransformFunction}\n   * @private\n   */\n  this.fromLonLat_ = exports.identityProjection;\n\n  /**\n   * 0 -- topdown, PI/2 -- the horizon\n   * @type {number}\n   * @private\n   */\n  this.tilt_ = 0;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.distance_ = 0;\n\n  /**\n   * @type {?Cesium.Matrix4}\n   * @private\n   */\n  this.lastCameraViewMatrix_ = null;\n\n  /**\n   * This is used to discard change events on view caused by updateView method.\n   * @type {boolean}\n   * @private\n   */\n  this.viewUpdateInProgress_ = false;\n\n  this.map_.on('change:view', (e) => {\n    this.setView_(this.map_.getView());\n  });\n  this.setView_(this.map_.getView());\n};\n\n\n/**\n * @param {Array.<number>} input Input coordinate array.\n * @param {Array.<number>=} opt_output Output array of coordinate values.\n * @param {number=} opt_dimension Dimension.\n * @return {Array.<number>} Input coordinate array (same array as input).\n */\nexports.identityProjection = function(input, opt_output, opt_dimension) {\n  const dim = opt_dimension || input.length;\n  if (opt_output) {\n    for (let i = 0; i < dim; ++i) {\n      opt_output[i] = input[i];\n    }\n  }\n  return input;\n};\n\n\n/**\n * @param {?ol.View} view New view to use.\n * @private\n */\nexports.prototype.setView_ = function(view) {\n  if (this.view_) {\n    olObservableUnByKey(this.viewListenKey_);\n    this.viewListenKey_ = null;\n  }\n\n  this.view_ = view;\n  if (view) {\n    const toLonLat = olProj.getTransform(view.getProjection(), 'EPSG:4326');\n    const fromLonLat = olProj.getTransform('EPSG:4326', view.getProjection());\n    googAsserts.assert(toLonLat && fromLonLat);\n\n    this.toLonLat_ = toLonLat;\n    this.fromLonLat_ = fromLonLat;\n\n    this.viewListenKey_ = olEvents.listen(view, 'propertychange',\n        this.handleViewEvent_, this);\n\n    this.readFromView();\n  } else {\n    this.toLonLat_ = exports.identityProjection;\n    this.fromLonLat_ = exports.identityProjection;\n  }\n};\n\n\n/**\n * @param {?} e\n * @private\n */\nexports.prototype.handleViewEvent_ = function(e) {\n  if (!this.viewUpdateInProgress_) {\n    this.readFromView();\n  }\n};\n\n\n/**\n * @param {number} heading In radians.\n * @api\n */\nexports.prototype.setHeading = function(heading) {\n  if (!this.view_) {\n    return;\n  }\n\n  this.view_.setRotation(heading);\n};\n\n\n/**\n * @return {number|undefined} Heading in radians.\n * @api\n */\nexports.prototype.getHeading = function() {\n  if (!this.view_) {\n    return undefined;\n  }\n  const rotation = this.view_.getRotation();\n  return rotation || 0;\n};\n\n\n/**\n * @param {number} tilt In radians.\n * @api\n */\nexports.prototype.setTilt = function(tilt) {\n  this.tilt_ = tilt;\n  this.updateCamera_();\n};\n\n\n/**\n * @return {number} Tilt in radians.\n * @api\n */\nexports.prototype.getTilt = function() {\n  return this.tilt_;\n};\n\n\n/**\n * @param {number} distance In meters.\n * @api\n */\nexports.prototype.setDistance = function(distance) {\n  this.distance_ = distance;\n  this.updateCamera_();\n  this.updateView();\n};\n\n\n/**\n * @return {number} Distance in meters.\n * @api\n */\nexports.prototype.getDistance = function() {\n  return this.distance_;\n};\n\n\n/**\n * Shortcut for ol.View.setCenter().\n * @param {!ol.Coordinate} center Same projection as the ol.View.\n * @api\n */\nexports.prototype.setCenter = function(center) {\n  if (!this.view_) {\n    return;\n  }\n  this.view_.setCenter(center);\n};\n\n\n/**\n * Shortcut for ol.View.getCenter().\n * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n * @api\n */\nexports.prototype.getCenter = function() {\n  if (!this.view_) {\n    return undefined;\n  }\n  return this.view_.getCenter();\n};\n\n\n/**\n * Sets the position of the camera.\n * @param {!ol.Coordinate} position Same projection as the ol.View.\n * @api\n */\nexports.prototype.setPosition = function(position) {\n  if (!this.toLonLat_) {\n    return;\n  }\n  const ll = this.toLonLat_(position);\n  googAsserts.assert(ll);\n\n  const carto = new Cesium.Cartographic(\n      olMath.toRadians(ll[0]),\n      olMath.toRadians(ll[1]),\n      this.getAltitude());\n\n  this.cam_.setView({\n    destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n  });\n  this.updateView();\n};\n\n\n/**\n * Calculates position under the camera.\n * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n * @api\n */\nexports.prototype.getPosition = function() {\n  if (!this.fromLonLat_) {\n    return undefined;\n  }\n  const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n  const pos = this.fromLonLat_([\n    olMath.toDegrees(carto.longitude),\n    olMath.toDegrees(carto.latitude)\n  ]);\n  googAsserts.assert(pos);\n  return pos;\n};\n\n\n/**\n * @param {number} altitude In meters.\n * @api\n */\nexports.prototype.setAltitude = function(altitude) {\n  const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n      this.cam_.position);\n  carto.height = altitude;\n  this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n  this.updateView();\n};\n\n\n/**\n * @return {number} Altitude in meters.\n * @api\n */\nexports.prototype.getAltitude = function() {\n  const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n      this.cam_.position);\n\n  return carto.height;\n};\n\n\n/**\n * Updates the state of the underlying Cesium.Camera\n * according to the current values of the properties.\n * @private\n */\nexports.prototype.updateCamera_ = function() {\n  if (!this.view_ || !this.toLonLat_) {\n    return;\n  }\n  const center = this.view_.getCenter();\n  if (!center) {\n    return;\n  }\n  const ll = this.toLonLat_(center);\n  googAsserts.assert(ll);\n\n  const carto = new Cesium.Cartographic(olMath.toRadians(ll[0]),\n      olMath.toRadians(ll[1]));\n  if (this.scene_.globe) {\n    const height = this.scene_.globe.getHeight(carto);\n    carto.height = height || 0;\n  }\n\n  const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n  /** @type {Cesium.optionsOrientation} */\n  const orientation = {\n    pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n    heading: -this.view_.getRotation(),\n    roll: undefined\n  };\n  this.cam_.setView({\n    destination,\n    orientation\n  });\n\n  this.cam_.moveBackward(this.distance_);\n\n  this.checkCameraChange(true);\n};\n\n\n/**\n * Calculates the values of the properties from the current ol.View state.\n * @api\n */\nexports.prototype.readFromView = function() {\n  if (!this.view_ || !this.toLonLat_) {\n    return;\n  }\n  const center = this.view_.getCenter();\n  if (center === undefined || center === null) {\n    return;\n  }\n  const ll = this.toLonLat_(center);\n  googAsserts.assert(ll);\n\n  const resolution = this.view_.getResolution();\n  this.distance_ = this.calcDistanceForResolution(\n      resolution || 0, olMath.toRadians(ll[1]));\n\n  this.updateCamera_();\n};\n\n\n/**\n * Calculates the values of the properties from the current Cesium.Camera state.\n * Modifies the center, resolution and rotation properties of the view.\n * @api\n */\nexports.prototype.updateView = function() {\n  if (!this.view_ || !this.fromLonLat_) {\n    return;\n  }\n  this.viewUpdateInProgress_ = true;\n\n  // target & distance\n  const ellipsoid = Cesium.Ellipsoid.WGS84;\n  const scene = this.scene_;\n  const target = olcsCore.pickCenterPoint(scene);\n\n  let bestTarget = target;\n  if (!bestTarget) {\n    //TODO: how to handle this properly ?\n    const globe = scene.globe;\n    const carto = this.cam_.positionCartographic.clone();\n    const height = globe.getHeight(carto);\n    carto.height = height || 0;\n    bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n  }\n  this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n  const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n  this.view_.setCenter(this.fromLonLat_([\n    olMath.toDegrees(bestTargetCartographic.longitude),\n    olMath.toDegrees(bestTargetCartographic.latitude)]));\n\n  // resolution\n  this.view_.setResolution(\n      this.calcResolutionForDistance(this.distance_,\n          bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n  /*\n   * Since we are positioning the target, the values of heading and tilt\n   * need to be calculated _at the target_.\n   */\n  if (target) {\n    const pos = this.cam_.position;\n\n    // normal to the ellipsoid at the target\n    const targetNormal = new Cesium.Cartesian3();\n    ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n    // vector from the target to the camera\n    const targetToCamera = new Cesium.Cartesian3();\n    Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n    Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n    // HEADING\n    const up = this.cam_.up;\n    const right = this.cam_.right;\n    const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n    const heading = Cesium.Cartesian3.angleBetween(right, normal);\n    const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n    const orientation = cross.z;\n\n    this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n    // TILT\n    const tiltAngle = Math.acos(\n        Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n    this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n  } else {\n    // fallback when there is no target\n    this.view_.setRotation(this.cam_.heading);\n    this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n  }\n\n  this.viewUpdateInProgress_ = false;\n};\n\n\n/**\n * Check if the underlying camera state has changed and ensure synchronization.\n * @param {boolean=} opt_dontSync Do not synchronize the view.\n */\nexports.prototype.checkCameraChange = function(opt_dontSync) {\n  const old = this.lastCameraViewMatrix_;\n  const current = this.cam_.viewMatrix;\n\n  if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n    this.lastCameraViewMatrix_ = current.clone();\n    if (opt_dontSync !== true) {\n      this.updateView();\n    }\n  }\n};\n\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n * @param {number} resolution Number of map units per pixel.\n * @param {number} latitude Latitude in radians.\n * @return {number} The calculated distance.\n * @api\n */\nexports.prototype.calcDistanceForResolution = function(resolution, latitude) {\n  const canvas = this.scene_.canvas;\n  const fovy = this.cam_.frustum.fovy; // vertical field of view\n  googAsserts.assert(!isNaN(fovy));\n  const metersPerUnit = this.view_.getProjection().getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n};\n\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n * @param {number} distance\n * @param {number} latitude\n * @return {number} The calculated resolution.\n * @api\n */\nexports.prototype.calcResolutionForDistance = function(distance, latitude) {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = this.scene_.canvas;\n  const fovy = this.cam_.frustum.fovy;\n  const metersPerUnit = this.view_.getProjection().getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport googAsserts from 'goog/asserts.js';\nimport * as olBase from 'ol/index.js';\nimport * as olEvents from 'ol/events.js';\nimport * as olExtent from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil from './util.js';\n\n/**\n * Concrete base class for converting from OpenLayers3 vectors to Cesium\n * primitives.\n * Extending this class is possible provided that the extending class and\n * the library are compiled together by the closure compiler.\n * @param {!Cesium.Scene} scene Cesium scene.\n * @constructor\n * @api\n * @struct\n */\nconst exports = function(scene) {\n\n  /**\n   * @protected\n   */\n  this.scene = scene;\n\n  /**\n   * Bind once to have a unique function for using as a listener\n   * @type {function(ol.source.Vector.Event)}\n   * @private\n   */\n  this.boundOnRemoveOrClearFeatureListener_ =\n      this.onRemoveOrClearFeature_.bind(this);\n};\n\n\n/**\n * @param {ol.source.Vector.Event} evt\n * @private\n */\nexports.prototype.onRemoveOrClearFeature_ = function(evt) {\n  const source = evt.target;\n  googAsserts.assertInstanceof(source, olSourceVector);\n\n  const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n  if (cancellers) {\n    const feature = evt.feature;\n    if (feature) {\n      // remove\n      const id = olBase.getUid(feature);\n      const canceller = cancellers[id];\n      if (canceller) {\n        canceller();\n        delete cancellers[id];\n      }\n    } else {\n      // clear\n      for (const key in cancellers) {\n        if (cancellers.hasOwnProperty(key)) {\n          cancellers[key]();\n        }\n      }\n      olcsUtil.obj(source)['olcs_cancellers'] = {};\n    }\n  }\n};\n\n\n/**\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature.\n * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n * @protected\n */\nexports.prototype.setReferenceForPicking = function(layer, feature, primitive) {\n  primitive.olLayer = layer;\n  primitive.olFeature = feature;\n};\n\n\n/**\n * Basics primitive creation using a color attribute.\n * Note that Cesium has 'interior' and outline geometries.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature.\n * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n * @param {!Cesium.Geometry} geometry\n * @param {!Cesium.Color} color\n * @param {number=} opt_lineWidth\n * @return {Cesium.Primitive}\n * @protected\n */\nexports.prototype.createColoredPrimitive = function(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n  const createInstance = function(geometry, color) {\n    return new Cesium.GeometryInstance({\n      // always update Cesium externs before adding a property\n      geometry,\n      attributes: {\n        color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n      }\n    });\n  };\n\n  const options = {\n    // always update Cesium externs before adding a property\n    flat: true, // work with all geometries\n    renderState: {\n      depthTest: {\n        enabled: true\n      }\n    }\n  };\n\n  if (opt_lineWidth !== undefined) {\n    if (!options.renderState) {\n      options.renderState = {};\n    }\n    options.renderState.lineWidth = opt_lineWidth;\n  }\n\n  const instances = createInstance(geometry, color);\n\n  const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n  let primitive;\n\n  if (heightReference == Cesium.HeightReference.CLAMP_TO_GROUND) {\n    const ctor = instances.geometry.constructor;\n    if (ctor && !ctor['createShadowVolume']) {\n      return null;\n    }\n    primitive = new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances: instances\n    });\n  } else {\n    const appearance = new Cesium.PerInstanceColorAppearance(options);\n    primitive = new Cesium.Primitive({\n      // always update Cesium externs before adding a property\n      geometryInstances: instances,\n      appearance\n    });\n  }\n\n  this.setReferenceForPicking(layer, feature, primitive);\n  return primitive;\n};\n\n\n/**\n * Return the fill or stroke color from a plain ol style.\n * @param {!ol.style.Style|ol.style.Text} style\n * @param {boolean} outline\n * @return {!Cesium.Color}\n * @protected\n */\nexports.prototype.extractColorFromOlStyle = function(style, outline) {\n  const fillColor = style.getFill() ? style.getFill().getColor() : null;\n  const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n  let olColor = 'black';\n  if (strokeColor && outline) {\n    olColor = strokeColor;\n  } else if (fillColor) {\n    olColor = fillColor;\n  }\n\n  return olcsCore.convertColorToCesium(olColor);\n};\n\n\n/**\n * Return the width of stroke from a plain ol style.\n * @param {!ol.style.Style|ol.style.Text} style\n * @return {number}\n * @protected\n */\nexports.prototype.extractLineWidthFromOlStyle = function(style) {\n  // Handling of line width WebGL limitations is handled by Cesium.\n  const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n  return width !== undefined ? width : 1;\n};\n\n\n/**\n * Create a primitive collection out of two Cesium geometries.\n * Only the OpenLayers style colors will be used.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature.\n * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n * @param {!Cesium.Geometry} fillGeometry\n * @param {!Cesium.Geometry} outlineGeometry\n * @param {!ol.style.Style} olStyle\n * @return {!Cesium.PrimitiveCollection}\n * @protected\n */\nexports.prototype.wrapFillAndOutlineGeometries = function(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n  const fillColor = this.extractColorFromOlStyle(olStyle, false);\n  const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n  const primitives = new Cesium.PrimitiveCollection();\n  if (olStyle.getFill()) {\n    const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n        fillGeometry, fillColor);\n    googAsserts.assert(!!p1);\n    primitives.add(p1);\n  }\n\n  if (olStyle.getStroke()) {\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n    const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n        outlineGeometry, outlineColor, width);\n    if (p2) {\n      // Some outline geometries are not supported by Cesium in clamp to ground\n      // mode. These primitives are skipped.\n      primitives.add(p2);\n    }\n  }\n\n  return primitives;\n};\n\n\n// Geometry converters\n/**\n * Create a Cesium primitive if style has a text component.\n * Eventually return a PrimitiveCollection including current primitive.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Geometry} geometry\n * @param {!ol.style.Style} style\n * @param {!Cesium.Primitive} primitive current primitive\n * @return {!Cesium.PrimitiveCollection}\n * @protected\n */\nexports.prototype.addTextStyle = function(layer, feature, geometry, style, primitive) {\n  let primitives;\n  if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n    primitives = new Cesium.PrimitiveCollection();\n    primitives.add(primitive);\n  } else {\n    primitives = primitive;\n  }\n\n  if (!style.getText()) {\n    return primitives;\n  }\n\n  const text = /** @type {!ol.style.Text} */ (style.getText());\n  const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n      text);\n  if (label) {\n    primitives.add(label);\n  }\n  return primitives;\n};\n\n\n/**\n * Add a billboard to a Cesium.BillboardCollection.\n * Overriding this wrapper allows manipulating the billboard options.\n * @param {!Cesium.BillboardCollection} billboards\n * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature.\n * @param {!ol.geom.Geometry} geometry\n * @param {!ol.style.Style} style\n * @return {!Cesium.Billboard} newly created billboard\n * @api\n */\nexports.prototype.csAddBillboard = function(billboards, bbOptions, layer, feature, geometry, style) {\n  const bb = billboards.add(bbOptions);\n  this.setReferenceForPicking(layer, feature, bb);\n  return bb;\n};\n\n\n/**\n * Convert an OpenLayers circle geometry to Cesium.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n * @param {!ol.ProjectionLike} projection\n * @param {!ol.style.Style} olStyle\n * @return {!Cesium.PrimitiveCollection} primitives\n * @api\n */\nexports.prototype.olCircleGeometryToCesium = function(layer, feature, olGeometry, projection, olStyle) {\n\n  olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n  googAsserts.assert(olGeometry.getType() == 'Circle');\n\n  // ol.Coordinate\n  let center = olGeometry.getCenter();\n  const height = center.length == 3 ? center[2] : 0.0;\n  let point = center.slice();\n  point[0] += olGeometry.getRadius();\n\n  // Cesium\n  center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n  point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n  // Accurate computation of straight distance\n  const radius = Cesium.Cartesian3.distance(center, point);\n\n  const fillGeometry = new Cesium.CircleGeometry({\n    // always update Cesium externs before adding a property\n    center,\n    radius,\n    height\n  });\n\n  const outlineGeometry = new Cesium.CircleOutlineGeometry({\n    // always update Cesium externs before adding a property\n    center,\n    radius,\n    extrudedHeight: height,\n    height\n  });\n\n  const primitives = this.wrapFillAndOutlineGeometries(\n      layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n  return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n};\n\n\n/**\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!number} width The width of the line.\n * @param {!Cesium.Color} color The color of the line.\n * @param {!Array<Cesium.Cartesian3>} positions The vertices of the line.\n * @return {!Cesium.GroundPrimitive} primitive\n */\nexports.prototype.createStackedGroundCorridors = function(layer, feature, width, color, positions) {\n  let previousDistance = 0;\n  width = Math.max(3, width); // A <3px width is too small for ground primitives\n  const geometryInstances = [];\n  // A stack of ground lines with increasing width (in meters) are created.\n  // Only one of these lines is displayed at any time giving a feeling of continuity.\n  // The values for the distance and width factor are more or less arbitrary.\n  // Applications can override this logics by subclassing the FeatureConverter class.\n  for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n    width *= 2.14;\n    const geometryOptions = {\n      // always update Cesium externs before adding a property\n      positions,\n      width,\n      vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n    };\n    geometryInstances.push(new Cesium.GeometryInstance({\n      geometry: new Cesium.CorridorGeometry(geometryOptions),\n      attributes: {\n        color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n        distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n      }\n    }));\n    previousDistance = distance;\n  }\n  return new Cesium.GroundPrimitive({\n    // always update Cesium externs before adding a property\n    geometryInstances\n  });\n};\n\n/**\n * Convert an OpenLayers line string geometry to Cesium.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n * @param {!ol.ProjectionLike} projection\n * @param {!ol.style.Style} olStyle\n * @return {!Cesium.PrimitiveCollection} primitives\n * @api\n */\nexports.prototype.olLineStringGeometryToCesium = function(layer, feature, olGeometry, projection, olStyle) {\n\n  olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n  googAsserts.assert(olGeometry.getType() == 'LineString');\n\n  const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n  const width = this.extractLineWidthFromOlStyle(olStyle);\n\n  let outlinePrimitive;\n  const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n  if (heightReference == Cesium.HeightReference.CLAMP_TO_GROUND) {\n    const color = this.extractColorFromOlStyle(olStyle, true);\n    outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n  } else {\n    const appearance = new Cesium.PolylineMaterialAppearance({\n      // always update Cesium externs before adding a property\n      material: this.olStyleToCesium(feature, olStyle, true)\n    });\n    const geometryOptions = {\n      // always update Cesium externs before adding a property\n      positions,\n      width,\n      vertexFormat: appearance.vertexFormat\n    };\n    outlinePrimitive = new Cesium.Primitive({\n      // always update Cesium externs before adding a property\n      geometryInstances: new Cesium.GeometryInstance({\n        geometry: new Cesium.PolylineGeometry(geometryOptions)\n      }),\n      appearance\n    });\n  }\n\n  this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n  return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n};\n\n\n/**\n * Convert an OpenLayers polygon geometry to Cesium.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n * @param {!ol.ProjectionLike} projection\n * @param {!ol.style.Style} olStyle\n * @return {!Cesium.PrimitiveCollection} primitives\n * @api\n */\nexports.prototype.olPolygonGeometryToCesium = function(layer, feature, olGeometry, projection, olStyle) {\n\n  olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n  googAsserts.assert(olGeometry.getType() == 'Polygon');\n\n  let fillGeometry, outlineGeometry;\n  if ((olGeometry.getCoordinates()[0].length == 5) &&\n      (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n    // Create a rectangle according to the longitude and latitude curves\n    const coordinates = olGeometry.getCoordinates()[0];\n    // Extract the West, South, East, North coordinates\n    const extent = olExtent.boundingExtent(coordinates);\n    const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n        extent[2], extent[3]);\n\n    // Extract the average height of the vertices\n    let maxHeight = 0.0;\n    if (coordinates[0].length == 3) {\n      for (let c = 0; c < coordinates.length; c++) {\n        maxHeight = Math.max(maxHeight, coordinates[c][2]);\n      }\n    }\n\n    // Render the cartographic rectangle\n    fillGeometry = new Cesium.RectangleGeometry({\n      ellipsoid: Cesium.Ellipsoid.WGS84,\n      rectangle,\n      height: maxHeight\n    });\n\n    outlineGeometry = new Cesium.RectangleOutlineGeometry({\n      ellipsoid: Cesium.Ellipsoid.WGS84,\n      rectangle,\n      height: maxHeight\n    });\n  } else {\n    const rings = olGeometry.getLinearRings();\n    // always update Cesium externs before adding a property\n    const hierarchy = {};\n    const polygonHierarchy = hierarchy;\n    googAsserts.assert(rings.length > 0);\n\n    for (let i = 0; i < rings.length; ++i) {\n      const olPos = rings[i].getCoordinates();\n      const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n      googAsserts.assert(positions && positions.length > 0);\n      if (i == 0) {\n        hierarchy.positions = positions;\n      } else {\n        if (!hierarchy.holes) {\n          hierarchy.holes = [];\n        }\n        hierarchy.holes.push({\n          positions\n        });\n      }\n    }\n\n    fillGeometry = new Cesium.PolygonGeometry({\n      // always update Cesium externs before adding a property\n      polygonHierarchy,\n      perPositionHeight: true\n    });\n\n    outlineGeometry = new Cesium.PolygonOutlineGeometry({\n      // always update Cesium externs before adding a property\n      polygonHierarchy: hierarchy,\n      perPositionHeight: true\n    });\n  }\n\n  const primitives = this.wrapFillAndOutlineGeometries(\n      layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n  return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n};\n\n\n/**\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Geometry} geometry\n * @return {!Cesium.HeightReference}\n * @api\n */\nexports.prototype.getHeightReference = function(layer, feature, geometry) {\n\n  // Read from the geometry\n  let altitudeMode = geometry.get('altitudeMode');\n\n  // Or from the feature\n  if (altitudeMode === undefined) {\n    altitudeMode = feature.get('altitudeMode');\n  }\n\n  // Or from the layer\n  if (altitudeMode === undefined) {\n    altitudeMode = layer.get('altitudeMode');\n  }\n\n  let heightReference = Cesium.HeightReference.NONE;\n  if (altitudeMode === 'clampToGround') {\n    heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n  } else if (altitudeMode === 'relativeToGround') {\n    heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n  }\n\n  return heightReference;\n};\n\n\n/**\n * Convert a point geometry to a Cesium BillboardCollection.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n * @param {!ol.ProjectionLike} projection\n * @param {!ol.style.Style} style\n * @param {!ol.style.Image} imageStyle\n * @param {!Cesium.BillboardCollection} billboards\n * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n * @api\n */\nexports.prototype.createBillboardFromImage = function(layer, feature, olGeometry, projection, style,\n    imageStyle, billboards, opt_newBillboardCallback) {\n\n  if (imageStyle instanceof olStyleIcon) {\n    // make sure the image is scheduled for load\n    imageStyle.load();\n  }\n\n  const image = imageStyle.getImage(1); // get normal density\n  const isImageLoaded = function(image) {\n    return image.src != '' &&\n        image.naturalHeight != 0 &&\n        image.naturalWidth != 0 &&\n        image.complete;\n  };\n  const reallyCreateBillboard = (function() {\n    if (!image) {\n      return;\n    }\n    if (!(image instanceof HTMLCanvasElement ||\n        image instanceof Image ||\n        image instanceof HTMLImageElement)) {\n      return;\n    }\n    const center = olGeometry.getCoordinates();\n    const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    let color;\n    const opacity = imageStyle.getOpacity();\n    if (opacity !== undefined) {\n      color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n    }\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n      // always update Cesium externs before adding a property\n      image,\n      color,\n      scale: imageStyle.getScale(),\n      heightReference,\n      verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\n      position\n    });\n    const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n    if (opt_newBillboardCallback) {\n      opt_newBillboardCallback(bb);\n    }\n  }).bind(this);\n\n  if (image instanceof Image && !isImageLoaded(image)) {\n    // Cesium requires the image to be loaded\n    let cancelled = false;\n    const source = layer.getSource();\n    const canceller = function() {\n      cancelled = true;\n    };\n    source.on(['removefeature', 'clear'],\n        this.boundOnRemoveOrClearFeatureListener_);\n    let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (!cancellers) {\n      cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n    }\n\n    const fuid = olBase.getUid(feature);\n    if (cancellers[fuid]) {\n      // When the feature change quickly, a canceller may still be present so\n      // we cancel it here to prevent creation of a billboard.\n      cancellers[fuid]();\n    }\n    cancellers[fuid] = canceller;\n\n    const listener = function() {\n      if (!billboards.isDestroyed() && !cancelled) {\n        // Create billboard if the feature is still displayed on the map.\n        reallyCreateBillboard();\n      }\n    };\n\n    olEvents.listenOnce(image, 'load', listener);\n  } else {\n    reallyCreateBillboard();\n  }\n};\n\n/**\n * Convert a point geometry to a Cesium BillboardCollection.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n * @param {!ol.ProjectionLike} projection\n * @param {!ol.style.Style} style\n * @param {!Cesium.BillboardCollection} billboards\n * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n * the new billboard is added.\n * @return {Cesium.Primitive} primitives\n * @api\n */\nexports.prototype.olPointGeometryToCesium = function(layer, feature, olGeometry, projection, style, billboards,\n    opt_newBillboardCallback) {\n  googAsserts.assert(olGeometry.getType() == 'Point');\n  olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n  let modelPrimitive = null;\n  const imageStyle = style.getImage();\n  if (imageStyle) {\n    const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n    if (olcsModelFunction) {\n      const olcsModel = olcsModelFunction();\n      const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n      const model = Cesium.Model.fromGltf(options);\n      modelPrimitive = new Cesium.PrimitiveCollection();\n      modelPrimitive.add(model);\n      if (olcsModel.debugModelMatrix) {\n        modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n          modelMatrix: olcsModel.debugModelMatrix\n        }));\n      }\n    } else {\n      this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n    }\n  }\n\n  if (style.getText()) {\n    return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n  } else {\n    return modelPrimitive;\n  }\n};\n\n\n/**\n * Convert an OpenLayers multi-something geometry to Cesium.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n * @param {!ol.ProjectionLike} projection\n * @param {!ol.style.Style} olStyle\n * @param {!Cesium.BillboardCollection} billboards\n * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n * the new billboard is added.\n * @return {Cesium.Primitive} primitives\n * @api\n */\nexports.prototype.olMultiGeometryToCesium = function(layer, feature, geometry, projection, olStyle, billboards,\n    opt_newBillboardCallback) {\n  // Do not reproject to 4326 now because it will be done later.\n\n  // FIXME: would be better to combine all child geometries in one primitive\n  // instead we create n primitives for simplicity.\n  const accumulate = function(geometries, functor) {\n    const primitives = new Cesium.PrimitiveCollection();\n    geometries.forEach((geometry) => {\n      primitives.add(functor(layer, feature, geometry, projection, olStyle));\n    });\n    return primitives;\n  };\n\n  let subgeos;\n  switch (geometry.getType()) {\n    case 'MultiPoint':\n      geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n      subgeos = geometry.getPoints();\n      if (olStyle.getText()) {\n        const primitives = new Cesium.PrimitiveCollection();\n        subgeos.forEach((geometry) => {\n          googAsserts.assert(geometry);\n          const result = this.olPointGeometryToCesium(layer, feature, geometry,\n              projection, olStyle, billboards, opt_newBillboardCallback);\n          if (result) {\n            primitives.add(result);\n          }\n        });\n        return primitives;\n      } else {\n        subgeos.forEach((geometry) => {\n          googAsserts.assert(geometry);\n          this.olPointGeometryToCesium(layer, feature, geometry, projection,\n              olStyle, billboards, opt_newBillboardCallback);\n        });\n        return null;\n      }\n    case 'MultiLineString':\n      geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n      subgeos = geometry.getLineStrings();\n      return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n    case 'MultiPolygon':\n      geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n      subgeos = geometry.getPolygons();\n      return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n    default:\n      googAsserts.fail(`Unhandled multi geometry type${geometry.getType()}`);\n  }\n};\n\n\n/**\n * Convert an OpenLayers text style to Cesium.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature..\n * @param {!ol.geom.Geometry} geometry\n * @param {!ol.style.Text} style\n * @return {Cesium.LabelCollection} Cesium primitive\n * @api\n */\nexports.prototype.olGeometry4326TextPartToCesium = function(layer, feature, geometry, style) {\n  const text = style.getText();\n  googAsserts.assert(text !== undefined);\n\n\n  const labels = new Cesium.LabelCollection({scene: this.scene});\n  // TODO: export and use the text draw position from OpenLayers .\n  // See src/ol/render/vector.js\n  const extentCenter = olExtent.getCenter(geometry.getExtent());\n  if (geometry instanceof olGeomSimpleGeometry) {\n    const first = geometry.getFirstCoordinate();\n    extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n  }\n  const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n  options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n  options.text = text;\n\n  options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n  const offsetX = style.getOffsetX();\n  const offsetY = style.getOffsetY();\n  if (offsetX != 0 && offsetY != 0) {\n    const offset = new Cesium.Cartesian2(offsetX, offsetY);\n    options.pixelOffset = offset;\n  }\n\n  options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n  let labelStyle = undefined;\n  if (style.getFill()) {\n    options.fillColor = this.extractColorFromOlStyle(style, false);\n    labelStyle = Cesium.LabelStyle.FILL;\n  }\n  if (style.getStroke()) {\n    options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n    options.outlineColor = this.extractColorFromOlStyle(style, true);\n    labelStyle = Cesium.LabelStyle.OUTLINE;\n  }\n  if (style.getFill() && style.getStroke()) {\n    labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n  }\n  options.style = labelStyle;\n\n  let horizontalOrigin;\n  switch (style.getTextAlign()) {\n    case 'left':\n      horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n      break;\n    case 'right':\n      horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n      break;\n    case 'center':\n    default:\n      horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n  }\n  options.horizontalOrigin = horizontalOrigin;\n\n  if (style.getTextBaseline()) {\n    let verticalOrigin;\n    switch (style.getTextBaseline()) {\n      case 'top':\n        verticalOrigin = Cesium.VerticalOrigin.TOP;\n        break;\n      case 'middle':\n        verticalOrigin = Cesium.VerticalOrigin.CENTER;\n        break;\n      case 'bottom':\n        verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n        break;\n      case 'alphabetic':\n        verticalOrigin = Cesium.VerticalOrigin.TOP;\n        break;\n      case 'hanging':\n        verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n        break;\n      default:\n        googAsserts.fail(`unhandled baseline ${style.getTextBaseline()}`);\n    }\n    options.verticalOrigin = verticalOrigin;\n  }\n\n\n  const l = labels.add(options);\n  this.setReferenceForPicking(layer, feature, l);\n  return labels;\n};\n\n\n/**\n * Convert an OpenLayers style to a Cesium Material.\n * @param {ol.Feature} feature OpenLayers feature..\n * @param {!ol.style.Style} style\n * @param {boolean} outline\n * @return {Cesium.Material}\n * @api\n */\nexports.prototype.olStyleToCesium = function(feature, style, outline) {\n  const fill = style.getFill();\n  const stroke = style.getStroke();\n  if ((outline && !stroke) || (!outline && !fill)) {\n    return null; // FIXME use a default style? Developer error?\n  }\n\n  let color = outline ? stroke.getColor() : fill.getColor();\n  color = olcsCore.convertColorToCesium(color);\n\n  if (outline && stroke.getLineDash()) {\n    return Cesium.Material.fromType('Stripe', {\n      // always update Cesium externs before adding a property\n      horizontal: false,\n      repeat: 500, // TODO how to calculate this?\n      evenColor: color,\n      oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n    });\n  } else {\n    return Cesium.Material.fromType('Color', {\n      // always update Cesium externs before adding a property\n      color\n    });\n  }\n\n};\n\n\n/**\n * Compute OpenLayers plain style.\n * Evaluates style function, blend arrays, get default style.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature\n * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n * @param {number} resolution\n * @return {Array.<!ol.style.Style>} null if no style is available\n * @api\n */\nexports.prototype.computePlainStyle = function(layer, feature, fallbackStyleFunction, resolution) {\n  /**\n   * @type {ol.FeatureStyleFunction|undefined}\n   */\n  const featureStyleFunction = feature.getStyleFunction();\n\n  /**\n   * @type {ol.style.Style|Array.<ol.style.Style>}\n   */\n  let style = null;\n\n  if (featureStyleFunction) {\n    style = featureStyleFunction.call(feature, resolution);\n  }\n\n  if (!style && fallbackStyleFunction) {\n    style = fallbackStyleFunction(feature, resolution);\n  }\n\n  if (!style) {\n    // The feature must not be displayed\n    return null;\n  }\n\n  // FIXME combine materials as in cesium-materials-pack?\n  // then this function must return a custom material\n  // More simply, could blend the colors like described in\n  // http://en.wikipedia.org/wiki/Alpha_compositing\n  return Array.isArray(style) ? style : [style];\n};\n\n\n/**\n * @protected\n * @param {!ol.Feature} feature\n * @param {!ol.style.Style} style\n * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n * @return {ol.geom.Geometry|undefined}\n */\nexports.prototype.getGeometryFromFeature = function(feature, style, opt_geom) {\n  if (opt_geom) {\n    return opt_geom;\n  }\n\n  const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n  if (geom3d && geom3d instanceof olGeomGeometry) {\n    return geom3d;\n  }\n\n  if (style) {\n    const geomFuncRes = style.getGeometryFunction()(feature);\n    if (geomFuncRes instanceof olGeomGeometry) {\n      return geomFuncRes;\n    }\n  }\n\n  return feature.getGeometry();\n};\n\n\n/**\n * Convert one OpenLayers feature up to a collection of Cesium primitives.\n * @param {ol.layer.Vector|ol.layer.Image} layer\n * @param {!ol.Feature} feature OpenLayers feature.\n * @param {!ol.style.Style} style\n * @param {!olcsx.core.OlFeatureToCesiumContext} context\n * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n * @return {Cesium.Primitive} primitives\n * @api\n */\nexports.prototype.olFeatureToCesium = function(layer, feature, style, context, opt_geom) {\n  let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n  if (!geom) {\n    // OpenLayers features may not have a geometry\n    // See http://geojson.org/geojson-spec.html#feature-objects\n    return null;\n  }\n\n  const proj = context.projection;\n  const newBillboardAddedCallback = function(bb) {\n    const featureBb = context.featureToCesiumMap[olBase.getUid(feature)];\n    if (featureBb instanceof Array) {\n      featureBb.push(bb);\n    }\n    else {\n      context.featureToCesiumMap[olBase.getUid(feature)] = [bb];\n    }\n  };\n\n  switch (geom.getType()) {\n    case 'GeometryCollection':\n      const primitives = new Cesium.PrimitiveCollection();\n      const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n      // TODO: use getGeometriesArray() instead\n      collection.getGeometries().forEach((geom) => {\n        if (geom) {\n          const prims = this.olFeatureToCesium(layer, feature, style, context,\n              geom);\n          if (prims) {\n            primitives.add(prims);\n          }\n        }\n      });\n      return primitives;\n    case 'Point':\n      geom = /** @type {!ol.geom.Point} */ (geom);\n      const bbs = context.billboards;\n      const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n          style, bbs, newBillboardAddedCallback);\n      if (!result) {\n        // no wrapping primitive\n        return null;\n      } else {\n        return result;\n      }\n    case 'Circle':\n      geom = /** @type {!ol.geom.Circle} */ (geom);\n      return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n          style);\n    case 'LineString':\n      geom = /** @type {!ol.geom.LineString} */ (geom);\n      return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n          style);\n    case 'Polygon':\n      geom = /** @type {!ol.geom.Polygon} */ (geom);\n      return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n          style);\n    case 'MultiPoint':\n    case 'MultiLineString':\n    case 'MultiPolygon':\n      const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n          style, context.billboards, newBillboardAddedCallback);\n      if (!result2) {\n        // no wrapping primitive\n        return null;\n      } else {\n        return result2;\n      }\n    case 'LinearRing':\n      throw new Error('LinearRing should only be part of polygon.');\n    default:\n      throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n  }\n};\n\n\n/**\n * Convert an OpenLayers vector layer to Cesium primitive collection.\n * For each feature, the associated primitive will be stored in\n * `featurePrimitiveMap`.\n * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n * @param {!ol.View} olView\n * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n * @return {!olcs.core.VectorLayerCounterpart}\n * @api\n */\nexports.prototype.olVectorLayerToCesium = function(olLayer, olView, featurePrimitiveMap) {\n  const proj = olView.getProjection();\n  const resolution = olView.getResolution();\n\n  if (resolution === undefined || !proj) {\n    googAsserts.fail('View not ready');\n    // an assertion is not enough for closure to assume resolution and proj\n    // are defined\n    throw new Error('View not ready');\n  }\n\n  let source = olLayer.getSource();\n  if (source instanceof olSourceCluster) {\n    source = source.getSource();\n  }\n\n  googAsserts.assertInstanceof(source, olSourceVector);\n  const features = source.getFeatures();\n  const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n  const context = counterpart.context;\n  for (let i = 0; i < features.length; ++i) {\n    const feature = features[i];\n    if (!feature) {\n      continue;\n    }\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = olLayer.getStyleFunction();\n    const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n        resolution);\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      continue;\n    }\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n      if (prims) {\n        if (!primitives) {\n          primitives = prims;\n        } else if (prims) {\n          let i = 0, prim;\n          while ((prim = prims.get(i))) {\n            primitives.add(prim);\n            i++;\n          }\n        }\n      }\n    }\n    if (!primitives) {\n      continue;\n    }\n    featurePrimitiveMap[olBase.getUid(feature)] = primitives;\n    counterpart.getRootPrimitive().add(primitives);\n  }\n\n  return counterpart;\n};\n\n\n/**\n * Convert an OpenLayers feature to Cesium primitive collection.\n * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n * @param {!ol.View} view\n * @param {!ol.Feature} feature\n * @param {!olcsx.core.OlFeatureToCesiumContext} context\n * @return {Cesium.Primitive}\n * @api\n */\nexports.prototype.convert = function(layer, view, feature, context) {\n  const proj = view.getProjection();\n  const resolution = view.getResolution();\n\n  if (resolution == undefined || !proj) {\n    return null;\n  }\n\n  /**\n   * @type {ol.StyleFunction|undefined}\n   */\n  const layerStyle = layer.getStyleFunction();\n\n  const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n  if (!styles.length) {\n    // only 'render' features with a style\n    return null;\n  }\n\n  context.projection = proj;\n\n  /**\n   * @type {Cesium.Primitive|null}\n   */\n  let primitives = null;\n  for (let i = 0; i < styles.length; i++) {\n    const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n    if (!primitives) {\n      primitives = prims;\n    } else if (prims) {\n      let i = 0, prim;\n      while ((prim = prims.get(i))) {\n        primitives.add(prim);\n        i++;\n      }\n    }\n  }\n  return primitives;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport googAsserts from 'goog/asserts.js';\nimport * as olProj from 'ol/proj.js';\nimport * as olEvents from 'ol/events.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\n/**\n * @param {!olcsx.OLCesiumOptions} options Options.\n * @constructor\n * @api\n * @struct\n */\nconst exports = function(options) {\n\n  /**\n   * @type {olcs.AutoRenderLoop}\n   * @private\n   */\n  this.autoRenderLoop_ = null;\n\n  /**\n   * @type {!ol.Map}\n   * @private\n   */\n  this.map_ = options.map;\n\n  /**\n   * @type {!function(): Cesium.JulianDate}\n   * @private\n   */\n  this.time_ = options.time || function() {\n    return Cesium.JulianDate.now();\n  };\n\n  /**\n   * No change of the view projection.\n   * @private\n   */\n  this.to4326Transform_ = olProj.getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.resolutionScale_ = 1.0;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.canvasClientWidth_ = 0.0;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.canvasClientHeight_ = 0.0;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.resolutionScaleChanged_ = true; // force resize\n\n  const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n  /**\n   * @type {!Element}\n   * @private\n   */\n  this.container_ = document.createElement('DIV');\n  const containerAttribute = document.createAttribute('style');\n  containerAttribute.value = `${fillArea}visibility:hidden;`;\n  this.container_.setAttributeNode(containerAttribute);\n\n  let targetElement = options.target || null;\n  if (targetElement) {\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n  } else {\n    const oc = this.map_.getViewport().querySelector('.ol-overlaycontainer');\n    if (oc && oc.parentNode) {\n      oc.parentNode.insertBefore(this.container_, oc);\n    }\n  }\n\n  /**\n   * Whether the Cesium container is placed over the ol map.\n   * @type {boolean}\n   * @private\n   */\n  this.isOverMap_ = !targetElement;\n\n\n  if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n      olEvents.listen(this.container_, overlayEvents[i], evt => evt.stopPropagation());\n    }\n  }\n\n\n  /**\n   * @type {!HTMLCanvasElement}\n   * @private\n   */\n  this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n  const canvasAttribute = document.createAttribute('style');\n  canvasAttribute.value = fillArea;\n  this.canvas_.setAttributeNode(canvasAttribute);\n\n  if (olcsUtil.supportsImageRenderingPixelated()) {\n    // non standard CSS4\n    this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n  }\n\n  this.canvas_.oncontextmenu = function() { return false; };\n  this.canvas_.onselectstart = function() { return false; };\n\n  this.container_.appendChild(this.canvas_);\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.enabled_ = false;\n\n  /**\n   * @type {!Array.<ol.interaction.Interaction>}\n   * @private\n   */\n  this.pausedInteractions_ = [];\n\n  /**\n   * @type {?ol.layer.Group}\n   * @private\n   */\n  this.hiddenRootGroup_ = null;\n\n  const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n    /** @type {Cesium.SceneOptions} */ ({});\n  sceneOptions.canvas = this.canvas_;\n  sceneOptions.scene3DOnly = true;\n\n  /**\n   * @type {!Cesium.Scene}\n   * @private\n   */\n  this.scene_ = new Cesium.Scene(sceneOptions);\n\n  const sscc = this.scene_.screenSpaceCameraController;\n\n  sscc.tiltEventTypes.push({\n    'eventType': Cesium.CameraEventType.LEFT_DRAG,\n    'modifier': Cesium.KeyboardEventModifier.SHIFT\n  });\n\n  sscc.tiltEventTypes.push({\n    'eventType': Cesium.CameraEventType.LEFT_DRAG,\n    'modifier': Cesium.KeyboardEventModifier.ALT\n  });\n\n  sscc.enableLook = false;\n\n  this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n  /**\n   * @type {!olcs.Camera}\n   * @private\n   */\n  this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n  /**\n   * @type {!Cesium.Globe}\n   * @private\n   */\n  this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n  this.globe_.baseColor = Cesium.Color.WHITE;\n  this.scene_.globe = this.globe_;\n  this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n  // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n  // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n  const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n    url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n    rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n  });\n  this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n  this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n  this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n    scene: this.scene_,\n    dataSourceCollection: this.dataSourceCollection_\n  });\n\n  const synchronizers = options.createSynchronizers ?\n    options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n      new olcsRasterSynchronizer(this.map_, this.scene_),\n      new olcsVectorSynchronizer(this.map_, this.scene_),\n      new olcsOverlaySynchronizer(this.map_, this.scene_)\n    ];\n\n  // Assures correct canvas size after initialisation\n  this.handleResize_();\n\n  for (let i = synchronizers.length - 1; i >= 0; --i) {\n    synchronizers[i].synchronize();\n  }\n\n  if (this.isOverMap_) {\n    // if in \"stacked mode\", hide everything except canvas (including credits)\n    const credits = this.canvas_.nextElementSibling;\n    if (credits) {\n      credits.style.display = 'none';\n    }\n  }\n\n  /**\n   * Time of the last rendered frame, as returned by `performance.now()`.\n   * @type {number}\n   * @private\n   */\n  this.lastFrameTime_ = 0;\n\n  /**\n   * The identifier returned by `requestAnimationFrame`.\n   * @type {number|undefined}\n   * @private\n   */\n  this.renderId_ = undefined;\n\n  /**\n   * Target frame rate for the render loop.\n   * @type {number}\n   * @private\n   */\n  this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n  /**\n   * If the Cesium render loop is being blocked.\n   * @type {boolean}\n   * @private\n   */\n  this.blockCesiumRendering_ = false;\n\n  /**\n   * If the warmup routine is active.\n   * @type {boolean}\n   * @private\n   */\n  this.warmingUp_ = false;\n\n  /**\n   * @type {ol.Feature}\n   * @private\n   */\n  this.trackedFeature_ = null;\n\n  /**\n   * @type {Cesium.Entity}\n   * @private\n   */\n  this.trackedEntity_ = null;\n\n  /**\n   * @type {Cesium.EntityView}\n   * @private\n   */\n  this.entityView_ = null;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.needTrackedEntityUpdate_ = false;\n\n  /**\n   * @type {!Cesium.BoundingSphere}\n   */\n  this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n  const eventHelper = new Cesium.EventHelper();\n  eventHelper.add(this.scene_.postRender, exports.prototype.updateTrackedEntity_, this);\n\n  // Cesium has a mechanism to prevent the camera to go under the terrain.\n  // Unfortunately, it is only active when all the terrain has been loaded, which:\n  // - does not prevent the camera to sink under terrain anymore;\n  // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n  // The property below enables a workaround found in the Camptocamp Cesium fork.\n  // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n  Cesium.Camera.enableSuspendTerrainAdjustment = false;\n};\n\n\nObject.defineProperties(exports.prototype, {\n  'trackedFeature': {\n    'get': /** @this {olcs.OLCesium} */ function() {\n      return this.trackedFeature_;\n    },\n    'set': /** @this {olcs.OLCesium} */ function(feature) {\n      if (this.trackedFeature_ !== feature) {\n\n        const scene = this.scene_;\n\n        //Stop tracking\n        if (!feature || !feature.getGeometry()) {\n          this.needTrackedEntityUpdate_ = false;\n          scene.screenSpaceCameraController.enableTilt = true;\n\n          if (this.trackedEntity_) {\n            this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n          }\n          this.trackedEntity_ = null;\n          this.trackedFeature_ = null;\n          this.entityView_ = null;\n          scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n          return;\n        }\n\n        this.trackedFeature_ = feature;\n\n        //We can't start tracking immediately, so we set a flag and start tracking\n        //when the bounding sphere is ready (most likely next frame).\n        this.needTrackedEntityUpdate_ = true;\n\n        const to4326Transform = this.to4326Transform_;\n        const toCesiumPosition = function() {\n          const geometry = feature.getGeometry();\n          googAsserts.assertInstanceof(geometry, olGeomPoint);\n          const coo = geometry.getCoordinates();\n          const coo4326 = to4326Transform(coo, undefined, coo.length);\n          return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n        };\n\n        // Create an invisible point entity for tracking.\n        // It is independant from the primitive/geometry created by the vector synchronizer.\n        const options = {\n          'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n          'point': {\n            'pixelSize': 1,\n            'color': Cesium.Color.TRANSPARENT\n          }\n        };\n\n        this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n      }\n    }\n  }\n});\n\n\n/**\n * Render the Cesium scene.\n * @private\n */\nexports.prototype.render_ = function() {\n  // if a call to `requestAnimationFrame` is pending, cancel it\n  if (this.renderId_ !== undefined) {\n    cancelAnimationFrame(this.renderId_);\n    this.renderId_ = undefined;\n  }\n\n  // only render if Cesium is enabled/warming and rendering hasn't been blocked\n  if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n    this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n  }\n};\n\n\n/**\n * Callback for `requestAnimationFrame`.\n * @param {number} frameTime The frame time, from `performance.now()`.\n * @private\n */\nexports.prototype.onAnimationFrame_ = function(frameTime) {\n  this.renderId_ = undefined;\n\n  // check if a frame was rendered within the target frame rate\n  const interval = 1000.0 / this.targetFrameRate_;\n  const delta = frameTime - this.lastFrameTime_;\n  if (delta < interval) {\n    // too soon, don't render yet\n    this.render_();\n    return;\n  }\n\n  // time to render a frame, save the time\n  this.lastFrameTime_ = frameTime;\n\n  const julianDate = this.time_();\n  this.scene_.initializeFrame();\n  this.handleResize_();\n  this.dataSourceDisplay_.update(julianDate);\n\n  // Update tracked entity\n  if (this.entityView_) {\n    const trackedEntity = this.trackedEntity_;\n    const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (trackedState === Cesium.BoundingSphereState.DONE) {\n      this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n      this.entityView_.update(julianDate, this.boundingSphereScratch_);\n    }\n  }\n\n  this.scene_.render(julianDate);\n  this.camera_.checkCameraChange();\n\n  // request the next render call after this one completes to ensure the browser doesn't get backed up\n  this.render_();\n};\n\n\n/**\n * @private\n */\nexports.prototype.updateTrackedEntity_ = function() {\n  if (!this.needTrackedEntityUpdate_) {\n    return;\n  }\n\n  const trackedEntity = this.trackedEntity_;\n  const scene = this.scene_;\n\n  const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n  if (state === Cesium.BoundingSphereState.PENDING) {\n    return;\n  }\n\n  scene.screenSpaceCameraController.enableTilt = false;\n\n  const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n  if (bs) {\n    bs.radius = 1;\n  }\n  this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n  this.entityView_.update(this.time_(), bs);\n  this.needTrackedEntityUpdate_ = false;\n};\n\n\n/**\n * @private\n */\nexports.prototype.handleResize_ = function() {\n  let width = this.canvas_.clientWidth;\n  let height = this.canvas_.clientHeight;\n\n  if (width === 0 | height === 0) {\n    // The canvas DOM element is not ready yet.\n    return;\n  }\n\n  if (width === this.canvasClientWidth_ &&\n      height === this.canvasClientHeight_ &&\n      !this.resolutionScaleChanged_) {\n    return;\n  }\n\n  let resolutionScale = this.resolutionScale_;\n  if (!olcsUtil.supportsImageRenderingPixelated()) {\n    resolutionScale *= window.devicePixelRatio || 1.0;\n  }\n  this.resolutionScaleChanged_ = false;\n\n  this.canvasClientWidth_ = width;\n  this.canvasClientHeight_ = height;\n\n  width *= resolutionScale;\n  height *= resolutionScale;\n\n  this.canvas_.width = width;\n  this.canvas_.height = height;\n  this.scene_.camera.frustum.aspectRatio = width / height;\n};\n\n\n/**\n * @return {!olcs.Camera}\n * @api\n */\nexports.prototype.getCamera = function() {\n  return this.camera_;\n};\n\n\n/**\n * @return {!ol.Map}\n * @api\n */\nexports.prototype.getOlMap = function() {\n  return this.map_;\n};\n\n/**\n * @return {!ol.View}\n * @api\n */\nexports.prototype.getOlView = function() {\n  const view = this.map_.getView();\n  googAsserts.assert(view);\n  return view;\n};\n\n/**\n * @return {!Cesium.Scene}\n * @api\n */\nexports.prototype.getCesiumScene = function() {\n  return this.scene_;\n};\n\n\n/**\n * @return {!Cesium.DataSourceCollection}\n * @api\n */\nexports.prototype.getDataSources = function() {\n  return this.dataSourceCollection_;\n};\n\n\n/**\n * @return {!Cesium.DataSourceDisplay}\n * @api\n */\nexports.prototype.getDataSourceDisplay = function() {\n  return this.dataSourceDisplay_;\n};\n\n\n/**\n * @return {boolean}\n * @api\n */\nexports.prototype.getEnabled = function() {\n  return this.enabled_;\n};\n\n\n/**\n * Enables/disables the Cesium.\n * This modifies the visibility style of the container element.\n * @param {boolean} enable\n * @api\n */\nexports.prototype.setEnabled = function(enable) {\n  if (this.enabled_ === enable) {\n    return;\n  }\n  this.enabled_ = enable;\n\n  // some Cesium operations are operating with canvas.clientWidth,\n  // so we can't remove it from DOM or even make display:none;\n  this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n  let interactions;\n  if (this.enabled_) {\n    this.throwOnUnitializedMap_();\n    if (this.isOverMap_) {\n      interactions = this.map_.getInteractions();\n      interactions.forEach((el, i, arr) => {\n        this.pausedInteractions_.push(el);\n      });\n      interactions.clear();\n\n      const rootGroup = this.map_.getLayerGroup();\n      if (rootGroup.getVisible()) {\n        this.hiddenRootGroup_ = rootGroup;\n        this.hiddenRootGroup_.setVisible(false);\n      }\n\n      this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      this.map_.getOverlayContainerStopEvent().classList.add('olcs-hideoverlay');\n    }\n\n    this.camera_.readFromView();\n    this.render_();\n  } else {\n    if (this.isOverMap_) {\n      interactions = this.map_.getInteractions();\n      this.pausedInteractions_.forEach((interaction) => {\n        interactions.push(interaction);\n      });\n      this.pausedInteractions_.length = 0;\n      this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n      this.map_.getOverlayContainerStopEvent().classList.remove('olcs-hideoverlay');\n      if (this.hiddenRootGroup_) {\n        this.hiddenRootGroup_.setVisible(true);\n        this.hiddenRootGroup_ = null;\n      }\n    }\n\n    this.camera_.updateView();\n  }\n};\n\n\n/**\n * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n * @param {number} height Target height of the camera\n * @param {number} timeout Milliseconds after which the warming will stop\n * @api\n*/\nexports.prototype.warmUp = function(height, timeout) {\n  if (this.enabled_) {\n    // already enabled\n    return;\n  }\n  this.throwOnUnitializedMap_();\n  this.camera_.readFromView();\n  const ellipsoid = this.globe_.ellipsoid;\n  const csCamera = this.scene_.camera;\n  const position = ellipsoid.cartesianToCartographic(csCamera.position);\n  if (position.height < height) {\n    position.height = height;\n    csCamera.position = ellipsoid.cartographicToCartesian(position);\n  }\n\n  this.warmingUp_ = true;\n  this.render_();\n\n  setTimeout(() => {\n    this.warmingUp_ = false;\n  }, timeout);\n};\n\n\n/**\n * Block Cesium rendering to save resources.\n * @param {boolean} block True to block.\n * @api\n*/\nexports.prototype.setBlockCesiumRendering = function(block) {\n  if (this.blockCesiumRendering_ !== block) {\n    this.blockCesiumRendering_ = block;\n\n    // reset the render loop\n    this.render_();\n  }\n};\n\n\n/**\n * Render the globe only when necessary in order to save resources.\n * Experimental.\n * @api\n */\nexports.prototype.enableAutoRenderLoop = function() {\n  if (!this.autoRenderLoop_) {\n    this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n  }\n};\n\n\n/**\n * Get the autorender loop.\n * @return {?olcs.AutoRenderLoop}\n * @api\n*/\nexports.prototype.getAutoRenderLoop = function() {\n  return this.autoRenderLoop_;\n};\n\n\n/**\n * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n * clientWidth and clientHeight which are the dimension on the screen and\n * width and height which are the dimensions of the drawing buffer.\n *\n * By using a resolution scale lower than 1.0, it is possible to render the\n * globe in a buffer smaller than the canvas client dimensions and improve\n * performance, at the cost of quality.\n *\n * Pixel ratio should also be taken into account; by default, a device with\n * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n * surface.\n *\n * @param {number} value\n * @this {olcs.OLCesium}\n * @api\n */\nexports.prototype.setResolutionScale = function(value) {\n  value = Math.max(0, value);\n  if (value !== this.resolutionScale_) {\n    this.resolutionScale_ = Math.max(0, value);\n    this.resolutionScaleChanged_ = true;\n    if (this.autoRenderLoop_) {\n      this.autoRenderLoop_.restartRenderLoop();\n    }\n  }\n};\n\n\n/**\n * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n * to render as quickly as possible.\n * @param {number} value The frame rate, in frames per second.\n * @api\n */\nexports.prototype.setTargetFrameRate = function(value) {\n  if (this.targetFrameRate_ !== value) {\n    this.targetFrameRate_ = value;\n\n    // reset the render loop\n    this.render_();\n  }\n};\n\n\n/**\n * Check if OpenLayers map is not properly initialized.\n * @private\n */\nexports.prototype.throwOnUnitializedMap_ = function() {\n  const map = this.map_;\n  const view = map.getView();\n  const center = view.getCenter();\n  if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n    throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n  }\n};\n\n\nexport default exports;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport * as olBase from 'ol/index.js';\nimport * as olEvents from 'ol/events.js';\n\n/**\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @constructor\n * @template T\n * @struct\n * @api\n */\nconst exports = function(map, scene) {\n  /**\n   * @type {!ol.Map}\n   * @protected\n   */\n  this.map = map;\n\n  /**\n   * @type {ol.Collection.<ol.Overlay>}\n   * @private\n   */\n  this.overlays_ = this.map.getOverlays();\n\n  /**\n   * @type {!Cesium.Scene}\n   * @protected\n   */\n  this.scene = scene;\n\n  /**\n   * @private\n   * @type {!Element}\n   */\n  this.overlayContainerStopEvent_ = document.createElement('DIV');\n  this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n  const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n  overlayEvents.forEach((event) => {\n    olEvents.listen(this.overlayContainerStopEvent_, event, evt => evt.stopPropagation());\n  });\n  this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n  /**\n   * @private\n   * @type {!Element}\n   */\n  this.overlayContainer_ = document.createElement('DIV');\n  this.overlayContainer_.className = 'ol-overlaycontainer';\n  this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n  /**\n   * @type {!Object<?,olcs.SynchronizedOverlay>}\n   * @private\n   */\n  this.overlayMap_ = {};\n};\n\n\n\n/**\n * Get the element that serves as a container for overlays that don't allow\n * event propagation. Elements added to this container won't let mousedown and\n * touchstart events through to the map, so clicks and gestures on an overlay\n * don't trigger any {@link ol.MapBrowserEvent}.\n * @return {!Element} The map's overlay container that stops events.\n */\nexports.prototype.getOverlayContainerStopEvent = function() {\n  return this.overlayContainerStopEvent_;\n};\n\n/**\n * Get the element that serves as a container for overlays.\n * @return {!Element} The map's overlay container.\n */\nexports.prototype.getOverlayContainer = function() {\n  return this.overlayContainer_;\n};\n\n/**\n * Destroy all and perform complete synchronization of the overlays.\n * @api\n */\nexports.prototype.synchronize = function() {\n  this.destroyAll();\n  this.addOverlays();\n  this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n  this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n};\n\n/**\n * @param {ol.Collection.Event} event\n * @private\n */\nexports.prototype.addOverlayFromEvent_ = function(event) {\n  const overlay = /** @type {ol.Overlay} */ (event.element);\n  this.addOverlay(overlay);\n};\n\n/**\n * @api\n */\nexports.prototype.addOverlays = function() {\n  this.overlays_.forEach((overlay) => { this.addOverlay(); });\n};\n\n/**\n * @param {ol.Overlay} overlay\n * @api\n */\nexports.prototype.addOverlay = function(overlay) {\n  if (!overlay) {\n    return;\n  }\n  const cesiumOverlay = new olcsSynchronizedOverlay({\n    scene: this.scene,\n    synchronizer: this,\n    parent: overlay\n  });\n\n  const overlayId = olBase.getUid(overlay).toString();\n  this.overlayMap_[overlayId] = cesiumOverlay;\n};\n\n/**\n * @param {ol.Collection.Event} event\n * @private\n */\nexports.prototype.removeOverlayFromEvent_ = function(event) {\n  const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n  this.removeOverlay(removedOverlay);\n};\n\n/**\n * Removes an overlay from the scene\n * @param {ol.Overlay} overlay\n * @api\n */\nexports.prototype.removeOverlay = function(overlay) {\n  const overlayId = olBase.getUid(overlay).toString();\n  const csOverlay = this.overlayMap_[overlayId];\n  if (csOverlay) {\n    csOverlay.destroy();\n    delete this.overlayMap_[overlayId];\n  }\n};\n\n/**\n * Destroys all the created Cesium objects.\n * @protected\n */\nexports.prototype.destroyAll = function() {\n  Object.keys(this.overlayMap_).forEach((key) => {\n    const overlay = this.overlayMap_[key];\n    overlay.destroy();\n    delete this.overlayMap_[key];\n  });\n};\n\n\n\nexport default exports;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport googAsserts from 'goog/asserts.js';\nimport * as olArray from 'ol/array.js';\nimport * as olBase from 'ol/index.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\n/**\n * This object takes care of one-directional synchronization of\n * Openlayers raster layers to the given Cesium globe.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @constructor\n * @extends {olcs.AbstractSynchronizer.<Cesium.ImageryLayer>}\n * @api\n * @struct\n */\nconst exports = function(map, scene) {\n  /**\n   * @type {!Cesium.ImageryLayerCollection}\n   * @private\n   */\n  this.cesiumLayers_ = scene.imageryLayers;\n\n  /**\n   * @type {!Cesium.ImageryLayerCollection}\n   * @private\n   */\n  this.ourLayers_ = new Cesium.ImageryLayerCollection();\n\n  olcsAbstractSynchronizer.call(this, map, scene);\n};\n\nolBase.inherits(exports, olcsAbstractSynchronizer);\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.addCesiumObject = function(object) {\n  this.cesiumLayers_.add(object);\n  this.ourLayers_.add(object);\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.destroyCesiumObject = function(object) {\n  object.destroy();\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.removeSingleCesiumObject = function(object, destroy) {\n  this.cesiumLayers_.remove(object, destroy);\n  this.ourLayers_.remove(object, false);\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.removeAllCesiumObjects = function(destroy) {\n  for (let i = 0; i < this.ourLayers_.length; ++i) {\n    this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n  }\n  this.ourLayers_.removeAll(false);\n};\n\n\n/**\n * Creates an array of Cesium.ImageryLayer.\n * May be overriden by child classes to implement custom behavior.\n * The default implementation handles tiled imageries in EPSG:4326 or\n * EPSG:3859.\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n * (or supported)\n * @protected\n */\nexports.prototype.convertLayerToCesiumImageries = function(olLayer, viewProj) {\n  const result = olcsCore.tileLayerToImageryLayer(olLayer, viewProj);\n  return result ? [result] : null;\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.createSingleLayerCounterparts = function(olLayerWithParents) {\n  const olLayer = olLayerWithParents.layer;\n  const uid = olBase.getUid(olLayer).toString();\n  const viewProj = this.view.getProjection();\n  googAsserts.assert(viewProj);\n  const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n  if (cesiumObjects) {\n    const listenKeyArray = [];\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n        // the compiler does not seem to be able to infer this\n        googAsserts.assert(cesiumObjects);\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n        }\n      }));\n    });\n\n    for (let i = 0; i < cesiumObjects.length; ++i) {\n      olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n    }\n\n    // there is no way to modify Cesium layer extent,\n    // we have to recreate when OpenLayers layer extent changes:\n    listenKeyArray.push(olLayer.on('change:extent', (e) => {\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n        this.ourLayers_.remove(cesiumObjects[i], false);\n      }\n      delete this.layerMap[olBase.getUid(olLayer)]; // invalidate the map entry\n      this.synchronize();\n    }));\n\n    listenKeyArray.push(olLayer.on('change', (e) => {\n      // when the source changes, re-add the layer to force update\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n        if (position >= 0) {\n          this.cesiumLayers_.remove(cesiumObjects[i], false);\n          this.cesiumLayers_.add(cesiumObjects[i], position);\n        }\n      }\n    }));\n\n    this.olLayerListenKeys[uid].push(...listenKeyArray);\n  }\n\n  return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n};\n\n\n/**\n * Order counterparts using the same algorithm as the Openlayers renderer:\n * z-index then original sequence order.\n * @override\n * @protected\n */\nexports.prototype.orderLayers = function() {\n  const layers = [];\n  const zIndices = {};\n  const queue = [this.mapLayerGroup];\n\n  while (queue.length > 0) {\n    const olLayer = queue.splice(0, 1)[0];\n    layers.push(olLayer);\n    zIndices[olBase.getUid(olLayer)] = olLayer.getZIndex();\n\n    if (olLayer instanceof olLayerGroup) {\n      const sublayers = olLayer.getLayers();\n      if (sublayers) {\n        // Prepend queue with sublayers in order\n        queue.unshift(...sublayers.getArray());\n      }\n    }\n  }\n\n  olArray.stableSort(layers, (layer1, layer2) =>\n    zIndices[olBase.getUid(layer1)] - zIndices[olBase.getUid(layer2)]\n  );\n\n  layers.forEach((olLayer) => {\n    const olLayerId = olBase.getUid(olLayer).toString();\n    const cesiumObjects = this.layerMap[olLayerId];\n    if (cesiumObjects) {\n      cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n    }\n  });\n};\n\n\n/**\n * @param {Cesium.ImageryLayer} counterpart\n */\nexports.prototype.raiseToTop = function(counterpart) {\n  this.cesiumLayers_.raiseToTop(counterpart);\n};\n\n\nexport default exports;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport * as olBase from 'ol/index.js';\nimport olOverlay from 'ol/Overlay.js';\nimport * as olProj from 'ol/proj.js';\nimport * as olDom from 'ol/dom.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n/**\n * @constructor\n * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n * @extends {ol.Overlay}\n * @struct\n * @api\n */\nconst exports = function(options) {\n  /**\n   * @private\n   * @type {?Function}\n   */\n  this.scenePostRenderListenerRemover_ = null;\n\n  /**\n   * @private\n   * @type {!Cesium.Scene}\n   */\n  this.scene_ = options.scene;\n\n  /**\n   * @private\n   * @type {!olcs.OverlaySynchronizer}\n   */\n  this.synchronizer_ = options.synchronizer;\n\n  /**\n   * @private\n   * @type {!ol.Overlay}\n   */\n  this.parent_ = options.parent;\n\n  /**\n   * @private\n   * @type {ol.Coordinate|undefined}\n   */\n  this.positionWGS84_ = undefined;\n\n  /**\n   * @private\n   * @type {MutationObserver}\n   */\n  this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n  /**\n   * @private\n   * @type {Array.<MutationObserver>}\n   */\n  this.attributeObserver_ = [];\n\n  /**\n   * @private\n   * @type {Array<ol.EventsKey>}\n   */\n  this.listenerKeys_ = [];\n  // synchronize our Overlay with the parent Overlay\n  this.listenerKeys_.push(this.parent_.on('change:position', this.setPropertyFromEvent_.bind(this)));\n  this.listenerKeys_.push(this.parent_.on('change:element', this.setPropertyFromEvent_.bind(this)));\n  this.listenerKeys_.push(this.parent_.on('change:offset', this.setPropertyFromEvent_.bind(this)));\n  this.listenerKeys_.push(this.parent_.on('change:position', this.setPropertyFromEvent_.bind(this)));\n  this.listenerKeys_.push(this.parent_.on('change:positioning', this.setPropertyFromEvent_.bind(this)));\n\n  olOverlay.call(this, this.parent_.getOptions());\n  this.setProperties(this.parent_.getProperties());\n\n  this.handleMapChanged();\n};\n\nolBase.inherits(exports, olOverlay);\n\n/**\n * @param {Node} target\n * @private\n */\nexports.prototype.observeTarget_ = function(target) {\n  this.observer_.disconnect();\n  this.observer_.observe(target, {\n    attributes: false,\n    childList: true,\n    characterData: true,\n    subtree: true\n  });\n  this.attributeObserver_.forEach((observer) => {\n    observer.disconnect();\n  });\n  this.attributeObserver_.length = 0;\n  for (let i = 0; i < target.childNodes.length; i++) {\n    const node = target.childNodes[i];\n    if (node.nodeType === 1) {\n      const observer = new MutationObserver(this.handleElementChanged.bind(this));\n      observer.observe(node, {\n        attributes: true,\n        subtree: true\n      });\n      this.attributeObserver_.push(observer);\n    }\n  }\n};\n\n/**\n *\n * @param {ol.Object.Event} event\n * @private\n */\nexports.prototype.setPropertyFromEvent_ = function(event) {\n  if (event.target && event.key) {\n    this.set(event.key, event.target.get(event.key));\n  }\n};\n/**\n * Get the scene associated with this overlay.\n * @see ol.Overlay.prototype.getMap\n * @return {!Cesium.Scene} The scene that the overlay is part of.\n * @api\n */\nexports.prototype.getScene = function() {\n  return this.scene_;\n};\n\n\n\n/**\n * @override\n */\nexports.prototype.handleMapChanged = function() {\n  if (this.scenePostRenderListenerRemover_) {\n    this.scenePostRenderListenerRemover_();\n    olDom.removeNode(this.element);\n  }\n  this.scenePostRenderListenerRemover_ = null;\n  const scene = this.getScene();\n  if (scene) {\n    this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n    this.updatePixelPosition();\n    const container = this.stopEvent ?\n      this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n    if (this.insertFirst) {\n      container.insertBefore(this.element, container.childNodes[0] || null);\n    } else {\n      container.appendChild(this.element);\n    }\n  }\n};\n\n/**\n * @override\n */\nexports.prototype.handlePositionChanged = function() {\n  // transform position to WGS84\n  const position = this.getPosition();\n  if (position) {\n    const sourceProjection = this.parent_.getMap().getView().getProjection();\n    this.positionWGS84_ = olProj.transform(position, sourceProjection, 'EPSG:4326');\n  } else {\n    this.positionWGS84_ = undefined;\n  }\n  this.updatePixelPosition();\n};\n\n/**\n * @override\n */\nexports.prototype.handleElementChanged = function() {\n  function cloneNode(node, parent) {\n    const clone = node.cloneNode();\n    if (parent) {\n      parent.appendChild(clone);\n    }\n    if (node.nodeType != Node.TEXT_NODE) {\n      clone.addEventListener('click', (event) => {\n        node.dispatchEvent(new MouseEvent('click', event));\n        event.stopPropagation();\n      });\n    }\n    const nodes = node.childNodes;\n    for (let i = 0; i < nodes.length; i++) {\n      if (!nodes[i]) {\n        continue;\n      }\n      cloneNode(nodes[i], clone);\n    }\n    return clone;\n  }\n  olDom.removeChildren(this.element);\n  const element = this.getElement();\n  if (element) {\n    if (element.parentNode && element.parentNode.childNodes) {\n      for (const node of element.parentNode.childNodes) {\n        const clonedNode = cloneNode(node, null);\n        this.element.appendChild(clonedNode);\n      }\n    }\n  }\n  if (element.parentNode) {\n    // set new Observer\n    this.observeTarget_(element.parentNode);\n  }\n};\n\n\n/**\n * @override\n */\nexports.prototype.updatePixelPosition = function() {\n  const position = this.positionWGS84_;\n  if (!this.scene_ || !position) {\n    this.setVisible(false);\n    return;\n  }\n  let cartesian;\n  if (position.length === 2) {\n    cartesian = Cesium.Cartesian3.fromDegreesArray(position)[0];\n  } else {\n    cartesian = Cesium.Cartesian3.fromDegreesArrayHeights(position)[0];\n  }\n  const camera = this.scene_.camera;\n  const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n  const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n  // check if overlay position is behind the horizon\n  if (!occluder.isPointVisible(cartesian)) {\n    this.setVisible(false);\n    return;\n  }\n  const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n  // check if overlay position is visible from the camera\n  if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n    this.setVisible(false);\n    return;\n  }\n  this.setVisible(true);\n\n  const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n  const pixel = [pixelCartesian.x, pixelCartesian.y];\n  const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n  this.updateRenderedPosition(pixel, mapSize);\n};\n\n/**\n * Destroys the overlay, removing all its listeners and elements\n * @api\n */\nexports.prototype.destroy = function() {\n  if (this.scenePostRenderListenerRemover_) {\n    this.scenePostRenderListenerRemover_();\n  }\n  if (this.observer_) {\n    this.observer_.disconnect();\n  }\n  olObservableUnByKey(this.listenerKeys_);\n  this.listenerKeys_.splice(0);\n  if (this.element.removeNode) {\n    this.element.removeNode(true);\n  } else {\n    this.element.remove();\n  }\n  this.element = null;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport googAsserts from 'goog/asserts.js';\nimport * as olBase from 'ol/index.js';\nimport * as olEvents from 'ol/events.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\n/**\n * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @param {olcs.FeatureConverter=} opt_converter\n * @constructor\n * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n * @api\n * @struct\n */\nconst exports = function(map, scene, opt_converter) {\n\n  /**\n   * @protected\n   */\n  this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n  /**\n   * @private\n   */\n  this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n  scene.primitives.add(this.csAllPrimitives_);\n  this.csAllPrimitives_.destroyPrimitives = false;\n\n  olcsAbstractSynchronizer.call(this, map, scene);\n};\n\nolBase.inherits(exports, olcsAbstractSynchronizer);\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.addCesiumObject = function(counterpart) {\n  googAsserts.assert(counterpart);\n  counterpart.getRootPrimitive()['counterpart'] = counterpart;\n  this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.destroyCesiumObject = function(object) {\n  object.getRootPrimitive().destroy();\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.removeSingleCesiumObject = function(object, destroy) {\n  object.destroy();\n  this.csAllPrimitives_.destroyPrimitives = destroy;\n  this.csAllPrimitives_.remove(object.getRootPrimitive());\n  this.csAllPrimitives_.destroyPrimitives = false;\n};\n\n\n/**\n * @inheritDoc\n */\nexports.prototype.removeAllCesiumObjects = function(destroy) {\n  this.csAllPrimitives_.destroyPrimitives = destroy;\n  if (destroy) {\n    for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n      this.csAllPrimitives_.get(i)['counterpart'].destroy();\n    }\n  }\n  this.csAllPrimitives_.removeAll();\n  this.csAllPrimitives_.destroyPrimitives = false;\n};\n\n/**\n * Synchronizes the layer visibility properties\n * to the given Cesium Primitive.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.Primitive} csPrimitive\n */\nexports.prototype.updateLayerVisibility = function(olLayerWithParents, csPrimitive) {\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    } else {\n      visible = false;\n    }\n  });\n  csPrimitive.show = visible;\n};\n/**\n * @inheritDoc\n */\nexports.prototype.createSingleLayerCounterparts = function(olLayerWithParents) {\n  const olLayer = olLayerWithParents.layer;\n  if (!(olLayer instanceof olLayerVector)) {\n    return null;\n  }\n  googAsserts.assertInstanceof(olLayer, olLayerLayer);\n\n  let source = olLayer.getSource();\n  if (source instanceof olSourceCluster) {\n    source = source.getSource();\n  }\n\n  googAsserts.assertInstanceof(source, olSourceVector);\n  googAsserts.assert(this.view);\n\n  const view = this.view;\n  const featurePrimitiveMap = {};\n  const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n      featurePrimitiveMap);\n  const csPrimitives = counterpart.getRootPrimitive();\n  const olListenKeys = counterpart.olListenKeys;\n\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n    olListenKeys.push(olEvents.listen(olLayerItem, 'change:visible', () => {\n      this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n    }));\n  });\n  this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n  const onAddFeature = (function(feature) {\n    googAsserts.assert(\n        (olLayer instanceof olLayerVector) ||\n        (olLayer instanceof olLayerImage)\n    );\n    const context = counterpart.context;\n    const prim = this.converter.convert(olLayer, view, feature, context);\n    if (prim) {\n      featurePrimitiveMap[olBase.getUid(feature)] = prim;\n      csPrimitives.add(prim);\n    }\n  }).bind(this);\n\n  const onRemoveFeature = (function(feature) {\n    const id = olBase.getUid(feature);\n    const context = counterpart.context;\n    const bbs = context.featureToCesiumMap[id];\n    if (bbs) {\n      delete context.featureToCesiumMap[id];\n      bbs.forEach((bb) => {\n        if (bb instanceof Cesium.Billboard) {\n          context.billboards.remove(bb);\n        }\n      });\n    }\n    const csPrimitive = featurePrimitiveMap[id];\n    delete featurePrimitiveMap[id];\n    if (csPrimitive) {\n      csPrimitives.remove(csPrimitive);\n    }\n  }).bind(this);\n\n  olListenKeys.push(olEvents.listen(source, 'addfeature', (e) => {\n    googAsserts.assert(e.feature);\n    onAddFeature(e.feature);\n  }, this));\n\n  olListenKeys.push(olEvents.listen(source, 'removefeature', (e) => {\n    googAsserts.assert(e.feature);\n    onRemoveFeature(e.feature);\n  }, this));\n\n  olListenKeys.push(olEvents.listen(source, 'changefeature', (e) => {\n    const feature = e.feature;\n    googAsserts.assert(feature);\n    onRemoveFeature(feature);\n    onAddFeature(feature);\n  }, this));\n\n  return counterpart ? [counterpart] : null;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.core\n */\nconst exports = {};\nimport * as olEasing from 'ol/easing.js';\nimport googAsserts from 'goog/asserts.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport * as olProj from 'ol/proj.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport olcsUtil from './util.js';\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @return {!Cesium.Cartesian2} the pixel size\n * @api\n */\nexports.computePixelSizeAtCoordinate = function(scene, target) {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  const pixelSize = new Cesium.Cartesian2();\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight,\n      distance, pixelSize);\n};\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexports.computeBoundingBoxAtTarget = function(scene, target, amount) {\n  const pixelSize = exports.computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n};\n\n\n/**\n *\n * @param {!ol.geom.Geometry} geometry\n * @param {number} height\n * @api\n */\nexports.applyHeightOffsetToGeometry = function(geometry, height) {\n  geometry.applyTransform((input, output, stride) => {\n    googAsserts.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n};\n\n\n/**\n * @param {ol.Coordinate} coordinates\n * @param {number=} rotation\n * @param {!Cesium.Cartesian3=} translation\n * @param {!Cesium.Cartesian3=} scale\n * @return {!Cesium.Matrix4}\n * @api\n */\nexports.createMatrixAtCoordinates = function(coordinates, rotation = 0, translation = Cesium.Cartesian3.ZERO, scale = new Cesium.Cartesian3(1, 1, 1)) {\n  const position = exports.ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n};\n\n\n/**\n * @param {!Cesium.Camera} camera\n * @param {number} angle\n * @param {!Cesium.Cartesian3} axis\n * @param {!Cesium.Matrix4} transform\n * @param {olcsx.core.RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.rotateAroundAxis = function(camera, angle, axis, transform,\n    opt_options) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options = opt_options || {};\n  const duration = defaultValue(options.duration, 500); // ms\n  const easing = defaultValue(options.easing, olEasing.linear);\n  const callback = options.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    googAsserts.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} heading\n * @param {!Cesium.Cartesian3} bottomCenter\n * @param {olcsx.core.RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.setHeadingUsingBottomCenter = function(scene, heading,\n    bottomCenter, opt_options) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = exports.computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  const rotateAroundAxis = exports.rotateAroundAxis;\n  rotateAroundAxis(camera, heading, zenith, transform, opt_options);\n};\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian2} pixel\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickOnTerrainOrEllipsoid = function(scene, pixel) {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n};\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickBottomPoint = function(scene) {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return exports.pickOnTerrainOrEllipsoid(scene, bottom);\n};\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickCenterPoint = function(scene) {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return exports.pickOnTerrainOrEllipsoid(scene, center);\n};\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n * intersection of the camera direction with the globe.\n * @param {!Cesium.Scene} scene\n * @return {number|undefined}\n * @api\n */\nexports.computeSignedTiltAngleOnGlobe = function(scene) {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = exports.signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n};\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Ray}\n */\nexports.bottomFovRay = function(scene) {\n  const camera = scene.camera;\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n};\n\n\n/**\n * Compute the angle between two Cartesian3.\n * @param {!Cesium.Cartesian3} first\n * @param {!Cesium.Cartesian3} second\n * @param {!Cesium.Cartesian3} normal Normal to test orientation against.\n * @return {number}\n */\nexports.signedAngleBetween = function(first, second, normal) {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n};\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} pivot Point around which the camera rotates.\n * @return {number}\n * @api\n */\nexports.computeAngleToZenith = function(scene, pivot) {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  const fy = camera.frustum.fovy / 2;\n  const ray = exports.bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = exports.signedAngleBetween(normal, direction, left);\n  return a + fy;\n};\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n * @api\n */\nexports.extentToRectangle = function(extent, projection) {\n  if (extent && projection) {\n    const ext = olProj.transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Cesium.ImageryLayer} null if not possible (or supported)\n * @api\n */\nexports.tileLayerToImageryLayer = function(olLayer, viewProj) {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage)) {\n    return null;\n  }\n\n  let provider = null;\n  let source = olLayer.getSource();\n\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n    source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection))  {\n      provider = new olcsCoreOLImageryProvider(source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n\n  } else {\n    // sources other than TileImage are currently not supported\n    return null;\n  }\n\n  // the provider is always non-null if we got this far\n\n  const layerOptions = {};\n\n  const forcedExtent = /** @type {ol.Extent} */ (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = exports.extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n};\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.ImageryLayer} csLayer\n * @api\n */\nexports.updateCesiumLayerProperties = function(olLayerWithParents, csLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n};\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n * @param {ol.Coordinate} coordinate Ol3 coordinate.\n * @return {!Cesium.Cartesian3} Cesium cartesian coordinate\n * @api\n */\nexports.ol4326CoordinateToCesiumCartesian = function(coordinate) {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n};\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n * @param {Array.<!ol.Coordinate>} coordinates Ol3 coordinates.\n * @return {!Array.<Cesium.Cartesian3>} Cesium cartesian coordinates\n * @api\n */\nexports.ol4326CoordinateArrayToCsCartesians = function(coordinates) {\n  googAsserts.assert(coordinates !== null);\n  const toCartesian = exports.ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n};\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n * @param {!T} geometry\n * @param {!ol.ProjectionLike} projection\n * @return {!T}\n * @template T\n * @api\n */\nexports.olGeometryCloneTo4326 = function(geometry, projection) {\n  googAsserts.assert(projection);\n\n  const proj4326 = olProj.get('EPSG:4326');\n  const proj = olProj.get(projection);\n  if (proj !== proj4326) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n};\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n * @param {ol.Color|CanvasGradient|CanvasPattern|string} olColor\n * @return {!Cesium.Color}\n * @api\n */\nexports.convertColorToCesium = function(olColor) {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  }\n  googAsserts.fail('impossible');\n};\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n * @param {string} url\n * @return {!olcsx.core.CesiumUrlDefinition}\n * @api\n */\nexports.convertUrlToCesium = function(url) {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n};\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @return {Promise<undefined>}\n * @api\n */\nexports.resetToNorthZenith = function(map, scene) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = exports.computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    exports.setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options = {\n      callback: () => {\n        const view = map.getView();\n        exports.normalizeView(view);\n        resolve();\n      }\n    };\n    exports.rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexports.rotateAroundBottomCenter = function(scene, angle) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options = {callback: resolve};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const rotateAroundAxis = exports.rotateAroundAxis;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n * @param {ol.View} view\n * @param {number=} angle\n * @api\n */\nexports.normalizeView = function(view, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n  view.setResolution(view.constrainResolution(resolution));\n};\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n *\n * @param {ol.proj.Projection} projection Projection to check.\n * @returns {boolean} Whether it's managed by Cesium.\n */\nexports.isCesiumProjection = function(projection) {\n  const is3857 = projection === olProj.get('EPSG:3857');\n  const is4326 = projection === olProj.get('EPSG:4326');\n  return is3857 || is4326;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport * as olProj from 'ol/proj.js';\nimport olcsUtil from '../util.js';\n\n/**\n * Special class derived from Cesium.ImageryProvider\n * that is connected to the given ol.source.TileImage.\n * @param {!ol.source.TileImage} source\n * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n *                                               projection of the source\n *                                               is not defined.\n * @constructor\n * @struct\n * @extends {Cesium.ImageryProvider}\n */\nconst exports = function(source, opt_fallbackProj) {\n  // Do not ol.inherit() or call super constructor from\n  // Cesium.ImageryProvider since this particular function is a\n  // 'non instanciable interface' which throws on instanciation.\n\n  /**\n   * @type {!ol.source.TileImage}\n   * @private\n   */\n  this.source_ = source;\n\n  /**\n   * @type {?ol.proj.Projection}\n   * @private\n   */\n  this.projection_ = null;\n\n  /**\n   * @type {?ol.proj.Projection}\n   * @private\n   */\n  this.fallbackProj_ = opt_fallbackProj || null;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.ready_ = false;\n\n  /**\n   * @type {?Cesium.Credit}\n   * @private\n   */\n  this.credit_ = null;\n\n  /**\n   * @type {?Cesium.TilingScheme}\n   * @private\n   */\n  this.tilingScheme_ = null;\n\n  /**\n   * @type {?Cesium.Rectangle}\n   * @private\n   */\n  this.rectangle_ = null;\n\n  const proxy = this.source_.get('olcs.proxy');\n  if (proxy) {\n    if (typeof proxy === 'function') {\n      this.proxy_ = {\n        'getURL': proxy\n      };\n    } else if (typeof proxy === 'string') {\n      this.proxy_ = new Cesium.DefaultProxy(proxy);\n    }\n  }\n\n  this.errorEvent_ = new Cesium.Event();\n\n  this.emptyCanvas_ = document.createElement('canvas');\n  this.emptyCanvas_.width = 1;\n  this.emptyCanvas_.height = 1;\n\n  this.source_.on('change', (e) => {\n    this.handleSourceChanged_();\n  });\n  this.handleSourceChanged_();\n};\n\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(exports.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'credit': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.credit_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\n/**\n * Checks if the underlying source is ready and cached required data.\n * @private\n */\nexports.prototype.handleSourceChanged_ = function() {\n  if (!this.ready_ && this.source_.getState() == 'ready') {\n    this.projection_ = olcsUtil.getSourceProjection(this.source_) || this.fallbackProj_;\n    if (this.projection_ == olProj.get('EPSG:4326')) {\n      this.tilingScheme_ = new Cesium.GeographicTilingScheme();\n    } else if (this.projection_ == olProj.get('EPSG:3857')) {\n      this.tilingScheme_ = new Cesium.WebMercatorTilingScheme();\n    } else {\n      return;\n    }\n    this.rectangle_ = this.tilingScheme_.rectangle;\n\n    this.credit_ = exports.createCreditForSource(this.source_);\n    this.ready_ = true;\n  }\n};\n\n\n/**\n * Try to create proper Cesium.Credit for the given ol.source.Source as closely as possible.\n * @param {!ol.source.Source} source\n * @return {?Cesium.Credit}\n */\nexports.createCreditForSource = function(source) {\n  let text = '';\n  let attributions = source.getAttributions();\n  if (typeof attributions === 'function') {\n    attributions = attributions();\n  }\n  if (attributions) {\n    attributions.forEach((htmlOrAttr) => {\n      const html = typeof htmlOrAttr === 'string' ? htmlOrAttr : htmlOrAttr.getHTML();\n      text += html;\n    });\n  }\n\n  return text.length > 0 ? new Cesium.Credit(text, true) : null;\n};\n\n\n/**\n * TODO: attributions for individual tile ranges\n * @export\n * @override\n */\nexports.prototype.getTileCredits = function(x, y, level) {\n  return undefined;\n};\n\n\n/**\n * @export\n * @override\n */\nexports.prototype.requestImage = function(x, y, level) {\n  const tileUrlFunction = this.source_.getTileUrlFunction();\n  if (tileUrlFunction && this.projection_) {\n\n    // Perform mapping of Cesium tile coordinates to OpenLayers tile coordinates:\n    // 1) Cesium zoom level 0 is OpenLayers zoom level 1 for EPSG:4326\n    const z_ = this.tilingScheme_ instanceof Cesium.GeographicTilingScheme ? level + 1 : level;\n    // 2) OpenLayers tile coordinates increase from bottom to top\n    const y_ = -y - 1;\n\n    let url = tileUrlFunction.call(this.source_,\n        [z_, x, y_], 1, this.projection_);\n    if (this.proxy_) {\n      url = this.proxy_.getURL(url);\n    }\n    return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n  } else {\n    // return empty canvas to stop Cesium from retrying later\n    return this.emptyCanvas_;\n  }\n};\n\n\nexport default exports;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n/**\n * Result of the conversion of an OpenLayers layer to Cesium.\n * @constructor\n * @struct\n * @param {!(ol.proj.Projection|string)} layerProjection\n * @param {!Cesium.Scene} scene\n */\nconst exports = function(layerProjection, scene) {\n  const billboards = new Cesium.BillboardCollection({scene});\n  const primitives = new Cesium.PrimitiveCollection();\n\n  /**\n   * @type {!Array.<ol.EventsKey>}\n   */\n  this.olListenKeys = [];\n\n  this.rootCollection_ = new Cesium.PrimitiveCollection();\n  /**\n   * @type {!olcsx.core.OlFeatureToCesiumContext}\n   */\n  this.context = {\n    projection: layerProjection,\n    billboards,\n    featureToCesiumMap: {},\n    primitives\n  };\n\n  this.rootCollection_.add(billboards);\n  this.rootCollection_.add(primitives);\n};\n\n\n/**\n * Unlisten.\n */\nexports.prototype.destroy = function() {\n  this.olListenKeys.forEach(olObservableUnByKey);\n  this.olListenKeys.length = 0;\n};\n\n\n/**\n * @return {!Cesium.Primitive}\n */\nexports.prototype.getRootPrimitive = function() {\n  return this.rootCollection_;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.util\n */\nconst exports = {};\n\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexports.obj = function(param) {\n  return param;\n};\n\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nexports.supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nexports.imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexports.supportsImageRenderingPixelated = function() {\n  if (exports.supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    exports.supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (exports.supportsImageRenderingPixelatedResult_) {\n      exports.imageRenderingValueResult_ = tmp;\n    }\n  }\n  return exports.supportsImageRenderingPixelatedResult_;\n};\n\n\n/**\n * @return {string}\n */\nexports.imageRenderingValue = function() {\n  exports.supportsImageRenderingPixelated();\n  return exports.imageRenderingValueResult_ || '';\n};\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexports.getSourceProjection = function(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n    || source.getProjection();\n};\n\n\nexport default exports;\n","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_Observable_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_Overlay_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_array_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_dom_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_easing_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_events_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_extent_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_Geometry_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_Point_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_geom_SimpleGeometry_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_index_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Group_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Image_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Layer_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Tile_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_layer_Vector_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_math_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_proj_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_Cluster_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_Image_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_ImageWMS_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_TileImage_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_TileWMS_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_source_Vector_js__;","module.exports = __WEBPACK_EXTERNAL_MODULE_ol_style_Icon_js__;"],"sourceRoot":""}