{"version":3,"sources":["webpack://olcs_unused_var/webpack/bootstrap","webpack://olcs_unused_var/./src/index.library.js","webpack://olcs_unused_var/./src/olcs/AbstractSynchronizer.js","webpack://olcs_unused_var/./src/olcs/AutoRenderLoop.js","webpack://olcs_unused_var/./src/olcs/Camera.js","webpack://olcs_unused_var/./src/olcs/FeatureConverter.js","webpack://olcs_unused_var/./src/olcs/OLCesium.js","webpack://olcs_unused_var/./src/olcs/OverlaySynchronizer.js","webpack://olcs_unused_var/./src/olcs/RasterSynchronizer.js","webpack://olcs_unused_var/./src/olcs/SynchronizedOverlay.js","webpack://olcs_unused_var/./src/olcs/VectorSynchronizer.js","webpack://olcs_unused_var/./src/olcs/contrib/LazyLoader.js","webpack://olcs_unused_var/./src/olcs/contrib/Manager.js","webpack://olcs_unused_var/./src/olcs/core.js","webpack://olcs_unused_var/./src/olcs/core/OLImageryProvider.js","webpack://olcs_unused_var/./src/olcs/core/VectorLayerCounterpart.js","webpack://olcs_unused_var/./src/olcs/math.js","webpack://olcs_unused_var/./src/olcs/util.js","webpack://olcs_unused_var/external \"ol.Observable\"","webpack://olcs_unused_var/external \"ol.Overlay\"","webpack://olcs_unused_var/external \"ol.easing\"","webpack://olcs_unused_var/external \"ol.extent\"","webpack://olcs_unused_var/external \"ol.geom.Geometry\"","webpack://olcs_unused_var/external \"ol.geom.Point\"","webpack://olcs_unused_var/external \"ol.geom.Polygon\"","webpack://olcs_unused_var/external \"ol.geom.SimpleGeometry\"","webpack://olcs_unused_var/external \"ol.layer.Group\"","webpack://olcs_unused_var/external \"ol.layer.Image\"","webpack://olcs_unused_var/external \"ol.layer.Layer\"","webpack://olcs_unused_var/external \"ol.layer.Tile\"","webpack://olcs_unused_var/external \"ol.layer.Vector\"","webpack://olcs_unused_var/external \"ol.proj\"","webpack://olcs_unused_var/external \"ol.source.Cluster\"","webpack://olcs_unused_var/external \"ol.source.Image\"","webpack://olcs_unused_var/external \"ol.source.ImageStatic\"","webpack://olcs_unused_var/external \"ol.source.ImageWMS\"","webpack://olcs_unused_var/external \"ol.source.TileImage\"","webpack://olcs_unused_var/external \"ol.source.TileWMS\"","webpack://olcs_unused_var/external \"ol.source.Vector\"","webpack://olcs_unused_var/external \"ol.style.Icon\""],"names":["AbstractSynchronizer","map","scene","view","getView","olLayers","getLayerGroup","getLayers","mapLayerGroup","layerMap","olLayerListenKeys","olGroupListenKeys_","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","layer","parents","olLayerWithParents","splice","olLayer","olLayerId","getUid","toString","console","assert","cesiumObjects","olLayerGroup","listenForGroupChanges_","createSingleLayerCounterparts","forEach","l","newOlLayerWithParents","concat","push","layerId","layerWithParents","onLayerChange","e","cesiumObjs","un","addCesiumObjects_","olcsListen","length","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","olObservableUnByKey","unlistenSingleGroup_","group","keys","key","removeLayer_","done","uuid","undefined","listenKeyArray","contentKeys","listenAddRemove","collection","on","event","element","bind","el","i","indexOf","removeAllCesiumObjects","objKey","object","destroy","AutoRenderLoop","ol3d","scene_","getCesiumScene","canvas_","canvas","_boundNotifyRepaintRequired","notifyRepaintRequired","repaintEventNames_","enable","requestRenderMode","maximumRenderTimeChange","repaintKey","addEventListener","window","getOlMap","disable","removeEventListener","restartRenderLoop","requestRender","Camera","cam_","camera","map_","view_","viewListenKey_","toLonLat_","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","input","opt_output","opt_dimension","dim","toLonLat","getTransform","getProjection","fromLonLat","handleViewEvent_","readFromView","setHeading","heading","setRotation","getHeading","rotation","getRotation","setTilt","tilt","updateCamera_","getTilt","setDistance","distance","updateView","getDistance","setCenter","center","getCenter","setPosition","position","ll","carto","Cesium","Cartographic","toRadians","getAltitude","setView","destination","Ellipsoid","WGS84","cartographicToCartesian","getPosition","cartesianToCartographic","pos","toDegrees","longitude","latitude","setAltitude","altitude","height","globe","getHeight","orientation","pitch","Math","PI_OVER_TWO","roll","moveBackward","checkCameraChange","resolution","getResolution","calcDistanceForResolution","ellipsoid","target","olcsCore","pickCenterPoint","bestTarget","positionCartographic","clone","Cartesian3","bestTargetCartographic","setResolution","calcResolutionForDistance","targetNormal","geocentricSurfaceNormal","targetToCamera","subtract","normalize","up","right","normal","y","x","angleBetween","cross","z","tiltAngle","acos","dot","isNaN","PI","opt_dontSync","old","current","viewMatrix","Matrix4","equalsEpsilon","fovy","frustum","metersPerUnit","getMetersPerUnit","visibleMapUnits","clientHeight","relativeCircumference","cos","abs","visibleMeters","requiredDistance","tan","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","evt","source","olSourceVector","cancellers","olcsUtil","obj","feature","id","canceller","hasOwnProperty","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","geometry","color","opt_lineWidth","createInstance","instance","GeometryInstance","ImageMaterialProperty","attributes","ColorGeometryInstanceAttribute","fromColor","options","flat","renderState","depthTest","enabled","lineWidth","instances","heightReference","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","constructor","GroundPrimitive","geometryInstances","Primitive","dataUri","image","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","type","uniforms","PerInstanceColorAppearance","extractColorFromOlStyle","style","outline","fillColor","getFill","getColor","strokeColor","getStroke","olColor","convertColorToCesium","extractLineWidthFromOlStyle","width","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","primitives","PrimitiveCollection","p1","add","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","billboards","bbOptions","eyeOffset","bb","olCircleGeometryToCesium","projection","olGeometryCloneTo4326","getType","point","slice","getRadius","ol4326CoordinateToCesiumCartesian","radius","CircleGeometry","outlinePrimitive","circlePolygon","olCreateCircularPolygon","positions","ol4326CoordinateArrayToCsCartesians","getLinearRing","getCoordinates","isGroundPolylinePrimitiveSupported","createStackedGroundCorridors","GroundPolylinePrimitive","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","readyPromise","then","_primitive","CircleOutlineGeometry","extrudedHeight","Array","isArray","max","previousDistance","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","linePositions","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","primitiveOptions","PolylineGeometry","olPolygonGeometryToCesium","getGeometry","get","coordinates","extent","boundingExtent","rectangle","Rectangle","fromDegrees","maxHeight","c","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","olPos","holes","PolygonGeometry","perPositionHeight","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","olStyleIcon","load","getImage","isImageLoaded","src","naturalHeight","naturalWidth","complete","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","opacity","getOpacity","Color","scale","getScale","anchor","getAnchor","pixelOffset","Cartesian2","cancelled","getSource","fuid","listener","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","Object","assign","cesiumOptions","model","Model","fromGltf","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","accumulate","geometries","functor","subgeos","getPoints","result","getLineStrings","getPolygons","labels","LabelCollection","extentCenter","getExtent","olGeomSimpleGeometry","first","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","font","getFont","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","horizontalOrigin","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","stroke","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getStyleFunction","getGeometryFromFeature","opt_geom","geom3d","olGeomGeometry","geomFuncRes","getGeometryFunction","olFeatureToCesium","context","geom","proj","newBillboardAddedCallback","featureBb","featureToCesiumMap","getGeometries","prims","bbs","result2","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","olSourceCluster","features","getFeatures","olcsCoreVectorLayerCounterpart","layerStyle","styles","prim","getRootPrimitive","convert","OLCesium","autoRenderLoop_","time_","time","JulianDate","now","to4326Transform_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","fillArea","container_","document","createElement","containerAttribute","createAttribute","value","setAttributeNode","targetElement","getElementById","appendChild","oc","getViewport","querySelector","parentNode","insertBefore","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","stopPropagation","canvasAttribute","supportsImageRenderingPixelated","imageRenderingValue","oncontextmenu","onselectstart","enabled_","pausedInteractions_","hiddenRootGroup_","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","UNIT_Z","camera_","olcsCamera","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","SingleTileImageryProvider","url","imageryLayers","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers","createSynchronizers","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","handleResize_","lastFrameTime_","renderId_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","BoundingSphere","eventHelper","EventHelper","postRender","prototype","updateTrackedEntity_","enableSuspendTerrainAdjustment","render_","cancelAnimationFrame","requestAnimationFrame","onAnimationFrame_","frameTime","interval","delta","julianDate","initializeFrame","update","trackedEntity","trackedState","getBoundingSphere","BoundingSphereState","DONE","render","state","PENDING","enableTilt","bs","FAILED","EntityView","mapProjection","clientWidth","resolutionScale","devicePixelRatio","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","visibility","interactions","throwOnUnitializedMap_","getInteractions","arr","clear","rootGroup","getVisible","setVisible","getOverlayContainer","classList","getOverlayContainerStopEvent","interaction","remove","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","olcsAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","defineProperties","defaultDataSource","entities","lookAtTransform","IDENTITY","to4326Transform","toCesiumPosition","olGeomPoint","coo","coo4326","CallbackProperty","TRANSPARENT","OverlaySynchronizer","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","olcsSynchronizedOverlay","synchronizer","parent","overlayId","removedOverlay","removeOverlay","csOverlay","RasterSynchronizer","cesiumLayers_","ourLayers_","ImageryLayerCollection","removeAll","convertLayerToCesiumImageries","viewProj","tileLayerToImageryLayer","olLayerItem","updateCesiumLayerProperties","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","stableSort","layer1","layer2","raiseToTop","olcsAbstractSynchronizer","SynchronizedOverlay","getOptions","scenePostRenderListenerRemover_","synchronizer_","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","setProperties","getProperties","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","set","getScene","removeNode","updatePixelPosition","container","stopEvent","insertFirst","handlePositionChanged","sourceProjection","getMap","transform","cloneNode","Node","TEXT_NODE","dispatchEvent","MouseEvent","nodes","removeChildren","getElement","clonedNode","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","occluder","Occluder","isPointVisible","cullingVolume","computeCullingVolume","direction","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","pixel","mapSize","updateRenderedPosition","olOverlay","VectorSynchronizer","opt_converter","converter","olcsFeatureConverter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","visible","layerVisible","show","olLayerVector","olLayerLayer","csPrimitives","olListenKeys","onAddFeature","olLayerImage","onRemoveFeature","Billboard","exports","promise","url_","Promise","resolve","reject","script","onload","onerror","head","Manager","cesiumUrl","cameraExtentInRadians","cesiumUrl_","boundingSphere_","blockLimiter_","promise_","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumLazyLoader","olcsContribLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","fromRectangle3D","instantiateOLCesium","configureForUsability","configureForPerformance","terrainProvider","createWorldTerrain","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","limitCameraToBoundingSphere","fromCartesian","ratio","currentlyFlying","flying","unblockLimiter","flyToBoundingSphere","cancel","toggle3d","is3DCurrentlyEnabled","resetToNorthZenith","rotateAroundBottomCenter","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","tiltOnGlobe","computeSignedTiltAngleOnGlobe","angle","bottom","pickBottomPoint","setHeadingUsingBottomCenter","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","magnitude","multiplyByScalar","flyTo","endTransform","getCameraExtentRectangle","olObservable","computePixelSizeAtCoordinate","pixelSize","getPixelDimensions","computeBoundingBoxAtTarget","amount","Transforms","eastNorthUpToFixedFrame","bottomLeft","multiplyByPoint","topRight","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","applyTransform","output","stride","createMatrixAtCoordinates","translation","ZERO","rawMatrix","quaternion","Quaternion","fromAxisAngle","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","axis","opt_options","clamp","defaultValue","duration","easing","linearEasing","callback","lastProgress","oldTransform","start","Date","step","timestamp","timeDifference","progress","stepAngle","rotate","bottomCenter","angleToZenith","computeAngleToZenith","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","fromTranslation","pickOnTerrainOrEllipsoid","ray","getPickRay","pick","pickEllipsoid","Ray","IntersectionTests","rayEllipsoid","getPoint","signedAngleBetween","convertLongitudeRange","bottomFovRay","fovy2","matrix","second","a","b","cosine","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","transformExtent","olMap","olLayerTile","provider","olSourceImageWMS","getUrl","getImageLoadFunction","defaultImageLoadFunction","sourceProps","olSourceTileWMS","attributions","getAttributions","params","getParams","olSourceTileImage","getSourceProjection","isCesiumProjection","olcsCoreOLImageryProvider","olSourceImageStatic","getImageExtent","layerOptions","forcedExtent","cesiumLayer","ImageryLayer","csLayer","layerOpacity","alpha","coordinate","toCartesian","cartesians","proj4326","properties","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","ctx","getContext","fillStyle","fillRect","convertUrlToCesium","subdomains","re","match","exec","replace","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","currentHeading","normalizeView","constrainResolution","is3857","is4326","OLImageryProvider","opt_fallbackProj","source_","projection_","fallbackProj_","ready_","tilingScheme_","rectangle_","proxy","proxy_","DefaultProxy","errorEvent_","Event","emptyCanvas_","handleSourceChanged_","frameState","getState","GeographicTilingScheme","WebMercatorTilingScheme","getTileCredits","level","calculateExtent","getSize","zoom","viewState","attributionsFunction","html","Credit","requestImage","tileUrlFunction","getTileUrlFunction","z_","y_","call","getURL","ImageryProvider","loadImage","tg","getTileGrid","getTileSize","getMaxZoom","VectorLayerCounterpart","layerProjection","BillboardCollection","rootCollection_","angleInRadians","angleInDegrees","param","supportsImageRenderingPixelatedResult_","imageRenderingValueResult_","setAttribute","tmp","observable","uidCounter_","olcs_uid","compareFnc","index","sort","removeChild","lastChild","isSupported"],"mappings":"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","file":"olcesium-debug.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.library.js\");\n","import OLCesium from './olcs/OLCesium.js';\n\nimport AbstractSynchronizer from './olcs/AbstractSynchronizer.js';\nimport RasterSynchronizer from './olcs/RasterSynchronizer.js';\nimport VectorSynchronizer from './olcs/VectorSynchronizer.js';\n\nimport * as core from './olcs/core.js';\nimport OLImageryProvider from './olcs/core/OLImageryProvider.js';\nimport VectorLayerCounterpart from './olcs/core/VectorLayerCounterpart.js';\n\nimport LazyLoader from './olcs/contrib/LazyLoader.js';\nimport Manager from './olcs/contrib/Manager.js';\n\n\nexport default OLCesium;\n\n// Using var for phantomJS\n// eslint-disable-next-line no-var\nvar olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nolcs.core = core.default;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nolcs.contrib.LazyLoader = LazyLoader;\nolcs.contrib.Manager = Manager;\n","/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {olcsListen, getUid} from './util.js';\n\n\nclass AbstractSynchronizer {\n  /**\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @template T\n   * @abstract\n   * @api\n   */\n  constructor(map, scene) {\n    /**\n     * @type {!ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.View}\n     * @protected\n     */\n    this.view = map.getView();\n\n    /**\n     * @type {!Cesium.Scene}\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * @type {ol.Collection.<ol.layer.Base>}\n     * @protected\n     */\n    this.olLayers = map.getLayerGroup().getLayers();\n\n    /**\n     * @type {ol.layer.Group}\n     */\n    this.mapLayerGroup = map.getLayerGroup();\n\n    /**\n     * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n     * Null value means, that we are unable to create equivalent layers.\n     * @type {Object.<string, ?Array.<T>>}\n     * @protected\n     */\n    this.layerMap = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer layers ids (from getUid).\n     * @type {!Object.<string, Array<ol.EventsKey>>}\n     * @protected\n     */\n    this.olLayerListenKeys = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer groups ids (from getUid).\n     * @type {!Object.<string, !Array.<ol.EventsKey>>}\n     * @private\n     */\n    this.olGroupListenKeys_ = {};\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   * @api\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @protected\n   */\n  orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  addLayers_(root) {\n    /** @type {Array<olcsx.LayerWithParents>} */\n    const fifo = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof olLayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = (e) => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   * @param {Array.<T>} cesiumObjects\n   * @param {string} layerId\n   * @param {ol.layer.Base} layer\n   * @private\n   */\n  addCesiumObjects_(cesiumObjects, layerId, layer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   * @private\n   */\n  removeAndDestroySingleLayer_(layer) {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  unlistenSingleGroup_(group) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  removeLayer_(root) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof olLayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  listenForGroupChanges_(group) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   * @protected\n   */\n  destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  addCesiumObject(object) {}\n\n  /**\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  destroyCesiumObject(object) {}\n\n  /**\n   * Remove single Cesium object from the collection.\n   * @param {!T} object\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeSingleCesiumObject(object, destroy) {}\n\n  /**\n   * Remove all Cesium objects from the collection.\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeAllCesiumObjects(destroy) {}\n\n  /**\n   * @param {olcsx.LayerWithParents} olLayerWithParents\n   * @return {?Array.<T>}\n   * @abstract\n   * @protected\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {}\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsCore from './core.js';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = olcsCore.pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    const canvas = this.scene_.canvas;\n    const fovy = this.cam_.frustum.fovy; // vertical field of view\n    console.assert(!isNaN(fovy));\n    const metersPerUnit = this.view_.getProjection().getMetersPerUnit();\n\n    // number of \"map units\" visible in 2D (vertically)\n    const visibleMapUnits = resolution * canvas.clientHeight;\n\n    // The metersPerUnit does not take latitude into account, but it should\n    // be lower with increasing latitude -- we have to compensate.\n    // In 3D it is not possible to maintain the resolution at more than one point,\n    // so it only makes sense to use the latitude of the \"target\" point.\n    const relativeCircumference = Math.cos(Math.abs(latitude));\n\n    // how many meters should be visible in 3D\n    const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n    // distance required to view the calculated length in meters\n    //\n    //  fovy/2\n    //    |\\\n    //  x | \\\n    //    |--\\\n    // visibleMeters/2\n    const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n    // NOTE: This calculation is not absolutely precise, because metersPerUnit\n    // is a great simplification. It does not take ellipsoid/terrain into account.\n\n    return requiredDistance;\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    // See the reverse calculation (calcDistanceForResolution) for details\n    const canvas = this.scene_.canvas;\n    const fovy = this.cam_.frustum.fovy;\n    const metersPerUnit = this.view_.getProjection().getMetersPerUnit();\n\n    const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n    const relativeCircumference = Math.cos(Math.abs(latitude));\n    const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n    const resolution = visibleMapUnits / canvas.clientHeight;\n\n    return resolution;\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil, {getUid, isGroundPolylinePrimitiveSupported} from './util.js';\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.PerInstanceColorAppearance(options);\n    }\n\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return olcsCore.convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          outlinePrimitive.readyPromise.then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        outlinePrimitive.readyPromise.then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            outlinePrimitive.readyPromise.then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale: imageStyle.getScale(),\n        heightReference,\n        position\n      });\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2(image.width / 2 - anchor[0], image.height / 2 - anchor[1]);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        const model = Cesium.Model.fromGltf(options);\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        modelPrimitive.add(model);\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = olcsCore.convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!olcsx.core.OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!olcsx.core.OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\nclass OLCesium {\n  /**\n   * @param {!olcsx.OLCesiumOptions} options Options.\n   * @constructor\n   * @api\n   */\n  constructor(options) {\n\n    /**\n     * @type {olcs.AutoRenderLoop}\n     * @private\n     */\n    this.autoRenderLoop_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = options.map;\n\n    /**\n     * @type {!function(): Cesium.JulianDate}\n     * @private\n     */\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     * @private\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.resolutionScale_ = 1.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientWidth_ = 0.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientHeight_ = 0.0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.resolutionScaleChanged_ = true; // force resize\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n    /**\n     * @type {!Element}\n     * @private\n     */\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || null;\n    if (targetElement) {\n      if (typeof targetElement === 'string') {\n        targetElement = document.getElementById(targetElement);\n      }\n      targetElement.appendChild(this.container_);\n    } else {\n      const oc = this.map_.getViewport().querySelector('.ol-overlaycontainer');\n      if (oc && oc.parentNode) {\n        oc.parentNode.insertBefore(this.container_, oc);\n      }\n    }\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * @type {boolean}\n     * @private\n     */\n    this.isOverMap_ = !targetElement;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n\n    /**\n     * @type {!HTMLCanvasElement}\n     * @private\n     */\n    this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (olcsUtil.supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() { return false; };\n    this.canvas_.onselectstart = function() { return false; };\n\n    this.container_.appendChild(this.canvas_);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * @type {!Array.<ol.interaction.Interaction>}\n     * @private\n     */\n    this.pausedInteractions_ = [];\n\n    /**\n     * @type {?ol.layer.Group}\n     * @private\n     */\n    this.hiddenRootGroup_ = null;\n\n    const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n      /** @type {Cesium.SceneOptions} */ ({});\n    sceneOptions.canvas = this.canvas_;\n    sceneOptions.scene3DOnly = true;\n\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.SHIFT\n    });\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.ALT\n    });\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    /**\n     * @type {!olcs.Camera}\n     * @private\n     */\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    /**\n     * @type {!Cesium.Globe}\n     * @private\n     */\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    const synchronizers = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = synchronizers.length - 1; i >= 0; --i) {\n      synchronizers[i].synchronize();\n    }\n\n    /**\n     * Time of the last rendered frame, as returned by `performance.now()`.\n     * @type {number}\n     * @private\n     */\n    this.lastFrameTime_ = 0;\n\n    /**\n     * The identifier returned by `requestAnimationFrame`.\n     * @type {number|undefined}\n     * @private\n     */\n    this.renderId_ = undefined;\n\n    /**\n     * Target frame rate for the render loop.\n     * @type {number}\n     * @private\n     */\n    this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n    /**\n     * If the Cesium render loop is being blocked.\n     * @type {boolean}\n     * @private\n     */\n    this.blockCesiumRendering_ = false;\n\n    /**\n     * If the warmup routine is active.\n     * @type {boolean}\n     * @private\n     */\n    this.warmingUp_ = false;\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.trackedFeature_ = null;\n\n    /**\n     * @type {Cesium.Entity}\n     * @private\n     */\n    this.trackedEntity_ = null;\n\n    /**\n     * @type {Cesium.EntityView}\n     * @private\n     */\n    this.entityView_ = null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.needTrackedEntityUpdate_ = false;\n\n    /**\n     * @type {!Cesium.BoundingSphere}\n     */\n    this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n\n    // Cesium has a mechanism to prevent the camera to go under the terrain.\n    // Unfortunately, it is only active when all the terrain has been loaded, which:\n    // - does not prevent the camera to sink under terrain anymore;\n    // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n    // The property below enables a workaround found in the Camptocamp Cesium fork.\n    // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n    Cesium.Camera.enableSuspendTerrainAdjustment = false;\n  }\n\n  /**\n   * Render the Cesium scene.\n   * @private\n   */\n  render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   * @private\n   */\n  onAnimationFrame_(frameTime) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === Cesium.BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  /**\n   * @private\n   */\n  updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === Cesium.BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  /**\n   * @private\n   */\n  handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 | height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!olcsUtil.supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    this.scene_.camera.frustum.aspectRatio = width / height;\n  }\n\n  /**\n   * @return {!olcs.Camera}\n   * @api\n   */\n  getCamera() {\n    return this.camera_;\n  }\n\n  /**\n   * @return {!ol.Map}\n   * @api\n   */\n  getOlMap() {\n    return this.map_;\n  }\n\n  /**\n   * @return {!ol.View}\n   * @api\n   */\n  getOlView() {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @return {!Cesium.Scene}\n   * @api\n   */\n  getCesiumScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceCollection}\n   * @api\n   */\n  getDataSources() {\n    return this.dataSourceCollection_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceDisplay}\n   * @api\n   */\n  getDataSourceDisplay() {\n    return this.dataSourceDisplay_;\n  }\n\n  /**\n   * @return {boolean}\n   * @api\n   */\n  getEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   * @param {boolean} enable\n   * @api\n   */\n  setEnabled(enable) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n        this.map_.getOverlayContainerStopEvent().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        this.map_.getOverlayContainerStopEvent().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n   * @api\n  */\n  warmUp(height, timeout) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n   * @api\n  */\n  setBlockCesiumRendering(block) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   * @api\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n   * @return {?olcs.AutoRenderLoop}\n   * @api\n  */\n  getAutoRenderLoop() {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   *\n   * @param {number} value\n   * @this {olcs.OLCesium}\n   * @api\n   */\n  setResolutionScale(value) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   * @api\n   */\n  setTargetFrameRate(value) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   * @private\n   */\n  throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n}\n\n\nObject.defineProperties(OLCesium.prototype, {\n  'trackedFeature': {\n    'get': /** @this {olcs.OLCesium} */ function() {\n      return this.trackedFeature_;\n    },\n    'set': /** @this {olcs.OLCesium} */ function(feature) {\n      if (this.trackedFeature_ !== feature) {\n\n        const scene = this.scene_;\n\n        //Stop tracking\n        if (!feature || !feature.getGeometry()) {\n          this.needTrackedEntityUpdate_ = false;\n          scene.screenSpaceCameraController.enableTilt = true;\n\n          if (this.trackedEntity_) {\n            this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n          }\n          this.trackedEntity_ = null;\n          this.trackedFeature_ = null;\n          this.entityView_ = null;\n          scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n          return;\n        }\n\n        this.trackedFeature_ = feature;\n\n        //We can't start tracking immediately, so we set a flag and start tracking\n        //when the bounding sphere is ready (most likely next frame).\n        this.needTrackedEntityUpdate_ = true;\n\n        const to4326Transform = this.to4326Transform_;\n        const toCesiumPosition = function() {\n          const geometry = feature.getGeometry();\n          console.assert(geometry instanceof olGeomPoint);\n          const coo = geometry.getCoordinates();\n          const coo4326 = to4326Transform(coo, undefined, coo.length);\n          return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n        };\n\n        // Create an invisible point entity for tracking.\n        // It is independant from the primitive/geometry created by the vector synchronizer.\n        const options = {\n          'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n          'point': {\n            'pixelSize': 1,\n            'color': Cesium.Color.TRANSPARENT\n          }\n        };\n\n        this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n      }\n    }\n  }\n});\n\n\nexport default OLCesium;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @constructor\n   * @extends {olcsAbstractSynchronizer.<Cesium.ImageryLayer>}\n   * @api\n   */\n  constructor(map, scene) {\n    super(map, scene);\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.cesiumLayers_ = scene.imageryLayers;\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(object) {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   * @param {!ol.layer.Base} olLayer\n   * @param {!ol.proj.Projection} viewProj Projection of the view.\n   * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n   * (or supported)\n   * @protected\n   */\n  convertLayerToCesiumImageries(olLayer, viewProj) {\n    const result = olcsCore.tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices = {};\n    const queue = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex();\n\n      if (olLayer instanceof olLayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  /**\n   * @param {Cesium.ImageryLayer} counterpart\n   */\n  raiseToTop(counterpart) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @param {olcs.FeatureConverter=} opt_converter\n   * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n   * @api\n   */\n  constructor(map, scene, opt_converter) {\n    super(map, scene);\n\n    /**\n     * @protected\n     */\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n    /**\n     * @private\n     */\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(counterpart) {\n    console.assert(counterpart);\n    counterpart.getRootPrimitive()['counterpart'] = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.getRootPrimitive().destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   * @param {olcsx.LayerWithParents} olLayerWithParents\n   * @param {!Cesium.Primitive} csPrimitive\n   */\n  updateLayerVisibility(olLayerWithParents, csPrimitive) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible &= layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector)) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap = {};\n    const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature) {\n      console.assert(\n          (olLayer instanceof olLayerVector) ||\n          (olLayer instanceof olLayerImage)\n      );\n      const context = counterpart.context;\n      const prim = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature) {\n      const id = getUid(feature);\n      const context = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }, this));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.contrib.LazyLoader\n */\nconst exports = class {\n  /**\n   * @param {string} url\n   * @struct\n   * @api\n   */\n  constructor(url) {\n    /**\n     * @type {Promise<undefined>}\n     * @protected\n     */\n    this.promise;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = url;\n  }\n\n  /**\n   * @return {Promise<undefined>}\n   * @api\n   */\n  load() {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n};\n\n\nexport default exports;\n","/**\n * @module olcs.contrib.Manager\n */\nimport olcsContribLazyLoader from '../contrib/LazyLoader.js';\nimport OLCesium from '../OLCesium.js';\nimport olcsCore from '../core.js';\nimport {toRadians} from '../math.js';\nimport olObservable from 'ol/Observable.js';\n\nconst Manager = class extends olObservable {\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl, {map, cameraExtentInRadians} = {}) {\n\n    super();\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumUrl_ = cesiumUrl;\n\n    /**\n     * @type {ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.Extent}\n     * @protected\n     */\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n\n    /**\n     * @private\n     * @type {Cesium.BoundingSphere}\n     */\n    this.boundingSphere_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.blockLimiter_ = false;\n\n    /**\n     * @type {Promise.<olcs.OLCesium>}\n     * @private\n     */\n    this.promise_;\n\n    /**\n     * @type {olcs.OLCesium}\n     * @protected\n     */\n    this.ol3d;\n\n\n    /**\n     * @const {number} Tilt angle in radians\n     * @private\n     */\n    this.cesiumInitialTilt_ = toRadians(50);\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogDensity = 0.0001;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogSSEFactor = 25;\n\n    /**\n     * Limit the minimum distance to the terrain to 2m.\n     * @protected\n     * @type {number}\n     */\n    this.minimumZoomDistance = 2;\n\n    /**\n     * Limit the maximum distance to the earth to 10'000km.\n     * @protected\n     * @type {number}\n     */\n    this.maximumZoomDistance = 10000000;\n\n    // when closer to 3000m, restrict the available positions harder\n    /**\n     * @protected\n     * @param {number} height\n     */\n    this.limitCameraToBoundingSphereRatio = height => (height > 3000 ? 9 : 3);\n  }\n\n\n  /**\n   * @return {Promise.<olcs.OLCesium>}\n   */\n  load() {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * @protected\n   * @return {olcs.OLCesium}\n   */\n  onCesiumLoaded() {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   * @return {olcs.OLCesium}\n   */\n  instantiateOLCesium() {\n    console.assert(this.map);\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    const terrainProvider = Cesium.createWorldTerrain();\n    scene.terrainProvider = terrainProvider;\n    return ol3d;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForPerformance(scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForUsability(scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this), scene);\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   * @protected\n   */\n  limitCameraToBoundingSphere() {\n    if (this.boundingSphere_ && !this.blockLimiter_) {\n      const scene = this.ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      const ratio = this.limitCameraToBoundingSphereRatio(carto.height);\n      if (Cesium.Cartesian3.distance(this.boundingSphere_.center, position) > this.boundingSphere_.radius * ratio) {\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          this.blockLimiter_ = true;\n          const unblockLimiter = () => this.blockLimiter_ = false;\n          camera.flyToBoundingSphere(this.boundingSphere_, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter\n          });\n        }\n      }\n    }\n  }\n\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   * @export\n   * @return {Promise<undefined>}\n   */\n  toggle3d() {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return olcsCore.resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return olcsCore.rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   *\n   * @export\n   * @param {number} lon\n   * @param {number} lat\n   * @param {number} elevation\n   * @param {number} headingDeg Heading value in degrees.\n   * @param {number} pitchDeg Pitch value in degrees.\n   * @returns {Promise<undefined>}\n   */\n  set3dWithView(lon, lat, elevation, headingDeg, pitchDeg) {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * @export\n   * @return {boolean}\n   */\n  is3dEnabled() {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading() {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = olcsCore.computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * @param {number} angle\n   */\n  setHeading(angle) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = olcsCore.pickBottomPoint(scene);\n    if (bottom) {\n      olcsCore.setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  /**\n   * @export\n   * @return {olcs.OLCesium}\n   */\n  getOl3d() {\n    return this.ol3d;\n  }\n\n  /**\n   * @export\n   * @return {!ol.View}\n   */\n  getOlView() {\n    const view = this.map.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @export\n   * @return {Cesium.Matrix4}\n   */\n  getCesiumViewMatrix() {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  /**\n   * @export\n   * @return {!Cesium.Scene}\n   */\n  getCesiumScene() {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * @export\n   * @param {!Cesium.Rectangle} rectangle\n   * @param {number=} offset in meters\n   * @return {Promise<undefined>}\n   */\n  flyToRectangle(rectangle, offset = 0) {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n\n  /**\n   * @protected\n   * @return {Cesium.Rectangle|undefined}\n   */\n  getCameraExtentRectangle() {\n    if (this.cameraExtentInRadians) {\n      return new Cesium.Rectangle(...this.cameraExtentInRadians);\n    }\n  }\n};\n\n\nexport default Manager;\n","/**\n * @module olcs.core\n */\nconst exports = {};\nimport {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport olcsUtil from './util.js';\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @return {!Cesium.Cartesian2} the pixel size\n * @api\n */\nexports.computePixelSizeAtCoordinate = function(scene, target) {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  const pixelSize = new Cesium.Cartesian2();\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight,\n      distance, pixelSize);\n};\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexports.computeBoundingBoxAtTarget = function(scene, target, amount) {\n  const pixelSize = exports.computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n};\n\n\n/**\n *\n * @param {!ol.geom.Geometry} geometry\n * @param {number} height\n * @api\n */\nexports.applyHeightOffsetToGeometry = function(geometry, height) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n};\n\n\n/**\n * @param {ol.Coordinate} coordinates\n * @param {number=} rotation\n * @param {!Cesium.Cartesian3=} translation\n * @param {!Cesium.Cartesian3=} scale\n * @return {!Cesium.Matrix4}\n * @api\n */\nexports.createMatrixAtCoordinates = function(coordinates, rotation = 0, translation = Cesium.Cartesian3.ZERO, scale = new Cesium.Cartesian3(1, 1, 1)) {\n  const position = exports.ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n};\n\n\n/**\n * @param {!Cesium.Camera} camera\n * @param {number} angle\n * @param {!Cesium.Cartesian3} axis\n * @param {!Cesium.Matrix4} transform\n * @param {olcsx.core.RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.rotateAroundAxis = function(camera, angle, axis, transform,\n    opt_options) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options = opt_options || {};\n  const duration = defaultValue(options.duration, 500); // ms\n  const easing = defaultValue(options.easing, linearEasing);\n  const callback = options.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} heading\n * @param {!Cesium.Cartesian3} bottomCenter\n * @param {olcsx.core.RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.setHeadingUsingBottomCenter = function(scene, heading,\n    bottomCenter, opt_options) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = exports.computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  const rotateAroundAxis = exports.rotateAroundAxis;\n  rotateAroundAxis(camera, heading, zenith, transform, opt_options);\n};\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian2} pixel\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickOnTerrainOrEllipsoid = function(scene, pixel) {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n};\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickBottomPoint = function(scene) {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return exports.pickOnTerrainOrEllipsoid(scene, bottom);\n};\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickCenterPoint = function(scene) {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return exports.pickOnTerrainOrEllipsoid(scene, center);\n};\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n * intersection of the camera direction with the globe.\n * @param {!Cesium.Scene} scene\n * @return {number|undefined}\n * @api\n */\nexports.computeSignedTiltAngleOnGlobe = function(scene) {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = exports.signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n};\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Ray}\n */\nexports.bottomFovRay = function(scene) {\n  const camera = scene.camera;\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n};\n\n\n/**\n * Compute the angle between two Cartesian3.\n * @param {!Cesium.Cartesian3} first\n * @param {!Cesium.Cartesian3} second\n * @param {!Cesium.Cartesian3} normal Normal to test orientation against.\n * @return {number}\n */\nexports.signedAngleBetween = function(first, second, normal) {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n};\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} pivot Point around which the camera rotates.\n * @return {number}\n * @api\n */\nexports.computeAngleToZenith = function(scene, pivot) {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  const fy = camera.frustum.fovy / 2;\n  const ray = exports.bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = exports.signedAngleBetween(normal, direction, left);\n  return a + fy;\n};\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n * @api\n */\nexports.extentToRectangle = function(extent, projection) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and static images\n * @param {!ol.Map} olMap\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Cesium.ImageryLayer} null if not possible (or supported)\n * @api\n */\nexports.tileLayerToImageryLayer = function(olMap, olLayer, viewProj) {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage)) {\n    return null;\n  }\n\n  let provider = null;\n  let source = olLayer.getSource();\n\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n    source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection)) {\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle: new Cesium.Rectangle.fromDegrees(\n            source.getImageExtent()[0],\n            source.getImageExtent()[1],\n            source.getImageExtent()[2],\n            source.getImageExtent()[3]\n        )\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else {\n    // sources other than TileImage|ImageStatic are currently not supported\n    return null;\n  }\n\n  // the provider is always non-null if we got this far\n\n  const layerOptions = {};\n\n  const forcedExtent = /** @type {ol.Extent} */ (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = exports.extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n};\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.ImageryLayer} csLayer\n * @api\n */\nexports.updateCesiumLayerProperties = function(olLayerWithParents, csLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n};\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n * @param {ol.Coordinate} coordinate Ol3 coordinate.\n * @return {!Cesium.Cartesian3} Cesium cartesian coordinate\n * @api\n */\nexports.ol4326CoordinateToCesiumCartesian = function(coordinate) {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n};\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n * @param {Array.<!ol.Coordinate>} coordinates Ol3 coordinates.\n * @return {!Array.<Cesium.Cartesian3>} Cesium cartesian coordinates\n * @api\n */\nexports.ol4326CoordinateArrayToCsCartesians = function(coordinates) {\n  console.assert(coordinates !== null);\n  const toCartesian = exports.ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n};\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n * @param {!T} geometry\n * @param {!ol.ProjectionLike} projection\n * @return {!T}\n * @template T\n * @api\n */\nexports.olGeometryCloneTo4326 = function(geometry, projection) {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj !== proj4326) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n};\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n * @param {ol.Color|CanvasGradient|CanvasPattern|string} olColor\n * @return {!Cesium.Color}\n * @api\n */\nexports.convertColorToCesium = function(olColor) {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n};\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n * @param {string} url\n * @return {!olcsx.core.CesiumUrlDefinition}\n * @api\n */\nexports.convertUrlToCesium = function(url) {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n};\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @return {Promise<undefined>}\n * @api\n */\nexports.resetToNorthZenith = function(map, scene) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = exports.computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    exports.setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options = {\n      callback: () => {\n        const view = map.getView();\n        exports.normalizeView(view);\n        resolve();\n      }\n    };\n    exports.rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexports.rotateAroundBottomCenter = function(scene, angle) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options = {callback: resolve};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const rotateAroundAxis = exports.rotateAroundAxis;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n * @param {ol.View} view\n * @param {number=} angle\n * @api\n */\nexports.normalizeView = function(view, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n  view.setResolution(view.constrainResolution(resolution));\n};\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n *\n * @param {ol.proj.Projection} projection Projection to check.\n * @returns {boolean} Whether it's managed by Cesium.\n */\nexports.isCesiumProjection = function(projection) {\n  const is3857 = projection === getProjection('EPSG:3857');\n  const is4326 = projection === getProjection('EPSG:4326');\n  return is3857 || is4326;\n};\n\n\nexport default exports;\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport {get as getProjection} from 'ol/proj.js';\nimport olcsUtil from '../util.js';\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.Map} olMap\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(olMap, source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = null;\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = olMap;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_(frameState) {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = olcsUtil.getSourceProjection(this.source_) || this.fallbackProj_;\n      if (this.projection_ == getProjection('EPSG:4326')) {\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme();\n      } else if (this.projection_ == getProjection('EPSG:3857')) {\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme();\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.tilingScheme_ instanceof Cesium.GeographicTilingScheme ? level + 1 : level;\n\n    const frameState = {\n      viewState: {zoom, center},\n      extent,\n    };\n\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    let attributions = attributionsFunction(frameState);\n    if (!Array.isArray(attributions)) {\n      attributions = [attributions];\n    }\n\n    return attributions.map(html => new Cesium.Credit(html, true));\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      // Perform mapping of Cesium tile coordinates to OpenLayers tile coordinates:\n      // 1) Cesium zoom level 0 is OpenLayers zoom level 1 for EPSG:4326\n      const z_ = this.tilingScheme_ instanceof Cesium.GeographicTilingScheme ? level + 1 : level;\n      // 2) OpenLayers tile coordinates increase from bottom to top\n      const y_ = -y - 1;\n\n      let url = tileUrlFunction.call(this.source_,\n          [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\nclass VectorLayerCounterpart {\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  * @param {!(ol.proj.Projection|string)} layerProjection\n  * @param {!Cesium.Scene} scene\n  */\n  constructor(layerProjection, scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n\n    /**\n    * @type {!Array.<ol.EventsKey>}\n    */\n    this.olListenKeys = [];\n\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    /**\n    * @type {!olcsx.core.OlFeatureToCesiumContext}\n    */\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  /**\n  * @return {!Cesium.Primitive}\n  */\n  getRootPrimitive() {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.util\n */\nconst exports = {};\n\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexports.obj = function(param) {\n  return param;\n};\n\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nexports.supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nexports.imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexports.supportsImageRenderingPixelated = function() {\n  if (exports.supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    exports.supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (exports.supportsImageRenderingPixelatedResult_) {\n      exports.imageRenderingValueResult_ = tmp;\n    }\n  }\n  return exports.supportsImageRenderingPixelatedResult_;\n};\n\n\n/**\n * @return {string}\n */\nexports.imageRenderingValue = function() {\n  exports.supportsImageRenderingPixelated();\n  return exports.imageRenderingValueResult_ || '';\n};\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexports.getSourceProjection = function(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n    || source.getProjection();\n};\n\n/**\n * @param {ol.Observable} observable\n * @param {string} type\n * @param {Function} listener\n * @return {!ol.events.EventsKey}\n */\nexport function olcsListen(observable, type, listener) {\n  // See https://github.com/openlayers/openlayers/pull/8481\n  // ol.events.listen is internal so we use `on` instead.\n  // And since `on` as a convoluted API (can return an EventsKey or an array of them)\n  // we use a cast here.\n  return /** @type {!ol.events.EventsKey} */ (observable.on(type, listener));\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\n/**\n * Sort the passed array such that the relative order of equal elements is preverved.\n * See https://en.wikipedia.org/wiki/Sorting_algorithm#Stability for details.\n * @param {Array<*>} arr The array to sort (modifies original).\n * @param {!function(*, *): number} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  for (let i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort((a, b) => compareFnc(a.value, b.value) || a.index - b.index);\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\n/**\n * @param {Cesium.Scene} scene The scene.\n */\nexport function isGroundPolylinePrimitiveSupported(scene) {\n  const obj = Cesium.GroundPolylinePrimitive;\n  return obj && obj.isSupported(scene);\n}\n\nexport default exports;\n","module.exports = ol.Observable;","module.exports = ol.Overlay;","module.exports = ol.easing;","module.exports = ol.extent;","module.exports = ol.geom.Geometry;","module.exports = ol.geom.Point;","module.exports = ol.geom.Polygon;","module.exports = ol.geom.SimpleGeometry;","module.exports = ol.layer.Group;","module.exports = ol.layer.Image;","module.exports = ol.layer.Layer;","module.exports = ol.layer.Tile;","module.exports = ol.layer.Vector;","module.exports = ol.proj;","module.exports = ol.source.Cluster;","module.exports = ol.source.Image;","module.exports = ol.source.ImageStatic;","module.exports = ol.source.ImageWMS;","module.exports = ol.source.TileImage;","module.exports = ol.source.TileWMS;","module.exports = ol.source.Vector;","module.exports = ol.style.Icon;"],"sourceRoot":""}